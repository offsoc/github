{"version":3,"file":"audit-log-stafftools-async-xxxxxxxxxxxx.js","mappings":"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","sources":["app/assets/modules/audit-log-stafftools-async.ts","node_modules/@github/include-fragment-element/dist/include-fragment-element.js","node_modules/@github/include-fragment-element/dist/include-fragment-element-define.js"],"sourcesContent":["import {controller, target} from '@github/catalyst'\nimport './github/audit-log/audit-log-search-input'\nimport {IncludeFragmentElement} from '@github/include-fragment-element'\n\nclass AsyncQueryStartRequest {\n  query_id: string\n  results_url: string\n  status_url: string\n}\n\n@controller\nclass AsyncAuditLogElement extends HTMLElement {\n  targetFetch: IncludeFragmentElement\n  @target spinner: HTMLElement\n  @target warning: HTMLElement\n  @target error: HTMLElement\n  @target resultsError: HTMLElement\n\n  closeWarning() {\n    this.warning.hidden = true\n  }\n\n  showWarning() {\n    this.warning.hidden = false\n  }\n\n  closeError() {\n    this.error.hidden = true\n  }\n\n  showError() {\n    this.error.hidden = false\n  }\n\n  closeResultsError() {\n    this.resultsError.hidden = true\n  }\n\n  showResults(resultsUrl: string) {\n    try {\n      this.targetFetch = new IncludeFragmentElement()\n      this.targetFetch.setAttribute('src', resultsUrl)\n      this.appendChild(this.targetFetch)\n    } catch (error) {\n      this.showError()\n\n      return\n    }\n  }\n\n  async connectedCallback() {\n    await this.startAndFetchAsyncQuery()\n  }\n\n  private async startAndFetchAsyncQuery() {\n    const spinner = this.spinner\n    const csrfInput = document.querySelector<HTMLInputElement>('.js-data-url-csrf')!\n    const jsonDownload = document.querySelector<HTMLElement>('.js-download-button')!\n\n    // Show/hide loading state. Set to `true` to hide menu and show loading state.\n    function loading(toggle: boolean) {\n      spinner.hidden = !toggle\n    }\n\n    const start_url = this.getAttribute('data-url')!\n    let response: AsyncQueryStartRequest\n    const wants = await fetch(\n      new Request(start_url, {\n        method: 'POST',\n        mode: 'same-origin',\n        headers: {\n          Accept: 'application/json',\n          'Scoped-CSRF-Token': csrfInput.value,\n          'X-Requested-With': ',XMLHttpRequest',\n        },\n      }),\n    )\n\n    if (wants.ok) {\n      response = await wants.json()\n    } else if (wants.status === 429) {\n      this.showWarning()\n      return\n    } else {\n      this.showError()\n      return\n    }\n\n    // Loading results\n    loading(true)\n\n    try {\n      await fetchPoll(response.status_url, 2000)\n    } catch (error) {\n      loading(false)\n      this.showError()\n      return\n    }\n\n    loading(false)\n    this.showResults(response.results_url)\n    jsonDownload.hidden = false\n  }\n}\n\nfunction fetchPoll(url: string, pollIntervalMs: number) {\n  return new Promise((resolve, reject) => {\n    setTimeout(async () => {\n      const request = new Request(url)\n      request.headers.append('X-Requested-With', 'XMLHttpRequest')\n      const response = await fetch(request)\n      if (response.status === 200) {\n        // Resource is ready.\n        resolve(response)\n      } else if (response.status === 202) {\n        resolve(fetchPoll(url, pollIntervalMs))\n      } else {\n        // Something unexpected happened.\n        reject(response)\n      }\n    }, pollIntervalMs) // Poll the endpoint every intervalMs\n  })\n}\n","var __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n};\nvar _IncludeFragmentElement_instances, _IncludeFragmentElement_busy, _IncludeFragmentElement_observer, _IncludeFragmentElement_handleData, _IncludeFragmentElement_getData, _IncludeFragmentElement_getStringOrErrorData, _IncludeFragmentElement_task, _IncludeFragmentElement_fetchDataWithEvents;\nconst privateData = new WeakMap();\nfunction isWildcard(accept) {\n    return accept && !!accept.split(',').find(x => x.match(/^\\s*\\*\\/\\*/));\n}\nlet cspTrustedTypesPolicyPromise = null;\nexport class IncludeFragmentElement extends HTMLElement {\n    constructor() {\n        super(...arguments);\n        _IncludeFragmentElement_instances.add(this);\n        _IncludeFragmentElement_busy.set(this, false);\n        _IncludeFragmentElement_observer.set(this, new IntersectionObserver(entries => {\n            for (const entry of entries) {\n                if (entry.isIntersecting) {\n                    const { target } = entry;\n                    __classPrivateFieldGet(this, _IncludeFragmentElement_observer, \"f\").unobserve(target);\n                    if (!(target instanceof IncludeFragmentElement))\n                        return;\n                    if (target.loading === 'lazy') {\n                        __classPrivateFieldGet(this, _IncludeFragmentElement_instances, \"m\", _IncludeFragmentElement_handleData).call(this);\n                    }\n                }\n            }\n        }, {\n            rootMargin: '0px 0px 256px 0px',\n            threshold: 0.01,\n        }));\n    }\n    static define(tag = 'include-fragment', registry = customElements) {\n        registry.define(tag, this);\n        return this;\n    }\n    static setCSPTrustedTypesPolicy(policy) {\n        cspTrustedTypesPolicyPromise = policy === null ? policy : Promise.resolve(policy);\n    }\n    static get observedAttributes() {\n        return ['src', 'loading'];\n    }\n    get src() {\n        const src = this.getAttribute('src');\n        if (src) {\n            const link = this.ownerDocument.createElement('a');\n            link.href = src;\n            return link.href;\n        }\n        else {\n            return '';\n        }\n    }\n    set src(val) {\n        this.setAttribute('src', val);\n    }\n    get loading() {\n        if (this.getAttribute('loading') === 'lazy')\n            return 'lazy';\n        return 'eager';\n    }\n    set loading(value) {\n        this.setAttribute('loading', value);\n    }\n    get accept() {\n        return this.getAttribute('accept') || '';\n    }\n    set accept(val) {\n        this.setAttribute('accept', val);\n    }\n    get data() {\n        return __classPrivateFieldGet(this, _IncludeFragmentElement_instances, \"m\", _IncludeFragmentElement_getStringOrErrorData).call(this);\n    }\n    attributeChangedCallback(attribute, oldVal) {\n        if (attribute === 'src') {\n            if (this.isConnected && this.loading === 'eager') {\n                __classPrivateFieldGet(this, _IncludeFragmentElement_instances, \"m\", _IncludeFragmentElement_handleData).call(this);\n            }\n        }\n        else if (attribute === 'loading') {\n            if (this.isConnected && oldVal !== 'eager' && this.loading === 'eager') {\n                __classPrivateFieldGet(this, _IncludeFragmentElement_instances, \"m\", _IncludeFragmentElement_handleData).call(this);\n            }\n        }\n    }\n    connectedCallback() {\n        if (!this.shadowRoot) {\n            this.attachShadow({ mode: 'open' });\n            const style = document.createElement('style');\n            style.textContent = `:host {display: block;}`;\n            this.shadowRoot.append(style, document.createElement('slot'));\n        }\n        if (this.src && this.loading === 'eager') {\n            __classPrivateFieldGet(this, _IncludeFragmentElement_instances, \"m\", _IncludeFragmentElement_handleData).call(this);\n        }\n        if (this.loading === 'lazy') {\n            __classPrivateFieldGet(this, _IncludeFragmentElement_observer, \"f\").observe(this);\n        }\n    }\n    request() {\n        const src = this.src;\n        if (!src) {\n            throw new Error('missing src');\n        }\n        return new Request(src, {\n            method: 'GET',\n            credentials: 'same-origin',\n            headers: {\n                Accept: this.accept || 'text/html',\n            },\n        });\n    }\n    load() {\n        return __classPrivateFieldGet(this, _IncludeFragmentElement_instances, \"m\", _IncludeFragmentElement_getStringOrErrorData).call(this);\n    }\n    fetch(request) {\n        return fetch(request);\n    }\n    refetch() {\n        privateData.delete(this);\n        __classPrivateFieldGet(this, _IncludeFragmentElement_instances, \"m\", _IncludeFragmentElement_handleData).call(this);\n    }\n}\n_IncludeFragmentElement_busy = new WeakMap(), _IncludeFragmentElement_observer = new WeakMap(), _IncludeFragmentElement_instances = new WeakSet(), _IncludeFragmentElement_handleData = async function _IncludeFragmentElement_handleData() {\n    if (__classPrivateFieldGet(this, _IncludeFragmentElement_busy, \"f\"))\n        return;\n    __classPrivateFieldSet(this, _IncludeFragmentElement_busy, true, \"f\");\n    __classPrivateFieldGet(this, _IncludeFragmentElement_observer, \"f\").unobserve(this);\n    try {\n        const data = await __classPrivateFieldGet(this, _IncludeFragmentElement_instances, \"m\", _IncludeFragmentElement_getData).call(this);\n        if (data instanceof Error) {\n            throw data;\n        }\n        const dataTreatedAsString = data;\n        const template = document.createElement('template');\n        template.innerHTML = dataTreatedAsString;\n        const fragment = document.importNode(template.content, true);\n        const canceled = !this.dispatchEvent(new CustomEvent('include-fragment-replace', {\n            cancelable: true,\n            detail: { fragment },\n        }));\n        if (canceled) {\n            __classPrivateFieldSet(this, _IncludeFragmentElement_busy, false, \"f\");\n            return;\n        }\n        this.replaceWith(fragment);\n        this.dispatchEvent(new CustomEvent('include-fragment-replaced'));\n    }\n    catch (_a) {\n        this.classList.add('is-error');\n    }\n    finally {\n        __classPrivateFieldSet(this, _IncludeFragmentElement_busy, false, \"f\");\n    }\n}, _IncludeFragmentElement_getData = async function _IncludeFragmentElement_getData() {\n    const src = this.src;\n    const cachedData = privateData.get(this);\n    if (cachedData && cachedData.src === src) {\n        return cachedData.data;\n    }\n    else {\n        let data;\n        if (src) {\n            data = __classPrivateFieldGet(this, _IncludeFragmentElement_instances, \"m\", _IncludeFragmentElement_fetchDataWithEvents).call(this);\n        }\n        else {\n            data = Promise.reject(new Error('missing src'));\n        }\n        privateData.set(this, { src, data });\n        return data;\n    }\n}, _IncludeFragmentElement_getStringOrErrorData = async function _IncludeFragmentElement_getStringOrErrorData() {\n    const data = await __classPrivateFieldGet(this, _IncludeFragmentElement_instances, \"m\", _IncludeFragmentElement_getData).call(this);\n    if (data instanceof Error) {\n        throw data;\n    }\n    return data.toString();\n}, _IncludeFragmentElement_task = async function _IncludeFragmentElement_task(eventsToDispatch) {\n    await new Promise(resolve => setTimeout(resolve, 0));\n    for (const eventType of eventsToDispatch) {\n        this.dispatchEvent(new Event(eventType));\n    }\n}, _IncludeFragmentElement_fetchDataWithEvents = async function _IncludeFragmentElement_fetchDataWithEvents() {\n    try {\n        await __classPrivateFieldGet(this, _IncludeFragmentElement_instances, \"m\", _IncludeFragmentElement_task).call(this, ['loadstart']);\n        const response = await this.fetch(this.request());\n        if (response.status !== 200) {\n            throw new Error(`Failed to load resource: the server responded with a status of ${response.status}`);\n        }\n        const ct = response.headers.get('Content-Type');\n        if (!isWildcard(this.accept) && (!ct || !ct.includes(this.accept ? this.accept : 'text/html'))) {\n            throw new Error(`Failed to load resource: expected ${this.accept || 'text/html'} but was ${ct}`);\n        }\n        const responseText = await response.text();\n        let data = responseText;\n        if (cspTrustedTypesPolicyPromise) {\n            const cspTrustedTypesPolicy = await cspTrustedTypesPolicyPromise;\n            data = cspTrustedTypesPolicy.createHTML(responseText, response);\n        }\n        __classPrivateFieldGet(this, _IncludeFragmentElement_instances, \"m\", _IncludeFragmentElement_task).call(this, ['load', 'loadend']);\n        return data;\n    }\n    catch (error) {\n        __classPrivateFieldGet(this, _IncludeFragmentElement_instances, \"m\", _IncludeFragmentElement_task).call(this, ['error', 'loadend']);\n        throw error;\n    }\n};\n","import { IncludeFragmentElement } from './include-fragment-element.js';\nconst root = (typeof globalThis !== 'undefined' ? globalThis : window);\ntry {\n    root.IncludeFragmentElement = IncludeFragmentElement.define();\n}\ncatch (e) {\n    if (!(root.DOMException && e instanceof DOMException && e.name === 'NotSupportedError') &&\n        !(e instanceof ReferenceError)) {\n        throw e;\n    }\n}\nexport default IncludeFragmentElement;\nexport * from './include-fragment-element.js';\n"],"names":["AsyncAuditLogElement","HTMLElement","closeWarning","warning","hidden","showWarning","closeError","error","showError","closeResultsError","resultsError","showResults","resultsUrl","targetFetch","IncludeFragmentElement","setAttribute","appendChild","connectedCallback","startAndFetchAsyncQuery","response","spinner","csrfInput","document","querySelector","jsonDownload","loading","toggle","start_url","getAttribute","wants","fetch","Request","method","mode","headers","Accept","value","ok","json","status","fetchPoll","url","pollIntervalMs","Promise","resolve","reject","setTimeout","request","append","status_url","results_url","target","controller","_IncludeFragmentElement_instances","_IncludeFragmentElement_busy","_IncludeFragmentElement_observer","_IncludeFragmentElement_handleData","_IncludeFragmentElement_getData","_IncludeFragmentElement_getStringOrErrorData","_IncludeFragmentElement_task","_IncludeFragmentElement_fetchDataWithEvents","__classPrivateFieldGet","receiver","state","kind","f","has","call","get","__classPrivateFieldSet","set","privateData","WeakMap","cspTrustedTypesPolicyPromise","constructor","arguments","add","IntersectionObserver","entries","entry","isIntersecting","unobserve","rootMargin","threshold","define","tag","registry","customElements","setCSPTrustedTypesPolicy","policy","observedAttributes","src","link","ownerDocument","createElement","href","val","accept","data","attributeChangedCallback","attribute","oldVal","isConnected","shadowRoot","attachShadow","style","textContent","observe","credentials","load","refetch","delete","WeakSet","Error","template","innerHTML","fragment","importNode","content","dispatchEvent","CustomEvent","cancelable","detail","replaceWith","_a","classList","cachedData","toString","eventsToDispatch","eventType","Event","ct","split","find","x","match","includes","responseText","text","cspTrustedTypesPolicy","createHTML","root","globalThis","window","e","DOMException","name","ReferenceError"],"sourceRoot":""}