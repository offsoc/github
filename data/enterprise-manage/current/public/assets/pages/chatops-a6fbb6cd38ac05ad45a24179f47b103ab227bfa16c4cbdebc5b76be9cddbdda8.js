(function(){window.forms={checkInputRadioField:function(){var t,e,a;return a=(t=$(this)).data("value"),"string"==typeof(e=$(t.data("input-field-id")).val())&&0!==e.length?t.val(a):t.val("")},setActiveRadioItem:function(){return $(this).parent().addClass("active").siblings().removeClass("active")},setActiveCheckboxItem:function(){return $(this).parent().toggleClass("active")}},$(function(){return $(document).ready(function(){return $(".radio-item input:checked, .checkbox-item input:checked").parent().addClass("active"),$(".radio-item input").click(forms.setActiveRadioItem),$(".checkbox-item input").click(forms.setActiveCheckboxItem)})})}).call(this),function(){$(document).ready(function(){function t(t){return $button=$(t.target),$form=$button.parents("form"),$container=$("#chatops"),$loading=$(".js-saveing-client-settings"),$results=$("#chatops_save_result"),$results.empty().hide(),$loading.show(),csrf=$("input[name=_csrf]").val(),{$button:$button,$form:$form,$container:$container,$loading:$loading,$results:$results,csrf:csrf}}function e(){$("#chatops-slack-config-token-section").show(),$("#chatops-slack-socket-section").hide(),$("#chatops-slack-app-section").hide(),$("#chatops-save-config").hide(),$("#chatops-slack-app-link").attr("href","#"),$("#chatops-slack-app-link").text(""),$("#chatops-slack-app-level-token-input").val(""),$("#chatops-save-config").attr("disabled","disabled"),$("#chatops-save-config").text("Save"),$("#chatops-app-level-token-section").show(),$("#chatops-app-level-label").hide()}function a(){$("#chatops-msteams-config-section").show(),$("#chatops-msteams-app-section").hide()}handleError=function(t,e,a){504==t.status?e.html("<p>The request timed out.<br/>Please try again.</p>").show():t.responseJSON&&t.responseJSON.error?e.html("<p>"+t.responseJSON.error+"</p>").show():e.html("<p>Unable to connect to chatops provider.<br/>Please check the form and try again.</p>").show(),a.addClass("invalid")},$(".js-select-chatops-client").on("click",function(t){var e=$(t.currentTarget).prop("for");"chatops-slack-radio"===e?($("#chatops-slack-config").show(),$("#chatops-teams-config").hide()):"chatops-teams-radio"===e&&($("#chatops-teams-config").show(),$("#chatops-slack-config").hide())}),$(".js-enable-chatops").on("click",function(){this.checked?($("#chatops").addClass("invalid"),$("#chatops-slack-radio").prop("checked",!0).trigger("click"),$("#chatops-slack-configuration-token").show()):$("#chatops").removeClass("invalid")}),$(".js-chatops-cancel").on("click",function(t){t.preventDefault(),e(),$("#chatops").addClass("invalid"),toggleSubmit()}),$(".js-chatops-remove").on("click",function(s){s.preventDefault(),({$button:$button,$form:$form,$container:$container,$loading:$loading,$results:$results,csrf:csrf}=t(s)),$loading=$(".js-removing-client-settings"),$loading.html("<span class='spinner-small'></span> Removing chat integration configuration..."),$.ajax({url:$button.val(),type:"GET",cache:!1}).fail(function(t){handleError(t,$results,$container)}).done(function(){a(),e(),$('input:checkbox[name="feature_toggles[chatops][enabled]"]').prop("checked",!1).trigger("change"),$results=$("#chatops_remove_result"),$results.html("<p>Chat integration configuration removed successfully. Please save to apply the settings.</p>"),s.target.style.display="none"}).always(function(){$loading.hide(),$results.show(),toggleSubmit()})}),$(".js-chatops-msteams-cancel").on("click",function(t){t.preventDefault(),a(),$("#chatops").addClass("invalid"),toggleSubmit()}),$("#chatops-slack-app-level-token-input").on("keyup",function(t){""!=$(t.target).val().trim()?$("#chatops-save-config").removeAttr("disabled"):$("#chatops-save-config").attr("disabled","disabled")}),$(".js-chatops-gen-manifest").on("click",function(t){t.preventDefault(),window.location=t.target.value}),$(".js-chatops-save-config").on("click",function(e){e.preventDefault();var a=$(e.target);if("Save"===a.text().trim()){a.attr("popover","#save-client-settings"),({$button:$button,$form:$form,$container:$container,$loading:$loading,$results:$results,csrf:csrf}=t(e));var s={_csrf:csrf,chatops:{app_type:"slacksocket",app_level_token:$form.find('input[name="chatops[slack_app_level_token]"]').val()}};$.ajax({type:"POST",url:$button.val(),data:s,cache:!1}).fail(function(t){handleError(t,$results,$container)}).done(function(t,e,s){200==s.status||t.indexOf("Session expired")<0?($results.html("<p>Slack app level token saved successfully. Please save to apply the settings.</p>"),a.text("Edit"),$("#chatops-app-level-token-section").hide(),$("#chatops-app-level-label").show(),$("#chatops").removeClass("invalid")):($results.html("<p>Unable to connect to chat integration provider.<br/>Please check the form and try again.</p>"),$container.addClass("invalid"))}).always(function(){$loading.hide(),$results.show(),toggleSubmit()})}else a.text("Save"),a.attr("popover",""),$("#chatops-app-level-token-section").show(),$("#chatops").addClass("invalid"),$("#chatops-app-level-label").hide(),toggleSubmit()}),$(".js-save-slack-settings").on("click",function(e){e.preventDefault(),({$button:$button,$form:$form,$container:$container,$loading:$loading,$results:$results,csrf:csrf}=t(e));var a={_csrf:csrf,config_token:$form.find('input[name="chatops[slack_config_token]"]').val(),socket_mode_enabled:$form.find('input[name="chatops[slacksocket_enabled]"]').is(":checked"),public_endpoint:$form.find('input[name="chatops[slack_public_endpoint]"]').val()};$.ajax({type:"POST",url:$button.val(),data:a,cache:!1}).fail(function(t){handleError(t,$results,$container)}).done(function(t,e,s){200==s.status?($("#chatops-slack-config-token-section").hide(),$("#chatops-slack-app-section").show(),$("#chatops-slack-app-link").attr("href",`https://api.slack.com/apps/${t.app_id}`),$("#chatops-slack-app-link").text(t.app_id),a.socket_mode_enabled?($results.html("<p>Slack app generated successfully.</p>"),$("#chatops-slack-socket-section").show(),$("#chatops-save-config").show()):($results.html("<p>Slack app generated successfully. Please save to apply the settings.</p>"),$container.removeClass("invalid"))):($results.html("<p>Unable to connect to chat integration provider.<br/>Please check the form and try again.</p>"),$container.addClass("invalid"))}).always(function(){$loading.hide(),$results.show(),toggleSubmit()})}),$(".js-save-teams-settings").on("click",function(e){e.preventDefault(),({$button:$button,$form:$form,$container:$container,$loading:$loading,$results:$results,csrf:csrf}=t(e));var a={_csrf:csrf,chatops:{app_type:"msteams",msteams:{app_id:$form.find('input[name="chatops[msteams_app_id]"]').val(),app_password:$form.find('input[name="chatops[msteams_app_password]"]').val(),public_endpoint:$form.find('input[name="chatops[msteams_public_endpoint]"]').val()}}};$.ajax({type:"POST",url:$button.val(),data:a,cache:!1}).fail(function(t){handleError(t,$results,$container)}).done(function(){$results.html("<p>Configuration successfully saved. Please save to apply the settings.</p>"),$("#chatops-msteams-config-section").hide(),$("#chatops-msteams-app-section").show(),$("#chatops_msteams_app_id").text(a.chatops.msteams.app_id),$container.removeClass("invalid")}).always(function(){$loading.hide(),$results.show(),toggleSubmit()})})})}.call(this);