<%# erblint:counter DeprecatedComponentsCounter 1 %>
<div class="mt-4 mb-6 position-relative" <%= test_selector("vulnerability-exposure-summary") %>>
  <%= render(partial: "repos/dependabot_alerts/vulnerability_exposure_feature_notice") if render_vulnerability_exposure_notice? %>
  <h3 class="mb-3 h4 pb-2 color-border-muted" style="border-bottom:1px solid;"> Vulnerable calls
    <%= render(Primer::Beta::Label.new(scheme: :success)) { "Beta" } %>
    <%= link_to(
        "Give us feedback",
        feedback_link,
        class: "text-small v-align-middle",
        style: "font-weight:normal;",
      ) %>
  </h3>

  <p>
    Found <%= pluralize(function_references.count, "call") %> across <%= pluralize(filenames.count, "file") %> to known vulnerable functions in <%= alert.package_name %> <%= affected_versions %>:
    <span class="markdown-body" style="display:inline-block">
      <% if function_names.count == 1 %>
        <code><%= function_names.first %></code>
      <% else %>
        <% function_names.slice(0, function_names.length-1).each do |function_name| %>
          <code><%= function_name %></code><%=", "%>
        <% end %>
        and <code><%= function_names.last %></code>
      <% end %>
    </span>
  </p>
  <% filenames.take(AFFECTED_FILES_COUNT).each_with_index do |filename, index| %>
    <%= render DependabotAlerts::AffectedFileComponent.new(repository: repository, filename: filename, function_references: function_references_per_file[filename], reveal_content: index.zero?) %>
  <% end %>

  <% if filenames.count > AFFECTED_FILES_COUNT %>
    <%= form_tag repository_alert_function_references_path(number: alert.number),
    method: :get,
    class: "ajax-pagination-form js-ajax-pagination" do %>
      <input name="skip" type="hidden" value="<%= AFFECTED_FILES_COUNT %>">
      <%= render Primer::ButtonComponent.new(type: :submit, scheme: :invisible, underline: false,
        font_weight: :normal, color: :muted, font_size: 5, classes: "Link--onHover", pb: 1, px: 0, pt: 0, "data-disable-with": "Loading...", test_selector: "show-more-affected-files-button") do %>
        Show more
      <% end %>
    <% end %>
  <% end %>
</div>
