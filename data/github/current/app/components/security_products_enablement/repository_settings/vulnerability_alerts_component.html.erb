<div <%= test_selector("vulnerability-alerting-settings")%>>
  <div class="ml-4 py-3">
    <div class="d-flex flex-md-row flex-column flex-md-items-center">
      <div class="mr-md-4 mb-md-0 mb-2 flex-auto col-md-10">
        <h4>Dependabot alerts</h4>
        <p class="mb-0">
          Receive alerts for vulnerabilities that affect your dependencies and manually generate Dependabot pull requests to resolve these vulnerabilities.
          <% if available? %>
            <%= link_to "Configure alert notifications", settings_notification_preferences_path(anchor: "vulnerability-alerts-heading"), target: "_blank", class: "Link--inTextBlock" %>.
          <% end %>
        </p>
        <% if GitHub.enterprise? && !available? %>
          <p class="mb-0 color-fg-muted text-small ws-normal">
            Contact your <%= GitHub.flavor %> administrators to
            <%= link_to("allow Dependabot alerts to be enabled", enterprise_help_url, class: "Link--inTextBlock") %>.
          </p>
        <% end %>
        <% if has_mixed_restrictions? %>
          <% if restricted_by_enterprise_policy? %>
            <%= render(SecurityProductsEnablement::RepositoryCodeSecurityPolicyNotificationComponent.new(business, mt: 1)) %>
          <% elsif restricted_by_security_configuration? %>
            <%= render(SecurityProductsEnablement::RepositoryCodeSecurityPolicyNotificationComponent.new(helpers.owner, mt: 1)) %>
          <% end %>
        <% end %>
      </div>
      <% if available? %>
        <div>
          <% if restricted? %>
            <div class="BtnGroup flex-auto">
              <div <%= test_selector("vulnerability-alerts-restricted-status") %>>
                <span><%= render Primer::Beta::Octicon.new(:"shield-lock", color: :muted) if display_shield_icon? %> <%= is_currently_enabled? ? 'Enabled' : 'Disabled' %></span>
              </div>
            </div>
          <% else %>
            <div class="BtnGroup flex-auto" <%= test_selector("vulnerability-alerting-toggle-buttons") %>>
              <%= form_tag data.update_security_products_settings_path, method: :put do %>
                <% if data.dependabot_alerts_enabled %>
                  <% if data.dependabot_alerts_disable_dependents_prompt %>
                    <%= render(Settings::SecuritySettingDialogComponent.new(
                      button_text: "Disable",
                      title: "Disable Dependabot alerts",
                      button_scheme: :danger,
                      button_aria_label: "Disable Dependabot alerts",
                      dialog_text: data.dependabot_alerts_disable_dependents_prompt,
                      input_name: "vulnerability_alerts_enabled",
                      input_value: 0,
                      data_octo_click: "repo_vuln_alerts",
                      data_octo_dimensions: !data.dependabot_alerts_enabled))
                    %>
                  <% else %>
                    <input type="hidden" name="vulnerability_alerts_enabled" value="0">
                    <%= render Primer::Beta::Button.new(type: :submit, scheme: :danger, "data-octo-click": "repo_vuln_alerts", "data-octo-dimensions": "enabled:#{ !data.dependabot_alerts_enabled },location:settings", "aria-label": "Disable dependabot alerts", px: 3) do %>
                      Disable
                    <% end %>
                  <% end %>
                <% else %>
                  <% if !data.dependabot_alerts_enable_prerequisites_prompt %>
                    <input type="hidden" name="vulnerability_alerts_enabled" value="1">
                    <%= render Primer::Beta::Button.new(type: :submit, block: true, "data-octo-click": "repo_vuln_alerts", "data-octo-dimensions": "enabled:#{ !data.dependabot_alerts_enabled },location:settings", "aria-label": "Enable dependabot alerts", px: 3) do %>
                      Enable
                    <% end %>
                  <% else %>
                    <%= render(Settings::SecuritySettingDialogComponent.new(
                      button_text: "Enable",
                      title: "Enable Dependabot alerts",
                      button_aria_label: "Enable Dependabot alerts",
                      dialog_text: data.dependabot_alerts_enable_prerequisites_prompt,
                      input_name: "vulnerability_alerts_enabled",
                      input_value: 1,
                      data_octo_click: "repo_vuln_alerts",
                      data_octo_dimensions: !data.dependabot_alerts_enabled))
                    %>
                  <% end %>
                <% end %>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
    <% if data.dependabot_alerts_custom_rules_toggle_visible %>
      <%= render(DependabotAlerts::RulesSettingsComponent.new(repository: current_repository)) %>
    <% end %>
  </div>
</div>
