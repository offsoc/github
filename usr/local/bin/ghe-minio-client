#!/bin/bash
#/
#/ Usage: ghe-minio-client [args]
#/
#/ Ensures that the access key and secret key for MinIO
#/ are set before calling the minio-client (mc) binary
#/ with the specified arguments.
#/
#/ In order to access the storage managed by MinIO (vs. the local filesystem),
#/ you must use "minio" as the host prefix for paths.  For example,
#/
#/ $ ghe-minio-client mb foo
#/ will make a local bucket/directory named foo in the current directory
#/
#/ $ ghe-minio-client mb minio/foo
#/ will make a bucket managed by MinIO in its configured data storage
#/
set -euo pipefail

port=${MINIO_PORT:-10004}
export MINIO_ACCESS_KEY=$(ghe-config 'secrets.minio.accesskey')
export MINIO_SECRET_KEY=$(ghe-config 'secrets.minio.secretkey')
export MC_HOST_minio="http://${MINIO_ACCESS_KEY}:${MINIO_SECRET_KEY}@localhost:$port"
MC=/usr/bin/mc

${MC} "$@"
