## WIP notes for Throttling V2

* Tracking issue: https://github.com/github/platform-data/issues/392
* Project description: https://github.com/github/platform-data/blob/project-throttling/docs/projects/throttlers-v2.md

### Action Plan

- [x] Phase I: Refactoring the throttlers implementation to use freno:
  - [x] Implement alternative code paths for replication delay checks based on freno.
  - [x] Replace a single cluster throttler to use the new checks  under a feature flag
  - [x] Replace the rest of the clusters
  - [x] :fire: the `SingleReplica`, `ActiveReplicaSet`, `ReplicaConnection`  and friends.

- [x] Phase II: Re-architecting the throttler systems
  - [x] Extract throttler funcitonality to a gem that is opensourced and well documented
    * See https://github.com/github/freno-throttler
  - [x] Untie throttlers to specific clusters
    * See https://github.com/github/freno-throttler/blob/master/lib/freno/throttler/mapper.rb
  - [x] Integrate freno/throttler in github/github
    * See https://github.com/github/github/pull/79512

- [ ] Future work (Left aside while we research on vitess, as it includes its own throttler system) https://github.com/github/platform-data/issues/437
  - [ ] Take advantage of the the mapper abstraction to create a generic throttler
that receives a more sophisticated context (ex. tables) and knows how to throttle, in order to be resilient to changes in the clusters that host the tables.
  - [ ] Remove references in the code to the cluster-specific throttlers (ex. Throttler::Mysql1)

cc @github/platform-data

### Notes

* throttler/per_second.rb. can be considered a rate limiter and not a throttler, we might want to refactor it. It's used in the lib/github/migrator
