<%# erblint:counter DeprecatedComponentsCounter 1 %>
<%# erblint:counter DeprecatedComponentsCounter 1 %>
<div data-limit="<%= Repository::VulnerabilityManagement::MAX_AUTHORIZED_VULNERABILITY_USERS_OR_TEAMS %>" class="js-authorized-pushers authorized-pushers width-auto width-md-full
  <% if current_repository.vulnerability_manager.vulnerability_restricted_users_and_teams_limit_reached? %>at-limit<% end %>">

  <%= render(Primer::Beta::AutoComplete.new(
    label_text: "Choose the people or teams you would like to grant access",
    placeholder: "Search for people or teams",
    src: access_to_alerts_suggestions_path,
    "data-add-url": access_to_alerts_actor_path,
    input_id: "search-people-teams-security-alert-access",
    list_id: "vulnerability-alert-results",
    inset: true,
    classes: "js-add-protected-branch-actor"
  )) do |component| %>
    <% component.with_leading_visual_icon(icon: :search) %>
  <% end %>

  <%= render(Primer::Beta::Flash.new(scheme: :warning, classes: "actor-limit-reached")) do %>
    <strong>You have reached the maximum number of people and teams you can add.</strong>
    Remove one or more to continue adding others.
  <% end %>

  <div class="Box protected-branch-authorized-pushers-table col-lg-8 col-md-10 col-12 mb-3">
    <div class="Box-header">
      <h3 class="Box-title">People and teams with access</h3>
    </div>
    <div>
      <div class="color-bg-subtle Box-row border-top clearfix d-flex flex-items-center">
        <%= primer_octicon(:organization, height: 32, mr: 2, classes: "flex-shrink-0") %>
        <div>
          <%
            default_authorized_users_text = "Organization and repository administrators"
            if current_repository.owner.is_a?(Organization)
              default_authorized_users_text = "Organization administrators, repository administrators, and teams with the security manager role"
            end
          %>
          <span class="text-emphasized"><%= default_authorized_users_text %></span>
          <div class="color-fg-muted js-protected-branch-admin-permission protected-branch-admin-permission">These members always see code scanning, Dependabot, and secret scanning alerts.</div>
        </div>
      </div>
      <div class="table-list">
        <div class="js-authorized-actors">
          <% current_repository.vulnerability_manager.authorized_users_and_teams.each do |actor| %>
            <%= render :partial => "branch_authorization/authorized_actor", :locals => {
              :actor => actor,
              :form_field_name => "vulnerability"
            } %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
