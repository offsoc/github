#!/bin/bash

set -e

CDPATH="" cd -- "$(dirname -- "$(dirname -- "$0")")"
ruby_dir="$(pwd)"

export PATH="$(pwd)/bin:$PATH"
export INTERNAL_API_URL="${INTERNAL_API_URL:="http://api.github.localhost/internal"}"

echo "Setting up go environment"
cd ../..
. script/goenv

cd ../..
make -C tools bin/cosmos-writer-cli

cd "$ruby_dir"

bundle install

for testfile in test/**/*_test.rb; do
  bundle exec ruby "$testfile" "$@"
done
