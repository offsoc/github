// Regenerate the ruby files with
//    protoc --proto_path=. --ruby_out=. --twirp_ruby_out=. vendor/gitrpc/proto/spokes.backend.proto

syntax = "proto3";
package spokes.backend;

// Calls that have to do with server health
service Health {
  // The load average for this host
  rpc Loadavg(LoadavgRequest) returns (LoadavgResponse);
}

message LoadavgRequest {}

message LoadavgResponse {
  float avg5  = 1;
  float avg10 = 2;
  float avg15 = 3;
}


// Calls that relate to Git repositories
service Git {
  // Does the repository exist? Returns true or an exception
  rpc Exists(ExistsRequest) returns (ExistsResponse);
  // The list of references for this repository
  rpc ReadRefs(ReadRefsRequest) returns (ReadRefsResponse);
}

message ExistsRequest {}
message ExistsResponse {
  bool exists = 1;
}

message ReadRefsRequest {
  enum Filter {
    DEFAULT = 0;
    EXTENDED = 1;
    ALL = 2;
  }
  Filter filter = 1;
}

message Reference {
  bytes refname = 1;
  string oid = 2;
}

message ReadRefsResponse {
  // bytes are not allowed as the key in a Map so we encode it as a list instead
  repeated Reference references = 1;
}
