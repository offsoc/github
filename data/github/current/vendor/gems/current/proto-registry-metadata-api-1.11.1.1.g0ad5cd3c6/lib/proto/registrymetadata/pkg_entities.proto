syntax = "proto3";

import "google/protobuf/timestamp.proto";
import "proto/rms/v1/container/entities.proto";
import "proto/rms/v1/npm/entities.proto";
import "proto/rms/v1/swift/entities.proto";
import "proto/rms/v1/nuget/entities.proto";
import "proto/rms/v1/ruby/entities.proto";
import "proto/rms/v1/maven/entities.proto";

package github.registry.metadata.v1.pkg;

option go_package = "github.com/github/registry-metadata/rms/twirp/proto/rms/v1/pkg";
option ruby_package = "Proto::RegistryMetadata::V1::Package";

// Value entities

enum Ecosystem {
    UNKNOWN = 0;
    CONTAINER = 1;
    NPM = 2;
    RUBYGEMS = 3;
    MAVEN = 4;
    NUGET = 5;
    PYPI = 6;
    SWIFT = 7;
}

enum PackageSubtype {
    ANY = 0;
    NOSPECIALSUBTYPE = 1;
    ACTIONS = 2;
}

enum Visibility {
  PRIVATE = 0;
  INTERNAL = 1;
  PUBLIC = 2;
}

enum ActorType {
    UNSPECIFIED = 0;
    USER = 1;
    INSTALLATION = 2;
    SITE_SCOPED_INSTALLATION = 3;
}


message Package {
    int64 id = 1;
    string namespace = 2;
    string name = 3;
    reserved 4; // bool is_public = 4; (deprecated)
    Ecosystem ecosystem = 5;
    google.protobuf.Timestamp created_at = 6;
    google.protobuf.Timestamp updated_at = 7;
    int64 author_id = 8;
    Visibility visibility = 9;
    int64 repo_id = 10;
    google.protobuf.Timestamp deleted_at = 11;
    string original_name = 12;
    ActorType author_type = 13;
    bool active_sync_perms = 14;
    int64 owner_id = 15;
    int64 download_count = 16;
    google.protobuf.Timestamp migrated_at = 17;
    bool is_immutable = 18;
    string md5 = 19;
    string display_login = 20;
}

message Version {
    int64 id = 1;
    int64 package_id = 2;
    string name = 3;
    string description = 4;
    string blob_store = 5;
    Ecosystem ecosystem = 6;
    oneof ecosystem_metadata {
        container.ContainerMetadata containerMetadata = 7;
        npm.NPMMetadata npmMetadata = 10;
        swift.SwiftMetadata swiftMetadata = 15;
        nuget.NugetMetadata nugetMetadata = 16;
        rubygems.RubyGemsMetadata rubyGemsMetadata = 17;
        maven.MavenMetadata mavenMetadata = 18;
    }
    google.protobuf.Timestamp created_at = 8;
    google.protobuf.Timestamp updated_at = 9;
    int64 download_count = 11;
    google.protobuf.Timestamp deleted_at = 12;
    string original_name = 13;
    google.protobuf.Timestamp migrated_at = 14;
}

message PackageMetadata {
    Package package = 1;
    repeated Version versions = 2;
    Version latest_version = 3;
    int64 total_version_count = 4;
    int64 total_tagged_versions_count = 5;
    int64 total_untagged_versions_count = 6;
}

message PackageSummary {
    Package package = 1;
    Version latest_version = 2;
    int64 total_download_count = 3;
    int64 total_version_count = 4;
}

message PackagesMetadata {
    Package package = 1;
    Version latest_version = 2;
    int64 total_version_count = 3;
}

message PackageFile {
    int32 id = 1;
    int32 package_version_id = 2;
    string filename = 3;
    string sha1 = 4;
    string md5 = 5;
    int32 uploader_id = 6;
    string guid = 7;
    int32 size = 8;
    int32 state = 9;
    google.protobuf.Timestamp created_at = 10;
    google.protobuf.Timestamp updated_at = 11;
    string sha256 = 12;
    string sri_512 = 13;
}

message PackageFileSummary {
    string namespace = 1;
    string package_name = 2;
    string package_original_name = 3;
    string version_name = 4;
    string version_original_name = 5;
    Ecosystem ecosystem = 6;
    PackageFile package_file = 7;
}

// Option entities

enum DeleteMode {
    SOFT = 0;
    PERMANENT = 1;
}

enum Order {
    DESCENDING = 0;
    ASCENDING = 1;
}

enum Filter {
    REPO_ID = 0;
}