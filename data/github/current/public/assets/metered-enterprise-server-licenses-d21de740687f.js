"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["metered-enterprise-server-licenses"],{42671:(e,t,r)=>{var s,n,a,i=r(72245),o=r(9449),l=r(28784),c=r(75177),d=r(38553),u=r(69909),h=r(86519),m=r(65481),p=r(30729),f=r(55847),x=r(87330),g=r(59857),b=r(55293);function v(e,t,r=!0){let s=1===e?t:`${t}s`;return r?`${e} ${s}`:s}function _({serverLicense:e,showDownloadLink:t=!1,meteredServerLicensesBaseUrl:r}){let s=new Date(Date.parse(e.expires_at)),n=`${r}/${e.reference_number}`;return(0,o.jsxs)("div",{className:"Box-row d-flex flex-items-center color-fg-muted",children:[(0,o.jsxs)("div",{className:"Box-title flex-1 ml-1 pl-6",children:[e.reference_number,(0,o.jsxs)("div",{className:"text-small text-normal",children:["Valid until ",s.toDateString()]})]}),(0,o.jsxs)("div",{className:"flex-1 text-center",children:[(0,o.jsx)("b",{children:e.seats})," ",v(e.seats,"seat",!1)]}),(0,o.jsx)("div",{className:"flex-1",children:(0,o.jsx)("div",{className:"d-flex flex-justify-end",children:t&&(0,o.jsx)(h.A,{href:n,className:"Link--inTextBlock",download:!0,children:"Download"})})})]})}try{_.displayName||(_.displayName="MeteredEnterpriseServerLicense")}catch{}function R({business:e,consumedEnterpriseLicenses:t,isStafftools:r=!1,serverLicenses:s=[],auditLogQueryUrl:n=""}){let a;let i=r?`/stafftools/enterprises/${e.slug}/metered_server_licenses`:`/enterprises/${e.slug}/metered_server_licenses`,R=s?.[0],y=R?.seats!==t,[j,E]=(0,b.useState)(s),[w,N]=(0,b.useState)(!!y),[S,C]=(0,b.useState)(t>0&&y?"Your license usage for Enterprise Cloud has changed. Generate a new license key to update server seats.":""),[k,A]=(0,b.useState)(y?"warning":void 0),[D,B]=(0,b.useState)(!1),L=r&&n.length>0;async function I(){B(!0);let e=await (0,l.DI)(i,{method:"POST"});if(!e.ok){A("danger"),C("There was an error generating a new server license. Please try again later."),N(!0),B(!1);return}A("success"),C(`New server license generated for ${v(t,"Enterprise Cloud user")}. Upload to your server instance.`),N(!0);let r=await e.json();E([r,...j]),B(!1);let s=`${i}/${r.reference_number}`;window?.open(s,"_blank")?.focus()}switch(k){case"warning":a=g.AlertIcon;break;case"success":a=g.CheckIcon;break;case"danger":a=g.StopIcon;break;default:a=g.InfoIcon}let T=()=>S&&k&&w?(0,o.jsxs)(m.A,{"data-testid":"license-status-banner",variant:k,sx:{display:"flex",alignItems:"center",borderRadius:"0",borderTop:"0",borderLeft:"0",borderRight:"0"},children:[a&&(0,o.jsx)(p.A,{"aria-label":"Alert icon",icon:a}),(0,o.jsx)("span",{className:"flex-1 pl-3",children:S}),"warning"===k?(0,o.jsx)(f.Q,{"aria-label":"Generate new license",onClick:()=>I(),sx:{svg:{color:"black",margin:0}},children:"Generate new license"}):(0,o.jsx)(x.K,{unsafeDisableTooltip:!0,variant:"invisible","aria-label":"Close",icon:g.XIcon,onClick:()=>N(!1),size:"small",sx:{svg:{color:"black",margin:0}}})]}):null;return(0,o.jsxs)("div",{className:"Box mb-4 rounded-2",children:[(0,o.jsxs)("div",{className:"Box-header d-flex flex-row flex-items-center gap-2",children:[(0,o.jsx)("div",{className:"p-2 bgColor-default border rounded-2",children:(0,o.jsx)(p.A,{icon:g.ServerIcon,className:"d-block",size:16})}),(0,o.jsx)("div",{className:"flex-1 d-flex flex-row flex-items-center gap-2",children:(0,o.jsx)("h3",{className:"text-normal",children:"Enterprise Server licenses"})}),L&&(0,o.jsx)(h.A,{href:n,children:"Audit Log"})]}),D?(0,o.jsx)(()=>(0,o.jsxs)(c.A,{className:"Box-footer",sx:{display:"flex",border:0,alignItems:"center",flexDirection:"column",padding:"32px"},"data-testid":"generating-license",children:[(0,o.jsx)(d.A,{}),(0,o.jsxs)(u.A,{as:"div",sx:{paddingTop:"16px"},children:["Generating a new license for ",v(t,"Enterprise Cloud user"),"."]})]}),{}):(0,o.jsx)(()=>0===j.length?(0,o.jsxs)(o.Fragment,{children:["danger"===k&&(0,o.jsx)(T,{}),(0,o.jsx)("div",{className:"Box-footer d-flex flex-items-center border-0",children:(0,o.jsxs)("div",{className:"text-normal ml-1 pl-6",children:["You don't have any server licenses.\xa0",t?(0,o.jsx)(h.A,{inline:!0,sx:{cursor:"pointer"},onClick:I,children:"Generate new license"}):(0,o.jsx)("span",{"data-testid":"add-cloud-users-message",children:"Please add users to your Enterprise Cloud account to generate a license"}),"."]})})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(T,{}),j.map((e,t)=>(0,o.jsx)(_,{serverLicense:e,showDownloadLink:0===t,meteredServerLicensesBaseUrl:i},e.reference_number))]}),{})]})}try{R.displayName||(R.displayName="MeteredEnterpriseServerLicenses")}catch{}try{(s=GeneratingLicense).displayName||(s.displayName="GeneratingLicense")}catch{}try{(n=DisplayLicenses).displayName||(n.displayName="DisplayLicenses")}catch{}try{(a=Banner).displayName||(a.displayName="Banner")}catch{}(0,i.k)("metered-enterprise-server-licenses",{Component:R})},92536:(e,t,r)=>{r.d(t,{R:()=>DeferredRegistry});let DeferredRegistry=class DeferredRegistry{register(e,t){let r=this.registrationEntries[e];r?r.resolve?.(t):this.registrationEntries[e]={promise:Promise.resolve(t)}}getRegistration(e){var t;return(t=this.registrationEntries)[e]||(t[e]=new s),this.registrationEntries[e].promise}constructor(){this.registrationEntries={}}};let s=class Deferred{constructor(){this.promise=new Promise(e=>{this.resolve=e})}}},75014:(e,t,r)=>{r.d(t,{Mm:()=>a,QJ:()=>i,w8:()=>n});var s=r(55293);function n(e){return((0,s.useEffect)(()=>{let t=e?.anchor;t&&("disabled"in t&&(t.disabled=!1),t.classList.remove("cursor-wait"))},[e]),e)?{reactPartialAnchor:{__wrapperElement:e}}:{}}function a(e){let t=(0,s.useRef)(e.__wrapperElement.anchor||null),[r,n]=(0,s.useState)(!1),a=(0,s.useCallback)(()=>{n(!r)},[r,n]);return(0,s.useEffect)(()=>{t.current&&(t.current.setAttribute("aria-expanded",r.toString()),t.current.setAttribute("aria-haspopup","true"))},[t,r]),i(e,a),{ref:t,open:r,setOpen:n}}function i(e,t){let r=(0,s.useRef)(e.__wrapperElement.anchor);(0,s.useEffect)(()=>{let e=r.current;if(e)return e.addEventListener("click",t),()=>e.removeEventListener("click",t)},[r,t])}},72245:(e,t,r)=>{r.d(t,{k:()=>c});let s=new(r(92536)).R;var n=r(9449),a=r(39595),i=r(24508),o=r(23235);let l=class ReactPartialElement extends i.H{async getReactNode(e){var t;let{Component:r}=await (t=this.name,s.getRegistration(t)),a=this.closest("react-partial-anchor");return(0,n.jsx)(o.c,{partialName:this.name,embeddedData:e,Component:r,wasServerRendered:this.hasSSRContent,ssrError:this.ssrError,anchorElement:a})}constructor(...e){super(...e),this.nameAttribute="partial-name"}};function c(e,t){s.register(e,t)}l=function(e,t,r,s){var n,a=arguments.length,i=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(i=(a<3?n(i):a>3?n(t,r,i):n(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i}([a.p_],l)},23581:(e,t,r)=>{r.d(t,{A:()=>o});let{getItem:s,setItem:n,removeItem:a}=(0,r(74572).A)("localStorage"),i="REACT_PROFILING_ENABLED",o={enable:()=>n(i,"true"),disable:()=>a(i),isEnabled:()=>!!s(i)}},28784:(e,t,r)=>{function s(e,t={}){!function(e){if(new URL(e,window.location.origin).origin!==window.location.origin)throw Error("Can not make cross-origin requests from verifiedFetch")}(e);let r={...t.headers,"GitHub-Verified-Fetch":"true","X-Requested-With":"XMLHttpRequest"};return fetch(e,{...t,headers:r})}function n(e,t){let r={...t?.headers??{},Accept:"application/json","Content-Type":"application/json"},n=t?.body?JSON.stringify(t.body):void 0;return s(e,{...t,body:n,headers:r})}function a(e,t={}){let r={...t.headers,"GitHub-Is-React":"true"};return s(e,{...t,headers:r})}function i(e,t){let r={...t?.headers??{},"GitHub-Is-React":"true"};return n(e,{...t,headers:r})}r.d(t,{DI:()=>s,QJ:()=>a,Sr:()=>i,lS:()=>n})},23235:(e,t,r)=>{r.d(t,{c:()=>p});var s=r(9449),n=r(55293),a=r(36165),i=r(45588),o=r(49107),l=r(47767),c=r(59840);function d({children:e,history:t}){let[r,a]=(0,n.useState)({location:t.location});return(0,c.m)(()=>t.listen(a),[t]),(0,s.jsx)(l.Ix,{location:r.location,navigator:t,children:e})}try{d.displayName||(d.displayName="PartialRouter")}catch{}var u=r(17857),h=r(51261),m=r(75014);function p({partialName:e,embeddedData:t,Component:r,wasServerRendered:l,ssrError:c,anchorElement:p}){let f=n.useRef(),x=globalThis.window;f.current||(f.current=x?(0,h.z)({window:x}):(0,i.sC)({initialEntries:[{pathname:"/"}]}));let g=f.current,b=(0,m.w8)(p);return(0,s.jsx)(a.U,{appName:e,wasServerRendered:l,children:(0,s.jsx)(o.Q,{history:g,routes:[],children:(0,s.jsxs)(d,{history:g,children:[(0,s.jsx)(r,{...t.props,...b}),(0,s.jsx)(u.h,{ssrError:c})]})})})}try{p.displayName||(p.displayName="PartialEntry")}catch{}},24508:(e,t,r)=>{r.d(t,{H:()=>ReactBaseElement});var s=r(9449),n=r(39595),a=r(34613),i=r(55293),o=r(23581),l=r(79461),c=r(51528);function d(e,t,r,s){var n,a=arguments.length,i=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(i=(a<3?n(i):a>3?n(t,r,i):n(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i}let u=RegExp("Minified React error #(?<invariant>\\d+)");let ReactBaseElement=class ReactBaseElement extends HTMLElement{get name(){return this.getAttribute(this.nameAttribute)}get embeddedDataText(){let e=this.embeddedData?.textContent;if(!e)throw Error(`No embedded data provided for react element ${this.name}`);return e}get hasSSRContent(){return"true"===this.getAttribute("data-ssr")}connectedCallback(){this.renderReact()}disconnectedCallback(){this.root?.unmount(),this.root=void 0}async renderReact(){if(!this.reactRoot)throw Error("No react root provided");let e={createRoot:a.createRoot,hydrateRoot:a.hydrateRoot};o.A.isEnabled()&&(e=await this.getReactDomWithProfiling());let t=JSON.parse(this.embeddedDataText),r=this.ssrError?.textContent,n=await this.getReactNode(t),l=(0,s.jsx)(i.StrictMode,{children:n});if(r&&this.logSSRError(r),this.hasSSRContent){let t=this.querySelector('style[data-styled="true"]');t&&document.head.appendChild(t),this.root=e.hydrateRoot(this.reactRoot,l,{onRecoverableError:e=>{if(!(e instanceof Error))return;let t=u.exec(e.message),r=String(t?.groups?.invariant);(0,c.i)({incrementKey:"REACT_HYDRATION_ERROR",incrementTags:{appName:this.name,invariant:r}})}}),t&&requestIdleCallback(()=>{t.parentElement?.removeChild(t)})}else this.root=e.createRoot(this.reactRoot),this.root.render(l);this.classList.add("loaded")}getReactDomWithProfiling(){return r.e("react-profiling").then(r.t.bind(r,87358,19))}logSSRError(e){if(l.z[e])return console.error("SSR failed with an expected error:",l.z[e]);try{let t=JSON.parse(e),r=function(e){if(!e.stacktrace)return"";let t="\n ";return e.stacktrace.map(e=>{let{function:r,filename:s,lineno:n,colno:a}=e,i=`${t} at ${r} (${s}:${n}:${a})`;return t=" ",i}).join("\n")}(t);console.error("Error During Alloy SSR:",`${t.type}: ${t.value}
`,t,r)}catch{console.error("Error During Alloy SSR:",e,"unable to parse as json")}}};d([n.aC],ReactBaseElement.prototype,"embeddedData",void 0),d([n.aC],ReactBaseElement.prototype,"ssrError",void 0),d([n.aC],ReactBaseElement.prototype,"reactRoot",void 0);try{u.displayName||(u.displayName="REACT_INVARIANT_ERROR_REGEX")}catch{}}},e=>{var t=t=>e(e.s=t);e.O(0,["react-lib","primer-react-css","vendors-node_modules_github_mini-throttle_dist_index_js-node_modules_primer_octicons-react_di-b40d97","vendors-node_modules_primer_react_lib-esm_Box_Box_js","vendors-node_modules_primer_react_lib-esm_Button_Button_js","vendors-node_modules_primer_react_lib-esm_TooltipV2_Tooltip_js","vendors-node_modules_primer_react_lib-esm_Button_IconButton_js-node_modules_primer_react_lib--82d739","ui_packages_react-core_create-browser-history_ts-ui_packages_safe-storage_safe-storage_ts-ui_-682c2c"],()=>t(42671)),e.O()}]);
//# sourceMappingURL=metered-enterprise-server-licenses-0b5c323ef8d1.js.map