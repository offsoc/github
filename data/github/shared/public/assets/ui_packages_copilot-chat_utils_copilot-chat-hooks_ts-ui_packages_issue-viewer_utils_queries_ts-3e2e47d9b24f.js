"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["ui_packages_copilot-chat_utils_copilot-chat-hooks_ts-ui_packages_issue-viewer_utils_queries_ts"],{39294:(e,t,s)=>{s.d(t,{J:()=>CopilotAuthTokenProvider});let AuthToken=class AuthToken{get authorizationHeaderValue(){return`GitHub-Bearer ${this.value}`}needsRefreshing(e){return this.isExpired||this.ssoChanged(e)}get isExpired(){let e=new Date(this.expiration);return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))<new Date(Date.now()+15e3)}ssoChanged(e){return!(this.ssoOrgIDs.every(t=>e.includes(t))&&e.every(e=>this.ssoOrgIDs.includes(e)))}static fromResult(e,t){return new AuthToken(e.token,e.expiration,t)}serialize(){return{value:this.value,expiration:this.expiration,ssoOrgIDs:this.ssoOrgIDs}}static deserialize(e){return new AuthToken(e.value,e.expiration,e.ssoOrgIDs)}constructor(e,t,s){this.value=e,this.expiration=t,this.ssoOrgIDs=s}};var a=s(74572),r=s(28784);let n="COPILOT_AUTH_TOKEN";let CopilotAuthTokenProvider=class CopilotAuthTokenProvider{async getAuthToken(){let e=this.getLocalStorageAuthToken();return e?this.validateAuthToken(e):this.fetchAuthToken()}setLocalStorageAuthToken(e){this.copilotLocalStorage.setItem(n,JSON.stringify(e.serialize()))}getLocalStorageAuthToken(){let e=this.copilotLocalStorage.getItem(n);return e?AuthToken.deserialize(JSON.parse(e)):null}async validateAuthToken(e){return e.needsRefreshing(this.ssoOrgIDs)?this.fetchAuthToken():e}fetchAuthToken(){return this.currentAuthTokenRequest||(this.currentAuthTokenRequest=this._fetchAuthToken()),this.currentAuthTokenRequest}async _fetchAuthToken(){let e=await (0,r.lS)("/github-copilot/chat/token",{method:"POST"});if(e.ok){let t=await e.json();this.currentAuthTokenRequest=null;let s=AuthToken.fromResult(t,this.ssoOrgIDs);return this.setLocalStorageAuthToken(s),s}throw this.currentAuthTokenRequest=null,Error("Failed to mint new auth token")}constructor(e){this.ssoOrgIDs=e,this.currentAuthTokenRequest=null,this.copilotLocalStorage=(0,a.A)("localStorage",{throwQuotaErrorsOnSet:!1,ttl:864e5})}}},25962:(e,t,s)=>{s.d(t,{Bc:()=>n,uN:()=>r,wg:()=>a});let a="copilot-chat-textarea",r="copilot-chat-topic-search",n="Review"},76206:(e,t,s)=>{s.d(t,{CB:()=>i,F2:()=>O,JP:()=>l,Jz:()=>r,Mw:()=>p,P:()=>f,Q7:()=>I,Qt:()=>E,SI:()=>C,Th:()=>w,UU:()=>m,Vb:()=>c,Xo:()=>u,Y6:()=>n,Z6:()=>T,Z8:()=>d,iW:()=>g,qS:()=>_,s0:()=>y,x_:()=>R,yR:()=>S,yh:()=>A,z$:()=>o});var a=s(83056);let r="/copilot";function n({role:e,content:t,error:s,references:a=[],thread:r,confirmations:n}){return{id:crypto.randomUUID(),threadID:r?.id||"temp",role:e,content:t,createdAt:new Date().toISOString(),error:s,references:a,skillExecutions:[],clientConfirmations:n}}function i(e){return e?.name||"New conversation"}function o(e){switch(e.type){case"file":return h(e);case"file-diff":return p(e);case"snippet":return function(e){if(e.title)return e.title;let t=e.path.split("/").pop(),s=`${e.range.start}-${e.range.end}`;return`${t}:${s}`}(e);case"repository":return`${e.ownerLogin}/${e.name}`;case"symbol":case"docset":return e.name;case"commit":return e.message;case"pull-request":return e.title;case"tree-comparison":return`${e.baseRevision.substring(0,5)}..${e.headRevision.substring(0,5)}`;default:return"unrecognized reference"}}function c(e){switch(e.type){case"file":return`${e.type}-${e.repoOwner}/${e.repoName}@${e.commitOID}:${e.path}`;case"file-changes":return`${e.type}-${e.repository.owner}/${e.repository.owner}@${e.ref}:${e.path}`;case"file-diff":return`${e.type}:${e.baseFile?.path}@${e.baseFile?.commitOID}-${e.headFile?.path}@${e.headFile?.commitOID}##${e.selectedRange?.start}-${e.selectedRange?.end}`;case"snippet":return`${e.type}-${e.repoOwner}/${e.repoName}@${e.commitOID}:${e.path}#${e.range.start}-${e.range.end}`;case"repository":return`${e.type}-${e.id}-${e.ownerLogin}/${e.name}`;case"symbol":return`${e.type}-${e.kind}-${e.name}`;case"docset":return`${e.type}-${e.name}`;case"commit":return`${e.type}-@${e.oid}-${e.repository.owner}/${e.repository.name}`;case"pull-request":return`${e.type}-${e.commit}-${e.repository.ownerLogin}/${e.repository.name}`;case"web-search":return`${e.type}-${e.query}`;default:return""}}function l(e){switch(e.type){case"file":case"file-diff":case"pull-request":return e.url;case"repository":return`/${e.ownerLogin}/${e.name}`;case"commit":return e.permalink;case"snippet":return function(e){if(("file"===e.type||"snippet"===e.type)&&e.languageName&&"markdown"===e.languageName.toLowerCase()){let t=new URL(e.url,window.location.origin);return t.search="plain=1",t.href}return e.url}(e);default:return"#"}}function d(e){let t=e.path.split("/");return(t.pop(),0===t.length)?"/":t.join("/")}function u(e){return h(e)}function h(e){return e.path.split("/").pop()||e.path}function p(e){let t=e.headFile?.path??e.baseFile?.path??e.head?.path??e.base?.path,s=t?.split("/").pop()??"";return e.selectedRange&&e.selectedRange.start?e.selectedRange.end&&e.selectedRange.start!==e.selectedRange.end?`${s} ${e.selectedRange.start}-${e.selectedRange.end}`:`${s} ${e.selectedRange.start}`:s}function g(e,t){return{type:"file",url:new URL((0,a.IO)({repo:t,commitish:t.refInfo.name,action:"blob",path:e}),window.location.origin).href,path:e,repoID:t.id,repoOwner:t.ownerLogin,repoName:t.name,ref:t.ref,commitOID:t.commitOID}}function E(e,t){let s=e.symbol?.fully_qualified_name||"";return{type:"symbol",kind:"suggestionSymbol",name:s,suggestionDefinitions:[{identOffset:{start:e.symbol?.ident_start||0,end:e.symbol?.ident_end||0},extentOffset:{start:e.symbol?.extent_start||0,end:e.symbol?.extent_end||0},kind:e.symbol?.kind||"",fullyQualifiedName:s,repoID:t.id,repoOwner:t.ownerLogin,repoName:t.name,ref:e.commit_sha,commitOID:e.commit_sha,path:e.path}],languageID:e.language_id}}function m(e){return{...e,type:"docset"}}function _(e){return{...e,type:"repository"}}function f(e){return!!e&&"scopingQuery"in e}function T(e){return!!e&&!f(e)}function R(e,t){return e===t||void 0!==e&&void 0!==t&&c(e)===c(t)}function S(e,t){if(void 0===e&&void 0===t)return!0;if(void 0===e||void 0===t||e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!R(e[s],t[s]))return!1;return!0}function y(e,t){e(!0),"immersive"===t&&window.history.pushState(null,"",`${r}`)}function C(e){return"file"===e.type}function w(e,t){if("user"===e.role)return{name:t,avatarURL:`/${t}.png`,type:"user"};if(e.references){let t=e.references.find(e=>"github.agent"===e.type);if(t)return{name:t.login,avatarURL:t.avatarURL,type:"agent"}}return{name:"Copilot",avatarURL:"",type:"copilot"}}function A(e){return"agent"===e.type}function I(e){let t=e.map(e=>w(e,"")).filter(e=>e?.type==="agent"),s=new Map;for(let e of t)s.set(e.name,e);return Array.from(s.values())}function O(e){let t=new Date(e.updatedAt).getTime();return new Date().getTime()-t>144e5}},33067:(e,t,s)=>{s.d(t,{Ld:()=>p,M8:()=>E,Tz:()=>m,U2:()=>g,W5:()=>a,cx:()=>h,o6:()=>_,xG:()=>r});var a,r,n=s(28784),i=s(97665),o=s(40458),c=s(94747),l=s(96540),d=s(88365),u=s(47050);s(5291),function(e){e.Unknown="unknown",e.Indexing="indexing",e.Indexed="indexed",e.Unindexed="not_indexed"}(a||(a={})),function(e){e.Unknown="unknown",e.CanIndex="ok",e.NotFound="not_found",e.Unauthorized="unauthorized",e.Forbidden="forbidden",e.ServiceUnavailable="service_unavailable",e.Requested="requested",e.RequestFailed="request_failed",e.QuotaExhausted="quota_exhausted"}(r||(r={}));let h=256,p=400;function g(e,t,s){let a=(0,l.useRef)(),r=(0,l.useRef)(),n=(0,l.useRef)([]),i=(0,l.useRef)(!1),[o,c]=(0,l.useState)([]),[d,u]=(0,l.useState)(!0),h=(0,l.useCallback)(()=>{c([]),u(!1)},[]),p=(0,l.useCallback)(()=>{if(s&&e)try{let e=new Worker(s);e.onmessage=({data:e})=>{i.current=!1,c(e.list),u(!1),r.current=e.query,n.current=e.list},a.current=e}catch(e){console.warn("Web workers are not available: ",e)}},[s,e]),g=(0,l.useCallback)(t=>{i.current&&(a.current?.terminate(),p());let s=r.current&&t.startsWith(r.current)&&n.current.length;u(!0),i.current=!0,a.current?.postMessage({baseList:s?n.current:e,query:t})},[e,p]);return((0,l.useEffect)(()=>(p(),()=>a.current?.terminate()),[p]),(0,l.useEffect)(()=>{g(t)},[t,g]),s)?[o,d,h]:[[],!1,()=>{}]}function E(e,t,s=!1){var a,r,n;let d=(0,i.jE)(),u=(0,l.useCallback)(()=>Promise.all(e.map(e=>d.invalidateQueries({queryKey:["repo-indexing-state",e]}))),[d,e]),h=(0,o.E)({queries:e.map(e=>({queryKey:["repo-indexing-state",e],queryFn:()=>f(e),placeholderData:{requestStatus:"unknown",code:"unknown",docs:"unknown"},staleTime:1/0}))}),{mutate:p}=(0,c.n)({mutationKey:["repo-indexing-state"],mutationFn:()=>T(e,t),onSuccess:u}),g={requestStatus:0===(r=(a=h.map(e=>e.data)).map(e=>e.requestStatus)).length?"unknown":r.every(e=>"ok"===e)?"ok":r.some(e=>"unknown"===e)?"unknown":r.find(e=>"ok"!==e&&"unknown"!==e),code:R(a.map(e=>e.code)),docs:s?(n=a.map(e=>e.docs)).every(e=>"indexing"===e||"not_indexed"===e)?"not_indexed":n.some(e=>"indexing"===e)?"indexing":"unknown":R(a.map(e=>e.docs))};return function(e,t){let s=(0,l.useRef)(void 0),a=(0,l.useRef)(e);(0,l.useEffect)(()=>{a.current=e},[e]),(0,l.useEffect)(()=>{if(t>0)return s.current=window.setInterval(()=>a.current(),t),()=>window.clearInterval(s.current)},[t])}(()=>void u(),"requested"===g.requestStatus||"indexing"===g.code||"indexing"===g.docs?1e4:0),[g,()=>p()]}function m(){let e=d.J.getPanelHeight(),t=d.J.getPanelWidth(),s=(0,l.useRef)(null),a=(0,l.useRef)(e),r=(0,l.useRef)(e),n=(0,l.useRef)(null),i=(0,l.useRef)(t),o=(0,l.useRef)(t),[c,u]=(0,l.useState)(e),[g,E]=(0,l.useState)(t),m=(0,l.useRef)(0);(0,l.useEffect)(()=>{m.current=parseFloat(getComputedStyle(document.documentElement).fontSize)},[]);let _=e=>Math.min(Math.max(e,h),window.innerHeight-m.current),f=e=>Math.min(Math.max(e,p),window.innerWidth-2*m.current),T=(0,l.useCallback)(e=>{if(null!==s.current){let t=s.current-e.clientY,n=_(a.current+t);u(n),r.current=n}if(null!==n.current){let t=n.current-e.clientX,s=f(i.current+t);E(s),o.current=s}},[]),R=(0,l.useCallback)(()=>{window.removeEventListener("mousemove",T),window.removeEventListener("mouseup",R),null!==s.current&&(d.J.setPanelHeight(r.current),s.current=null),null!==n.current&&(d.J.setPanelWidth(o.current),n.current=null)},[T]),S=(0,l.useCallback)((e,t,r)=>{0===e.button&&(e.preventDefault(),r&&(s.current=e.clientY,a.current=c),t&&(n.current=e.clientX,i.current=g),window.addEventListener("mousemove",T),window.addEventListener("mouseup",R))},[c,g,T,R]),y=(0,l.useCallback)(e=>{if("ArrowUp"===e.key){let t=_(c+4);u(t),d.J.setPanelHeight(t),e.preventDefault()}else if("ArrowDown"===e.key){let t=_(c-4);u(t),d.J.setPanelHeight(t),e.preventDefault()}else if("ArrowRight"===e.key){let t=f(g-4);E(t),d.J.setPanelWidth(t),e.preventDefault()}else if("ArrowLeft"===e.key){let t=f(g+4);E(t),d.J.setPanelWidth(t),e.preventDefault()}},[c,g]);return{panelWidth:g,panelHeight:c,startResize:S,onResizerKeyDown:y}}function _(e){let[t,s]=(0,l.useState)({}),a=(0,u.qY)();return(0,l.useEffect)(()=>{e&&(a?.current?.clientWidth||480)+480>=window.innerWidth?s({left:`${window.innerWidth-(a?.current?.clientWidth||480)}px !important`,bottom:"64px"}):s({})},[e,a]),t}async function f(e){let t=await fetch(`/search/check_indexing_status?nwo=${encodeURIComponent(e)}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)return{requestStatus:"request_failed",code:"unknown",docs:"unknown"};let s=await t.json();return{requestStatus:s.can_index,code:s.code_status,docs:s.docs_status}}async function T(e,t){let s=1===e.length?`nwo=${encodeURIComponent(e[0])}`:`nwos=${encodeURIComponent(JSON.stringify(e))}`;return(0,n.DI)(`/search/index_embeddings?${s}&index_code=${!t}`,{method:"POST"})}function R(e){return e.some(e=>"indexed"===e)?"indexed":e.some(e=>"not_indexed"===e)?"not_indexed":e.some(e=>"indexing"===e)?"indexing":"unknown"}},37414:(e,t,s)=>{s.d(t,{k:()=>CopilotChatService,S:()=>c});var a=s(39294),r=s(83056),n=s(28784);let ApiCache=class ApiCache{async get(...e){let t=e.join(this.separator),s=this.cache.get(t);if(s)return s;{let s=this.fetchFn(...e);return this.cache.set(t,s),(await s).ok||this.cache.delete(t),s}}constructor(e){this.fetchFn=e,this.separator="-!-",this.cache=new Map}};var i=s(88043);let o=new Set(["snippet","file","symbol","docset","repository"]),c={400:"This message could not be processed.",401:"You\u2019re not authorized to use Copilot.",403:"This response could not be shown as it violates GitHub\u2019s content policies.",404:"Resource not found. Please try again.",408:"Your network connection was interrupted. Please try again.",413:"Message too large. Please shorten it or remove some references and try again.",429:"GitHub API rate limit exceeded. Please wait and try again."};let CopilotChatService=class CopilotChatService{async fetchThreads(e={}){let t=new URLSearchParams;"string"==typeof e.name&&t.set("name",e.name);let s=`/threads?${t.toString()}`,a=await this.makeCAPIRequest(s,"GET");if(!a.ok)return a;let r=(await a.json()).threads||[];return{status:a.status,ok:!0,payload:r}}async createThread(){let e=await this.makeCAPIRequest("/threads","POST");if(!e.ok)return e;let t=(await e.json()).thread;return{status:e.status,ok:!0,payload:t}}async deleteThread(e){let t=await this.makeCAPIRequest(`/threads/${e}`,"DELETE");return t.ok?{status:t.status,ok:!0,payload:null}:t}async renameThread(e,t){let s=await this.makeCAPIRequest(`/threads/${e}/name`,"PATCH",{generate:!1,name:t});if(!s.ok)return s;let a=(await s.json()).name||"";return{status:s.status,ok:!0,payload:a}}async clearThread(e){let t=await this.makeCAPIRequest(`/threads/${e}/clear`,"PATCH");return t.ok?{status:t.status,ok:!0,payload:null}:t}async generateThreadName(e){let t=await this.makeCAPIRequest(`/threads/${e}/name`,"PATCH",{generate:!0,name:""});if(!t.ok)return t;let s=(await t.json()).name||"";return{status:t.status,ok:!0,payload:s}}async listMessages(e){if(this.listMessagesCache?.thread.id===e)return{status:200,ok:!0,payload:this.listMessagesCache};let t=await this.makeCAPIRequest(`/threads/${e}/messages`,"GET");if(!t.ok)return t;let s=await t.json();return this.listMessagesCache=s,{status:t.status,ok:!0,payload:s}}async createMessage(e,t,s,a,r){this.listMessagesCache=void 0;let n=await this.makeCAPIRequest(`/threads/${e}/messages`,"POST",{content:t,intent:s,references:a,currentURL:window.location.href,customInstructions:r});if(!n.ok)return n;let i=(await n.json()).message;return{status:n.status,ok:!0,payload:i}}async createMessageStreaming(e,t,s,a,r,n,i,o){this.listMessagesCache=void 0;let c={content:t,intent:s,references:a,context:r,currentURL:window.location.href,streaming:!0,confirmations:n,customInstructions:i,knowledgeBases:o},l=await this.makeCAPIRequest(`/threads/${e}/messages`,"POST",c,!0);return l.ok?{status:l.status,ok:!0,response:l}:l}async sendFeedback({feedback:e,feedbackChoice:t,messageId:s,threadId:a,textResponse:r}){let n=await this.makeDotcomRequest(`${this.urlPathPrefix}/feedback`,"POST",{feedback:e,feedback_choice:t,message_id:s,thread_id:a,text_response:r});return n.ok?{status:n.status,ok:!0,payload:null}:n}async listDocsets(){let e=await this.fetchDocsetsResponse();return e.ok?{status:200,ok:!0,payload:e.payload.knowledgeBases}:e}async listAdministratedCopilotEnterpriseOrganizations(){let e=await this.fetchDocsetsResponse();return e.ok?{status:200,ok:!0,payload:e.payload.administratedCopilotEnterpriseOrganizations}:e}fetchDocsetsResponse(){return this.docsetsPromise||(this.docsetsPromise=this.docsetRequestPromise()),this.docsetsPromise}async docsetRequestPromise(){let e=await this.makeDotcomRequest("/github-copilot/docs/docsets","GET");return e.ok?{status:200,ok:!0,payload:await e.json()}:e}async deleteDocset(e){let t=await this.makeDotcomRequest(`/copilot/docsets/${e.id}`,"DELETE");return t.ok?{status:t.status,ok:!0,payload:null}:t}async listRepoFiles(e){let t=(0,r.Cl)({repo:e,commitOid:e.commitOID,includeDirectories:!1});return this.repoFilesCache.get(t)}async querySymbols(e,t){return this.querySymbolsCache.get(e.ownerLogin,e.name,t)}async fetchImplicitContext(e,t,s){let a=await this.makeDotcomRequest(`${this.urlPathPrefix}/implicit-context/${t}/${s}/${encodeURIComponent(e)}`,"GET");return a.ok?{status:a.status,ok:a.ok,payload:await a.json()}:a}async fetchRepo(e){let t;if(this.repoDetailsCache.has(e))t=this.repoDetailsCache.get(e);else{let s=await this.makeDotcomRequest(`${this.urlPathPrefix}/repositories/${e}`,"GET");if(!s.ok)return s;t=await s.json(),this.repoDetailsCache.set(e,t)}return{status:200,ok:!0,payload:t}}async listAgents(e){let t=await (0,n.lS)(e);if(!t.ok)return{status:t.status,ok:!1,error:c[t.status]||this.ERROR_MSG};let s=await t.json();return{status:t.status,ok:t.ok,payload:s}}async hydrateReference(e){if(!o.has(e.type))return{status:204,ok:!0,payload:e};let t=await this.makeDotcomRequest(`${this.urlPathPrefix}/reference_details`,"POST",{reference:e});return t.ok?{status:t.status,ok:t.ok,payload:await t.json()}:t}async fetchLanguageForFileReference(e){let{repoOwner:t,repoName:s}=e,a=window.btoa(e.path),n=(0,r.RT)({ownerLogin:t,name:s},a,!0),i=await this.makeDotcomRequest(n,"GET");return i.ok?{status:i.status,ok:i.ok,payload:await i.json()}:i}async generateSuggestions(e,t){let s={context:[e],currentUrl:`${window.location.href}`},a=await this.makeCAPIRequest(`/threads/${t}/suggestions`,"POST",s);if(!a.ok)return a;let r=await a.json();return{status:a.status,ok:a.ok,payload:r}}async makeDotcomRequest(e,t,s){let a={};for(let e of(0,i.f)()){let t=e.split("="),s=t[0]?.replaceAll("_","-"),r="1";t.length>1&&(r=t[1]),a[`X-Experiment-${s}`]=r}let r=await this.copilotAuthTokenProvider.getAuthToken();a["X-Copilot-Api-Token"]=r.value;try{let r=await (0,n.lS)(e,{method:t,body:s,headers:a});if(r.ok)return r;return{status:r.status,ok:!1,error:c[r.status]||this.ERROR_MSG}}catch(e){return{status:500,ok:!1,error:this.ERROR_MSG}}}get directConnectConfiguration(){return{integrationID:"copilot-chat"}}async makeCAPIRequest(e,t,s,a=!1,r="/github/chat"){try{let n=this.apiURL,o={Authorization:(await this.copilotAuthTokenProvider.getAuthToken()).authorizationHeaderValue,"copilot-integration-id":this.directConnectConfiguration.integrationID};for(let e of(0,i.f)()){let t=e.split("="),s=t[0]?.replaceAll("_","-"),a="1";t.length>1&&(a=t[1]),o[`X-Experiment-${s}`]=a}a&&(o["Content-Type"]="text/event-stream");let l=await fetch(n+r+e,{method:t,mode:"cors",cache:"no-cache",headers:o,body:JSON.stringify(s)});if(l.ok)return l;return{status:l.status,ok:!1,error:c[l.status]||this.ERROR_MSG}}catch(e){return{status:500,ok:!1,error:this.ERROR_MSG}}}constructor(e,t){this.urlPathPrefix="/github-copilot/chat",this.ERROR_MSG="I'm sorry but there was an error. Please try again.",this.docsetsPromise=void 0,this.repoDetailsCache=new Map,this.listMessagesCache=void 0,this.listRepoFilesImpl=async e=>{let t=await this.makeDotcomRequest(e,"GET");return t.ok?{status:200,ok:!0,payload:(await t.json()).paths||[]}:t},this.repoFilesCache=new ApiCache(this.listRepoFilesImpl),this.querySymbolsImpl=async(e,t,s)=>{let a=await this.makeDotcomRequest(`/search/suggestions?query=repo:${e}/${t} ${s}`,"GET");return a.ok?{status:200,ok:!0,payload:(await a.json()).suggestions.filter(e=>"SUGGESTION_KIND_SYMBOL"===e.kind)}:a},this.querySymbolsCache=new ApiCache(this.querySymbolsImpl),this.apiURL=e,this.copilotAuthTokenProvider=new a.J(t.map(e=>e.id))}}},89426:(e,t,s)=>{s.d(t,{C6:()=>n,G7:()=>a,wh:()=>r,xP:()=>i});let a="tree-comparison",r={explain:"explain",conversation:"conversation",suggest:"suggest",askDocs:"ask-docs",discussFileDiff:"discuss-file-diff",explainFileDiff:"explain-file-diff",reviewPr:"review-pull-request"},n=["exception","filtered","contentTooLarge","rateLimit","agentUnauthorized","agentRequest","networkError","multipleAgentsAttempt"],i=["bing-search","codesearch","kb-search","pathsearch","show-symbol-definition","getissue","getprcommits","getcommit","getrelease","getrepo","getdiff","get-diff-by-range","getfile","getfilechanges","getdiscussion","get-actions-job-logs","getpullrequest","getalert","planskill","get-github-data","support-search"]},57938:(e,t,s)=>{s.d(t,{W:()=>r});var a=s(97564);let r=new class CopilotFeatureFlags{get embedding(){return(0,a.G7)("copilot_conversational_ux_embedding_update")}get copyMessage(){return(0,a.G7)("copilot_copy_message")}get formatDiff(){return(0,a.G7)("copilot_format_diff")}get unstickyReferences(){return(0,a.G7)("copilot_conversational_ux_history_refs")}get vulnerabilityAnnotations(){return(0,a.G7)("code_vulnerability_scanning")}get implicitContext(){return(0,a.G7)("COPILOT_IMPLICIT_CONTEXT")}get issueCreation(){return(0,a.G7)("copilot_issue_creation")}get staticThreadSuggestions(){return(0,a.G7)("copilot_chat_static_thread_suggestions")}get followUpThreadSuggestions(){return(0,a.G7)("copilot_chat_follow_up_thread_suggestions")}get followupToAgent(){return(0,a.G7)("copilot_followup_to_agent")}get customInstructions(){return(0,a.G7)("copilot_chat_custom_instructions")}get reactMarkdown(){return(0,a.G7)("copilot_react_markdown")}get dotcomUserServerTokens(){return(0,a.G7)("copilot_chat_dotcom_user_server_tokens")}get copilotFloatingButton(){return(0,a.G7)("copilot_floating_button")}}},88365:(e,t,s)=>{s.d(t,{J:()=>i});var a=s(45062),r=s(74572),n=s(76206);let CopilotLocalStorage=class CopilotLocalStorage{get selectedThreadID(){return this.localStorage.getItem(this.COPILOT_SELECTED_THREAD_ID_STORAGE_KEY)}set selectedThreadID(e){let t=this.COPILOT_SELECTED_THREAD_ID_STORAGE_KEY;if(null==e){this.localStorage.removeItem(t);return}this.localStorage.setItem(t,e)}getPanelHeight(){let e=this.localStorage.getItem(this.COPILOT_PANEL_HEIGHT);return e?parseInt(e):this.DEFAULT_PANEL_HEIGHT}setPanelHeight(e){let t=this.COPILOT_PANEL_HEIGHT;this.localStorage.setItem(t,e.toString())}getPanelWidth(){let e=this.localStorage.getItem(this.COPILOT_PANEL_WIDTH);return e?parseInt(e):this.DEFAULT_PANEL_WIDTH}setPanelWidth(e){let t=this.COPILOT_PANEL_WIDTH;this.localStorage.setItem(t,e.toString())}getCollapsedState(){return"false"!==this.sessionStorage.getItem(this.COPILOT_COLLAPSED_STATE_KEY)}setCollapsedState(e){let t=this.COPILOT_COLLAPSED_STATE_KEY;this.sessionStorage.setItem(t,e.toString())}getSelectedTopic(e){return this.localStorage.getItem(this.COPILOT_SELECTED_TOPIC_STORAGE_KEY(e))}setSelectedTopic(e,t){if(null==t){this.localStorage.removeItem(this.COPILOT_SELECTED_TOPIC_STORAGE_KEY(e));return}let s=this.COPILOT_SELECTED_TOPIC_STORAGE_KEY(e);this.localStorage.setItem(s,t)}getSavedMessage(e){return this.localStorage.getItem(this.COPILOT_SAVED_USER_MESSAGE_KEY(e))}setSavedMessage(e,t){this.setSavedMessageFast(e,t)}setSavedMessageFast(e,t){let s=this.COPILOT_SAVED_USER_MESSAGE_KEY(e);if(null==t){this.localStorage.removeItem(s);return}this.localStorage.setItem(s,t)}getCurrentReferences(e){let t=this.COPILOT_CURRENT_REFERENCES_KEY(e),s=this.localStorage.getItem(t);return s?JSON.parse(s):null}setCurrentReferences(e,t){let s=this.COPILOT_CURRENT_REFERENCES_KEY(e),a=t.filter((e,s)=>s===t.findIndex(t=>(0,n.Vb)(e)===(0,n.Vb)(t)));this.localStorage.setItem(s,JSON.stringify(a))}clearCurrentReferences(e){let t=this.COPILOT_CURRENT_REFERENCES_KEY(e);this.localStorage.removeItem(t)}migrateNullThreadToNewThread(e){let t=this.getSavedMessage(null);this.setSavedMessage(null,null),t&&this.setSavedMessage(e,t);let s=this.getCurrentReferences(null);this.clearCurrentReferences(null),s&&this.setCurrentReferences(e,s)}constructor(){this.COPILOT_SELECTED_THREAD_ID_STORAGE_KEY="COPILOT_SELECTED_THREAD_ID_STORAGE_KEY",this.COPILOT_COLLAPSED_STATE_KEY="COPILOT_COLLAPSED_STATE_KEY",this.COPILOT_PANEL_HEIGHT="COPILOT_PANEL_HEIGHT",this.DEFAULT_PANEL_HEIGHT=600,this.COPILOT_PANEL_WIDTH="COPILOT_PANEL_WIDTH",this.DEFAULT_PANEL_WIDTH=480,this.COPILOT_SAVED_USER_MESSAGE_KEY=e=>`COPILOT_SAVED_USER_MESSAGE_${e}`,this.COPILOT_CURRENT_REFERENCES_KEY=e=>`COPILOT_CURRENT_REFERENCES_${e}`,this.COPILOT_SELECTED_TOPIC_STORAGE_KEY=e=>`COPILOT_SELECTED_TOPIC_${e}`,this.COPILOT_AUTH_TOKEN_KEY="COPILOT_AUTH_TOKEN",this.localStorage=(0,r.A)("localStorage",{throwQuotaErrorsOnSet:!1,ttl:864e5}),this.sessionStorage=(0,r.A)("sessionStorage",{throwQuotaErrorsOnSet:!1,ttl:864e5})}};!function(e,t,s,a){var r,n=arguments.length,i=n<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,s):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,s,a);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(i=(n<3?r(i):n>3?r(t,s,i):r(t,s))||i);n>3&&i&&Object.defineProperty(t,s,i)}([(0,a.s)(100)],CopilotLocalStorage.prototype,"setSavedMessage",null);let i=new CopilotLocalStorage},88043:(e,t,s)=>{s.d(t,{R:()=>i,f:()=>n});var a=s(74572);let r="copilot_experiments";function n(){let e=(0,a.A)("localStorage").getItem(r);return e?e.split(","):[]}function i(e){(0,a.A)("localStorage").setItem(r,e.join(","))}},73766:(e,t,s)=>{s.d(t,{J:()=>a});function a(e){let t=e.indexOf("/");if(-1===t||0===t)return`${e} in:name archived:false`;let s=e.slice(0,t),a=e.slice(t+1);return 0===a.length?`org:${s} in:name archived:false`:`org:${s} ${a} in:name archived:false`}},13369:(e,t,s)=>{s.d(t,{A:()=>c,c:()=>l});var a=s(74848),r=s(96540),n=s(76206);let CopilotAutocompleteManager=class CopilotAutocompleteManager{filenameFromPath(e){let t=e.split("/");return t[t.length-1]}async fetchAutocompleteSuggestions(e,t){let[s,a]=await Promise.all([this.manager.service.querySymbols(e,t),this.manager.service.listRepoFiles(e)]);if(s.ok){let t=s.payload.flatMap(t=>t.symbol?[(0,n.Qt)(t,e)]:[]);this.symbolSuggestions=new Map(t.map(e=>[e.name,e]))}if(this.repoFileSuggestions.has(e.name)){this.fileSuggestions=this.repoFileSuggestions.get(e.name);return}if(a.ok){let t=new Map;this.repoFileSuggestions.set(e.name,t);let s=0,r=()=>{let i=Math.min(s+5e3,a.payload.length);for(;s<i;s++){let r=a.payload[s];if(r){let s=(0,n.iW)(r,e);t.set(s.path,s)}}if(s<a.payload.length)setTimeout(r,0);else{this.fileSuggestions=t;return}};r()}}findReference(e,t){return t.currentReferences.find(t=>e===(0,n.Vb)(t))}async addToReferences(e,t){let s=(0,n.Vb)(e);if(this.findReference(s,t))return;let a=e;if((0,n.SI)(e)){let t=await this.manager.service.fetchLanguageForFileReference(e);if(t.ok&&t.payload.language){let{languageName:s,languageId:r}=t.payload.language;a={...e,languageName:s,languageId:r}}}this.manager.addReference(a,"autocomplete")}constructor(e){this.fileSuggestions=new Map,this.symbolSuggestions=new Map,this.knowledgeSuggestions=new Map,this.repoFileSuggestions=new Map,this.manager=e}};var i=s(5291);let o=(0,r.createContext)(null);function c({children:e}){let t=(0,i.b)(),s=(0,r.useMemo)(()=>new CopilotAutocompleteManager(t),[t]);return(0,a.jsx)(o.Provider,{value:s,children:e})}function l(){return(0,r.useContext)(o)}try{o.displayName||(o.displayName="CopilotChatAutocompleteContext")}catch{}try{c.displayName||(c.displayName="CopilotChatAutocompleteProvider")}catch{}},47050:(e,t,s)=>{s.d(t,{Jf:()=>S,Mj:()=>C,qY:()=>A,Pk:()=>w});var a=s(74848),r=s(83028),n=s(96540),i=s(18312),o=s(76206),c=s(97564),l=s(51848),d=s(97156),u=s(57938),h=s(88365);let p=(e,t)=>{let s=d.cg.location?.pathname?.split("/").length>=3,a=t=>(t&&(h.J.selectedThreadID=t),{...e,selectedThreadID:t,currentView:"thread",showTopicPicker:!t&&e.showTopicPicker}),r=t=>(h.J.setCurrentReferences(e.selectedThreadID,t),{...e,currentReferences:t});switch(t.type){case"SLASH_COMMANDS_ERROR":return(0,l.BI)("copilot.slash_commands_error"),{...e,slashCommandLoading:{...e.slashCommandLoading,state:"error"}};case"SLASH_COMMANDS_LOADED":return(0,l.BI)("copilot.slash_commands_loaded"),{...e,slashCommandLoading:{...e.slashCommandLoading,state:"loaded"}};case"SLASH_COMMANDS_LOADING":return(0,l.BI)("copilot.slash_commands_loading"),{...e,slashCommandLoading:{...e.slashCommandLoading,state:"loading"}};case"OPEN_THREAD_ACTION_MENU":return(0,l.BI)("copilot.open_thread_action_menu",{open:t.open}),{...e,threadActionMenuIsOpened:t.open};case"OPEN_COPILOT_CHAT":return(0,l.BI)("copilot.open_copilot_chat",{source:t.source}),{...e,chatIsOpen:!0,entryPointId:t.id};case"CLOSE_COPILOT_CHAT":return(0,l.BI)("copilot.close_copilot_chat"),{...e,chatIsOpen:!1};case"EXPAND_COPILOT_CHAT":return(0,l.BI)("copilot.expand_copilot_chat"),{...e,chatIsCollapsed:!1};case"COLLAPSE_COPILOT_CHAT":return(0,l.BI)("copilot.collapse_copilot_chat"),{...e,chatIsCollapsed:!0};case"THREAD_CREATED":return(0,l.BI)("copilot.thread_created",{...E(t.thread),count:e.threads.size+1}),{...a(t.thread.id),threads:new Map(e.threads.set(t.thread.id,t.thread)),messages:[],messagesLoading:{...e.messagesLoading,state:"loaded"},currentReferences:h.J.getCurrentReferences(t.thread.id)??[],currentTopic:s?e.currentTopic:void 0,defaultRecipient:void 0,allClientConfirmations:[]};case"SUGGESTIONS_GENERATED":return{...e,suggestions:t.suggestions};case"CLEAR_SUGGESTIONS":return{...e,suggestions:null};case"CLEAR_THREAD":return(0,l.BI)("copilot.clear_thread"),{...e,messages:[],currentReferences:[]};case"CLEAR_REFERENCES":if((0,l.BI)("copilot.clear_references"),(0,c.G7)("COPILOT_CHAT_CONVERSATION_INTENT_KNOWLEDGE_SEARCH_SKILL"))return{...e,currentReferences:e.currentReferences.filter(e=>"docset"===e.type)};return{...e,currentReferences:[]};case"CLEAR_CURRENT_REFERENCES":return(0,l.BI)("copilot.clear_references"),{...e,currentReferences:[]};case"MESSAGES_UPDATED":if((0,l.BI)("copilot.messages_updated",{count:t.messages?.length,loading:t.state}),!t.messages)return{...e,messagesLoading:{...e.messagesLoading,state:t.state}};{let s=e.defaultRecipient,a=e.allClientConfirmations;return"loaded"===t.state&&t.messages.length>0&&(s=_(t.messages[t.messages.length-1],e),a=t.messages.map(e=>e.clientConfirmations?.map(e=>JSON.stringify(Object.values(e.confirmation).sort()))).flat().filter(Boolean)),{...e,defaultRecipient:s,allClientConfirmations:a,messages:t.messages,messagesLoading:{...e.messagesLoading,state:t.state}}}case"WAITING_ON_COPILOT":return(0,l.BI)("copilot.waiting_on_copilot",{isWaitingOnCopilot:t.loading}),{...e,isWaitingOnCopilot:t.loading};case"SELECT_THREAD":return(0,l.BI)("copilot.select_thread",{threadID:t.thread?.id}),{...a(t.thread?.id||null)};case"HANDLE_EVENT_START":return(0,l.BI)("copilot.handle_event_start"),{...t.references?r(t.references):e,chatIsOpen:!0,chatIsCollapsed:!1,entryPointId:t.id};case"THREADS_LOADING":return(0,l.BI)("copilot.threads_loading"),{...e,threadsLoading:{...e.threadsLoading,state:"loading"}};case"DISMISS_ATTACH_KNOWLEDGE_BASE_HERE_POPOVER":return(0,l.BI)("copilot.dismiss_attach_knowledge_base_here_popover"),{...e,renderAttachKnowledgeBaseHerePopover:!1};case"DISMISS_KNOWLEDGE_BASE_ATTACHED_TO_CHAT_POPOVER":return(0,l.BI)("copilot.dismiss_knowledge_base_attached_to_chat_popover"),{...e,renderKnowledgeBaseAttachedToChatPopover:!1};case"KNOWLEDGE_BASES_LOADING":return(0,l.BI)("copilot.knowledge_bases_loading"),{...e,knowledgeBasesLoading:{...e.knowledgeBasesLoading,state:"loading"}};case"KNOWLEDGE_BASES_LOADED":return(0,l.BI)("copilot.knowledge_bases_loaded",{count:t.knowledgeBases.length}),{...e,knowledgeBases:t.knowledgeBases,knowledgeBasesLoading:{...e.knowledgeBasesLoading,state:"loaded",error:null}};case"KNOWLEDGE_BASES_LOADING_ERROR":return(0,l.BI)("copilot.knowledge_bases_loading_error",{error:t.message}),{...e,knowledgeBasesLoading:{...e.knowledgeBasesLoading,state:"error",error:t.message}};case"THREADS_LOADED":return(0,l.BI)("copilot.threads_loaded",{count:t.threads.length}),{...e,threadsLoading:{...e.threadsLoading,state:"loaded"},threads:new Map(t.threads.map(e=>[e.id,e]))};case"THREADS_LOADING_ERROR":return(0,l.BI)("copilot.threads_loading_error",{error:t.message}),{...e,threadsLoading:{error:t.message,state:"error"}};case"DELETE_THREAD_KEEP_SELECTION":return(0,l.BI)("copilot.thread_deleted",{...E(t.thread),count:e.threads.size-1}),e.threads.delete(t.thread.id),{...a(null),threads:new Map(e.threads),threadsLoading:{...e.threadsLoading,state:"loaded"},messages:[],messagesLoading:{state:"loaded",error:null},currentReferences:[],currentView:"list"};case"DELETE_THREAD":return(0,l.BI)("copilot.thread_deleted",{...E(t.thread),count:e.threads.size-1}),e.threads.delete(t.thread.id),{...a(null),threads:new Map(e.threads),threadsLoading:{...e.threadsLoading,state:"loaded"},messages:[],messagesLoading:{state:"loaded",error:null},currentReferences:[]};case"DELETE_THREAD_ERROR":return(0,l.BI)("copilot.delete_thread_error",{...E(t.thread),error:t.error}),{...e,threadsLoading:{...e.threadsLoading,error:t.error},threads:new Map(e.threads.set(t.thread.id,t.thread))};case"MESSAGE_ADDED":return(0,l.BI)("copilot.message_added",{...g(t.message),count:e.messages.length+1}),{...e,messages:[...e.messages,t.message]};case"THREAD_UPDATED":return(0,l.BI)("copilot.thread_updated",E(t.thread)),{...e,...a(t.thread.id),threads:new Map(e.threads.set(t.thread.id,t.thread))};case"REFERENCES_LOADED":return(0,l.BI)("copilot.references_loaded",{count:t.references.length}),{...e,currentReferences:t.references};case"ADD_REFERENCE":return(0,l.BI)("copilot.add_reference",{...m(t.reference),source:t.source,count:e.currentReferences.length+1}),{...e,...r([...e.currentReferences.filter(e=>!(0,o.x_)(e,t.reference)),t.reference])};case"REMOVE_REFERENCE":{let s=e.currentReferences[t.referenceIndex];return s&&(0,l.BI)("copilot.remove_reference",{...m(s),count:e.currentReferences.length-1}),{...r(e.currentReferences.filter((e,s)=>s!==t.referenceIndex))}}case"SHOW_TOPIC_PICKER":return{...e,showTopicPicker:t.show};case"CURRENT_TOPIC_UPDATED":return t.topic&&(0,l.BI)("copilot.current_topic_updated",{type:t.topic?(0,o.P)(t.topic)?"docset":"repository":"none"}),{...e,currentTopic:t.topic,topicLoading:{...e.topicLoading,state:t.state}};case"MESSAGE_STREAMING_STARTED":return(0,l.BI)("copilot.message_streaming_started",{...g(t.message),count:e.messages.length}),{...e,isWaitingOnCopilot:!0,streamer:t.streamer,streamingMessage:t.message,messages:[...e.messages]};case"MESSAGE_STREAMING_TOKEN_ADDED":return{...e,streamingMessage:e.streamingMessage?{...e.streamingMessage,content:e.streamingMessage.content+t.token}:null};case"MESSAGE_STREAMING_FUNCTION_CALLED":if(e.streamingMessage){let s=e.streamingMessage.skillExecutions||[],a=s.findIndex(e=>"started"===e.status),r=a>=0?s[a]:null,n=s;switch(t.status){case"started":n=[...s,{slug:t.name,status:t.status,arguments:t.arguments,errorMessage:t.errorMessage,references:[]}];break;case"completed":r&&(n[a]={...r,status:t.status,references:t.references});break;case"error":r&&(n[a]={...r,status:t.status,errorMessage:t.errorMessage})}return{...e,streamingMessage:{...e.streamingMessage,skillExecutions:n}}}return e;case"MESSAGE_STREAMING_COMPLETED":{let s,a=e.defaultRecipient;return e.streamingMessage&&(a=_(s={...e.streamingMessage,id:t.messageResponse.id,references:t.messageResponse.references,createdAt:t.messageResponse.createdAt,intent:t.messageResponse.intent,copilotAnnotations:t.messageResponse.copilotAnnotations},e),(0,l.BI)("copilot.message_streaming_completed",{...g(s),count:e.messages.length+1})),{...e,defaultRecipient:a,isWaitingOnCopilot:!1,streamer:null,streamingMessage:null,messages:s?[...e.messages,s]:e.messages}}case"MESSAGE_STREAMING_FAILED":return(0,l.BI)("copilot.message_streaming_failed"),{...e,isWaitingOnCopilot:!1,streamer:null,streamingMessage:null};case"MESSAGE_STREAMING_STOPPED":{let t;return e.streamingMessage&&(t={...e.streamingMessage,interrupted:!0},(0,l.BI)("copilot.message_streaming_stopped",{...g(t),count:e.messages.length+1})),{...e,isWaitingOnCopilot:!1,streamer:null,streamingMessage:null,messages:t?[...e.messages,t]:e.messages}}case"SELECT_REFERENCE":return t.reference&&(0,l.BI)("copilot.select_reference",m(t.reference)),{...e,selectedReference:t.reference};case"VIEW_ALL_THREADS":return{...e,currentView:"list"};case"VIEW_CURRENT_THREAD":return{...e,currentView:"thread"};case"IMPLICIT_CONTEXT_UPDATED":if(!(0,o.yR)(t.context,e.context))return{...e,context:t.context};return e;case"SET_TOP_REPOSITORIES":return{...e,topRepositoriesCache:t.topics};case"SET_AGENTS":return{...e,agents:t.agents};case"MESSAGE_STREAMING_CONFIRMATION":{let s={title:t.title,message:t.message,confirmation:t.confirmation};return{...e,streamingMessage:e.streamingMessage?{...e.streamingMessage,confirmations:e.streamingMessage.confirmations?[...e.streamingMessage.confirmations,s]:[s]}:null}}case"AGENT_ERROR":{let s=e.streamingMessage,a=t.error;return{...e,streamingMessage:s&&{...s,agentErrors:[...s.agentErrors??[],{type:a.type,code:a.code,message:a.message,identifier:a.identifier}]}}}}};function g(e){var t;if(!e)return(0,l.Ti)({});let s={id:e.id,role:e.role,createdAt:e.createdAt,threadID:e.threadID,referenceCount:e.references?.length??0};return e.intent&&(s.intent=e.intent),e.error&&(s.error=e.error),e.copilotAnnotations&&(s.copilotAnnotations=function(e){if(e)return{CodeVulnerability:e.CodeVulnerability?.map(e=>({details:{type:e?.details?.type}}))}}(e.copilotAnnotations)),e.skillExecutions&&(s.skillExecutions=(t=e.skillExecutions)?t.map(e=>({slug:e?.slug,status:e?.status,argumentCount:e?.arguments?.length??0,errorMessage:e?.errorMessage,references:e?.references?.length??0})):[]),e.interrupted&&(s.interrupted=!0),(0,l.Ti)(s)}function E(e){return e?(0,l.Ti)({id:e.id,createdAt:e.createdAt,updatedAt:e.updatedAt,currentReferenceCount:e.currentReferences?.length??0}):(0,l.Ti)({})}function m(e){return e?(0,l.Ti)({type:e.type}):(0,l.Ti)({})}function _(e,t){if(!u.W.followupToAgent)return;let s=(0,o.Th)(e,t.currentUserLogin);if("agent"===s.type)return s.name}var f=s(13369),T=s(5291);let R=(0,n.createContext)(null),S=(0,n.createContext)(null),y=(0,n.createContext)(null);function C({children:e,topic:t,login:s,apiURL:c,workerPath:l,threadId:d,refs:u,selectedReference:h,mode:g,ssoOrganizations:E,renderKnowledgeBases:m,renderAttachKnowledgeBaseHerePopover:_,renderKnowledgeBaseAttachedToChatPopover:S,customInstructions:C,chatVisibleSetting:w,chatVisibleSettingPath:A,agentsPath:I,optedInToUserFeedback:O,agents:D,messages:L,testReducerState:k,reviewLab:P}){let v=k||{threadsLoading:{state:"pending",error:null},messagesLoading:{state:"pending",error:null},slashCommandLoading:{state:"pending",error:null},showTopicPicker:(!d||"assistive"===g)&&!t,topicLoading:{state:"pending",error:null},threads:new Map,knowledgeBasesLoading:{state:"pending",error:null},knowledgeBases:[],messages:L??[],streamer:null,streamingMessage:null,selectedThreadID:d,currentTopic:t,chatIsOpen:!1,chatIsCollapsed:"assistive"===g,isWaitingOnCopilot:!1,currentUserLogin:s,apiUrl:c,currentReferences:u,findFileWorkerPath:l,threadActionMenuIsOpened:!1,currentView:"thread",selectedReference:h??null,mode:g,currentRepository:(0,o.Z6)(t)?t:void 0,ssoOrganizations:E,context:void 0,renderKnowledgeBases:m??!0,renderAttachKnowledgeBaseHerePopover:_,renderKnowledgeBaseAttachedToChatPopover:S,customInstructions:C,chatVisibleSetting:w,chatVisibleSettingPath:A,topRepositoriesCache:void 0,agentsPath:I,optedInToUserFeedback:O,agents:D,suggestionsDismissed:!1,reviewLab:P},[N,M]=(0,n.useReducer)(p,v),G=(0,r.E7)();return(0,a.jsx)(R.Provider,{value:N,children:(0,a.jsx)(y.Provider,{value:M,children:(0,a.jsx)(T.v,{apiURL:c,state:N,dispatch:M,ssoOrganizations:E,children:(0,a.jsx)(f.A,{children:(0,a.jsx)(i.RelayEnvironmentProvider,{environment:G,children:e})})})})})}function w(){return(0,n.useContext)(R)}function A(){return(0,n.useContext)(S)}try{R.displayName||(R.displayName="CopilotChatContext")}catch{}try{S.displayName||(S.displayName="ChatPanelReferenceContext")}catch{}try{y.displayName||(y.displayName="CopilotChatDispatchContext")}catch{}try{C.displayName||(C.displayName="CopilotChatProvider")}catch{}},5291:(e,t,s)=>{s.d(t,{v:()=>R,b:()=>S});var a=s(74848),r=s(70170),n=s(96540),i=s(25962),o=s(97564),c=s(51848),l=s(28784),d=s(76206);let u=/^data:\s+/;let CopilotStreamingError=class CopilotStreamingError extends Error{constructor(e){super(e.description),this.error=e}};let CopilotChatMessageStreamer=class CopilotChatMessageStreamer{async *stream(){let e=new TextDecoder("utf-8"),t="";for(;;){let s,a;try{({value:s,done:a}=await this.reader.read())}catch(e){throw new CopilotStreamingError({type:"error",errorType:"networkError",description:"NETWORK_CONNECTION_INTERRUPTED"})}if(a)break;for(t+=e.decode(s);;){let e=t.indexOf("\n\n");if(-1===e)break;let s=JSON.parse(t.slice(0,e).replace(u,""));if(yield s,"complete"===s.type)return;t=t.slice(e+2)}}}async stop(){return this.reader.cancel()}constructor(e){this.reader=e}};var h=s(37414),p=s(89426),g=s(57938),E=s(88365);let CopilotChatManager=class CopilotChatManager{async openChat(e,t,s,a,r){if(this.dispatch({type:"OPEN_COPILOT_CHAT",source:s}),"list"!==t&&(await this.findOrStartNewThread(e,r),a)){let e=new FormData;e.set("copilot_chat_visible","true"),(0,l.DI)(a,{method:"PUT",body:e})}}closeChat(e){if(this.dispatch({type:"CLOSE_COPILOT_CHAT"}),e){let t=new FormData;t.set("copilot_chat_visible","false"),(0,l.DI)(e,{method:"PUT",body:t,headers:{Accept:"application/json"}})}E.J.setCollapsedState(!0)}viewAllThreads(){this.dispatch({type:"VIEW_ALL_THREADS"})}viewCurrentThread(){this.dispatch({type:"VIEW_CURRENT_THREAD"})}collapseChat(){this.dispatch({type:"COLLAPSE_COPILOT_CHAT"}),E.J.setCollapsedState(!0)}expandChat(){this.dispatch({type:"EXPAND_COPILOT_CHAT"}),E.J.setCollapsedState(!1)}async sendChatMessage(e,t,s,a,r,n,i,c){let l=(0,d.P)(a),u=function({references:e,topicIsDocset:t}){let s=new Set(e.map(e=>e.type));return!0===(t||s.has("docset"))?(0,o.G7)("COPILOT_CHAT_CONVERSATION_INTENT_KNOWLEDGE_SEARCH_SKILL")?p.wh.conversation:p.wh.askDocs:p.wh.conversation}({references:s,topicIsDocset:l}),h=l?void 0:a;return l&&!s.some(e=>"docset"===e.type&&e.name===a.name)&&s.push({type:"docset",name:a.name,id:a.id,scopingQuery:a.scopingQuery,avatarUrl:a.avatarUrl,repos:a.repos,description:a.description}),this.sendMessage(e,t,u,s,h,r,n,i,c)}async stopStreaming(e,t){await t.stop(),this.dispatch({type:"MESSAGE_STREAMING_STOPPED",message:e})}async sendMessage(e,t,s,a,r,n,i,o,l){let u=i?[i]:[],h=(0,d.Y6)({role:"user",content:t,references:a,thread:e,confirmations:u});this.dispatch({type:"MESSAGE_ADDED",message:h});let g=(0,d.Y6)({role:"assistant",content:"",thread:e});if(this.dispatch({type:"WAITING_ON_COPILOT",loading:!0}),!e){let t=await this.service.createThread();if(t.ok)e=t.payload,E.J.migrateNullThreadToNewThread(e.id);else{this.handleSendMessageError(e,f(t.error));return}}this.dispatch({type:"THREAD_UPDATED",thread:{...e,updatedAt:new Date().toISOString()}}),this.unstickyReferencesFeatureEnabled&&s!==p.wh.askDocs&&this.dispatch({type:"CLEAR_REFERENCES",threadID:e.id});let m=a.length&&(1!==a.length||a[0]?.type!=="repository")?void 0:n;(0,c.BI)("copilot.implicit_context",{usedImplicitContext:!!m,type:m?.[0]?.type,count:m?.length}),!a.length&&r&&(a=[(0,d.qS)(r)]);let _=await this.service.createMessageStreaming(e.id,t,s,a,m??[],u,o?[o]:[],l);if(!_.ok){this.handleSendMessageError(e,f(_.error));return}let T=_.response.body?.getReader();if(!T){this.handleSendMessageError(e,f(this.service.ERROR_MSG));return}let R=new CopilotChatMessageStreamer(T);this.dispatch({type:"MESSAGE_STREAMING_STARTED",message:g,streamer:R}),await this.handleStreamingMessage(e,R,m)}addReference(e,t){this.dispatch({type:"ADD_REFERENCE",reference:e,source:t})}removeReference(e){this.dispatch({type:"REMOVE_REFERENCE",referenceIndex:e})}async dismissAttachKnowledgeBaseHerePopover(){this.dispatch({type:"DISMISS_ATTACH_KNOWLEDGE_BASE_HERE_POPOVER"}),await (0,l.DI)("/settings/dismiss-notice/copilot_for_docs_attach_knowledge_base_here",{method:"POST"})}async dismissKnowledgeBaseAttachedToChatPopover(){this.dispatch({type:"DISMISS_KNOWLEDGE_BASE_ATTACHED_TO_CHAT_POPOVER"}),await (0,l.DI)("/settings/dismiss-notice/copilot_for_docs_knowledge_base_attached_to_chat",{method:"POST"})}async selectThread(e,t=!0){this.dispatch({type:"SELECT_THREAD",thread:e});let s=[];s.push(this.fetchMessages(e?.id||null)),t&&s.push(this.fetchThreads()),await Promise.all(s)}addMessage(e,t,s,a){let r=(0,d.Y6)({role:e,content:s,references:a,thread:t});this.dispatch({type:"MESSAGE_ADDED",message:r})}async renameThread(e,t){(await this.service.renameThread(e.id,t)).ok&&this.dispatch({type:"THREAD_UPDATED",thread:{...e,name:t}})}async clearThread(e){(await this.service.clearThread(e.id)).ok&&this.dispatch({type:"CLEAR_THREAD",threadID:e.id})}async deleteThreadKeepSelection(e){this.dispatch({type:"DELETE_THREAD_KEEP_SELECTION",thread:e});let t=await this.service.deleteThread(e.id);t.ok||this.dispatch({type:"DELETE_THREAD_ERROR",thread:e,error:t.error})}async deleteThread(e){this.dispatch({type:"DELETE_THREAD",thread:e});let t=await this.service.deleteThread(e.id);t.ok||this.dispatch({type:"DELETE_THREAD_ERROR",thread:e,error:t.error})}async createThread(e,t){this.dispatch({type:"THREADS_LOADING"});let s=await this.service.createThread();if(!s.ok)return this.dispatch({type:"THREADS_LOADING_ERROR",message:s.error}),null;let a=s.payload;return e&&E.J.setSavedMessageFast(a.id,e),t&&E.J.setCurrentReferences(a.id,t),this.dispatch({type:"THREAD_CREATED",thread:a}),a}async generateSuggestions(e,t){let s=await this.service.generateSuggestions(e,t);if(!s.ok)return null;let a=s.payload;return this.dispatch({type:"SUGGESTIONS_GENERATED",suggestions:a}),a}clearSuggestions(){this.dispatch({type:"CLEAR_SUGGESTIONS"})}async handleOpenPanelEvent(e,t,s){let a=t.payload;if(m(a)?e=await this.createThread():_(a,[p.wh.reviewPr])?(this.addMessage("user",a.thread,i.Bc,a.references),this.addMessage("assistant",a.thread,a.completion,a.references),this.selectThread(a.thread,!0)):e=await this.findOrStartNewThread(e),this.dispatch({type:"HANDLE_EVENT_START",references:a.references,id:a.id}),_(a,[p.wh.conversation,p.wh.discussFileDiff,p.wh.reviewPr])&&!m(a))return;let r=`blob ${a.intent}`;a.id&&(r=`element ${t.payload.id}`),(0,c.BI)("copilot.open_copilot_chat",{source:r}),await this.sendMessage(e,a.content,a.intent,a.references??[],(0,d.Z6)(s)?s:void 0)}async handleSearchCopilotEvent(e){let t=await this.createThread(),s=await this.fetchCurrentRepo(e.repoNwo),a=s?[{type:"repository",...s}]:[];this.openChat(t,"thread","search-bar"),this.expandChat(),await this.sendMessage(t,e.content,p.wh.conversation,a),(0,c.BI)("copilot.open_copilot_chat",{source:"search-bar"})}async handleAddReferenceEvent(e){await this.findOrStartNewThread(),this.addReference(e.reference,"event"),e.openPanel&&this.dispatch({type:"OPEN_COPILOT_CHAT",source:"event",id:e.id})}handleSymbolChangedEvent(e){let t=e.context;this.dispatch({type:"IMPLICIT_CONTEXT_UPDATED",context:[t]})}getSelectedThread(e){return e.selectedThreadID&&e.threads.get(e.selectedThreadID)||null}sortThreads(e){return Array.from(e.values()).sort((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime())}async sendMessageToNewThread(e,t,s,a){""!==t.trim()&&(e&&(E.J.setSavedMessageFast(e,null),E.J.clearCurrentReferences(e)),await this.sendMessage(null,t,p.wh.conversation,s,void 0,a))}async fetchMessages(e){let t=E.J.getCurrentReferences(e);if(!e){this.threadDataLoaded([],t||[]);return}this.dispatch({type:"MESSAGES_UPDATED",messages:[],state:"loading"});let s=await this.service.listMessages(e);if(s.ok){let e=s.payload.thread;this.threadDataLoaded(s.payload.messages,t||e.currentReferences||[])}else this.dispatch({type:"MESSAGES_UPDATED",state:"error"})}selectReference(e){this.dispatch({type:"SELECT_REFERENCE",reference:e})}setTopRepositoryTopics(e){this.dispatch({type:"SET_TOP_REPOSITORIES",topics:e})}async handleStreamingMessage(e,t,s){try{for await(let a of t.stream())await this.processStreamingMessage(e,a,s)}catch(s){let t=this.isWrappedStreamingResponseError(s)?this.getStreamingErrorMessage(s.error):f(this.service.ERROR_MSG);this.handleSendMessageError(e,t);return}}isWrappedStreamingResponseError(e){return!!e&&"object"==typeof e&&"error"in e&&!!e.error&&"object"==typeof e.error&&"errorType"in e.error&&"string"==typeof e.error.errorType&&p.C6.includes(e.error.errorType)}async processStreamingMessage(e,t,s){switch(t.type){case"content":this.dispatch({type:"MESSAGE_STREAMING_TOKEN_ADDED",token:t.body});break;case"functionCall":var a;a=t.name,(p.xP.includes(a)||g.W.issueCreation&&"githubissuecreate"===a)&&this.dispatch({type:"MESSAGE_STREAMING_FUNCTION_CALLED",name:t.name,status:t.status,arguments:t.arguments,errorMessage:t.errorMessage,references:t.references});break;case"confirmation":this.dispatch({type:"MESSAGE_STREAMING_CONFIRMATION",title:t.title,message:t.message,confirmation:t.confirmation});break;case"complete":this.dispatch({type:"MESSAGE_STREAMING_COMPLETED",messageResponse:t}),await this.handleSendMessageSuccess(e),s&&s.length>0&&g.W.followUpThreadSuggestions&&await this.generateSuggestions(s[0],e.id);break;case"error":{let s=this.getStreamingErrorMessage(t);this.handleSendMessageError(e,s);break}case"debug":console.log("Prompt Body:",t.body);break;case"agentError":this.dispatch({type:"AGENT_ERROR",error:{type:t.agentErrorType,code:t.code,message:t.message,identifier:t.identifier}})}}getStreamingErrorMessage(e){switch(e.errorType){case"filtered":return f(h.S[403]||this.service.ERROR_MSG);case"contentTooLarge":return f(h.S[413]||this.service.ERROR_MSG);case"rateLimit":return f(h.S[429]||this.service.ERROR_MSG);case"agentUnauthorized":{let t=JSON.parse(e.description);return{type:"agentUnauthorized",isError:!0,message:`You haven't authorized ${t.name} to access your account. You can do that by going here: ${window.location.origin}/login/oauth/authorize?client_id=${t.client_id}`,details:t}}case"agentRequest":{let t=JSON.parse(e.description);return{type:"agentRequest",isError:!0,message:t.message,details:t}}case"multipleAgentsAttempt":return f("Only one agent is allowed per thread, and their context can't be shared. If you want to interact with another agent, please start a new thread and @ mention the new agent.");case"networkError":return f(h.S[408]||this.service.ERROR_MSG);default:return f(this.service.ERROR_MSG)}}async handleSendMessageSuccess(e){E.J.setSavedMessage(e.id,null),E.J.clearCurrentReferences(e.id),this.dispatch({type:"WAITING_ON_COPILOT",loading:!1}),e=await this.generateThreadName(e),this.dispatch({type:"THREAD_UPDATED",thread:{...e,updatedAt:new Date().toISOString()}})}handleSendMessageError(e,t){let s=(0,d.Y6)({role:"assistant",content:"",error:t,thread:e});this.dispatch({type:"MESSAGE_ADDED",message:s}),this.dispatch({type:"WAITING_ON_COPILOT",loading:!1}),this.dispatch({type:"MESSAGE_STREAMING_FAILED"})}async fetchThreads(){this.dispatch({type:"THREADS_LOADING"});let e=await this.service.fetchThreads();return e.ok?(setTimeout(()=>this.dispatch({type:"THREADS_LOADED",threads:e.payload}),100),e.payload):(setTimeout(()=>this.dispatch({type:"THREADS_LOADING_ERROR",message:e.error}),100),null)}async findOrStartNewThread(e,t){let s=null;if(e)s=e;else{let e=await this.fetchThreads();if(e?.length){let t=E.J.selectedThreadID;s=t&&e.find(e=>e.id===t)||e[0]}}if(s&&(0,d.F2)(s)&&(s=null),s&&t){let e=await this.service.listMessages(s.id);if(e.ok){let a=e.payload.messages,r=a?.length;r>=2&&!a[r-2]?.references?.find(e=>d.x_(e,t))&&(s=null)}}return await this.selectThread(s,!1),s}async generateThreadName(e){if(e.name)return e;let t=await this.service.generateThreadName(e.id);return t.ok&&(e={...e,name:t.payload}),e}async fetchAgents(e){let t=await this.service.listAgents(e),s=[];return t.ok&&(s=t.payload,this.dispatch({type:"SET_AGENTS",agents:s})),s}async fetchCurrentRepo(e){this.dispatch({type:"CURRENT_TOPIC_UPDATED",topic:void 0,state:"loading"});let t=await this.service.fetchRepo(e);if(t.ok)return this.dispatch({type:"CURRENT_TOPIC_UPDATED",topic:t.payload,state:"loaded"}),t.payload;this.dispatch({type:"CURRENT_TOPIC_UPDATED",topic:void 0,state:"error"})}async fetchKnowledgeBases(){this.dispatch({type:"KNOWLEDGE_BASES_LOADING"});let e=await this.service.listDocsets();return e.ok?this.dispatch({type:"KNOWLEDGE_BASES_LOADED",knowledgeBases:e.payload}):this.dispatch({type:"KNOWLEDGE_BASES_LOADING_ERROR",message:e.error}),e}async fetchCurrentDocset(e){this.dispatch({type:"CURRENT_TOPIC_UPDATED",topic:void 0,state:"loading"});let t=await this.fetchKnowledgeBases();if(!t.ok){this.dispatch({type:"CURRENT_TOPIC_UPDATED",topic:void 0,state:"error"});return}let s=t.payload.find(t=>t.name===e);if(!s){this.dispatch({type:"CURRENT_TOPIC_UPDATED",topic:void 0,state:"error"});return}this.dispatch({type:"CURRENT_TOPIC_UPDATED",topic:s,state:"loaded"})}async fetchImplicitContext(e,t,s){let a=await this.service.fetchImplicitContext(e,t,s);if(a.ok){let e=a.payload?Array.isArray(a.payload)?a.payload:[a.payload]:void 0;this.dispatch({type:"IMPLICIT_CONTEXT_UPDATED",context:e})}}async deleteDocset(e){return(await this.service.deleteDocset(e)).ok}threadDataLoaded(e,t){this.dispatch({type:"MESSAGES_UPDATED",messages:e,state:"loaded"}),this.dispatch({type:"REFERENCES_LOADED",references:t})}constructor(e,t,s){this.unstickyReferencesFeatureEnabled=g.W.unstickyReferences,this.clearCurrentReferences=()=>{this.dispatch({type:"CLEAR_CURRENT_REFERENCES"})},this.clearCurrentTopic=()=>{this.dispatch({type:"CURRENT_TOPIC_UPDATED",topic:void 0,state:"loaded"})},this.showTopicPicker=(e=!0)=>{this.dispatch({type:"SHOW_TOPIC_PICKER",show:e})},this.dispatch=e,this.service=new h.k(t,s)}};function m(e){var t;return _(e,[p.wh.explain,p.wh.suggest])||_(e,[p.wh.conversation])&&"content"in(t=e)&&"string"==typeof t.content}function _(e,t){return new Set(t).has(e.intent)}function f(e){return{isError:!0,message:e,type:"basic"}}let T=(0,n.createContext)(null);function R({apiURL:e,state:t,dispatch:s,ssoOrganizations:i,children:o}){let c=(0,n.useMemo)(()=>new CopilotChatManager(s,e,i),[s,e,i]);return(0,n.useEffect)(()=>{(async()=>{if(t.selectedThreadID&&t.messages.length>0&&!t.currentTopic){let e=E.J.getSelectedTopic(t.selectedThreadID);if(e){let t=Number(e);isNaN(t)?await c.fetchCurrentDocset(e):await c.fetchCurrentRepo(t)}}})()},[t.selectedThreadID,c,t.messages.length,t.currentTopic]),(0,n.useEffect)(()=>{let e=async()=>{let e=window.location.hash,t=window.location.pathname,s=window.location.hash?`${t}${e}`:t,a=s.slice(1).split("/");if(a.length<2)return;let r=a[0],n=a[1];r&&n&&await c.fetchImplicitContext(s,r,n)},t=(0,r.s)(()=>{e()},500);g.W.implicitContext&&(t(),function(){let{replaceState:e}=window.history;window.history.replaceState=function(...t){e.apply(window.history,t),window.dispatchEvent(new Event("replaceState"))},window.addEventListener("popstate",t),window.addEventListener("replaceState",t),()=>{window.removeEventListener("popstate",t),window.removeEventListener("replaceState",t)}}())},[c]),(0,a.jsx)(T.Provider,{value:c,children:o})}function S(){return(0,n.useContext)(T)}try{T.displayName||(T.displayName="CopilotChatManagerContext")}catch{}try{R.displayName||(R.displayName="CopilotChatManagerProvider")}catch{}}}]);
//# sourceMappingURL=ui_packages_copilot-chat_utils_copilot-chat-hooks_ts-ui_packages_issue-viewer_utils_queries_ts-274f3a84d125.js.map