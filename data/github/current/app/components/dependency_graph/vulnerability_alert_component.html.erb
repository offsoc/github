<%= render(Primer::Alpha::Overlay.new(
  title: "Alerts for package #{package_name}",
  id: "#{manifest_path}-#{package_name}-#{alerts_id}",
  role: :dialog,
  test_selector: "alerts_badge",
  style: "max-width:258px;width:258px"
)) do |overlay| %>
  <% overlay.with_show_button("aria-label": "Vulnerability Alerts", bg: badge_color, color: badge_color,
    size: :small, py: 0, border: 0, border_radius: 3 ) do |button| %>
    <% button.with_leading_visual_icon(icon: :shield, size: :xsmall) %>
    <% button.with_trailing_action_icon(icon: :"triangle-down") %>
    <%= highest_severity_count %> <%= highest_severity %>
  <% end %>
  <% overlay.with_body do %>
    <%= render(
    Primer::Alpha::ActionList.new(
      show_dividers: false, aria: { label: "Alerts" }, mt: 3)
    ) do |component| %>
      <% component.with_item(
        label: "View Dependabot #{'alert'.pluralize(alerts.count)}",
        href: repository_alerts_path(
          user_id: repository.owner_display_login,
          repository: repository.name,
          q: "package:#{package_name} manifest:#{manifest_path} is:open")
        ) do |item| %>
        <% item.with_leading_visual_icon(icon: :dependabot) %>
        <% item.with_description do %>
          <%= render(Primer::Beta::Text.new(color: :muted)) do %>
            <%= highest_severity_count %> <%= highest_severity %>
            &#183; <%= alerts.count%> total
          <% end %>
        <% end  %>
      <% end  %>
      <% if fixable_alerts? && dependabot_pr.present? %>
        <% component.with_item(
          label: "Update to v#{highest_fixed_in}",
          href: gh_show_pull_request_path(dependabot_pr)
          ) do |item| %>
          <% item.with_leading_visual_icon(icon: :"git-pull-request") %>
          <% item.with_description do %>
            <%= render(Primer::Beta::Text.new(color: :muted)) do %>
              #<%= dependabot_pr.number  %>
            <% end %>
        <% end  %>
        <% end %>
      <% end  %>
    <% end  %>
  <% end %>
  <% if fixable_alerts? %>
    <% overlay.with_footer(display: :block, show_divider: true) do %>
      <%= render(Primer::Box.new(px: 2)) do %>
        <%= primer_octicon(:"file-code", mr: 1) %>
        <%= render(Primer::Beta::Text.new(font_family: :mono, font_size: :small)) do %>
          <b><%= manifest_path %></b> update suggested:
        <% end %>
        <%= render(
          Primer::Box.new(
            border: true,
            border_radius: 2,
            display: :flex,
            my: 2,
            align_items: :center,
            justify_content: :space_between,
            style: "overflow: hidden")
          ) do %>
          <%= render(
            Primer::Beta::Text.new(tag: :div, id: "#{manifest_path}-#{package_name}-#{alerts_id}-update",
              font_family: :mono, font_size: :small,
              pl: 2,
              style: "white-space: nowrap;overflow: hidden;text-overflow: ellipsis;")
            ) do %><%= package_name %> ~&gt; <%= highest_fixed_in %>
          <% end %>
          <%= render(Primer::Beta::ClipboardCopy.new(
            for: "#{manifest_path}-#{package_name}-#{alerts_id}-update",
            "aria-label": "Copy text to the system clipboard",
            bg: :subtle,
            p: 2,
            border_radius: 0,
            border: :left,
            classes: "Button Button--iconOnly",
            style: "height:100%")) %>
        <% end %>
        <%= render(Primer::Beta::Text.new(tag: :p, font_size: :small, color: :subtle, style: "white-space: normal" )) do %>
          Always verify the validity and compatibility of suggestions with your codebase.
        <% end %>
      <% end %>
    <% end %>
  <% end %>
<% end %>
