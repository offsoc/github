"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["security-managers"],{25143:(e,t,s)=>{var a,r=s(86233),n=s(79840),i=s(9449),o=s(97665),l=s(65490);function c(e){return(0,i.jsx)(o.Ht,{client:new l.E,children:e.children})}try{c.displayName||(c.displayName="App")}catch{}var d=s(82897),u=s(59857),m=s(75177),h=s(44981),g=s(31881),p=s(13473),_=s(73729),y=s(69909),x=s(55293),f=s(28784),j=s(55847),b=s(86079),w=s(94407),v=s(54392),S=s(79849),N=s(97286),A=s(94747),k=s(47767);function C(){let[e,t]=(0,x.useState)(!1),[s,a]=(0,x.useState)(1),[r,n]=(0,x.useState)(""),[l,c]=(0,x.useState)([]),[d,h]=(0,x.useState)([]),[g,p]=(0,x.useState)(""),{business:_}=(0,k.g)(),{isLoading:y,isLoadingError:C,data:T}=(0,N.I)({queryKey:["assignment-suggestions",_],queryFn:async()=>{let e=new URL(`/enterprises/${_}/security-managers/assignment-suggestions`,window.location.origin),t=await (0,f.lS)(`${e.pathname}${e.search}`);if(!t.ok)throw Error("Failed to load teams");return t.json()},enabled:e});(0,x.useEffect)(()=>{C&&p("Failed to load teams. Please refresh the page and try again. If the issue persists, contact GitHub support.")},[C]),(0,x.useEffect)(()=>{C||(r?c((T??[]).filter(e=>e.name.toLowerCase().includes(r))):c(T??[]))},[r,T,C]);let R=(0,A.n)({mutationFn:async e=>{let t=new URL(`/enterprises/${_}/security-managers`,window.location.origin);return Promise.allSettled(e.map(e=>{let s={teamSlugs:[e.slug]};return(0,f.lS)(t.pathname,{method:"POST",body:s})}))}}),E=(0,x.useCallback)(()=>{n(""),c(T??[]),h([]),a(1),t(!1),R.reset()},[T,R]),F=(0,x.useCallback)(e=>{d.some(t=>t.slug===e.slug)?h(d.filter(t=>t.slug!==e.slug)):h(d.concat(e))},[d]),L=(0,o.jE)(),H=(0,x.useCallback)(async()=>{p(""),R.mutate(d,{onSettled:()=>L.invalidateQueries({queryKey:["assignment-suggestions",_]}),onSuccess:e=>{h(d.filter((t,s)=>null==e[s]||"fulfilled"!==e[s].status||!e[s].value.ok)),e.every(e=>"fulfilled"===e.status&&e.value.ok)?(E(),window.location.reload()):e.some(e=>"fulfilled"===e.status&&e.value.ok)?p("Some teams could not be assigned the security manager role. Please try again. If the issue persists, contact GitHub support."):p("Failed to assign the security manager role. Please try again. If the issue persists, contact GitHub support.")}})},[d,R,L,_,E]),I=R.isPending,P=1===s?[{content:"Cancel",onClick:E},{content:"Next",onClick:()=>{d.length>0?a(2):p("Please select at least one team to assign to the security manager role.")},buttonType:"primary",disabled:y}]:[{content:"Back",disabled:I,onClick:()=>a(1)},{content:"Yes, assign the role",onClick:H,buttonType:"primary",loading:I,loadingAnnouncement:"Saving"}];(0,x.useEffect)(()=>p(""),[s,e]);let q=(0,x.useRef)(null);return(0,x.useEffect)(()=>{g&&q.current?.querySelector("h2")?.focus()},[g]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(j.Q,{variant:"primary",onClick:()=>t(!0),"aria-haspopup":"dialog","data-testid":"assignment-dialog-button",children:"Assign new team"}),e&&(0,i.jsx)(b.l,{title:"Assign security manager role",onClose:E,height:1===s?"small":"auto",width:"large",renderBody:({children:e})=>(0,i.jsx)(b.l.Body,{sx:{height:"100%",p:0},children:e}),footerButtons:P,children:(0,i.jsxs)(m.A,{className:"d-flex flex-column",sx:{maxHeight:"100%"},children:[g&&(0,i.jsxs)(v.l,{variant:"critical",className:"m-2",ref:q,children:[(0,i.jsx)(v.l.Title,{as:"h2",tabIndex:-1,children:"Something went wrong"}),g]}),1===s&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(S.u,{placeholderText:"Search for teams","aria-label":"Select teams",selectionVariant:"multiple","aria-multiselectable":!0,onFilterChange:n,loading:y,items:l.map(e=>({id:e.slug,text:e.name,selected:d.some(t=>t.slug===e.slug),onAction:()=>F(e),role:"option"})),textInputProps:{sx:{m:2},contrast:!0,leadingVisual:u.SearchIcon}}),!y&&0===l.length&&(0,i.jsxs)(w.A,{spacious:!0,children:[(0,i.jsx)(w.A.Heading,{children:"No teams found"}),(0,i.jsx)(w.A.Description,{children:r?"No teams found for the search term.":"Create a team to assign the security manager role."})]})]}),2===s&&(0,i.jsxs)("div",{className:"p-2",children:[(0,i.jsx)("p",{className:"text-bold mx-2",children:"We will add the team members to all organizations within your enterprise."}),(0,i.jsx)("p",{className:"mx-2",children:"This change will notify the owners of each of these organizations."}),(0,i.jsx)("p",{className:"mx-2",children:"Please note that this change may take some time to propagate to all organizations."}),(0,i.jsx)("p",{className:"mx-2",children:"Are you sure you want to proceed?"})]})]})})]})}try{C.displayName||(C.displayName="AssignmentDialog")}catch{}var T=s(86519),R=s(281),E=s(87330),F=s(17909),L=s(33520),H=s(38553);function I({search:e,hideRemoveAction:t=!1}){let s;let{business:a}=(0,k.g)(),[r,n]=(0,x.useState)([]),[o,l]=(0,x.useState)(1),[c,d]=(0,x.useState)(0),[m,h]=(0,x.useState)(null),{isSuccess:g,isFetching:p,isError:_,refetch:y,data:j}=(0,N.I)({queryKey:["security-manager-teams",a,o,e],queryFn:async()=>{let t=new URL(`/enterprises/${a}/security-managers/teams`,window.location.origin),s=new URLSearchParams({page:o.toString(),search:e});t.search=s.toString();let r=await (0,f.lS)(t.toString());if(!r.ok)throw Error("Failed to fetch security manager teams");return r.json()}});return(0,x.useEffect)(()=>{if(j){let{teams:e,totalPages:t}=j;n(e),d(t),o>t&&l(t)}},[o,j]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"border rounded-2",children:[p&&(0,i.jsx)("div",{className:"d-flex flex-items-center flex-justify-center flex-auto p-3",children:(0,i.jsx)(H.A,{srText:"Fetching Security manager teams"})}),_&&(0,i.jsx)("div",{className:"d-flex flex-items-center flex-justify-center flex-auto p-3",children:"Error loading security manager teams, please try again."}),g&&(0,i.jsx)(function(){let e=r.map(e=>(0,i.jsxs)("div",{"data-testid":`esm-team-${e.slug}`,className:"d-flex flex-items-center flex-justify-between border-bottom p-3",children:[(0,i.jsxs)("div",{className:"d-flex flex-items-center",children:[(0,i.jsx)(u.GlobeIcon,{size:24,className:"border rounded-1 p-1"}),(0,i.jsx)(T.A,{href:e.path,muted:!0,className:"pl-2",children:e.name})]}),!t&&(0,i.jsxs)(R.W,{children:[(0,i.jsx)(R.W.Anchor,{children:(0,i.jsx)(E.K,{icon:u.KebabHorizontalIcon,size:"small","aria-label":"Open column options",variant:"invisible","data-testid":`column-options-${e.slug}`})}),(0,i.jsx)(R.W.Overlay,{align:"end",children:(0,i.jsx)(F.l,{children:(0,i.jsx)(F.l.Item,{variant:"danger",onSelect:()=>h(e),"data-testid":`remove-team-${e.slug}`,children:"Remove"})})})]})]},e.slug));return 0===e.length?(0,i.jsxs)(w.A,{children:[(0,i.jsx)(w.A.Visual,{children:(0,i.jsx)(u.GlobeIcon,{size:24})}),(0,i.jsx)(w.A.Heading,{children:"No security manager teams found"})]}):(0,i.jsxs)(i.Fragment,{children:[e,(0,i.jsx)(L.A,{currentPage:o,pageCount:c,onPageChange:(e,t)=>l(t)})]})},{})]}),null!=m&&(0,i.jsx)(b.l,{onClose:()=>h(null),title:"Remove security manager",footerButtons:[{content:"Cancel",onClick:()=>h(null)},{content:"Remove security manager team permission",onClick:(s=m.slug,async()=>{let e=new URL(`/enterprises/${a}/security-managers/${s}`,window.location.origin),t=await (0,f.lS)(e.toString(),{method:"DELETE"});h(null),t.ok&&y()}),buttonType:"danger"}],children:(0,i.jsxs)("div",{className:"p-2",children:[(0,i.jsx)("p",{className:"mx-2",children:"This action will remove team members from all organizations within your enterprise unless they were already members of those organizations. Existing organization members will retain their membership."}),(0,i.jsx)("p",{className:"mx-2",children:"This change will notify the owners of each of these organizations."}),(0,i.jsx)("p",{className:"mx-2",children:"Please note that this change may take some time to propagate to all organizations."}),(0,i.jsx)("p",{className:"mx-2",children:"Are you sure you want to proceed?"})]})})]})}try{I.displayName||(I.displayName="SecurityManagerTeamList")}catch{}try{(a=TeamList).displayName||(a.displayName="TeamList")}catch{}function P(){let e=(0,d.B)(),[t,s]=(0,x.useState)(""),a=(0,i.jsxs)(m.A,{sx:{mb:3,display:"flex",justifyContent:"space-between"},children:[(0,i.jsx)(h.A,{"data-testid":"search-input",leadingVisual:u.SearchIcon,"aria-label":"Find a team search bar",name:"search",value:t,onChange:e=>s(e.target.value),placeholder:"Find a team...",sx:{width:"30%",bg:"canvas.subtle"}}),!e.readonly&&(0,i.jsx)(C,{})]});return(0,i.jsxs)(g.M,{sx:{padding:"none"},children:[(0,i.jsx)(g.M.Header,{sx:{marginBottom:3},children:(0,i.jsx)(p.A,{className:"pt-0 pb-2 mb-0",children:(0,i.jsx)(_.A,{as:"h2","data-testid":"page-heading",className:"f2",sx:{fontWeight:"normal"},children:"Security managers"})})}),(0,i.jsxs)(g.M.Content,{as:"div",children:[(0,i.jsx)("div",{className:"mb-3",children:(0,i.jsxs)(y.A,{sx:{color:"fg.muted",lineHeight:"20px",fontSize:"14px"},children:["Grant a team permission to manage security alerts and settings across your organizations. The teams will also be granted read access to all repositories."," "]})}),a,(0,i.jsx)(I,{search:t,hideRemoveAction:e.readonly||!e.canRemoveTeams})]})]})}try{P.displayName||(P.displayName="EnterpriseSecurityManagers")}catch{}(0,n.Q)("security-managers",()=>({App:c,routes:[(0,r.a)({path:"/enterprises/:business/security-managers",Component:P})]}))},28784:(e,t,s)=>{function a(e,t={}){!function(e){if(new URL(e,window.location.origin).origin!==window.location.origin)throw Error("Can not make cross-origin requests from verifiedFetch")}(e);let s={...t.headers,"GitHub-Verified-Fetch":"true","X-Requested-With":"XMLHttpRequest"};return fetch(e,{...t,headers:s})}function r(e,t){let s={...t?.headers??{},Accept:"application/json","Content-Type":"application/json"},r=t?.body?JSON.stringify(t.body):void 0;return a(e,{...t,body:r,headers:s})}function n(e,t={}){let s={...t.headers,"GitHub-Is-React":"true"};return a(e,{...t,headers:s})}function i(e,t){let s={...t?.headers??{},"GitHub-Is-React":"true"};return r(e,{...t,headers:s})}s.d(t,{DI:()=>a,QJ:()=>n,Sr:()=>i,lS:()=>r})},86233:(e,t,s)=>{s.d(t,{a:()=>a});function a({path:e,Component:t,shouldNavigateOnError:s,transitionType:a,children:r}){return{path:e,Component:t,coreLoader:async function({location:e}){let t;try{let s=`${e.pathname}${e.search}`;t=await window.fetch(s,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-GitHub-Target":"dotcom","X-React-Router":"json"}})}catch(e){return{type:s?"route-handled-error":"error",error:{type:"fetchError"}}}if(t.redirected)return{type:"redirect",url:t.url};if(!t.ok)return{type:s?"route-handled-error":"error",error:{type:"httpError",httpStatus:t.status}};try{let e=await t.json();return{type:"loaded",data:e,title:e.title}}catch(e){return{type:s?"route-handled-error":"error",error:{type:"badResponseError"}}}},loadFromEmbeddedData:function({embeddedData:e}){return{data:e,title:e.title}},transitionType:a,children:r}}}},e=>{var t=t=>e(e.s=t);e.O(0,["react-lib","primer-react-css","vendors-node_modules_github_mini-throttle_dist_index_js-node_modules_primer_octicons-react_di-b40d97","vendors-node_modules_primer_react_lib-esm_Box_Box_js","vendors-node_modules_primer_react_lib-esm_Button_Button_js","vendors-node_modules_primer_react_lib-esm_TooltipV2_Tooltip_js","vendors-node_modules_primer_react_node_modules_primer_octicons-react_dist_index_esm_mjs","vendors-node_modules_primer_react_lib-esm_ActionList_index_js","vendors-node_modules_primer_react_lib-esm_ActionMenu_ActionMenu_js-node_modules_primer_react_-5b2420","vendors-node_modules_github_catalyst_lib_index_js-node_modules_github_hydro-analytics-client_-7901e7","vendors-node_modules_primer_react_lib-esm_FilteredActionList_FilteredActionList_js","vendors-node_modules_primer_react_lib-esm_Heading_Heading_js-node_modules_primer_react_lib-es-cdb604","vendors-node_modules_primer_react_lib-esm_PageLayout_PageLayout_js","vendors-node_modules_tanstack_query-core_build_modern_queryClient_js-node_modules_tanstack_qu-0e879d","vendors-node_modules_primer_react_lib-esm_Banner_index_js-node_modules_primer_react_lib-esm_B-f80ec0","ui_packages_react-core_create-browser-history_ts-ui_packages_safe-storage_safe-storage_ts-ui_-682c2c","ui_packages_react-core_register-app_ts"],()=>t(25143)),e.O()}]);
//# sourceMappingURL=security-managers-991279f1eff8.js.map