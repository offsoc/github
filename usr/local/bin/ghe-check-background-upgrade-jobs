#!/bin/bash
#/ Usage: ghe-check-background-upgrade-jobs
#/
#/ Check if background upgrade jobs are completed or not.

set -e

export PATH="$PATH:/usr/local/share/enterprise"

. /usr/local/share/enterprise/ghe-systemd-lib.sh

if is_cluster_delegate; then
  ghe-check-elasticsearch-upgrade
else
  cluster_delegate="$(/usr/local/share/enterprise/ghe-call-configrb ghes_cluster_delegate)"
  ssh $cluster_delegate "/usr/local/share/enterprise/ghe-check-elasticsearch-upgrade"
fi

echo "All background upgrade jobs are completed"
