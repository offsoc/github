# typed: true
# frozen_string_literal: true

# Security Center subscribes to the `github.security_alerts.v1.RepositoryVulnerabilityAlertLifecycleEvent` Hydro topic
# for Dependabot alert lifecycle events.

GitHub.subscribe("error.active_job") do |*, payload|
  job, error = payload.values_at(:job, :error)
  next unless job.is_a?(VulnerableVersionRangeCreateVulnerabilityAlertsJob)
  next unless error.is_a?(Exception)

  job.report_failure(error)
end
