"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["ui_packages_copilot-pr-review-banner_CopilotPrReviewBanner_tsx"],{39294:(e,t,a)=>{a.d(t,{J:()=>CopilotAuthTokenProvider});let AuthToken=class AuthToken{get authorizationHeaderValue(){return`GitHub-Bearer ${this.value}`}needsRefreshing(e){return this.isExpired||this.ssoChanged(e)}get isExpired(){let e=new Date(this.expiration);return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()))<new Date(Date.now()+15e3)}ssoChanged(e){return!(this.ssoOrgIDs.every(t=>e.includes(t))&&e.every(e=>this.ssoOrgIDs.includes(e)))}static fromResult(e,t){return new AuthToken(e.token,e.expiration,t)}serialize(){return{value:this.value,expiration:this.expiration,ssoOrgIDs:this.ssoOrgIDs}}static deserialize(e){return new AuthToken(e.value,e.expiration,e.ssoOrgIDs)}constructor(e,t,a){this.value=e,this.expiration=t,this.ssoOrgIDs=a}};var s=a(74572),r=a(28784);let i="COPILOT_AUTH_TOKEN";let CopilotAuthTokenProvider=class CopilotAuthTokenProvider{async getAuthToken(){let e=this.getLocalStorageAuthToken();return e?this.validateAuthToken(e):this.fetchAuthToken()}setLocalStorageAuthToken(e){this.copilotLocalStorage.setItem(i,JSON.stringify(e.serialize()))}getLocalStorageAuthToken(){let e=this.copilotLocalStorage.getItem(i);return e?AuthToken.deserialize(JSON.parse(e)):null}async validateAuthToken(e){return e.needsRefreshing(this.ssoOrgIDs)?this.fetchAuthToken():e}fetchAuthToken(){return this.currentAuthTokenRequest||(this.currentAuthTokenRequest=this._fetchAuthToken()),this.currentAuthTokenRequest}async _fetchAuthToken(){let e=await (0,r.lS)("/github-copilot/chat/token",{method:"POST"});if(e.ok){let t=await e.json();this.currentAuthTokenRequest=null;let a=AuthToken.fromResult(t,this.ssoOrgIDs);return this.setLocalStorageAuthToken(a),a}throw this.currentAuthTokenRequest=null,Error("Failed to mint new auth token")}constructor(e){this.ssoOrgIDs=e,this.currentAuthTokenRequest=null,this.copilotLocalStorage=(0,s.A)("localStorage",{throwQuotaErrorsOnSet:!1,ttl:864e5})}}},25962:(e,t,a)=>{a.d(t,{Bc:()=>i,uN:()=>r,wg:()=>s});let s="copilot-chat-textarea",r="copilot-chat-topic-search",i="Review"},822:(e,t,a)=>{a.d(t,{HS:()=>i,Oc:()=>r,Tv:()=>l,Xr:()=>SymbolChangedEvent,f7:()=>o,fD:()=>n,qR:()=>s});let OpenCopilotChatEvent=class OpenCopilotChatEvent extends Event{constructor(e){super("open-copilot-chat",{bubbles:!1,cancelable:!0}),this.payload=e}};let AddCopilotChatReferenceEvent=class AddCopilotChatReferenceEvent extends Event{constructor(e,t=!1,a){super("add-copilot-chat-reference",{bubbles:!1,cancelable:!0}),this.reference=e,this.openPanel=t,this.id=a}};let SymbolChangedEvent=class SymbolChangedEvent extends Event{constructor(e){super("symbol-changed",{bubbles:!1,cancelable:!0}),this.context=e}};function s(e){window.dispatchEvent(new OpenCopilotChatEvent(e))}function r(e,t=!1,a){window.dispatchEvent(new AddCopilotChatReferenceEvent(e,t,a))}function i(e){return window.addEventListener("open-copilot-chat",e),()=>{window.removeEventListener("open-copilot-chat",e)}}function o(e){return window.addEventListener("add-copilot-chat-reference",e),()=>{window.removeEventListener("add-copilot-chat-reference",e)}}function n(e){return window.addEventListener("search-copilot-chat",e),()=>{window.removeEventListener("search-copilot-chat",e)}}function l(e){return window.addEventListener("symbol-changed",e),()=>{window.removeEventListener("symbol-changed",e)}}},37414:(e,t,a)=>{a.d(t,{k:()=>CopilotChatService,S:()=>l});var s=a(39294),r=a(83056),i=a(28784);let ApiCache=class ApiCache{async get(...e){let t=e.join(this.separator),a=this.cache.get(t);if(a)return a;{let a=this.fetchFn(...e);return this.cache.set(t,a),(await a).ok||this.cache.delete(t),a}}constructor(e){this.fetchFn=e,this.separator="-!-",this.cache=new Map}};var o=a(88043);let n=new Set(["snippet","file","symbol","docset","repository"]),l={400:"This message could not be processed.",401:"You\u2019re not authorized to use Copilot.",403:"This response could not be shown as it violates GitHub\u2019s content policies.",404:"Resource not found. Please try again.",408:"Your network connection was interrupted. Please try again.",413:"Message too large. Please shorten it or remove some references and try again.",429:"GitHub API rate limit exceeded. Please wait and try again."};let CopilotChatService=class CopilotChatService{async fetchThreads(e={}){let t=new URLSearchParams;"string"==typeof e.name&&t.set("name",e.name);let a=`/threads?${t.toString()}`,s=await this.makeCAPIRequest(a,"GET");if(!s.ok)return s;let r=(await s.json()).threads||[];return{status:s.status,ok:!0,payload:r}}async createThread(){let e=await this.makeCAPIRequest("/threads","POST");if(!e.ok)return e;let t=(await e.json()).thread;return{status:e.status,ok:!0,payload:t}}async deleteThread(e){let t=await this.makeCAPIRequest(`/threads/${e}`,"DELETE");return t.ok?{status:t.status,ok:!0,payload:null}:t}async renameThread(e,t){let a=await this.makeCAPIRequest(`/threads/${e}/name`,"PATCH",{generate:!1,name:t});if(!a.ok)return a;let s=(await a.json()).name||"";return{status:a.status,ok:!0,payload:s}}async clearThread(e){let t=await this.makeCAPIRequest(`/threads/${e}/clear`,"PATCH");return t.ok?{status:t.status,ok:!0,payload:null}:t}async generateThreadName(e){let t=await this.makeCAPIRequest(`/threads/${e}/name`,"PATCH",{generate:!0,name:""});if(!t.ok)return t;let a=(await t.json()).name||"";return{status:t.status,ok:!0,payload:a}}async listMessages(e){if(this.listMessagesCache?.thread.id===e)return{status:200,ok:!0,payload:this.listMessagesCache};let t=await this.makeCAPIRequest(`/threads/${e}/messages`,"GET");if(!t.ok)return t;let a=await t.json();return this.listMessagesCache=a,{status:t.status,ok:!0,payload:a}}async createMessage(e,t,a,s,r){this.listMessagesCache=void 0;let i=await this.makeCAPIRequest(`/threads/${e}/messages`,"POST",{content:t,intent:a,references:s,currentURL:window.location.href,customInstructions:r});if(!i.ok)return i;let o=(await i.json()).message;return{status:i.status,ok:!0,payload:o}}async createMessageStreaming(e,t,a,s,r,i,o,n){this.listMessagesCache=void 0;let l={content:t,intent:a,references:s,context:r,currentURL:window.location.href,streaming:!0,confirmations:i,customInstructions:o,knowledgeBases:n},c=await this.makeCAPIRequest(`/threads/${e}/messages`,"POST",l,!0);return c.ok?{status:c.status,ok:!0,response:c}:c}async sendFeedback({feedback:e,feedbackChoice:t,messageId:a,threadId:s,textResponse:r}){let i=await this.makeDotcomRequest(`${this.urlPathPrefix}/feedback`,"POST",{feedback:e,feedback_choice:t,message_id:a,thread_id:s,text_response:r});return i.ok?{status:i.status,ok:!0,payload:null}:i}async listDocsets(){let e=await this.fetchDocsetsResponse();return e.ok?{status:200,ok:!0,payload:e.payload.knowledgeBases}:e}async listAdministratedCopilotEnterpriseOrganizations(){let e=await this.fetchDocsetsResponse();return e.ok?{status:200,ok:!0,payload:e.payload.administratedCopilotEnterpriseOrganizations}:e}fetchDocsetsResponse(){return this.docsetsPromise||(this.docsetsPromise=this.docsetRequestPromise()),this.docsetsPromise}async docsetRequestPromise(){let e=await this.makeDotcomRequest("/github-copilot/docs/docsets","GET");return e.ok?{status:200,ok:!0,payload:await e.json()}:e}async deleteDocset(e){let t=await this.makeDotcomRequest(`/copilot/docsets/${e.id}`,"DELETE");return t.ok?{status:t.status,ok:!0,payload:null}:t}async listRepoFiles(e){let t=(0,r.Cl)({repo:e,commitOid:e.commitOID,includeDirectories:!1});return this.repoFilesCache.get(t)}async querySymbols(e,t){return this.querySymbolsCache.get(e.ownerLogin,e.name,t)}async fetchImplicitContext(e,t,a){let s=await this.makeDotcomRequest(`${this.urlPathPrefix}/implicit-context/${t}/${a}/${encodeURIComponent(e)}`,"GET");return s.ok?{status:s.status,ok:s.ok,payload:await s.json()}:s}async fetchRepo(e){let t;if(this.repoDetailsCache.has(e))t=this.repoDetailsCache.get(e);else{let a=await this.makeDotcomRequest(`${this.urlPathPrefix}/repositories/${e}`,"GET");if(!a.ok)return a;t=await a.json(),this.repoDetailsCache.set(e,t)}return{status:200,ok:!0,payload:t}}async listAgents(e){let t=await (0,i.lS)(e);if(!t.ok)return{status:t.status,ok:!1,error:l[t.status]||this.ERROR_MSG};let a=await t.json();return{status:t.status,ok:t.ok,payload:a}}async hydrateReference(e){if(!n.has(e.type))return{status:204,ok:!0,payload:e};let t=await this.makeDotcomRequest(`${this.urlPathPrefix}/reference_details`,"POST",{reference:e});return t.ok?{status:t.status,ok:t.ok,payload:await t.json()}:t}async fetchLanguageForFileReference(e){let{repoOwner:t,repoName:a}=e,s=window.btoa(e.path),i=(0,r.RT)({ownerLogin:t,name:a},s,!0),o=await this.makeDotcomRequest(i,"GET");return o.ok?{status:o.status,ok:o.ok,payload:await o.json()}:o}async generateSuggestions(e,t){let a={context:[e],currentUrl:`${window.location.href}`},s=await this.makeCAPIRequest(`/threads/${t}/suggestions`,"POST",a);if(!s.ok)return s;let r=await s.json();return{status:s.status,ok:s.ok,payload:r}}async makeDotcomRequest(e,t,a){let s={};for(let e of(0,o.f)()){let t=e.split("="),a=t[0]?.replaceAll("_","-"),r="1";t.length>1&&(r=t[1]),s[`X-Experiment-${a}`]=r}let r=await this.copilotAuthTokenProvider.getAuthToken();s["X-Copilot-Api-Token"]=r.value;try{let r=await (0,i.lS)(e,{method:t,body:a,headers:s});if(r.ok)return r;return{status:r.status,ok:!1,error:l[r.status]||this.ERROR_MSG}}catch(e){return{status:500,ok:!1,error:this.ERROR_MSG}}}get directConnectConfiguration(){return{integrationID:"copilot-chat"}}async makeCAPIRequest(e,t,a,s=!1,r="/github/chat"){try{let i=this.apiURL,n={Authorization:(await this.copilotAuthTokenProvider.getAuthToken()).authorizationHeaderValue,"copilot-integration-id":this.directConnectConfiguration.integrationID};for(let e of(0,o.f)()){let t=e.split("="),a=t[0]?.replaceAll("_","-"),s="1";t.length>1&&(s=t[1]),n[`X-Experiment-${a}`]=s}s&&(n["Content-Type"]="text/event-stream");let c=await fetch(i+r+e,{method:t,mode:"cors",cache:"no-cache",headers:n,body:JSON.stringify(a)});if(c.ok)return c;return{status:c.status,ok:!1,error:l[c.status]||this.ERROR_MSG}}catch(e){return{status:500,ok:!1,error:this.ERROR_MSG}}}constructor(e,t){this.urlPathPrefix="/github-copilot/chat",this.ERROR_MSG="I'm sorry but there was an error. Please try again.",this.docsetsPromise=void 0,this.repoDetailsCache=new Map,this.listMessagesCache=void 0,this.listRepoFilesImpl=async e=>{let t=await this.makeDotcomRequest(e,"GET");return t.ok?{status:200,ok:!0,payload:(await t.json()).paths||[]}:t},this.repoFilesCache=new ApiCache(this.listRepoFilesImpl),this.querySymbolsImpl=async(e,t,a)=>{let s=await this.makeDotcomRequest(`/search/suggestions?query=repo:${e}/${t} ${a}`,"GET");return s.ok?{status:200,ok:!0,payload:(await s.json()).suggestions.filter(e=>"SUGGESTION_KIND_SYMBOL"===e.kind)}:s},this.querySymbolsCache=new ApiCache(this.querySymbolsImpl),this.apiURL=e,this.copilotAuthTokenProvider=new s.J(t.map(e=>e.id))}}},89426:(e,t,a)=>{a.d(t,{C6:()=>i,G7:()=>s,wh:()=>r,xP:()=>o});let s="tree-comparison",r={explain:"explain",conversation:"conversation",suggest:"suggest",askDocs:"ask-docs",discussFileDiff:"discuss-file-diff",explainFileDiff:"explain-file-diff",reviewPr:"review-pull-request"},i=["exception","filtered","contentTooLarge","rateLimit","agentUnauthorized","agentRequest","networkError","multipleAgentsAttempt"],o=["bing-search","codesearch","kb-search","pathsearch","show-symbol-definition","getissue","getprcommits","getcommit","getrelease","getrepo","getdiff","get-diff-by-range","getfile","getfilechanges","getdiscussion","get-actions-job-logs","getpullrequest","getalert","planskill","get-github-data","support-search"]},88043:(e,t,a)=>{a.d(t,{R:()=>o,f:()=>i});var s=a(74572);let r="copilot_experiments";function i(){let e=(0,s.A)("localStorage").getItem(r);return e?e.split(","):[]}function o(e){(0,s.A)("localStorage").setItem(r,e.join(","))}},50:(e,t,a)=>{a.r(t),a.d(t,{default:()=>r});let s=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"pullRequestId"}],t=[{kind:"Variable",name:"id",variableName:"pullRequestId"}],a={alias:null,args:null,kind:"ScalarField",name:"additions",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"deletions",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"login",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"baseRefOid",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"databaseId",storageKey:null},n=[o],l={alias:null,args:null,kind:"ScalarField",name:"closed",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"headRefOid",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"isDraft",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"isCopilotDotcomChatEnabled",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},m=[o,p];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"useLoadTreeComparisonQuery",selections:[{alias:null,args:t,concreteType:null,kind:"LinkedField",name:"node",plural:!1,selections:[{kind:"InlineFragment",selections:[a,s,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"author",plural:!1,selections:[r],storageKey:null},i,{alias:null,args:null,concreteType:"Repository",kind:"LinkedField",name:"baseRepository",plural:!1,selections:n,storageKey:null},l,c,{alias:null,args:null,concreteType:"Repository",kind:"LinkedField",name:"headRepository",plural:!1,selections:n,storageKey:null},d],type:"PullRequest",abstractKey:null}],storageKey:null},{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"viewer",plural:!1,selections:[r,u],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"useLoadTreeComparisonQuery",selections:[{alias:null,args:t,concreteType:null,kind:"LinkedField",name:"node",plural:!1,selections:[h,{kind:"InlineFragment",selections:[a,s,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"author",plural:!1,selections:[h,r,p],storageKey:null},i,{alias:null,args:null,concreteType:"Repository",kind:"LinkedField",name:"baseRepository",plural:!1,selections:m,storageKey:null},l,c,{alias:null,args:null,concreteType:"Repository",kind:"LinkedField",name:"headRepository",plural:!1,selections:m,storageKey:null},d],type:"PullRequest",abstractKey:null},p],storageKey:null},{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"viewer",plural:!1,selections:[r,u,p],storageKey:null}]},params:{id:"92dd75761b2c940ba7e1d7021b0b3348",metadata:{},name:"useLoadTreeComparisonQuery",operationKind:"query",text:null}}}();s.hash="d4ea9de9ca211f8b71b5528149cae5bd";let r=s},23398:(e,t,a)=>{a.d(t,{A:()=>n});var s=a(74848),r=a(59857),i=a(75177),o=a(38553);function n(e){let{isLoading:t,isError:a,hasUnreadMessages:n,zIndex:l,fill:c,bg:d,borderColor:u,customIcon:h}=e;return(0,s.jsxs)(i.A,{sx:{borderRadius:"100%",position:"relative",bg:d||(a?"attention.subtle":"canvas.subtle"),width:24,height:24,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid",borderColor:u||(a?"attention.muted":"border.default"),color:c||(t?"accent.fg":"fg.default"),zIndex:l||-1,flexShrink:0},children:[(0,s.jsx)(i.A,{sx:{position:"absolute",display:t?"flex":"none"},children:(0,s.jsx)(o.A,{size:"medium",sx:{width:24,height:24,color:"accent.fg"}})}),n&&(0,s.jsx)(i.A,{className:"unread-indicator",sx:{width:"10px",height:"10px",left:"16px",top:"-2px",borderColor:"canvas.default"}}),h||(0,s.jsx)(r.CopilotIcon,{size:12}),a?(0,s.jsx)(i.A,{sx:{position:"absolute",bottom:0,right:0,transform:"translate(4px,4px)",color:"attention.fg"},children:(0,s.jsx)(r.AlertFillIcon,{size:12})}):null]})}try{n.displayName||(n.displayName="CopilotBadge")}catch{}},85618:(e,t,a)=>{a.d(t,{jI:()=>ek});var s=a(74848),r=a(96540),i=a(89426);let o=(0,r.createContext)(void 0),n=({children:e,...t})=>{let[a,n]=(0,r.useState)({baseRepoId:t.baseRepoId??0,baseRevision:t.baseRevision??"",headRepoId:t.headRepoId??0,headRevision:t.headRevision??""}),{baseRepoId:l,headRepoId:d,baseRevision:u,headRevision:h}=a,p=(0,r.useMemo)(()=>({setTreeComparison:n,treeComparison:c({baseRepoId:l,baseRevision:u,headRepoId:d,headRevision:h})?{type:i.G7,baseRevision:u,headRevision:h,baseRepoId:l,headRepoId:d,diffHunks:[]}:void 0}),[l,u,d,h]);return(0,s.jsx)(o.Provider,{value:p,children:e})},l=()=>{let e=(0,r.useContext)(o);if(!e)throw Error("useTreeComparison must be used with TreeComparisonProvider.");return e},c=({baseRepoId:e,baseRevision:t,headRepoId:a,headRevision:s})=>void 0!==e&&0!==e&&void 0!==a&&0!==a&&void 0!==t&&""!==t&&void 0!==s&&""!==s;try{o.displayName||(o.displayName="TreeComparisonContext")}catch{}try{n.displayName||(n.displayName="TreeComparisonProvider")}catch{}var d=a(37414);let u=(0,r.createContext)(void 0),h=({children:e,...t})=>{let[a,i]=(0,r.useState)({ssoOrganizations:t.ssoOrganizations??[],apiURL:t.apiURL??""}),{apiURL:o,ssoOrganizations:n}=a,l=(0,r.useMemo)(()=>{let e;return t.chatService?e=t.chatService:void 0!==n&&o.length>0&&(e=new d.k(o,n)),{chatService:e,setChatServiceData:i}},[o,t.chatService,n]);return(0,s.jsx)(u.Provider,{value:l,children:e})},p=()=>{let e=(0,r.useContext)(u);if(!e)throw Error("useChatService must be used with CopilotChatServiceProvider.");return e};try{u.displayName||(u.displayName="CopilotChatServiceContext")}catch{}try{h.displayName||(h.displayName="CopilotChatServiceProvider")}catch{}let m=(0,r.createContext)(void 0),g=({children:e})=>{let[t,a]=(0,r.useState)({hasDiffHunks:!1}),i=(0,r.useMemo)(()=>({completionData:t,setCompletionData:a}),[t]);return(0,s.jsx)(m.Provider,{value:i,children:e})},y=()=>{let e=(0,r.useContext)(m);if(!e)throw Error("useReviewCompletionData must be used with ReviewCompletionDataProvider.");return e};try{m.displayName||(m.displayName="ReviewCompletionDataContext")}catch{}try{g.displayName||(g.displayName="ReviewCompletionDataProvider")}catch{}let f=(0,r.createContext)(void 0),v=({children:e})=>{let[t,a]=(0,r.useState)(),i=(0,r.useMemo)(()=>({reviewThread:t,setReviewThread:a}),[t]);return(0,s.jsx)(f.Provider,{value:i,children:e})},k=()=>{let e=(0,r.useContext)(f);if(!e)throw Error("useReviewThread must be used with ReviewThreadProvider.");return e};try{f.displayName||(f.displayName="ReviewThreadContext")}catch{}try{v.displayName||(v.displayName="ReviewThreadProvider")}catch{}let w=(0,r.createContext)(void 0),C=({children:e,...t})=>{let[a,i]=(0,r.useState)(t.threadName),o=(0,r.useMemo)(()=>({threadName:a,setThreadName:i}),[a]);return(0,s.jsx)(w.Provider,{value:o,children:e})},x=()=>{let e=(0,r.useContext)(w);if(!e)throw Error("useThreadName must be used with ThreadNameProvider.");return e};try{w.displayName||(w.displayName="ThreadNameContext")}catch{}try{C.displayName||(C.displayName="ThreadNameProvider")}catch{}var b=a(25962);function R(e,t){switch(t.type){case"LOADING":return{...e,isLoading:!0};case"LOADED":return{isLoading:!1,isError:t.isError};case"ERROR":return{isLoading:!1,isError:!0};default:throw Error("invalid action")}}function T(e,t,a=Error("Promise timed out")){return Promise.race([e,new Promise((e,s)=>{setTimeout(()=>{s(a)},t)})])}function A(e){return e.some(e=>"user"===e.role.toLowerCase()&&e.references?.some(e=>e.type===i.G7&&e.diffHunks.length>0))}var E=a(75177),j=a(85053),S=a(23398);let P=({isLoading:e,isError:t})=>(0,s.jsx)(S.A,{isLoading:e,zIndex:1,bg:e?"var(--bgColor-inset, var(--color-bg-inset))":t?"var(--bgColor-danger-muted, var(--color-danger-subtle))":"var(--bgColor-accent-muted, var(--color-bg-accent))",fill:t?"danger.fg":"accent.fg",borderColor:e?void 0:t?"var(--borderColor-danger-muted, var(--color-danger-muted))":"var(--borderColor-accent-muted, var(--color-accent-muted))"});try{P.displayName||(P.displayName="CopilotBadge")}catch{}var D=a(14744),N=a.n(D),L=a(92240);let I={display:"none"},q={position:"relative",borderRadius:2,width:"100%",display:"flex",alignItems:"center",gap:2,borderStyle:"solid",borderWidth:"1px",p:3},O={mb:3},F={my:3},M={mt:3},_={backgroundColor:"var(--bgColor-inset, var(--color-canvas-subtle))",borderColor:"var(--borderColor-muted, var(--color-border-muted))"},G={backgroundColor:"var(--bgColor-danger-muted, var(--color-danger-subtle))",borderColor:"var(--borderColor-danger-muted, var(--color-danger-muted))"},K={backgroundColor:"var(--bgColor-accent-muted, var(--color-accent-subtle))",borderColor:"var(--borderColor-accent-muted, var(--color-accent-muted))"},z=({isDismissed:e,isError:t,isLoading:a,children:r,location:i})=>{let o={};return o=e?I:a?N()(q,_):t?N()(q,G):N()(q,K),"compare"===i?o=N()(o,F):"files_changed"===i?o=N()(o,O):"conversation"===i&&(o=N()(o,M)),(0,s.jsx)(E.A,{...(0,L.G)("copilot-review-banner"),sx:o,children:r})};try{z.displayName||(z.displayName="BannerContainer")}catch{}var $=a(86519);let U=()=>(0,s.jsx)($.A,{href:"https://gh.io/copilot-code-reviews-feedback",target:"_blank",sx:{fontSize:"12px",mr:2},children:"Give feedback"});try{U.displayName||(U.displayName="FeedbackLink")}catch{}var B=a(87330),H=a(55847),W=a(69909),Q=a(59857),X=a(28784);let J=(0,r.createContext)(void 0),V=({analyticsPath:e,children:t})=>{let[a,i]=(0,r.useState)(),o=(0,r.useCallback)(()=>{void 0===a&&i(performance.now())},[a]),n=(0,r.useCallback)(async(t,a)=>{let s=a??new FormData;s.append("_method",t),await (0,X.DI)(e,{body:s,method:t})},[e]),l=(0,r.useMemo)(()=>({makeAnalyticsRequest:n,loadingMessageShownTime:a,markLoadingMessageAsShown:o}),[n,a,o]);return(0,s.jsx)(J.Provider,{value:l,children:t})},Y=()=>{let e=(0,r.useContext)(J);if(!e)throw Error("useAnalytics must be used with AnalyticsProvider.");return e};try{J.displayName||(J.displayName="AnalyticsContext")}catch{}try{V.displayName||(V.displayName="AnalyticsProvider")}catch{}let Z={color:"danger.fg"},ee=({iconButton:e,isError:t,onDismiss:a})=>{let{makeAnalyticsRequest:i}=Y(),o=(0,r.useCallback)((e,s)=>{e.preventDefault(),a();let r=new FormData;r.append("button",s),r.append("error",t?"true":"false"),i("DELETE",r)},[t,i,a]);if(e)return(0,s.jsx)(B.K,{unsafeDisableTooltip:!0,onClick:e=>o(e,"X"),icon:Q.XIcon,"aria-label":"Dismiss",variant:"invisible",size:"small"});let n={p:0};return t&&(n=N()(n,Z)),(0,s.jsx)(H.Q,{onClick:e=>o(e,"DISMISS"),variant:"invisible",size:"small",sx:{marginLeft:1},children:(0,s.jsx)(W.A,{sx:n,children:"Dismiss"})})};try{ee.displayName||(ee.displayName="DismissBannerButton")}catch{}var et=a(18312);let ea=a(50),es=({children:e,pullRequestId:t})=>{let{setTreeComparison:a}=l(),i=function(e){let{node:t,viewer:a}=(0,et.useLazyLoadQuery)(ea,{pullRequestId:e},{fetchPolicy:"store-or-network"});if(!(t&&!t.closed&&t.isDraft&&a&&t&&t.author&&a.login===t.author.login&&(t?.additions??0)+(t?.deletions??0)>0&&a?.isCopilotDotcomChatEnabled))return null;let s=t?.baseRepository?.databaseId;if("number"!=typeof s)return null;let r=t?.headRepository?.databaseId;return"number"!=typeof r?null:{baseRepoId:s,baseRevision:t?.baseRefOid,headRepoId:r,headRevision:t?.headRefOid,diffHunks:[]}}(t);return(0,r.useEffect)(()=>{i&&a(i)},[i,a]),(0,s.jsx)(s.Fragment,{children:e})};try{es.displayName||(es.displayName="PullRequestLoader")}catch{}var er=a(69014);let ei=({children:e,signedWebsocketChannel:t})=>{let[a,i]=(0,r.useState)(),{treeComparison:o,setTreeComparison:n}=l();return(!function({signedWebsocketChannel:e,handlePullRequestWebsocketEvent:t,handleBranchWebsocketEvent:a}){let s=(0,r.useCallback)(e=>{"gid"in e?t&&t(e):"after"in e&&"before"in e&&a&&a(e)},[a,t]);(0,er.x)(e,s)}({signedWebsocketChannel:t,handlePullRequestWebsocketEvent:(0,r.useCallback)(e=>{i(e.gid)},[]),handleBranchWebsocketEvent:(0,r.useCallback)(e=>{o&&e.before===o.headRevision&&n({...o,headRevision:e.after})},[n,o])}),void 0!==a)?(0,s.jsx)(es,{pullRequestId:a,children:e}):(0,s.jsx)(s.Fragment,{children:e})};try{ei.displayName||(ei.displayName="WebsocketLoader")}catch{}var eo=a(83028),en=a(97564);let el=({onDismiss:e})=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(W.A,{sx:{color:"fg.default"},children:[(0,s.jsx)(W.A,{sx:{fontWeight:500},children:"Copilot"})," had trouble creating a review for this pull request"]}),(0,s.jsx)(ee,{isError:!0,iconButton:!1,onDismiss:e})]});try{el.displayName||(el.displayName="ErrorMessage")}catch{}let ec=()=>{let{markLoadingMessageAsShown:e}=Y();return(0,r.useEffect)(()=>e(),[e]),(0,s.jsxs)(W.A,{sx:{color:"fg.muted"},children:[(0,s.jsx)(W.A,{sx:{color:"fg.default",fontWeight:500},children:"Copilot"})," is analyzing the changes in this pull request\u2026"]})};try{ec.displayName||(ec.displayName="LoadingMessage")}catch{}var ed=a(822);let eu=({onDismiss:e})=>{let{completionData:t}=y();return t?.hasDiffHunks?(0,s.jsx)(eh,{}):(0,s.jsx)(ep,{onDismiss:e})},eh=()=>{let{makeAnalyticsRequest:e,loadingMessageShownTime:t}=Y(),{treeComparison:a}=l(),o=void 0===t?void 0:Math.round(performance.now()-t),{completionData:n}=y(),{reviewThread:c}=k(),d=(0,r.useCallback)(()=>{if(void 0===a||n?.message===void 0||void 0===c)return;(0,ed.qR)({content:b.Bc,intent:i.wh.reviewPr,references:[a],completion:n.message,thread:c});let t=new FormData;void 0!==o&&t.append("round_trip_time_ms",String(o)),e("POST",t)},[e,a,c,n,o]);return(0,r.useEffect)(()=>{d()},[d]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(W.A,{sx:{color:"fg.muted"},children:[(0,s.jsx)(W.A,{sx:{color:"fg.default",fontWeight:500},children:"Copilot"})," has found some possible improvements"]}),(0,s.jsx)(H.Q,{variant:"invisible",size:"small",sx:{marginLeft:1},onClick:d,children:"Show in Chat"})]})},ep=({onDismiss:e})=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(W.A,{sx:{color:"fg.default"},children:[(0,s.jsx)(W.A,{sx:{fontWeight:500},children:"Copilot"})," found no suggestions for this pull request"]}),(0,s.jsx)(ee,{iconButton:!1,onDismiss:e,isError:!1})]});try{eu.displayName||(eu.displayName="ReadyMessage")}catch{}try{eh.displayName||(eh.displayName="HasReviewMessage")}catch{}try{ep.displayName||(ep.displayName="NoChangesMessage")}catch{}let em=({onRequestReview:e})=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(W.A,{sx:{color:"fg.default"},children:[(0,s.jsx)(W.A,{sx:{fontWeight:500},children:"Copilot"})," can help you review this pull request"]}),(0,s.jsx)(H.Q,{variant:"invisible",size:"small",sx:{marginLeft:1},onClick:e,children:(0,s.jsx)(W.A,{sx:{fontWeight:500},children:"Ask Copilot to review"})})]});try{em.displayName||(em.displayName="RequestReviewMessage")}catch{}let eg=({isLoading:e,isError:t,isReviewRequested:a,handleDismiss:r,handleRequestReview:i})=>a?t?(0,s.jsx)(el,{onDismiss:r}):e?(0,s.jsx)(ec,{}):(0,s.jsx)(eu,{onDismiss:r}):(0,s.jsx)(em,{onRequestReview:i});try{eg.displayName||(eg.displayName="BannerMessage")}catch{}let ey=(0,eo.E7)(),ef=({location:e})=>{let[t,a]=(0,r.useState)(!1),[o,n]=(0,r.useState)(!1),{treeComparison:c}=l(),{isLoading:d,isError:u}=function({isDismissed:e=!1,isReviewRequested:t=!1}){let{treeComparison:a}=l(),[s,o]=(0,r.useReducer)(R,{isLoading:!1,isError:!1}),{completionData:n,setCompletionData:c}=y(),{setReviewThread:d}=k(),{isLoading:u,isError:h}=s,m=(0,r.useRef)(u),{chatService:g}=p(),{threadName:f}=x(),v=(0,r.useCallback)(async()=>{if("string"!=typeof f||f.length<1||void 0===g)return!1;let e=await T(g.fetchThreads({name:f}),15e3);if(void 0===e||!e.ok)return!1;let t=e.payload;if(t.length<1)return!1;let a=t[t.length-1];if(void 0===a)return!1;let s=await T(g.listMessages(a.id),5e4);if(void 0===s||!s.ok)return!1;d(a);let r=s.payload.messages,i=r[r.length-1],n=A(r);return c({message:i?.content,hasDiffHunks:n}),o({type:"LOADED",isError:!1}),!0},[g,c,d,f]),w=(0,r.useCallback)(async()=>{if(void 0===g)return;let e=await T(g.createThread(),15e3);if(void 0!==e&&e.ok){let t=e.payload;if(d(t),void 0===a)return;let s=await T(g.createMessage(t.id,b.Bc,i.wh.reviewPr,[a]),5e4),r=s.ok?s.payload:void 0,n=await T(g.listMessages(t.id),5e4),l=!1;n&&n.ok&&(l=A(n.payload.messages)),c({message:r?.content,hasDiffHunks:l}),o({type:"LOADED",isError:!s.ok}),f&&s.ok&&T(g.renameThread(t.id,f),5e4)}else o({type:"ERROR"})},[a,g,c,d,f]);return(0,r.useEffect)(()=>{h||n?.message!==void 0||e||u||m.current||void 0===g||void 0===a||!t||(async()=>{m.current=!0,o({type:"LOADING"});try{await v()||await w()}catch(e){o({type:"ERROR"})}finally{m.current=!1}})()},[g,v,n,w,h,u,a,e,t]),s}({isDismissed:t,isReviewRequested:o}),h=(0,r.useCallback)(()=>a(!0),[a]),m=(0,r.useCallback)(()=>n(!0),[n]);return void 0===c?null:(0,s.jsxs)(z,{location:e,isLoading:d,isError:u,isDismissed:t,children:[(0,s.jsx)(P,{isLoading:d,isError:u}),(0,s.jsx)(E.A,{sx:{display:"flex",alignItems:"center",fontSize:0,paddingLeft:1},children:(0,s.jsx)(eg,{isReviewRequested:o,isError:u,isLoading:d,handleDismiss:h,handleRequestReview:m})}),(0,s.jsxs)(E.A,{sx:{display:"flex",flexGrow:1,justifyContent:"flex-end"},children:[(0,s.jsxs)(E.A,{sx:{mt:1},children:[(0,s.jsx)(j.A,{variant:"secondary",sx:{mr:2},children:"Alpha"}),(0,s.jsx)(U,{})]}),(0,s.jsx)(ee,{isError:u,iconButton:!0,onDismiss:h})]})]})},ev=({analyticsPath:e,children:t,environment:a,pullRequestId:r,signedWebsocketChannel:i,apiURL:o,ssoOrganizations:l,chatService:c,threadName:d,...u})=>(0,s.jsx)(et.RelayEnvironmentProvider,{environment:a,children:(0,s.jsx)(V,{analyticsPath:e,children:(0,s.jsx)(h,{ssoOrganizations:l,apiURL:o,chatService:c,children:(0,s.jsx)(g,{children:(0,s.jsx)(C,{threadName:d,children:(0,s.jsx)(n,{...u,children:(0,s.jsx)(v,{children:(0,s.jsx)(ei,{signedWebsocketChannel:i,children:"string"==typeof r&&r.length>0?(0,s.jsx)(es,{pullRequestId:r,children:t}):t})})})})})})})});function ek({environment:e,location:t,...a}){return(0,en.G7)("copilot_reviews")?(0,s.jsx)(ev,{...a,environment:e??ey,children:(0,s.jsx)(ef,{location:t})}):null}try{ef.displayName||(ef.displayName="InnerComponent")}catch{}try{ev.displayName||(ev.displayName="ProviderStack")}catch{}try{ek.displayName||(ek.displayName="CopilotPrReviewBanner")}catch{}}}]);
//# sourceMappingURL=ui_packages_copilot-pr-review-banner_CopilotPrReviewBanner_tsx-ef0efd785438.js.map