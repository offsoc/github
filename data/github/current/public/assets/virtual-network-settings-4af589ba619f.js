"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["virtual-network-settings"],{95470:(e,r,t)=>{var n=t(74848),a=t(96540),s=t(85402),i=t(79190),o=t(97156);let l=()=>({auth:{clientId:"669ab7d0-33a3-4db6-9f12-98be5fbe497f",authority:"https://login.microsoftonline.com/d140fce4-7363-4338-8dc0-c788481155d9",redirectUri:`${o.fV.origin}/enterprises/azure_callback`},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!1}}),c={scopes:["https://management.core.windows.net/.default"]};var u=t(55847);let d=e=>{let{instance:r}=(0,s.dk)(),{onError:t}=e;return(0,n.jsx)(u.Q,{variant:"primary",onClick:()=>{try{r.loginPopup(c)}catch(e){"popup_window_error"===e.errorCode?t(Error("Popup window was blocked. Please allow popups for this site and try again.")):t(e);return}},sx:{display:"inline"},children:"Sign in"})};try{d.displayName||(d.displayName="SignInButton")}catch{}let p=()=>{let{instance:e}=(0,s.dk)();return(0,n.jsx)(u.Q,{variant:"danger",onClick:()=>{e.logoutPopup({postLogoutRedirectUri:"/",mainWindowRedirectUri:"/"})},children:"Sign out of Azure"})};try{p.displayName||(p.displayName="SignOutButton")}catch{}var h=t(74115);async function m(e){let r;let t=new Headers,n=`Bearer ${e}`;t.append("Authorization",n);try{r=await fetch("https://management.azure.com/subscriptions?api-version=2020-01-01",{method:"GET",headers:t})}catch(e){throw console.log("Error occurred!",e),e}return r.json()}async function _(e,r){let t;let n=new Headers,a=`Bearer ${e}`;n.append("Authorization",a);try{t=await fetch(`https://management.azure.com/subscriptions/${r}/resourcegroups?api-version=2021-04-01`,{method:"GET",headers:n})}catch(e){throw console.log("Error occurred!",e),e}return t.json()}async function b(e,r){let t;let n=new Headers,a=`Bearer ${e}`;n.append("Authorization",a);try{t=await fetch(`https://management.azure.com/${r}/providers/Microsoft.Network/virtualNetworks?api-version=2021-08-01`,{method:"GET",headers:n})}catch(e){throw console.log("Error occurred!",e),e}return t.json()}var w=t(66889),y=t(72507);function f(e){let{onError:r,appState:t,setAppState:s}=e,{accessToken:i,subscriptionError:o}=t,[l,c]=(0,a.useState)(!1),[u,d]=(0,a.useState)([]),[p,h]=(0,a.useState)(""),_=(0,a.useId)();(0,a.useEffect)(()=>{let e=async()=>{let e;if(!i)return;try{e=await m(i)}catch(e){r(e);return}let n=e.value.map(({subscriptionId:e,displayName:r})=>({id:e,name:r}));d(n),s({...t,selectedSubscription:n[0]}),h(`${n[0].name} (${n[0].id})`),c(!0)};try{e()}catch(e){r(e)}},[i]);let b=u.map(({id:e,name:r})=>({text:`${r} (${e})`,id:e})),[f,g]=a.useState("");return(0,n.jsxs)(w.A,{required:!0,sx:{mt:3},children:[(0,n.jsx)(w.A.Label,{id:_,children:"Susbscription"}),(0,n.jsxs)(y.A,{children:[(0,n.jsx)(y.A.Input,{block:!0,onChange:e=>{g(e.currentTarget.value)},value:p,placeholder:"Select a Subscription","aria-invalid":!!o}),(0,n.jsx)(y.A.Overlay,{width:"xlarge",children:(0,n.jsx)(y.A.Menu,{"aria-labelledby":_,loading:!l,items:b,selectedItemIds:[],filterFn:e=>e.text.includes(f),onSelectedChange:e=>{if(!Array.isArray(e))return;let r=e[0],n=u.find(e=>e.id===r.id);if(n)h(`${n.name} (${n.id})`),s({...t,selectedSubscription:n});else throw Error(`Error locating subscription with id ${r.id}`)},selectionVariant:"single"})})]}),!!o&&(0,n.jsx)(w.A.Validation,{variant:"error",children:o})]})}try{f.displayName||(f.displayName="SubscriptionPicker")}catch{}var g=t(73880);function v(e){let{appState:r,setAppState:t,onError:s}=e,{accessToken:i,selectedSubscription:o,resourceGroupError:l}=r,[c,u]=(0,a.useState)([]);(0,a.useEffect)(()=>{let e=async()=>{if(i){if(o){let e=await _(i,o.id);u(e.value.map(({id:e,name:r})=>({id:e,name:r}))),e.value.length>0?t({...r,selectedResourceGroup:e.value[0].id}):t({...r,selectedResourceGroup:null})}else t({...r,selectedResourceGroup:null})}};try{e()}catch(e){s(e)}},[i,o]);let d=c.map(({id:e,name:r})=>(0,n.jsx)(g.A.Option,{value:e,children:r},e));return(0,n.jsxs)(w.A,{required:!0,sx:{mt:3},children:[(0,n.jsx)(w.A.Label,{children:"Resource Group"}),(0,n.jsx)(g.A,{block:!0,onChange:e=>{t({...r,selectedResourceGroup:e.target.value})},"aria-invalid":!!l,children:d}),!!l&&(0,n.jsx)(w.A.Validation,{variant:"error",children:l})]})}try{v.displayName||(v.displayName="ResourceGroupPicker")}catch{}function j(e){let{appState:r,setAppState:t,onError:s}=e,{accessToken:i,selectedResourceGroup:o,virtualNetworkError:l}=r,[c,u]=(0,a.useState)([]);(0,a.useEffect)(()=>{let e=async()=>{if(i){if(o){let e=(await b(i,o)).value.map(e=>{let r=e.properties.subnets.map(e=>({id:e.id,name:e.name}));return{id:e.id,name:e.name,subnets:r}});if(u(e),e.length>0){let n=null;e[0].subnets.length>0&&(n=e[0].subnets[0]),t({...r,selectedVirtualNetwork:e[0],subnets:e[0].subnets,selectedSubnet:n})}else t({...r,selectedVirtualNetwork:null,subnets:[],selectedSubnet:null})}else u([]),t({...r,selectedVirtualNetwork:null,subnets:[],selectedSubnet:null})}};try{e()}catch(e){s(e)}},[i,o]);let d=c.map(({id:e,name:r})=>(0,n.jsx)(g.A.Option,{value:e,children:r},e));return(0,n.jsxs)(w.A,{required:!0,sx:{mt:3},children:[(0,n.jsx)(w.A.Label,{children:"Virtual Network"}),(0,n.jsx)(g.A,{block:!0,onChange:e=>{let n=e.target.value,a=c.find(e=>e.id===n);if(a){let e=null;a.subnets.length>0&&(e=a.subnets[0]),t({...r,selectedVirtualNetwork:a,subnets:a.subnets,selectedSubnet:e})}else throw Error(`Error locating vNet with id ${n}`)},"aria-invalid":!!l,children:d}),!!l&&(0,n.jsx)(w.A.Validation,{variant:"error",children:l})]})}try{j.displayName||(j.displayName="VirtualNetworkPicker")}catch{}function x(e){let{appState:r,setAppState:t}=e,{subnets:a,subnetError:s}=r,i=a.map(({id:e,name:r})=>(0,n.jsx)(g.A.Option,{value:e,children:r},e));return(0,n.jsxs)(w.A,{required:!0,sx:{mt:3},children:[(0,n.jsx)(w.A.Label,{children:"Subnet"}),(0,n.jsx)(g.A,{block:!0,onChange:e=>{let n=e.target.value,s=a.find(e=>e.id===n);if(s)t({...r,selectedSubnet:s});else throw Error(`Error locating subnet with id ${n}`)},"aria-invalid":!!s,children:i}),!!s&&(0,n.jsx)(w.A.Validation,{variant:"error",children:s})]})}try{x.displayName||(x.displayName="SubnetPicker")}catch{}function k(e){let{instance:r,accounts:t}=(0,s.dk)(),{appState:i,setAppState:o,businessName:l,createNetworkRegistration:d,onError:p}=e;(0,a.useEffect)(()=>{let e=async()=>{let e;try{e=await r.acquireTokenSilent({...c,account:t[0]})}catch(t){if(t instanceof h.CB)try{e=await r.acquireTokenPopup(c)}catch(e){"popup_window_error"===e.errorCode?p(Error("Popup window was blocked. Please allow popups for this site and try again.")):p(e);return}p(t);return}o({...i,accessToken:e.accessToken})};try{e()}catch(e){p(e)}},[]);let m=async e=>{e.preventDefault();let r={subscriptionError:null,resourceGroupError:null,virtualNetworkError:null,subnetError:null};i.selectedSubscription||(r.subscriptionError="Subscription is required"),i.selectedResourceGroup||(r.resourceGroupError="Resource group is required"),i.selectedVirtualNetwork||(r.virtualNetworkError="Virtual network is required"),i.selectedSubnet||(r.subnetError="Subnet is required"),o({...i,...r}),i.selectedSubscription&&i.selectedVirtualNetwork&&i.selectedResourceGroup&&i.selectedSubnet&&d(i.selectedSubscription,i.selectedVirtualNetwork,i.selectedSubnet)};return(0,n.jsxs)("form",{noValidate:!0,onSubmit:m,children:[(0,n.jsx)(f,{appState:i,setAppState:o,onError:p}),(0,n.jsx)(v,{appState:i,setAppState:o,onError:p}),(0,n.jsx)(j,{appState:i,setAppState:o,onError:p}),(0,n.jsx)(x,{appState:i,setAppState:o}),(0,n.jsx)("div",{className:"mt-3",children:(0,n.jsxs)(u.Q,{variant:"primary",children:["Add to ",l]})})]})}try{k.displayName||(k.displayName="RegisterVNetForm")}catch{}var S=t(11983),N=t(65481),A=t(28784),E=t(82897);function R(){let e=(0,E.B)(),r=(0,a.useMemo)(()=>new i.vq(l()),[]),t=e.business.name,{formAction:o}=e,[c,u]=(0,a.useState)(null),[h,m]=(0,a.useState)({accessToken:null,selectedSubscription:null,selectedResourceGroup:null,selectedVirtualNetwork:null,selectedSubnet:null,subnets:[],subscriptionError:null,resourceGroupError:null,virtualNetworkError:null,subnetError:null}),_=async(e,r,t)=>{let n=await (0,A.lS)(o,{method:"POST",body:{subnet_id:t.id,subnet_name:t.name,subscription_id:e.id,subscription_name:e.name,virtual_network_name:r.name}});if(n.ok){let e=await n.json();window.location.href=e.redirect_url;return}let a=await n.json();if(a.errors.length>0){u(Error(a.errors[0]));return}throw Error("Unknown error")};return(0,n.jsx)(s.r7,{instance:r,children:(0,n.jsxs)(S.A,{children:[(0,n.jsxs)("div",{className:"Subhead",children:[(0,n.jsxs)("h2",{className:"Subhead-heading",children:["Add your Azure virtual network to ",(0,n.jsx)("span",{className:"text-bold",children:t})]}),(0,n.jsx)("div",{className:"Subhead-actions",children:(0,n.jsx)(s.e7,{children:(0,n.jsx)(p,{})})})]}),(0,n.jsxs)("div",{className:"App",children:[(0,n.jsxs)(s.e7,{children:[c&&(0,n.jsx)(N.A,{variant:"danger",children:c.message}),(0,n.jsx)(k,{appState:h,setAppState:m,onError:u,businessName:t,createNetworkRegistration:_})]}),(0,n.jsx)(s.hj,{children:(0,n.jsxs)("div",{className:"blankslate",children:[(0,n.jsx)("h3",{className:"blankslate-heading",children:"Please sign-in to Azure to add a virtual network"}),(0,n.jsx)("p",{children:"GitHub currently only supports Azure Virtual Networks. Once you have your virtual network configured, you can install the GitHub Virtual Network app in the Azure Marketplace to connect it to your GitHub account."}),(0,n.jsx)("div",{className:"blankslate-action",children:(0,n.jsx)(d,{onError:u})})]})})]})]})})}try{R.displayName||(R.displayName="NewPage")}catch{}var V=t(79840),G=t(86233);(0,V.Q)("virtual-network-settings",()=>({routes:[(0,G.a)({path:"/enterprises/:business/settings/virtual_networks/new",Component:R}),(0,G.a)({path:"/enterprises/azure_callback",Component:R})]}))},28784:(e,r,t)=>{function n(e,r={}){!function(e){if(new URL(e,window.location.origin).origin!==window.location.origin)throw Error("Can not make cross-origin requests from verifiedFetch")}(e);let t={...r.headers,"GitHub-Verified-Fetch":"true","X-Requested-With":"XMLHttpRequest"};return fetch(e,{...r,headers:t})}function a(e,r){let t={...r?.headers??{},Accept:"application/json","Content-Type":"application/json"},a=r?.body?JSON.stringify(r.body):void 0;return n(e,{...r,body:a,headers:t})}function s(e,r={}){let t={...r.headers,"GitHub-Is-React":"true"};return n(e,{...r,headers:t})}function i(e,r){let t={...r?.headers??{},"GitHub-Is-React":"true"};return a(e,{...r,headers:t})}t.d(r,{DI:()=>n,QJ:()=>s,Sr:()=>i,lS:()=>a})},86233:(e,r,t)=>{t.d(r,{a:()=>n});function n({path:e,Component:r,shouldNavigateOnError:t,transitionType:n,children:a}){return{path:e,Component:r,coreLoader:async function({location:e}){let r;try{let t=`${e.pathname}${e.search}`;r=await window.fetch(t,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-GitHub-Target":"dotcom","X-React-Router":"json"}})}catch(e){return{type:t?"route-handled-error":"error",error:{type:"fetchError"}}}if(r.redirected)return{type:"redirect",url:r.url};if(!r.ok)return{type:t?"route-handled-error":"error",error:{type:"httpError",httpStatus:r.status}};try{let e=await r.json();return{type:"loaded",data:e,title:e.title}}catch(e){return{type:t?"route-handled-error":"error",error:{type:"badResponseError"}}}},loadFromEmbeddedData:function({embeddedData:e}){return{data:e,title:e.title}},transitionType:n,children:a}}}},e=>{var r=r=>e(e.s=r);e.O(0,["react-lib","primer-react-css","vendors-node_modules_github_mini-throttle_dist_index_js-node_modules_primer_octicons-react_di-b40d97","vendors-node_modules_primer_react_lib-esm_Box_Box_js","vendors-node_modules_primer_react_lib-esm_Button_Button_js","vendors-node_modules_primer_react_lib-esm_TooltipV2_Tooltip_js","vendors-node_modules_primer_react_node_modules_primer_octicons-react_dist_index_esm_mjs","vendors-node_modules_primer_react_lib-esm_ActionList_index_js","vendors-node_modules_primer_react_lib-esm_Text_Text_js-node_modules_primer_react_lib-esm_Text-7845da","vendors-node_modules_primer_react_lib-esm_FormControl_FormControl_js","vendors-node_modules_github_catalyst_lib_index_js-node_modules_github_hydro-analytics-client_-7901e7","vendors-node_modules_primer_react_lib-esm_BaseStyles_js-node_modules_primer_react_lib-esm_Fea-a7e9f8","ui_packages_react-core_create-browser-history_ts-ui_packages_safe-storage_safe-storage_ts-ui_-682c2c","ui_packages_react-core_register-app_ts"],()=>r(95470)),e.O()}]);
//# sourceMappingURL=virtual-network-settings-945320d76b37.js.map