<%
  alert = alerts.first
  alerts_with_fixes = alerts.sort_by { |a| a.vulnerability.severity }.select { |a| a.vulnerable_version_range.fixed_in }
  num_fixes = 5
%>

<table <%= test_selector("alert-row") %> cellpadding="0" cellspacing="0" style="box-sizing: border-box; border-collapse: separate !important; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%; border-bottom: 1px solid #eaecef; margin-bottom: 9px; margin-top: 6px;" width="100%">
  <tr>
    <td style="box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 14px; vertical-align: top;" valign="top">
      <table cellpadding="0" cellspacing="0" style="box-sizing: border-box; border-collapse: separate !important; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;" width="100%">
        <tr>
          <td>
            <table cellpadding="0" cellspacing="0" style="box-sizing: border-box; border-collapse: separate !important; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%; table-layout: fixed;" width="100%">
              <tr>
                <td style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 14px; color:#24292e; width: 54%; vertical-align:top;">
                  <span style="display:block; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 12px; color:#6A737D;">Dependency</span>
                  <span style="word-break: break-word; word-wrap: break-word; font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 16px; font-weight: 600 !important;"><%= alert.vulnerable_version_range.affects %></span>
                </td>
                <td style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 14px; color:#24292e; width: 23%; vertical-align:top; padding-right: 6px;" >
                  <% if alert.vulnerable_version_range.requirements %>
                    <span style="display:block; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 12px; color:#6A737D;">Version</span>
                      <% alert.vulnerable_version_range.requirements.split(/\s*,\s*/).each do |version| %>
                        <span style="display: inline-block; word-break: break-all; word-wrap: break-word; -webkit-hyphens: auto; -moz-hyphens: auto; hyphens: auto; font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; font-weight: 600 !important; white-space: normal !important; background-color: #ffeef0; border-radius: 2px; padding: 1px 6px; margin-right:2px; margin-bottom: 2px; color: #86181d;"><%= version %>
                        </span>
                      <% end %>
                  <% end %>
                </td>
                <td style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 14px; color:#24292e; width: 23%; vertical-align:top;">
                  <% if alert.vulnerable_version_range.fixed_in.present? %>
                    <span style="display:block; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 12px; color:#6A737D;">Upgrade to</span>
                    <span style="display: inline-block; word-break: break-all; word-wrap: break-word; -webkit-hyphens: auto; -moz-hyphens: auto; hyphens: auto; font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; font-weight: 600 !important; white-space: normal !important; background-color: #dcffe4; border-radius: 2px; padding: 1px 6px; color: #165c26;">~> <%= alert.vulnerable_version_range.fixed_in %></span>
                  <% end %>
                </td>
              </tr>
              <tr>
                <% pull_request = @view.pull_request_for_alert(alert: alert, repository: repo) %>
                <td colspan="<%= pull_request ? "2" : "3" %>" style="box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 14px; vertical-align: top; padding-bottom: 9px; padding-top: 12px;" valign="top">
                    <span style="display:block; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 12px; color:#6A737D;">Defined in</span>
                    <span style="word-break: break-word; word-wrap: break-word; font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; font-weight: 600 !important; white-space: normal;">
                      <%= alert.filename %>
                    </span>
                  </td>
                  <% if pull_request %>
                    <td style="box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 14px; vertical-align: top; padding-bottom: 9px; padding-top: 12px;" valign="top">
                      <span style="display:block; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 12px; color:#6A737D;">Suggested update</span>
                      <span style="word-break: break-word; word-wrap: break-word; -webkit-hyphens: auto; -moz-hyphens: auto; hyphens: auto; font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13px; font-weight: 600 !important; white-space: nowrap !important;">
                        <%= link_to pull_request_url(pull_request), :title => pull_request.title do %>
                          #<%= pull_request.issue.number %>
                        <% end %>
                      </span>
                    </td>
                  <% end %>
              </tr>
              <tr>
                <td colspan="3" style="box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 14px; vertical-align: top; padding-bottom: 9px; padding-top: 12px;" valign="top">
                  <span style="display:block; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 12px; color:#6A737D;">Vulnerabilities</span>
                  <table cellpadding="0" cellspacing="0" style="box-sizing: border-box; border-collapse: separate !important; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;" width="100%">
                    <% alerts_with_fixes.first(num_fixes).each do |alert_row| %>
                      <tr>
                        <td style="color:#24292e; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 14px; vertical-align: top; padding-right: 6px; min-width: 130px; margin-bottom: 6px;" valign="top">
                          <%= alert_row.vulnerability.identifier %>
                          <span style="color:#6A737D; white-space:nowrap;"><%= alert_row.vulnerability.severity.titleize %> severity</span>
                        </td>
                      </tr>
                    <% end %>
                    <% if alerts_with_fixes.count > num_fixes %>
                      <tr>
                        <td>
                          <a style="color: #0366d6; text-decoration: none; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 12px;" href="<%= @view.alert_permalink(alert) %>">View <%= alerts_with_fixes.count - num_fixes %> more</a>
                        </td>
                      </tr>
                    <% end %>
                  </table>
                </td>
              </tr>
            </table>
          </td>
        </tr>

        <% if alert.dismissed? %>
          <tr>
            <td>
              <table cellpadding="0" cellspacing="0" style="box-sizing: border-box; border-collapse: separate !important; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%; margin-bottom: 9px;" width="100%">

                <tr>
                  <td style="padding-right: 6px; width: 16px;">
                    <img src="<%= image_url("/vulnerability/dismiss-icon.png") %>" alt="" style="-ms-interpolation-mode: bicubic; border: 0; width: 16px; height: 12px;" width="16px" height="12px">
                  </td>
                  <td style="box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 14px; vertical-align: middle; color: #24292e; width: 100%;">
                    <% if alert.dismisser %>
                      This alert was dismissed by <strong style="font-weight:700;">@<%= alert.dismisser.display_login %></strong> on <%= @view.full_month_date(alert.dismissed_at) %> citing, "<%= alert.dismiss_reason %>."
                    <% else %>
                      This alert was dismissed.
                    <% end %>
                  </td>
                </tr>
              </table>
            </td>
          </tr>
        <% end %>
      </table>
    </td>
  </tr>
</table>
