(function(){window.forms={checkInputRadioField:function(){var e,t,a;return a=(e=$(this)).data("value"),"string"==typeof(t=$(e.data("input-field-id")).val())&&0!==t.length?e.val(a):e.val("")},setActiveRadioItem:function(){return $(this).parent().addClass("active").siblings().removeClass("active")},setActiveCheckboxItem:function(){return $(this).parent().toggleClass("active")}},$(function(){return $(document).ready(function(){return $(".radio-item input:checked, .checkbox-item input:checked").parent().addClass("active"),$(".radio-item input").click(forms.setActiveRadioItem),$(".checkbox-item input").click(forms.setActiveCheckboxItem)})})}).call(this),function(){$(document).ready(function(){$(".js-enable-actions").on("click",function(){this.checked?$("#actions").addClass("invalid"):$("#actions").removeClass("invalid")}),$(".js-setup-storage").on("click",function(e){e.preventDefault(),$(".js-actions-storage-list").hide(),$(".js-actions-storage-dropdown").show(),$(".js-actions-storage-select").val(e.target.name).trigger("change")}),$(".js-actions-storage-select").on("change",function(e){var t,a={azure:$("#actions-azure-blob-storage-provider"),s3:$("#actions-amazon-s3-storage-provider"),gcs:$("#actions-google-cloud-storage-provider")},s={azure:$(".js-azure-dropdown-logo"),s3:$(".js-s3-dropdown-logo"),gcs:$(".js-gcs-dropdown-logo")},i={azure:$("#actions-azure-oidc-auth-radio-button"),s3:$("#actions-s3-oidc-auth-radio-button"),gcs:$("#actions-gcs-oidc-auth-radio-button")};for(var n in t=e.currentTarget.value,a)n===t?(a[n].show(),s[n].show(),i[n].click()):(a[n].hide(),s[n].hide())}),$(".js-actions-auth-type-toggle").on("change",function(e){e.currentTarget.checked&&"credential"===e.currentTarget.value?$(".actions-storage-warning").show():$(".actions-storage-warning").hide()});var e=function(e,t,a){a.show(),$("#actions-test-storage-loading").html("Testing storage connection...<br/> Validation with OIDC may take up to 5 minutes.");var s=setInterval(function(){$.ajax({url:"/setup/settings/test/storage/actions/status",type:"GET",dataType:"json",success:function(i){"success"===i.status?(clearInterval(s),e.html("<p>Actions storage configuration successfully validated.</p>"),t.removeClass("invalid"),a.hide(),e.show(),toggleSubmit()):"error"===i.status&&(clearInterval(s),e.html("<p>Unable to connect to storage provider.<br/>Please check the form and try again.</p>").show(),a.hide(),e.show(),toggleSubmit(),t.addClass("invalid"))}})},5e3)},t=function(){return $(".js-actions-storage-dropdown").is(":visible")?$('input[name="actions_storage[auth_type]"]:checked').val():"credential"};$(".js-test-actions-settings").on("click",function(a){var s,i,n,o,c,r,d;a.preventDefault(),i=(s=$(a.target)).parents("form"),n=$("#actions"),o=$(".js-testing-actions"),(c=$("#actions_test_result")).empty().hide(),o.show(),$("#actions-test-storage-loading").html("Testing storage connection..."),r=$("input[name=_csrf]").val();var l=i.find('select[name="actions_storage[blob_provider]"]')[0].value;switch(l){case"azure":d="oidc"===(u=t())?{_csrf:r,actions_storage:{blob_provider:l,auth_type:u,azure_oidc:{client_id:i.find('input[name="actions_storage[azure_oidc][client_id]"]').val(),tenant_id:i.find('input[name="actions_storage[azure_oidc][tenant_id]"]').val(),storage_account:i.find('input[name="actions_storage[azure_oidc][storage_account]"]').val(),endpoint_suffix:i.find('input[name="actions_storage[azure_oidc][endpoint_suffix]"]').val()},enterprise_identifier:i.find("#hostname-field").val()}}:{_csrf:r,actions_storage:{blob_provider:l,auth_type:u,azure:{connection_string:i.find('input[name="actions_storage[azure][connection_string]"]').val()}}};break;case"gcs":d="oidc"===(u=t())?{_csrf:r,actions_storage:{blob_provider:l,auth_type:u,gcs_oidc:{bucket_name:i.find('input[name="actions_storage[gcs_oidc][bucket_name]"]').val(),service_url:i.find('input[name="actions_storage[gcs_oidc][service_url]"]').val(),workload_id:i.find('input[name="actions_storage[gcs_oidc][workload_id]"]').val(),service_acc:i.find('input[name="actions_storage[gcs_oidc][service_acc]"]').val()},enterprise_identifier:i.find("#hostname-field").val()}}:{_csrf:r,actions_storage:{blob_provider:l,auth_type:u,gcs:{service_url:i.find('input[name="actions_storage[gcs][service_url]"]').val(),bucket_name:i.find('input[name="actions_storage[gcs][bucket_name]"]').val(),access_key_id:i.find('input[name="actions_storage[gcs][access_key_id]"]').val(),access_secret:i.find('input[name="actions_storage[gcs][access_secret]"]').val(),force_path_style:i.find('input[name="actions_storage[gcs][force_path_style]"]').is(":checked")}}};break;case"s3":var u;if("oidc"===(u=t()))d={_csrf:r,actions_storage:{blob_provider:l,auth_type:u,s3_oidc:{bucket_name:i.find('input[name="actions_storage[s3_oidc][bucket_name]"]').val(),role_arn:i.find('input[name="actions_storage[s3_oidc][role_arn]"]').val(),region:i.find('input[name="actions_storage[s3_oidc][region]"]').val(),sts_endpoint:i.find('input[name="actions_storage[s3_oidc][sts_endpoint]"]').val()},enterprise_identifier:i.find("#hostname-field").val()}};else if((d={_csrf:r,actions_storage:{blob_provider:l,auth_type:u,s3:{service_url:i.find('input[name="actions_storage[s3][service_url]"]').val(),bucket_name:i.find('input[name="actions_storage[s3][bucket_name]"]').val(),access_key_id:i.find('input[name="actions_storage[s3][access_key_id]"]').val(),access_secret:i.find('input[name="actions_storage[s3][access_secret]"]').val(),force_path_style:i.find('input[name="actions_storage[s3][force_path_style]"]').is(":checked")}}}).actions_storage.s3.access_key_id.includes("\\")||d.actions_storage.s3.access_secret.includes("\\"))return o.hide(),c.html("<p>AWS S3 keys must not contain a backslash (<code>&bsol;</code>).<br/>Please regenerate the credentials and try again.</p>").show(),n.addClass("invalid"),void toggleSubmit();break;default:console.error("unexpected blob provider: "+l)}$.ajax({type:"POST",url:s.val(),data:d,cache:!1}).fail(function(e){504==e.status?c.html("<p>The request timed out.<br/>Please try again.</p>").show():c.html("<p>Unable to connect to storage provider.<br/>Please check the form and try again.</p>").show(),n.addClass("invalid")}).done(function(t,a,s){202==s.status?e(c,n,o):(c.html("<p>Actions storage configuration successfully validated.</p>"),n.removeClass("invalid"))}).always(function(e,t,a){202!=a.status&&(o.hide(),c.show(),toggleSubmit())})})})}.call(this);