# Provide role based access to Stafftools features
# Initial demo roles are "admin", "developer", "read-only", and "support"
# See https://github.com/github/github/issues/85201

permissions:
  controllers:
    - name: Stafftools::SearchIndexesController
      allowed_roles: ["super-admin", "developer"]
      actions:
        - name: toggle_code_search
          allowed_roles_override: ["super-admin"]
        - name: toggle_code_search_indexing
          allowed_roles_override: ["super-admin"]

    - name: Stafftools::SessionsController
      allowed_roles: ["*"]
      actions:
        - name: impersonate
          allowed_roles_override: ["can-impersonate-users"]
        - name: override_impersonate
          allowed_roles_override: ["can-impersonate-users-without-permission"]

    - name: Stafftools::Users::RenamesController
      allowed_roles: ["*"]
      actions:
        - name: create
          allowed_roles_override: ["super-admin"]

    - name: Stafftools::Users::ActivitiesController
      allowed_roles: ["*"]
      actions:
        - name: destroy
          allowed_roles_override: ["super-admin", "support", "support-contractors"]

    - name: Stafftools::Users::EmuDeprovisioningController
      allowed_roles: ["*"]
      actions:
        - name: create
          allowed_roles_override: ["super-admin", "support"]
        - name: destroy
          allowed_roles_override: ["super-admin", "support"]

    - name: Stafftools::Users::ForYouFeedsController
      allowed_roles: ["*"]
      actions:
        - name: destroy
          allowed_roles_override: ["*"]

    - name: Stafftools::Users::Repositories::BulkPrivatizationsController
      allowed_roles: ["*"]
      actions:
        - name: create
          allowed_roles_override: ["super-admin", "support", "support-contractors"]

    - name: Stafftools::Users::SiteAdminsController
      allowed_roles: ["*"]
      actions:
        - name: index
          allowed_roles_override: ["super-admin"]
        - name: create
          allowed_roles_override: ["super-admin"]

    - name: Stafftools::Users::ForcePushPreferencesController
      allowed_roles: ["*"]
      actions:
        - name: update
          allowed_roles_override: ["super-admin", "support", "support-contractors"]

    - name: Stafftools::Users::SuccessorsController
      allowed_roles: ["*"]
      actions:
        - name: index
          allowed_roles_override: ["super-admin"]

    - name: Stafftools::Users::PrivilegedAccessRevocationsController
      allowed_roles: ["*"]
      actions:
        - name: create
          allowed_roles_override: ["super-admin"]

    - name: Stafftools::Users::SuspensionsController
      allowed_roles: ["*"]
      actions:
        - name: create
          allowed_roles_override: ["super-admin"]
        - name: destroy
          allowed_roles_override: ["super-admin"]

    - name: Stafftools::Users::LockoutsController
      allowed_roles: ["*"]
      actions:
        - name: destroy
          allowed_roles_override: ["super-admin"]

    - name: Stafftools::Users::GitHubDeveloperPromotionsController
      allowed_roles: ["*"]
      actions:
        - name: create
          allowed_roles_override: ["super-admin"]

    - name: Stafftools::Users::GitHubBiztoolsPromotionsController
      allowed_roles: ["*"]
      actions:
        - name: create
          allowed_roles_override: ["super-admin"]

    - name: Stafftools::Users::SearchRecords::ReindexRequestsController
      allowed_roles: ["*"]
      actions:
        - name: create
          excluded_roles: ["read-only"]

    - name: Stafftools::Users::SearchRecords::ReindexOrgsController
      allowed_roles: ["*"]
      actions:
        - name: create
          excluded_roles: ["read-only"]

    - name: Stafftools::UsersController
      allowed_roles: ["*"]
      actions:
        - name: destroy
          allowed_roles_override: ["super-admin", "developer"]

    - name: Stafftools::Users::DataPacksController
      allowed_roles: ["*"]
      actions:
        - name: delete
          allowed_roles_override: ["super-admin"]

    - name: Stafftools::Users::InteractionsController
      allowed_roles: ["super-admin", "support", "support-contractors"]

    - name: Stafftools::Users::StaffAccessRequestsController
      allowed_roles: ["can-impersonate-users"]

    - name: Stafftools::SearchController
      allowed_roles: ["*"]
      actions:
        - name: audit_log
          allowed_roles_override: ["super-admin", "developer", "support", "support-contractors"]
        - name: async_query_start
          allowed_roles_override: ["super-admin", "developer", "support", "support-contractors"]
        - name: async_query_status
          allowed_roles_override: ["super-admin", "developer", "support", "support-contractors"]
        - name: async_query_results
          allowed_roles_override: ["super-admin", "developer", "support", "support-contractors"]
        - name: audit_log_advanced_search
          allowed_roles_override: ["super-admin", "developer", "support", "support-contractors"]

    - name: Stafftools::NetworksController
      allowed_roles: ["*"]
      actions:
        - name: mark_as_broken
          allowed_roles_override: ["super-admin", "support"]

    - name: Stafftools::TwoFactorCredentialsController
      allowed_roles: ["super-admin", "can-disable-2fa"]
      actions:
        - name: destroy
          allowed_roles_override: ["can-disable-2fa"]

    - name: Stafftools::PasswordsController
      allowed_roles: ["*"]
      actions:
        - name: randomize
          allowed_roles_override: ["super-admin"]

    - name: Stafftools::AvatarsController
      allowed_roles: ["super-admin"]
      actions:
        - name: index
          allowed_roles_override: ["*"]

    - name: Stafftools::EmailsController
      allowed_roles: ["*"]
      actions:
        - name: destroy
          allowed_roles_override: ["super-admin"]
        - name: destroy_billing_external_email
          allowed_roles_override: ["super-admin"]
        - name: change_email_notifications
          allowed_roles_override: ["super-admin", "support", "support-contractors"]
        - name: create
          allowed_roles_override: ["can-add-email"]

    - name: Stafftools::EmailClaimsController
      allowed_roles: ["*"]
      actions:
        - name: update
          allowed_roles_override: ["super-admin", "support", "support-contractors"]

    - name: Stafftools::Repositories::StaffAccessController
      allowed_roles: ["can-unlock-repos-with-owners-permission"]
      actions:
        - name: override_unlock
          allowed_roles_override: ["can-unlock-repos-without-owners-permission"]

    - name: Stafftools::Orgs::SamlProvidersController
      allowed_roles: ["super-admin", "support"]

    - name: Stafftools::IntegrationInstallationTriggersController
      allowed_roles: ["*"]
      actions:
        - name: new
          allowed_roles_override: ["super-admin", "developer"]
        - name: create
          allowed_roles_override: ["super-admin", "developer"]
        - name: destroy
          allowed_roles_override: ["super-admin", "developer"]
        - name: edit
          allowed_roles_override: ["super-admin", "developer"]
        - name: update
          allowed_roles_override: ["super-admin", "developer"]

    - name: Stafftools::ReservedLoginsController
      allowed_roles: ["*"]
      actions:
        - name: create
          allowed_roles_override: ["super-admin"]
        - name: destroy
          allowed_roles_override: ["can-unreserve-login"]

    # Trade compliance controllers
    - name: Stafftools::TradeCompliance::BatchOperationsController
      allowed_roles: ["can-execute-trade-controls"]

    - name: Stafftools::Users::TradeComplianceController
      allowed_roles: ["can-execute-trade-controls", "can-view-trade-controls"]

    - name: Stafftools::Businesses::TradeComplianceController
      allowed_roles: ["can-execute-trade-controls", "can-view-trade-controls"]

    - name: Stafftools::Users::TradeCompliance::ScreeningProfileController
      allowed_roles: ["can-execute-trade-controls"]

    - name: Stafftools::Businesses::TradeCompliance::ScreeningStatusController
      allowed_roles: ["can-execute-trade-controls"]

    - name: Stafftools::Users::TradeCompliance::ManualScreeningController
      allowed_roles: ["can-execute-trade-controls"]

    - name: Stafftools::Users::TradeCompliance::SdnSuspensionController
      allowed_roles: ["can-execute-trade-controls"]

    - name: Stafftools::Users::TradeCompliance::CheckViolationsController
      allowed_roles: ["can-execute-trade-controls", "can-view-trade-controls"]

    - name: Stafftools::Users::TradeCompliance::RestrictionsEnforcementController
      allowed_roles: ["can-execute-trade-controls"]

    - name: Stafftools::TradeCompliance::MicrosoftTradeHelpEmailsController
      allowed_roles: ["can-execute-trade-controls", "can-view-trade-controls"]

    - name: Stafftools::TradeCompliance::TradeScreeningRecordsController
      allowed_roles: ["can-view-trade-controls", "can-execute-trade-controls"]

    - name: Stafftools::CodespacesController
      allowed_roles: ["*"]
      actions:
        - name: deprovision_dependent_codespaces
          allowed_roles_override: ["super-admin", "can-deprovision-codespaces"]
        - name: suspend_dependent_codespaces
          allowed_roles_override: ["super-admin", "can-deprovision-codespaces"]
        - name: deprovision_environment
          allowed_roles_override: ["super-admin", "can-deprovision-codespaces"]
        - name: bulk_restore_environments
          allowed_roles_override: ["super-admin", "can-deprovision-codespaces"]

    - name: Stafftools::CopilotBusinessTrialsController
      allowed_roles: ["*"]

    - name: Stafftools::CopilotSeatsController
      allowed_roles: ["*"]
      actions:
        - name: update
          allowed_roles_override: ["super-admin", "support"]
        - name: destroy
          allowed_roles_override: ["super-admin", "support"]

    - name: Stafftools::CopilotSettingsController
      allowed_roles: ["*"]
      actions:
        - name: create
          allowed_roles_override: ["super-admin", "support", "support-contractors"]
        - name: destroy
          allowed_roles_override: ["super-admin", "support", "support-contractors"]
        - name: administrative_block
          allowed_roles_override: ["super-admin", "developer", "support", "support-contractors"]
        - name: warn_via_sire
          allowed_roles_override: ["super-admin", "developer", "support", "support-contractors"]

  rest_api:
    # Stafftools permissions api section
    - route_pattern: /staff/stafftools/accesses
      allowed_roles: ["entitlements_master"]
    - route_pattern: /staff/stafftools/accesses/:username
      allowed_roles: ["entitlements_master"]
    - route_pattern: /staff/stafftools/roles
      allowed_roles: ["entitlements_master"]
    - route_pattern: /staff/stafftools/roles/:rolename/accesses
      allowed_roles: ["entitlements_master"]
    - route_pattern: /staff/stafftools/roles/accesses/:username
      allowed_roles: ["entitlements_master"]
    - route_pattern: /staff/stafftools/roles/:rolename/accesses/:username
      allowed_roles: ["entitlements_master"]

# Proxima map Okta security group names to stafftools roles
proxima_okta_group:
  - okta_name: "stafftools-can-add-email-jit"
    okta_always_on_name: "stafftools-can-add-email-always-on"
    role_name: "can-add-email"
  - okta_name: "stafftools-can-deprovision-codespaces-jit"
    okta_always_on_name: "stafftools-can-deprovision-codespaces-always-on"
    role_name: "can-deprovision-codespaces"
  - okta_name: "stafftools-can-disable-2fa-jit"
    okta_always_on_name: "stafftools-can-disable-2fa-always-on"
    role_name: "can-disable-2fa"
  - okta_name: "stafftools-can-execute-trade-controls-jit"
    okta_always_on_name: "stafftools-can-execute-trade-controls-always-on"
    role_name: "can-execute-trade-controls"
  - okta_name: "stafftools-can-impersonate-users-jit"
    okta_always_on_name: "stafftools-can-impersonate-users-always-on"
    role_name: "can-impersonate-users"
  - okta_name: "stafftools-can-impersonate-users-without-permission-jit"
    okta_always_on_name: "stafftools-can-impersonate-users-without-permission-always-on"
    role_name: "can-impersonate-users-without-permission"
  - okta_name: "stafftools-can-unlock-repos-with-owners-permission-jit"
    okta_always_on_name: "stafftools-can-unlock-repos-with-owners-permission-always-on"
    role_name: "can-unlock-repos-with-owners-permission"
  - okta_name: "stafftools-can-unlock-repos-without-owners-permission-jit"
    okta_always_on_name: "stafftools-can-unlock-repos-without-owners-permission-always-on"
    role_name: "can-unlock-repos-without-owners-permission"
  - okta_name: "stafftools-can-unreserve-login-jit"
    okta_always_on_name: "stafftools-can-unreserve-login-always-on"
    role_name: "can-unreserve-login"
  - okta_name: "stafftools-can-view-trade-controls-jit"
    okta_always_on_name: "stafftools-can-view-trade-controls-always-on"
    role_name: "can-view-trade-controls"
  - okta_name: "stafftools-developer-jit"
    okta_always_on_name: "stafftools-developer-always-on"
    role_name: "developer"
  - okta_name: "stafftools-read-only-jit"
    okta_always_on_name: "stafftools-read-only-always-on"
    role_name: "read-only"
  - okta_name: "stafftools-super-admin-jit"
    okta_always_on_name: "stafftools-super-admin-always-on"
    role_name: "super-admin"
  - okta_name: "stafftools-support-jit"
    okta_always_on_name: "stafftools-support-always-on"
    role_name: "support"
  - okta_name: "stafftools-support-contractors-jit"
    okta_always_on_name: "stafftools-support-contractors-always-on"
    role_name: "support-contractors"
  - okta_name: "sire-hubbers"
    role_name: "sire"
