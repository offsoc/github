production:
  mysql1_primary:
    adapter: trilogy
    multi_statement: false
    multi_result: false
    encoding: utf8mb4
    collation: utf8mb4_unicode_520_ci
    query_retries: 1
    connection_retries: 1
    deadlock_retries: 3
    track_gtid: true
    pool: <%= ENV["ENTERPRISE_MYSQL_POOL"] || 5 %>
    advisory_locks: <%= ENV["ENTERPRISE_MYSQL_ADVISORY_LOCKS"] || true %>
    database: <%= ENV["ENTERPRISE_MYSQL_DATABASE"] || "github_enterprise" %>
    username: <%= ENV["ENTERPRISE_MYSQL_USERNAME"] || "github" %>
    password: <%= ENV["ENTERPRISE_MYSQL_PASSWORD"] || "github" %>
    host: <%= ENV["ENTERPRISE_MYSQL_HOSTNAME"] || "localhost" %>
    port: <%= ENV["ENTERPRISE_MYSQL_PORT"] || "3306" %>
<% if ENV["ENTERPRISE_MYSQL_TLS"] %>
    ssl_mode: VERIFY_IDENTITY
    sslcapath: /etc/ssl/certs
    tls_min_version: <%= Trilogy::TLS_VERSION_12 %>
<% end %>
    strict: false
    structure:
      - structure.sql
      - abilities-structure.sql
      - authnd-structure.sql
      - configurations-structure.sql
      - lodge-structure.sql
      - mysql2-structure.sql
      - notifications-deliveries-structure.sql
      - notifications-entries-structure.sql
      - notifications-summaries-structure.sql
      - mysql5-structure.sql
      - migrations-structure.sql
      - repositories-pushes-structure.sql
      - repositories-structure.sql
      - security-overview-analytics-structure.sql
      - spokes-structure.sql
      - stratocaster-structure.sql
      - memex-structure.sql
      - collab-structure.sql
      - copilot-structure.sql
      - ballast-structure.sql
      - signup-flow-structure.sql
      - repositories-actions-checks-structure.sql
      - issues-pull-requests-structure.sql
      - gitbackups-structure.sql
      - notify-structure.sql
      - iam-structure.sql
      - billing-structure.sql
      - permissions-structure.sql
      - token-scanning-service-structure.sql
      - vt-structure.sql
      - commits-structure.sql
    schema_cache_path: <%= "db/schema/enterprise.dump" unless ENV["ENTERPRISE_SKIP_SCHEMA_CACHE"] %>
    variables:
      sql_mode: 'STRICT_ALL_TABLES,NO_ZERO_DATE,NO_ZERO_IN_DATE,NO_AUTO_VALUE_ON_ZERO,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION'

  mysql1_readonly:
    adapter: trilogy
    multi_statement: false
    multi_result: false
    encoding: utf8mb4
    collation: utf8mb4_unicode_520_ci
    pool: <%= ENV["ENTERPRISE_MYSQL_POOL"] || 5 %>
    advisory_locks: <%= ENV["ENTERPRISE_MYSQL_ADVISORY_LOCKS"] || true %>
    database: <%= ENV["ENTERPRISE_MYSQL_DATABASE"] || "github_enterprise" %>
    username: <%= ENV["ENTERPRISE_MYSQL_USERNAME"] || "github" %>
    password: <%= ENV["ENTERPRISE_MYSQL_PASSWORD"] || "github" %>
    host: <%= ENV["ENTERPRISE_MYSQL_REPLICA_HOSTNAME"] || ENV["ENTERPRISE_MYSQL_HOSTNAME"] || "localhost" %>
    port: <%= ENV["ENTERPRISE_MYSQL_REPLICA_PORT"] || ENV["ENTERPRISE_MYSQL_PORT"] || "3306" %>
<% if ENV["ENTERPRISE_MYSQL_TLS"] %>
    ssl_mode: VERIFY_IDENTITY
    sslcapath: /etc/ssl/certs
    tls_min_version: <%= Trilogy::TLS_VERSION_12 %>
<% end %>
    strict: false
    connect_timeout: 1
    query_retries: 3
    connection_retries: 3
    deadlock_retries: 3
    structure:
      - structure.sql
      - abilities-structure.sql
      - authnd-structure.sql
      - configurations-structure.sql
      - lodge-structure.sql
      - collab-structure.sql
      - copilot-structure.sql
      - ballast-structure.sql
      - signup-flow-structure.sql
      - repositories-actions-checks-structure.sql
      - issues-pull-requests-structure.sql
      - gitbackups-structure.sql
      - notify-structure.sql
      - mysql5-structure.sql
      - migrations-structure.sql
      - repositories-pushes-structure.sql
      - repositories-structure.sql
      - security-overview-analytics-structure.sql
      - spokes-structure.sql
      - stratocaster-structure.sql
      - memex-structure.sql
      - mysql2-structure.sql
      - notifications-deliveries-structure.sql
      - notifications-entries-structure.sql
      - notifications-summaries-structure.sql
      - iam-structure.sql
      - billing-structure.sql
      - permissions-structure.sql
      - token-scanning-service-structure.sql
      - vt-structure.sql
      - commits-structure.sql
    schema_cache_path: <%= "db/schema/enterprise.dump" unless ENV["ENTERPRISE_SKIP_SCHEMA_CACHE"] %>
    variables:
      sql_mode: 'STRICT_ALL_TABLES,NO_ZERO_DATE,NO_ZERO_IN_DATE,NO_AUTO_VALUE_ON_ZERO,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION'
