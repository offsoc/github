import {Meta} from '@storybook/blocks'
import {Controls} from '@storybook/blocks'
import imageExampleListItem from '../images/listitem-example-list-items.png'
import imageExpandCollapseToggle from '../images/listitem-expand-collapse-toggle.png'
import imageLeadingVisual from '../images/listitem-leading-visual.png'
import imageTitlePrimaryAction from '../images/listitem-title-primary-action.png'
import imageParentLevelNodeCompletionTally from '../images/listitem-parent-node-level-completion-tally.png'
import imageSelection from '../images/listitem-selection.png'
import imageSecondaryInfoAndActions from '../images/listitem-secondary-info-and-actions.png'
import imageOverflowActions from '../images/listitem-overflow-actions.png'
import imageControlHint from '../images/listitem-control-hint.png'

<Meta title="Recipes/NestedListView/Documentation/Accessibility/ListItem" />

## Nested ListView ListItem

<img alt="A parent list item that contains three child list items. Each list item has a selection checkbox, an open status indicator, a title, tags, assignees, and overflow actions. The parent issue also has a downwards-facing chevron to indicate that it is toggled open, and a tally badge to indicate how many of its child issues are still open." src={imageExampleListItem} />

In a Nested ListView a ListItem is a node in a tree view construct. Nodes can be assembled in a series, as well as nested to create parent/child relationships.

### ListView component reference

[ListItem/ListItem.tsx](https://github.com/github/github/blob/master/ui/packages/list-view/src/ListItem/ListItem.tsx)

### Overview of ListItem Issue node anatomy

Broadly-speaking, there are three parts of a ListItem Issue node:

1. The ListItem Issue node's outer `li` element,
2. The ListItem Issue node's inner wrapper container, and
3. The ListItem Issue node inner wrapper's content.

The outer `li` element and its ARIA declarations helps to communicate positional and parent/child relationship information, as well as expanded/collapsed state to assistive technology.

The node's inner wrapper and content has specific markup considerations in order to meet the design needs and also make it compatible with a tree view construct.

### Overview of ListItem Issue node assistive technology considerations

#### Tree views, multiple secondary actions, and control hints

A tree view construct handles the majority of assistive technology interaction considerations. The one thing that needs custom consideration is making the content placed in the inner wrapper both readable and interactable.

The reason for this is that tree views only support, and are expected to support reading the node's name and taking action on it. Secondary information and actions are not expected, nor is there a standardized way to announce this information or take action on it.

To make assistive technology users aware of, and able to interact with ListItem secondary information and actions, its content must be placed in a modal dialog. Users are made aware of the ability to trigger the dialog via a control hint announcement that indicates a required custom keyboard shortcut keypress sequence. The dialog and control hint announcement will be documented in subsequent sections of this document.

#### Suppression of secondary info and actions

As tree view constructs only [support one main action](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-listitem--docs#tree-views-multiple-secondary-actions-and-control-hints), there needs to be a mechanism to suppress information other than the node's name from being discovered or announced by assistive technology. This will ensure Nested ListView ListItem content can be navigated and operated by:

* Sighted cursor users, who can see and click on visual UI.
* Low or no vision keyboard users can use [applicable keyboard commands](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-overview--overview#keyboard-support) on ListItem elements.
* Voice command and gaze-based users can use visible or announced accessible names.
* Multimodal users can use the previous techniques interchangeably on the fly.

The [secondary info and actions](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-listitem--docs#secondary-info-and-actions-container) portion of the ListItem needs to be suppressed from assistive technology. If other content is introduced into this component, such as [the ListView metadata subcomponent](?path=%2Fdocs%2Frecipes-list-view-documentation-accessibility-listitem--docs#listitem-metadata).

Suppressing the presence of content from assistive technology relies on two techniques to work:

1. Applying `aria-hidden="true"` to the content's parent container element, and also
2. Applying `tabindex="-1"` to each interactive child element inside the parent container.

This:

1. Removes the ability of the content to be announced, and also
2. Be focused on by user interaction.

Example markup of this approach:

```html
<div aria-hidden="true">
  <ul>
    <li><a tabindex="-1" href="/path/to/resource/">canonical</a></li>
    <li><a tabindex="-1" href="/path/to/resource/">feature</a></li>
    <li><a tabindex="-1" href="/path/to/resource/">fy24</a></li>
  </ul>
  <button tabindex="-1" type="button">3 comments</button>
  <a tabindex="-1" aria-label="Assigned to @ohiosveryown" href="/path/to/resource/">
    <img alt="" src="avatar.png" />
  </a>
</div>
```

The list of all interactive elements and attributes `tabindex="-1"` needs to be applied to is:

* `<a>`,
* `<button>`,
* `<input>`,
* `<textarea>`,
* `<select>`,
* `<details>`,
* `<audio>`,
* `<video>`,
* `<object>`,
* Any element with scroll overflow in Firefox,
* Any element with the `contenteditable` attribute applied to it, and
* Any element with a `tabindex` attribute applied to it, whose value is `0`, `1`, or higher.

#### `aria-label` and the ListItem accessible name

The accessible name of a ListItem node is constructed by different important aspects of its visible content. This is done by way of concatenating strings used as a value for the `aria-label` declared on [the ListItem's outer `li` element](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-listitem--docs#overview-of-listitem-issue-node-behavior). Examples of this important information are:

* Selection state
* Issue type
* Issue status
* Activity
* Child task completion
* Control hint
* Etc.

**This order is intentional**, in that the assistive technology announcement needs to prioritize speed and ease of understanding. The most important information comes first, followed by helpful secondary information.

For example, an `aria-label` value for a Nested ListView being used for a repository's Issues would be:

```html
<li
  aria-label="{listitem type}: {listitem title}: {listitem status}. {new activity}. {completion}. Press Control, Shift, U for more actions."
>
  <!---Nested ListItem content-->
</li>
```

This allows a user to quickly understand the ListItem's:

1. Type,
2. Title,
3. Status, and then that
4. There are more actions available.

[Secondary info and actions](?path=%2Fdocs%2Frecipes-list-view-documentation-accessibility-listitem--docs#secondary-info-and-actions) **are not** included in the `aria-label` construction.

Punctuation is significant in the `aria-label` string value. It will affect how assistive technology pronounces the accessible name. This will help users understand what the content is.

The control hint ("Press Control, Shift, U for more actions.") is **always** appended to the end of the concatenated string as the last item.

Aspects of the ListItem that contribute towards the `aria-label` string value will be identified in applicable following subsections.

#### Reacting to a repo being placed in read-only mode

A user can [archive a repo](https://docs.github.com/en/repositories/archiving-a-github-repository/archiving-repositories), which places it in read-only mode. When this happens, a `readonly` prop is applied to the Nested ListView component. A `readonly` prop is also applied if the user does not have update permission.

Note that the `readonly` prop is different than [the HTML `readonly` attribute](https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes/readonly), as a user can still navigate to the destination a ListItem links to via its [primary action](?path=%2Fdocs%2Frecipes-nestedlistview-documentation-accessibility-listitem--docs#titleprimary-action).

When the `readonly` prop is applied, the following functionality and subcomponents are removed from ListItems:

* Drag and drop, and
* [Selection checkboxes](?path=%2Fdocs%2Frecipes-nestedlistview-documentation-accessibility-listitem--docs#selection).

The [secondary info and actions dialog is preserved](?path=%2Fdocs%2Frecipes-nestedlistview-documentation-accessibility-listitem--docs#secondary-info-and-actions-dialog), as it will still be needed to allow users to navigate the ListItem metadata.

### Expand/collapse toggle

<img alt="A cropped portion of a ListItem that shows the expand/collapse toggle, issue status, type, and title. An arrow labeled, 'Expand/collapse toggle' is pointed to the relevant subcomponent." src={imageExpandCollapseToggle} />

This subcomponent is **required**.

The expand/collapse toggle intentionally does not use a `button` or other interactive element. The reason for this is that the interactive behavior is handled by keypresses or an click event that is detected on the expand/collapse toggle target area. This is because of the "one action per node" limitation of a tree view construct.

An expand/collapse toggle **is not** displayed if a ListItem node does not have any child nodes.

#### Expand/collapse toggle reference

The TreeView component has documentation and logic already established for this subcomponent:

* [Expanding directory nodes](https://github.com/github/primer/blob/main/apis/tree-view-api.md#expanding-directory-nodes)
* [Collapsing directory nodes](https://github.com/github/primer/blob/main/apis/tree-view-api.md#collapsing-directory-nodes)
* [Expanded child directory nodes when a parent node is collapsed](https://github.com/github/primer/blob/main/apis/tree-view-api.md#expanded-child-directory-nodes-when-a-parent-node-is-collapsed)
* [Activating nodes](https://github.com/github/primer/blob/main/apis/tree-view-api.md#activating-nodes)

#### Expand/collapse toggle example markup

```html
<div id="uuid-nested-list-view-container">
  <!-- Nested ListView container title -->
  <!-- Nested ListView metadata -->
  <!-- Nested ListView announcements -->
  <ul role="tree" id="uuid" aria-labelledby="uuid-title">
    <!-- Other Nested ListView ListItem parent nodes -->
    <li id="uuid-node3" role="treeitem" tabindex="-1" aria-selected="false" aria-level="1">
      <div>
        <svg aria-hidden="true" focusable="false">
          <!-- Octoicon SVG code -->
        </svg>
      </div>
      <!-- Nested ListView ListItem content -->
    </li>
    <!-- Other Nested ListView ListItem parent nodes -->
  </ul>
</div>
```

### Inner wrapper container

This subcomponent is **required**.

The ListItem's inner wrapper container is used to contain the ListItem's content. A semantically neutral `div` element is used to achieve this.

#### Inner wrapper container example markup

```html
<div id="uuid-nested-list-view-container">
  <!-- Nested ListView container title -->
  <!-- Nested ListView metadata -->
  <!-- Nested ListView announcements -->
  <ul role="tree" id="uuid" aria-labelledby="uuid-title">
    <!-- Other Nested ListView ListItem parent nodes -->
    <li id="uuid-node3" role="treeitem" tabindex="-1" aria-selected="false" aria-level="1">
      <!-- Nested ListView ListItem expand/collapse toggle -->
      <div>
        <!-- Nested ListView ListItem content -->
      </div>
    </li>
    <!-- Other Nested ListView ListItem parent nodes -->
  </ul>
</div>
```

### Leading visual

<img alt="A cropped portion of a ListItem that shows the issue status icon and title. An arrow labeled, 'Leading visual' is pointed to the issue status icon." src={imageLeadingVisual} />

* This subcomponent is **optional**. If a Nested ListView ListItem leading visual is used, **all** ListItems in the ListView component instance are **required** to use one.
* This subcomponent contributes to the `aria-label` used for the ListItem accessible name **only** if used and the leading visual **is not** decorative.

A ListItem can only have **one** leading visual. The type of icon utilized depends on the content needs of the overall page/view the Nested ListView component is placed in.

Some, but not all ListItem leading visuals are not decorative. Leading visuals that are not decorative **must** have their content included in assistive technology announcements. ListItem leading visuals that are decorative **must not** have their content included in assistive technology announcements.

Further information about what is and is not a decorative leading visual is [documented in more detail in the ListView component](?path=%2Fdocs%2Frecipes-list-view-documentation-accessibility-listitem--docs#listitem-leading-visual).

#### Leading visual reference

The ListView component has documentation and logic already established for this subcomponent. The one addition is that if the leading visual is interactive it **must** have its [interactivity suppressed](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-listitem--docs#suppression-of-secondary-info-and-actions). Interactivity suppression is accomplished by applying the following declarations to the parent-level interactive element:

* `aria-hidden="true"`

* `tabindex="-1"`

* [ListItem leading visual](?path=%2Fdocs%2Frecipes-list-view-documentation-accessibility-listitem--docs#listitem-leading-visual)
  * [Status icons](?path=%2Fdocs%2Frecipes-list-view-documentation-accessibility-listitem--docs#status-icons)
  * [CI check status](?path=%2Fdocs%2Frecipes-list-view-documentation-accessibility-listitem--docs#ci-check-status)
  * [Branded logos and avatars](?path=%2Fdocs%2Frecipes-list-view-documentation-accessibility-listitem--docs#branded-logos-and-avatars)
  * [Generic icons](?path=%2Fdocs%2Frecipes-list-view-documentation-accessibility-listitem--docs#generic-icons)

* [ListItem/LeadingBadge.tsx](https://github.com/github/github/blob/master/ui/packages/list-view/src/ListItem/LeadingBadge.tsx)

* [ListItem/LeadingBadgeContext.tsx](https://github.com/github/github/blob/master/ui/packages/list-view/src/ListItem/LeadingBadgeContext.tsx)

* [ListItem/LeadingContent.tsx](https://github.com/github/github/blob/master/ui/packages/list-view/src/ListItem/LeadingContent.tsx)

* [ListItem/LeadingVisual.tsx](https://github.com/github/github/blob/master/ui/packages/list-view/src/ListItem/LeadingVisual.tsx)

### New/unread activity indicator

* This subcomponent is **optional**. If Nested ListView ListItem selection is used, **all** ListItems in the ListView component instance are **required** to use one.
* This subcomponent contributes to the `aria-label` used for the ListItem accessible name **only** if used.

A small blue dot is used to indicate the presence of a new ListItem, or activity that has occured within the content that the ListItem's primary action links to.

#### New/unread activity indicator `aria-label` content

The new activity's presence must be added to the ListItem `li`'s `aria-label` string. This content is placed:

* Immediately after the [status](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-listitem--docs#leading-visual) string, if present. Otherwise, it is placed
* Immediately after the [title/primary action](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-listitem--docs#titleprimary-action) string.

```
Epic. Intelligent Chatbot Support: Status: Open. New activity. 5 of 10 Issues completed. 50% complete. Press Control, Shift, U for more actions.
```

#### New/unread activity indicator reference

The ListView component has applicable documentation and logic available for this subcomponent:

* [ListItem new/unread activity indicator](https://ui.githubapp.com/storybook/?path=%2Fdocs%2Frecipes-list-view-documentation-accessibility-listitem--docs#listitem-newunread-activity-indicator)
* [ListItem/NewActivityContext.tsx](https://github.com/github/github/blob/master/ui/packages/list-view/src/ListItem/NewActivityContext.tsx)

### Title/primary action

<img alt="A cropped portion of a ListItem that shows the selection checkbox, collapsed chevron, issue status icon, type, title, and completion tally. An arrow labeled, 'Title/primary action' is pointed to the issue title." src={imageTitlePrimaryAction} />

* This subcomponent is **required**.
* This subcomponent contributes to the `aria-label` used for the ListItem accessible name.

The ListItem's accessible name is the title of the ListItem, plus other relevant node information. It can can navigate to a destination or trigger an action.

Interacting with a ListItem's primary action should honor [all applicable keyboard commands](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-overview--overview#keyboard-support). This includes:

* <kbd>Enter</kbd> and <kbd>Space</kbd> (if [selection](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-listitem--docs#selection)
  is present), as well as
* [Modifier keys](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-overview--overview#modifier-keys) accompanying an <kbd>Enter</kbd> keypress.

#### Considerations for when the primary action triggers a side panel modal dialog

Certain designs, including displaying Repository Issues, trigger a side panel modal dialog when activated. Here, the expected element to trigger this action is a `button` element.

However, both the design and historical user behavior may expect the visual UI to look like a text link. Because of this, the title will need to be constructed in such a way that it:

1. Announces itself as a ListItem node to assistive technology,
2. Responds to expected link keyboard interactions,
3. Responds to expected link mouse interactions, and also
4. Responds to expected link context menu interactions.

ARIA and tabindex attribute declarations are utilized in order to preserve the visual design, including text wrapping.

The `hX` element from the ListView ListItem is also removed. This is to ensure that assistive technology such as JAWS and NVDA function as expected when interacting with a tree view construct.

JavaScript logic will intercept a click, tap, or keypress activation request and load the dialog instead.

#### Title/primary action example markup

```html
<div id="uuid-list-view-node3-title">
  <a
    href="/path/to/resource/"
    role="presentation"
    tabindex="-1">
    {listitem title}
  <a>
</div>
```

**Notes:**

* An `a` element wraps the ListItem title string.
  * This enables context menu interactions such as copying the Issue URL or opening it in an private window.
  * Right click, middle click, and long-press events should "pass through" the parent `li`, `ul`, `div` and other associated elements if the user positions the cursor over the link's visible surface area.
* The `href` attribute's value supplies the URL that the link navigates to.
  * In the case of Issues, it would be the Issue detail page.
* The declaration of `role="presentation"` removes the announcement of the `a` element's role from assistive technology.
  * The tree view node role is conferred by the parent `li` element and its attribute declarations instead.
  * Using `role="presentation"` and not `aria-hidden="true"` still enables assistive technology to parse and announce the ListItem title string.
  * Experientially, the tree view node will announce as expected for assistive technology users, and function as expected for both assistive and non-assistive technology users:
    * The anchor element's role is being suppressed
    * Focus is being managed by the side menu dialog when the tree view node is activated.
    * Expected keyboard, mouse, and touch actions are being honored.
* The declaration of `tabindex="-1"` prevents the anchor element from being focused by assistive technology.
  * Focus is instead handled by [the roving tabindex](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-overview--overview#focus-management-and-node-traversal) declared on the `li` elements.

#### Title/primary action reference

The ListView component has applicable documentation and logic available for this subcomponent:

* [ListItem title](?path=%2Fdocs%2Frecipes-list-view-documentation-accessibility-listitem--docs#listitem-title)
* [ListItem/Title.tsx](https://github.com/github/github/blob/master/ui/packages/list-view/src/ListItem/Title.tsx)
* [ListView/TitleContext.tsx](https://github.com/github/github/blob/master/ui/packages/list-view/src/ListView/TitleContext.tsx)
* [ListView/use-next-header-tag.ts](https://github.com/github/github/blob/master/ui/packages/list-view/src/hooks/use-next-header-tag.ts)

### Parent node-level completion tally

<img alt="A cropped portion of a ListItem that shows the selection checkbox, collapsed chevron, issue status icon, type, title, and completion tally. An arrow labeled, 'Parent node-level completion tally' is pointed to the relevant subcomponent." src={imageParentLevelNodeCompletionTally} />

This subcomponent is **optional**.

A completion tally can also be placed on a parent-level ListItem node, after the title/primary action. More information about this subcomponent is available in [the parent Nested ListView documentation](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-list-view--docs#component-level-completion-tally).

A completion tally can be either static or part of the ListItem's title/primary action. It **cannot** be interactive, due to [limitations with secondary actions](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-listitem--docs#tree-views-multiple-secondary-actions-and-control-hints).

There are two aspects to parent node-level completion tally markup:

1. Its content being included in [the ListItem's `aria-label`](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-listitem--docs#aria-label-and-the-listitem-accessible-name), and
2. The component markup itself

The tally information is added to the ListItem's `aria-label`:

```html
Epic. Intelligent Chatbot Support: Status: Open. 3 of 7 Issues completed. Press Control, Shift, U for more actions.
```

The tally is placed next to the [ListItem title](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-listitem--docs#titleprimary-action) in this example:

#### Static parent node-level completion tally markup

```html
<div id="uuid-list-view-node3-title">
  <a
    href="/path/to/resource/"
    role="presentation"
    tabindex="-1">
    {listitem title}
  <a>
  <div>
    <span aria-hidden="true">3 of 7</span>
    <span class="sr-only">3 of 7 Issues completed</span>
  </div>
</div>
```

#### Interactive parent node-level completion tally markup

```html
<div id="uuid-list-view-node3-title">
  <a
    href="/path/to/resource/"
    role="presentation"
    tabindex="-1">
    {listitem title}
  <a>
  <div>
    <button
      aria-hidden="true"
      tabindex="-1"
      type="button">
      <span aria-hidden="true">3 of 7</span>
      <span class="sr-only">3 of 7 Issues completed</span>
    </button>
  </div>
</div>
```

**Note:**

* An `a` element is placed as the child of the containing `div` element.

  * The `a` element contains the two `span` elements.
  * Both `aria-hidden="true"` and `tabindex="-1"` are declared on the `a` element to allow it to be clicked/tapped, but prevent it from being focused or announced by assistive technology. The announcement is instead handled by the `aria-label`.

### Selection

<img alt="A cropped portion of a ListItem that shows the selection checkbox, collapsed chevron, issue status icon, type, title, and completion tally. An arrow labeled, 'Selection' is pointed to the selection checkbox." src={imageSelection} />

* This subcomponent is **optional**. If Nested ListView ListItem selection is used, **all** ListItems in the ListView component instance are **required** to use one.
* This subcomponent contributes to the `aria-label` used for the ListItem accessible name **only** if used.

One or more Nested ListView ListItem can be selected in order to have [bulk actions](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-list-view--docs#metadata-container-info-and-bulk-actions) applied to them.

Parent ListItems are placed in an indeterminate state if any of their child ListItems are selected. If all child ListItems are selected, the parent ListItem is placed in a selected state. This state is reflected if [a bulk selection action](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-list-view--docs#metadata-container-info-and-bulk-actions) is utilized.

#### Selection reference

The ListView component has documentation and logic already established for this subcomponent:

* [ListItem selection](?path=%2Fdocs%2Frecipes-list-view-documentation-accessibility-listitem--docs#listitem-selection)
* [ListItem/Selection.tsx](https://github.com/github/github/blob/master/ui/packages/list-view/src/ListItem/Selection.tsx)
* [ListItem/SelectionContext.tsx](https://github.com/github/github/blob/master/ui/packages/list-view/src/ListItem/SelectionContext.tsx)

#### Selection example markup

```html
<div id="uuid-nested-list-view-container">
  <!-- Nested ListView container title -->
  <!-- Nested ListView metadata -->
  <!-- Nested ListView announcements -->
  <ul role="tree" id="uuid" aria-labelledby="uuid-title">
    <!-- Other Nested ListView ListItem parent nodes -->
    <li
      id="uuid-node3"
      role="treeitem"
      tabindex="-1"
      aria-label="{listitem title}"
      aria-selected="false"
      aria-level="1"
    >
      <!-- Nested ListView ListItem expand/collapse toggle -->
      <div>
        <div>
          <!-- Nested ListView ListItem title -->
        </div>
        <div>
          <input
            aria-label="Select: {listitem title}."
            id="uuid-list-view-node3-checkbox"
            tabindex="-1"
            type="checkbox"
          />
        </div>
        <!-- Other Nested ListView ListItem content -->
      </div>
    </li>
    <!-- Other Nested ListView ListItem parent nodes -->
  </ul>
</div>
```

### Trailing badge

This subcomponent is **optional**.

ListItem trailing badges are conditionally applied to individual ListItems in a ListView component instance. Trailing badges **are not** labels, we allow an exception
to this rule for the Issues Experience team but this is not recommended. Please contact the Shared Components team or accessibility if you think your use case applies.

A ListItem can only have **one** trailing badge. The type of badge utilized depends on the content needs of the overall page/view the Nested ListView component is placed in.

ListItem trailing badges **are not** decorative. Because of this, their content must be included in assistive technology announcements.

#### Trailing badge reference

The TreeView component has documentation and logic already established for this subcomponent:

* [ListItem trailing badge](?path=%2Fdocs%2Frecipes-list-view-documentation-accessibility-listitem--docs#listitem-trailing-badge)
* [ListItem/TrailingBadge.tsx](https://github.com/github/github/blob/master/ui/packages/list-view/src/ListItem/TrailingBadge.tsx)
* [ListItem/TrailingBadgeContext.tsx](https://github.com/github/github/blob/master/ui/packages/list-view/src/ListItem/TrailingBadgeContext.tsx)

### Secondary info and actions container

<img alt="A cropped portion of a ListItem that two overall sections. The first section contains a status badge and title. The second section contains labels, a comment tally, assignees, and an overflow button. The second section is labeled, 'Secondary info and actions'." src={imageSecondaryInfoAndActions} />

This subcomponent is **required**. Use [the TreeView component](https://primer.style/components/tree-view) if a Nested ListView design does not have secondary info and actions present in the design.

The secondary info and actions container functions like the ListItem's [inner wrapper container](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-listitem--docs#inner-wrapper-container). It is used to encapsulate the secondary info and actions of a ListItem. Examples of secondary info and actions are, but are not limited to:

* Labels,
* Comment tallies,
* Assignees,
* etc.

A semantically neutral `div` is used to achieve this.

#### Secondary info and actions container markup

```html
<div id="uuid-nested-list-view-container">
  <!-- Nested ListView container title -->
  <!-- Nested ListView metadata -->
  <!-- Nested ListView announcements -->
  <ul role="tree" id="uuid" aria-labelledby="uuid-title">
    <!-- Other Nested ListView ListItem parent nodes -->
    <li
      id="uuid-node3"
      role="treeitem"
      tabindex="-1"
      aria-label="{listitem title}"
      aria-selected="false"
      aria-level="1"
    >
      <!-- Nested ListView ListItem expand/collapse toggle -->
      <div>
        <div>
          <!-- Nested ListView ListItem title -->
        </div>
        <div>
          <!-- Nested ListView ListItem checkbox -->
        </div>
        <div aria-hidden="true">
          <!-- Nested ListView ListItem secondary info and actions content -->
        </div>
      </div>
    </li>
    <!-- Other Nested ListView ListItem parent nodes -->
  </ul>
</div>
```

**Note:** `aria-hidden="true"` **must** be declared on the container's `div` to help [remove the content's presence from assistive technology](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-listitem--docs#suppression-of-secondary-info-and-actions).

### Secondary info and actions

This subcomponent is **required**. Use [the TreeView component](https://primer.style/components/tree-view) if a Nested ListView design does not have secondary info and actions present in the design.

The order of ListItem secondary info and actions is up to the component author to determine. The sole exception is the location of overflow actions, provided they are used.

**Note:** `tabindex="-1"` **must** be declared on each interactive element used as a secondary action, to help [remove the content's presence from assistive technology](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-listitem--docs#suppression-of-secondary-info-and-actions).

#### Secondary info and actions reference

The ListView component has documentation and logic already established for this subcomponent:

* [ListItem secondary info and actions](?path=%2Fdocs%2Frecipes-list-view-documentation-accessibility-listitem--docs#listitem-secondary-info-and-actions)
* [General advice for disambiguating interactive controls](?path=%2Fdocs%2Frecipes-list-view-documentation-accessibility-listitem--docs#general-advice-for-disambiguating-interactive-controls)
* [ListItem/ActionBar.tsx](https://github.com/github/github/blob/master/ui/packages/list-view/src/ListItem/ActionBar.tsx)

### Secondary info and actions dialog

This subcomponent is **required**.

As [a tree view construct only supports one action per node](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-listitem--docs#overview-of-listitem-issue-node-assistive-technology-considerations), an alternate mechanism is needed to allow all users access a node's secondary info and action content. To accomplish this, a modal dialog can be triggered by a custom keyboard shortcut.

The Primer [Dialog component](https://primer.style/components/dialog) should be used to accomplish this.

The modal dialog contains **all** the information contained within the Nested ListView ListItem node that currently has focus placed on it when the keyboard shortcut is activated. The order of the modal's content should generally reflect the order of the ListItem content. For example, the ListItem title/primary action should come first, followed by secondary actions and information in the same general visual order as the non-dialog treatment.

**Note:** The dialog may use the side panel design as a visual treatment. It will still behave like a dialog for assistive technology.

#### Secondary info and actions dialog behavior

Taking action on information contained within the modal will affect the ListItem content in its non-modal state. For example, if a user removes a label when the ListItem node dialog is open, the ListItem node will also be updated to have that label removed. The opposite also applies: if a label is added to a ListItem node when the dialog before the dialog is triggered the new label, as well as any other subsequent node-level content modifications will be included the next time the dialog is triggered.

**Only one** modal dialog can be open at a time. If a modal dialog is currently open it will need to be dismissed before another dialog can be triggered.

Focus within the dialog should be managed by the Dialog component. When the dialog is dismissed focus **must** return to the ListItem node that triggered it.

A modal's opened state does not persist across page loads or navigation. If a user navigates away from the page or refreshes the page, the modal will be dismissed.

If an action that requires user confirmation is triggered while a modal is open **and** a dismissal, reload, or navigation event occurs, the modal's dismissal is interrupted **only** if the subcomponent explicitly handles this behavior. An example of this is a dialog asking for confirmation that you want to remove an Issue assignee.

Secondary actions placed in a dialog **cannot** affect other ListItem nodes. This behavior is is instead accomplished via [bulk actions](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-list-view--docs#metadata-container-info-and-bulk-actions).

#### Secondary info and actions dialog keyboard support

The modal dialog supports **all** keyboard interactions supported by the Dialog component. An example of this is <kbd>Esc</kbd> for dismissing the dialog.

Secondary actions placed within the dialog should respect existing, specified keyboard behavior.

### Overflow actions

<img alt="A cropped portion of a ListItem that two overall sections. The first section contains a status badge and title. The second section contains labels, a comment tally, assignees, and an overflow button. An arrow labeled, 'Overflow actions' is pointed to the relevant subcomponent." src={imageOverflowActions} />

This subcomponent is **required**.

Overflow actions are automatically created when there are more secondary actions than there is available horizontal viewport space. These actions are automatically folded into an overflow menu so as to not create horizontal overflow.

Additionally, overflow actions can be used to contain less-important, less frequently used actions on all viewports.

#### Overflow actions reference

The ListView component has documentation and logic already established for this subcomponent:

* [ListItem overflow actions](?path=%2Fdocs%2Frecipes-list-view-documentation-accessibility-listitem--docs#listitem-overflow-actions)

### Control hint

<img alt="Three list items. One is parent-level, and the other two are children. The first child list item has a focus ring drawn around it. Towards the end of the focus ring is a small popup label that reads, 'Open actions dialog. Control, Shift, U'." src={imageControlHint} />

* This subcomponent is **required**.
* This subcomponent contributes to the `aria-label` used for the ListItem accessible name.

Each Nested ListView node can use a [keyboard shortcut](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-overview--overview#keyboard-support) to toggle open a [dialog](?path=%2Fdocs%2Frecipes-list-view-documentation-accessibility-listitem--docs#secondary-info-and-actions-dialog) to allow users to read and operate [secondary info and actions](?path=%2Fdocs%2Frecipes-list-view-documentation-accessibility-listitem--docs#secondary-info-and-actions).

Because this interaction is not part of the typical, expected interaction model with a tree view construct, a control hint is announced on each ListItem node's `aria-label`. Additionally, a visual control hint is also displayed, for sighted keyboard-only users.

#### Control hint announcement

The control hint announcement is "Press Control, Shift, U for more actions." and it is **always** added to the end of each ListItem node's `aria-label`. An example of this could be:

```
Task: Acquire domain for launch. Status: Open. Press Control, Shift, U for more actions.
```

Note the period and space (". ") placed before the control hint. This will provide a pause that will help a user understand where the end of the ListItem node content ends and the control hint begins.

##### Control hint announcement example markup

```html
<div id="uuid-nested-list-view-container">
  <!-- Nested ListView container title -->
  <!-- Nested ListView metadata -->
  <!-- Nested ListView announcements -->
  <ul role="tree" id="uuid" aria-labelledby="uuid-title">
    <!-- Other Nested ListView ListItem parent nodes -->
    <li
      id="uuid-node3"
      role="treeitem"
      tabindex="-1"
      aria-label="{listitem type}: {listitem title}: {listitem status}. Press Control, Shift, U for more actions."
      aria-selected="false"
      aria-level="1"
    >
      <!-- Nested ListView content -->
    </li>
    <!-- Other Nested ListView ListItem parent nodes -->
  </ul>
</div>
```

#### Control hint UI

The control hint UI allows keyboard-only, non screenreader users to understand how to access Nested ListView ListItem secondary info and actions. It is a visual representation of the control hint announcement.

The control hint behavior has two aspects:

1. Being visually displayed when a Nested ListView ListItem node is focused. This applies to when focus is applied by using <kbd>Tab</kbd> to navigate into the Nested ListView component, or when other [keyboard interactions](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-overview--overview#keyboard-support) [move focus to another node](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-overview--overview#focus-management-and-node-traversal).
2. Removing its presence from assistive technology, as this functionality will already be announced by [the control hint announcement](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-listitem--docs#control-hint-announcement).

##### Control hint UI example markup

```html
<div id="uuid-nested-list-view-container">
  <!-- Nested ListView container title -->
  <!-- Nested ListView metadata -->
  <!-- Nested ListView announcements -->
  <ul role="tree" id="uuid" aria-labelledby="uuid-title">
    <!-- Other Nested ListView ListItem parent nodes -->
    <li
      id="uuid-node3"
      role="treeitem"
      tabindex="-1"
      aria-label="{listitem type}: {listitem title}: {listitem status}. Press Control, Shift, U for more actions."
      aria-selected="false"
      aria-level="1"
    >
      <div aria-hidden="true">
        <p>Opens actions dialog</p>
        <p><kbd>Control</kbd>+<kbd>Shift</kbd>+<kbd>U</kbd></p>
      </div>
      <!-- Nested ListView content -->
    </li>
    <!-- Other Nested ListView ListItem parent nodes -->
  </ul>
</div>
```

**Notes:**

* The `aria-label` value is preserved, including the "Press Control, Shift, U for more actions." control hint announcement.
* `aria-hidden="true"` is declared on the control hint UI container's `div` to help remove the content's presence from assistive technology.
* The control hint itself is **only** displayed when a ListItem receives focus. The [`:focus-visible` pseudo class](https://developer.mozilla.org/en-US/docs/Web/CSS/:focus-visible) may be helpful for ensuring this behavior.

#### Control hint future state

The control hint should eventually be able to support:

* Being conditionally turned off and on as a user preference.
  * If turned off, the control hint announcement should not be included in the `aria-label` string.
  * The control hint UI should be hidden.
* Being rebound to a different keyboard shortcut key combination.
  * If rebound, the new keyboard shortcut key combination should be included in the `aria-label` string.
  * The control hint UI's content should be updated to show the new keyboard shortcut.

**Reference:**

* [github/sub-issues: \[Batch\] Outreach: Keyboard shortcuts](https://github.com/github/sub-issues/issues/120)
* [github/primer: \[Epic\] Design an accessible keyboard shortcut UI](https://github.com/github/primer/issues/2029)

### Groups

This subcomponent is **optional**.

A Nested ListView can be configured by the user in such a way that it is organized by parent-level metadata. When done, it places each applicable ListItem and child ListItems into a group. An example of this could be sorting by milestones.

The Nested ListView uses headings to create both a visual and semantic grouping of ListItems sorted this way. Each list of ListItems then becomes its own smaller NestedListView instance. This helps assistive technology users understand that each group is its own entity, all under the umbrella of [the Nested ListView title](https://ui.githubapp.com/storybook/?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-list-view--docs#title).

**High-level example:**

* `h2` Issues
  * `h3` Golden GA
    * `ul` (start of tree view construct 1)
      * `li` Integrate with backend systems
      * `li` Epic: Introduce AI in Product
        * `ul`
          * `li` Smart Product Recommendations
          * `li` Advanced Search and Filtering
          * `li` Personalized Shopping Experience
      * `li` Hero site - Development Alpha 3
      * `li` Epic: Intelligent Chatbot Support
      * `li` Final creative shots from game
  * `h3` Beta
    * `ul` (start of tree view construct 2)
      * `li` Implementation of AI in e-commerce
      * `li` Free and paid levels
      * `li` Task: Acquire domain for launch

Nested ListView Groups **cannot** be themselves, and are all presented at the same level of hierarchy.

Broadly-speaking, there are four parts of a ListItem Issue node:

1. The outer wrapper container,
2. The selection checkbox,
3. The title, and
4. The ListItem tally badge.

#### Group outer wrapper

This subcomponent is **required**.

A Nested ListView Group needs a container that can express the boundaries of its content. This container communicates the boundary area that the rest of the Group's content is placed in. A semantically neutral `div` element is used to achieve this.

##### Group outer wrapper example markup

```html
<div id="uuid-nested-list-view-container">
  <!-- Nested ListView container title -->
  <!-- Nested ListView metadata -->
  <!-- Nested ListView announcements -->
  <div>
    <!-- Nested ListView Group content -->
  </div>
  <!-- Nested ListView tree view construct -->
  </ul>
</div>
```

#### Group selection checkbox

This subcomponent is **optional**. If Nested ListView ListItem selection is used, **all** ListView Groups **and** ListItems in the ListView component instance are required to use one.

This selection checkbox functions much like [the ListView component's bulk select all metadata action](https://ui.githubapp.com/storybook/?path=%2Fdocs%2Frecipes-list-view-documentation-accessibility-list-view--docs#1-select-all-list-view-list-items) does. However, it **only** selects the Nested ListView ListItems associated with the parent metadata associated with the grouping. It **does not** select all Nested ListView ListItems.

Checking one or more Nested ListView ListItems in a Group will place both the Group's selection checkbox and the Nested ListView's bulk select all metadata action in [an indeterminate state](https://html.spec.whatwg.org/multipage/input.html#checkbox-state-\(type=checkbox\)). This applies to all ListItems of any level within a Group.

Manually checking all ListItems in a Group will place the Group selection checkbox in a checked state. It will revert to an indeterminate state if any ListItem in the Group is then unchecked. If all ListItems are unchecked the Group selection checkbox will be placed in an unchecked state.

Checking the Nested ListView's bulk select all metadata action will place **all** Nested ListView ListItems in **every** Group in a selected state, as well as their Group selection checkboxes. This applies to **all** ListItems of any level within a Group.

##### Group selection checkbox example markup

```html
<div id="uuid-nested-list-view-container">
  <!-- Nested ListView container title -->
  <!-- Nested ListView metadata -->
  <!-- Nested ListView announcements -->
  <div>
    <div>
      <input id="uuid-nested-list-view-group-1-select-all" type="checkbox" />
      <label for="uuid-nested-list-view-group-1-select-all" class="sr-only">Select all {list items}: {group title} </label>
    </div>
    <!-- Other Nested ListView Group content -->
  </div>
  <!-- Nested ListView tree view construct -->
  </ul>
</div>
```

**Notes:**

* The outermost `div` is used for positioning and styling purposes.
* The `div` contains a checkbox `input` with a visually hidden `label` element.
  * The `label` element provides the accessible name for the checkbox `input`, and uses the string, "Select all `list items`: `group title`"
  * `list items` is the fallback term if an author does not specify an alternative.
    * If author-supplied, the term **must** concisely and accurately describe what ListItem content a user can select (ex: "issues").
    * `group title` is a placeholder for [the Group title](?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-list-view--docs#group-title).
* The `label` element has a `for` attribute, whose value matches the `id` value assigned to the following checkbox `input`.
* The checkbox `input` has an `id` assigned to it whose value is used to create the programmatic association between the `label` element and this `input` element.
* The label is visually hidden using a declaration of `class="sr-only"`, using [Primer's Screen reader only class](https://primer.style/design/foundations/css-utilities/layout#screen-reader-only).

#### Group title

This subcomponent is **required**.

A Group title is the name of the parent-level metadata used to organize the Nested ListView ListItems by type.

The title uses a heading level element that is one level deeper than [the Nested ListView's title](https://ui.githubapp.com/storybook/?path=%2Fdocs%2Frecipes-nested-list-view-documentation-accessibility-list-view--docs#title). For example, if the Nested ListView's title is an `h2`, the Group title would be an `h3`.

##### Group title example markup

```html
<div id="uuid-nested-list-view-container">
  <!-- Nested ListView container title -->
  <!-- Nested ListView metadata -->
  <!-- Nested ListView announcements -->
  <div>
    <div>
      <input id="uuid-nested-list-view-group-1-select-all" type="checkbox" />
      <label for="uuid-nested-list-view-group-1-select-all" class="sr-only">Select all {list items}: {group title} </label>
    </div>
    <h3>
      Golden GA
    </h3>
    <!-- Other Nested ListView Group content -->
  </div>
  <!-- Nested ListView tree view construct -->
  </ul>
</div>
```

#### ListItem tally badge

This subcomponent is **optional**.

A ListItem tally badge is a count of the number of ListItems in a Group. It includes **all** applicable ListItems, including both parent and child ListItems of any level.

##### ListItem tally badge example markup

```html
<div id="uuid-nested-list-view-container">
  <!-- Nested ListView container title -->
  <!-- Nested ListView metadata -->
  <!-- Nested ListView announcements -->
  <div>
    <div>
      <input id="uuid-nested-list-view-group-1-select-all" type="checkbox" />
      <label for="uuid-nested-list-view-group-1-select-all" class="sr-only">Select all {list items}: {group title} </label>
    </div>
    <h3>
      Golden GA
    </h3>
    <div>
      5
    </div>
    <!-- Other Nested ListView Group content -->
  </div>
  <!-- Nested ListView tree view construct -->
  </ul>
</div>
```

**Notes:**

* The `div` is used for positioning and styling purposes.
* `5` is a placeholder for the number of issues in a Group.
