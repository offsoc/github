"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_assets_modules_github_settings_user-sessions-map-element_ts"],{29916:(t,e,a)=>{var r=a(39595),n=a(27193),s=a(5225),o=a(76178),l=a(48707),i=a(3733),c=a(54140),p=a(18457),u=a(51001),d=a(21671),f=a(32658),h=a(29598),g=a(14398),m=a(43837),y=a(50183),A=a(92486);let v=[].indexOf||function(t){for(let e=0,a=this.length;e<a;e++)if(e in this&&this[e]===t)return e;return -1},_={legend:!1,zoom:!1,graticule:!1,hover:!1,link:!1};function b(t,e,a,r){var n,s=arguments.length,o=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,a):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,a,r);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(o=(s<3?n(o):s>3?n(e,a,o):n(e,a))||o);return s>3&&o&&Object.defineProperty(e,a,o),o}let k=(0,s.A)(x);async function x(t){let e=await (0,n.Ee)(t,{headers:{accept:"application/json"}});return await e.json()}let j=class UserSessionsMapElement extends HTMLElement{async connectedCallback(){let t=this.graph,e=t.getAttribute("data-url");if(e){t.classList.add("is-graph-loading"),t.classList.remove("is-graph-load-error","is-graph-empty");try{let a=await k(e);t.classList.remove("is-graph-loading"),null!=a&&a.unusable?t.classList.add("is-graph-without-usable-data"):null!=a&&0===a.length||null!=a&&null!=a.summary&&0===a.summary.total||null!=a[0]&&null!=a[0].weeks&&0===a[0].weeks.length?t.classList.add("is-graph-empty"):function(t,e,a){let r=Object.assign({},_,void 0),n=t.getBoundingClientRect(),s=Math.round(n.width),b=Math.round(n.height),k=(0,y.A)(null),x=(0,y.A)(".js-map-data"),j=JSON.parse(x.attr("data-map-data")),w=(0,i.A)().scale(s/2/Math.PI).translate([0,0]),$=(0,f.s_)().scaleExtent([1,20]).on("zoom",function(t){r.zoom&&M.attr("transform",t.transform)}),C=(0,c.A)().projection(w),L=(0,p.A)(),O=(0,y.A)(t).append("svg").attr("width",s).attr("height",b).on("click",function(t){if(null!=t&&t.defaultPrevented)return t.stopPropagation()},!0).append("g").attr("transform",`translate(${s/2},${b/2})`).call($);O.append("rect").attr("class",`map-background${r.zoom?" map-background-zoom":""}`).attr("x",-s/2).attr("y",-b/2).attr("width",s).attr("height",b);let M=O.append("g");function R(){if(k.node()===this)return k.classed("active",!1),k=(0,y.A)(null),M.transition().duration(750).call($.translate([0,0]).scale(1).event);k.classed("active",!1),k=(0,y.A)(this).classed("active",!0)}function z(t){return t.toLowerCase().replace(/\s+/,"-")}function N(t){let e=0;void 0!==t&&void 0!==t.target&&(e=j[t.target.__data__.properties.iso_a2]||0);let a=(0,y.A)(".js-map-country-info");return a.transition().duration(100).style("opacity",1),a.html(""),a.append("span").text(function(){return`${0===e?"No":e} ${1===e?"event":"events"} originating from ${t.target.__data__.properties.name}`})}(function(e){let a=(0,o.Ay)(e,e.objects.countries),n=(0,l.A)(e,e.objects.countries,function(t,e){return t!==e}),s=(0,l.A)(e,e.objects.land),i=x.attr("data-search-path");(0,y.A)(t).datum(a.features),M.append("path").datum(s).attr("class","map-land").attr("d",C);let c=M.selectAll(".map-country").data(a.features).enter().append("a").attr("class","map-country-outline").attr("aria-label",t=>t.properties.name);r.link?c.attr("data-pjax","").attr("xlink:href",function(t){return`${i} country:${encodeURIComponent(t.properties.iso_a2)}`.replace(/=\s+/,"=")}):c.attr("role","button"),c.append("path").attr("class",function(t){let e=z(t.properties.iso_a2),a=z(t.properties.name);return`map-country ${e} ${a}`}).attr("d",C),r.hoverShowCountryInfo&&c.on("click",R).on("mouseover",N).on("mouseout",function(){return(0,y.A)(".js-map-country-info").transition().style("opacity",0)}),M.append("path").datum(n).attr("class","map-borders").attr("d",C),r.graticule&&M.append("g").attr("class","map-graticule").selectAll("path").data(L.lines).enter().append("path").attr("d",C),function(t){let e=z(t.attr("data-country"));if(k.classed("active",!1),k=(0,y.A)(null),e.length){let t=M.select(`.${e}`);t.size()&&((k=(0,y.A)(t.node())).classed("active",!0),function(t){let e=x.attr("data-search-path");t.attr("xlink:href",e)}((0,y.A)(t.node().parentNode)))}}(x)})(e),function(e){let a=Object.keys(e),n=a.length,o=(0,y.A)(t).datum().filter(function(t){let e=t.properties.iso_a2;return"-99"!==e&&v.call(a,e)>=0});for(let t of o){let e=t.properties;e.count=j[e.iso_a2]||0}let l=(0,d.A)(o,function(t){return t.properties.count}),i=(0,m.RZ)().domain([0,l]).range([0,15]),c=M.selectAll(".map-point").data(o,function(t){return t.properties.iso_a2});if(c.enter().append("circle").attr("class",t=>`map-point ${t.properties.iso_a2}`).attr("r",0).transition((0,A.kY)().delay((t,e)=>e/n*15)).ease(h.NZ).attr("r",t=>i(t.properties.count)).each(function(t){let e=(0,y.A)(this),[a,r]=function(t){let e=t.properties.iso_a2;return w({US:[-98.5795,39.828175],CA:[-107.74899,59.24028],AU:[134.016341,-24.367113],SE:[15.985167,63.687217],GB:[-1.505067,53.647271],FR:[2.3488,48.85341],NO:[10.683333,59.933333],ID:[106.828333,-6.175],IN:[72.825833,18.975],MY:[101.7,3.133333]}[e]||(0,u.A)(t))}(t);return e.attr("cx",a).attr("cy",r)}),c.exit().remove(),r.legend&&o.length>0){O.select(".map-legend").remove();let t=O.append("g").attr("class","map-legend").attr("transform",`translate(${s/2-25},${b/2-50})`).selectAll("g").data([l,Math.round(l/3)]).enter().append("g");t.append("circle").attr("class","map-legend-circle").attr("cy",function(t){return-i(t)}).attr("r",i),t.append("line").attr("x1",function(t){return-i(t)/2+5}).attr("x2",function(t){return-i(t)-20}).attr("y1",function(t){return -2*i(t)}).attr("y2",function(t){return -2*i(t)}).attr("class","map-legend-link"),t.append("text").attr("class","map-legend-text").attr("y",function(t){return -2*i(t)}).attr("x",function(t){return-i(t)-20}).attr("dy","0.5em").text(function(t){return t<10?t:(0,g.GP)(".2s")(t)})}}(j)}(t,a)}catch(e){throw t.classList.remove("is-graph-loading"),t.classList.add("is-graph-load-error"),e}}}};b([r.aC],j.prototype,"graph",void 0),j=b([r.p_],j)}}]);
//# sourceMappingURL=app_assets_modules_github_settings_user-sessions-map-element_ts-8e43f81a71c6.js.map