apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: github-shadow-lab

images:
  - name: octofactory.service.private-us-east-1.github.net/moda-artifacts-docker/docker-nginx
    digest: sha256:d6c2586408684f8a4262fff592a1602150e8aec2bfd164c26c83190bde53be2f

configMapGenerator:
  - name: elasticsearch
    options:
      disableNameSuffixHash: true
      annotations:
        moda.github.net/canary-v2: "true"
    literals:
      - AUDITLOGSEARCH3_URL=https://auditlogsearch3-ssl.service.iad.github.net
      - COMMIT_SEARCH_1_URL=https://commit-search-1.service.iad.github.net
      - GENERAL_SEARCH_1_URL=https://general-search-1.service.iad.github.net
      - GITHUBSEARCH6_URL=https://githubsearch6-ssl.service.iad.github.net
  - name: observability-config
    options:
      disableNameSuffixHash: true
      annotations:
        moda.github.net/canary-v2: "true"
    literals:
      - GITHUB_TELEMETRY_LOGS_ENABLED="true"
      - GH_LOG_DESTINATION="stdout"

resources:
  - ../production/unicorn/
  - ./configmaps/unicorn
  - ./namespaces/namespace.yaml

patches:
  - path: ./deployments/unicorn.yaml
  - path: ./services/unicorn.yaml
  - path: ./poddisruptionbudgets/delete-pdb.yaml
