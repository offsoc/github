#!/bin/bash

set -e

if [ "$1" == "--pristine" ] || [ "$1" == "--reset" ]; then
  echo "cleaning up aqueduct-client-ruby docker images..."
  docker images -q aqueduct-client-ruby | xargs docker rmi --force
  docker images -q --filter dangling=true | xargs docker rmi;
  if [ "$1" == "--reset" ]; then
    exit
  fi
fi

echo "building docker container..."
appdir=$(cd "$(dirname "$0")"/.. && pwd)
tag=$($appdir/script/image-tag)
cd "$appdir" && docker build --rm -t aqueduct-client-ruby:${tag} .
