{"version":3,"file":"app_assets_modules_github_diffs_blob-lines_ts-app_assets_modules_github_diffs_linkable-line-n-e2d8d7-xxxxxxxxxxxx.js","mappings":"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","sources":["app/assets/modules/github/blob-anchor.ts","app/assets/modules/github/diffs/blob-lines.ts","app/assets/modules/github/diffs/helpers.ts","app/assets/modules/github/diffs/diff-range.ts","app/assets/modules/github/diffs/linkable-line-number.ts","app/assets/modules/github/diffs/prose-diff.ts","app/assets/modules/github/hydro-tracking.ts","app/assets/modules/github/range.ts","ui/packages/copilot-code-chat/diff-view/rails/diff-selection-event.ts","ui/packages/hotkey/hotkey.ts","ui/packages/onfocus/onfocus.ts","ui/packages/soft-nav/states.ts","ui/packages/subscription/subscription.ts","ui/packages/visible/visible.ts"],"sourcesContent":["export interface BlobOffset {\n  // Line number\n  // Lines start at 1.\n  line: number\n\n  // Optional column number.\n  // Like lines, columns are 1-indexed.\n  column: number | null\n}\n\nexport interface BlobRange {\n  // Starting offset of range.\n  start: BlobOffset\n\n  // End offset of range.\n  // End offset may be the same as the start. This indicates a collapsed range.\n  // Should always be initialized to a value that is equal or greater than the\n  // start range such the range is always in ascending order. Reversed ranges\n  // have undefined behavior.\n  end: BlobOffset\n}\n\n// Inverse of `formatBlobRange`.\n//\n// Examples\n//\n//   parseBlobRange(\"#L3\")\n//   // => {start: {line: 3}}\n//\n//   parseBlobRange(\"L3-L5\")\n//   // => {start: {line: 3}, end: {line: 5}}\n//\n//   parseBlobRange(\"\")\n//   // => null\nexport function parseBlobRange(str: string): BlobRange | undefined {\n  const lines = str.match(/#?(?:L)(\\d+)((?:C)(\\d+))?/g)\n  if (!lines) {\n    return\n  } else if (lines.length === 1) {\n    const offset = parseBlobOffset(lines[0])\n    if (!offset) return\n    return Object.freeze({start: offset, end: offset})\n  } else if (lines.length === 2) {\n    const startOffset = parseBlobOffset(lines[0])\n    const endOffset = parseBlobOffset(lines[1]!)\n    if (!startOffset || !endOffset) return\n\n    return ascendingBlobRange(\n      Object.freeze({\n        start: startOffset,\n        end: endOffset,\n      }),\n    )\n  } else {\n    return\n  }\n}\n\n// Inverse of `parseBlobRange`.\n//\n// Examples\n//\n//   formatBlobRange({start: {line: 3}})\n//   // => \"L3\"\n//\n//   formatBlobRange({start: {line: 3}, end: {line: 5}})\n//   // => \"L3-L5\"\n//\n//   formatBlobRange({start: {line: 3, column: 1}, end: {line: 5, column: 5}})\n//   // => \"L3C1-L5C5\"\n//\n//   formatBlobRange({start: {line: 3, column: 1}, end: {line: 5,}})\n//   // => \"L3C1-L5\"\nexport function formatBlobRange(blobRange: BlobRange): string {\n  const {start, end} = ascendingBlobRange(blobRange)\n\n  if (start.column != null && end.column != null) {\n    return `L${start.line}C${start.column}-L${end.line}C${end.column}`\n  } else if (start.column != null) {\n    return `L${start.line}C${start.column}-L${end.line}`\n  } else if (end.column != null) {\n    return `L${start.line}-L${end.line}C${end.column}`\n  } else if (start.line === end.line) {\n    return `L${start.line}`\n  } else {\n    return `L${start.line}-L${end.line}`\n  }\n}\n\n// Returns a String containing the file prefix with trailing dash.\n//\n// Examples\n//\n//   parseAnchorPrefix(\"#file-zshrc-L3\")\n//   // => \"file-zshrc-\"\n//\n//   parseAnchorPrefix(\"file-zshrc-L3-L5\")\n//   // => \"file-zshrc-\"\n//\n//   parseAnchorPrefix(\"\")\n//   // => \"\"\nfunction parseAnchorPrefix(str: string): string {\n  const match = str.length < 5000 && str.match(/(file-.+?-)L\\d+?/i)\n  return match ? match[1]! : ''\n}\n\nexport type AnchorInfo = {\n  blobRange: BlobRange\n  anchorPrefix: string\n}\n\n// Examples\n//\n//   parseFileAnchor(\"#file-zshrc-L3\")\n//   // => { blobRange: {start: {line: 3}}, anchorPrefix: \"file-zshrc-\" }\n//\n//   parseFileAnchor(\"file-zshrc-L3-L5\")\n//   // => { blobRange: {start: {line: 3}, end: {line: 5}}, anchorPrefix: \"file-zshrc-\" }\n//\n//   parseFileAnchor(\"\")\n//   // => { blobRange: null, anchorPrefix: undefined }\nexport function parseFileAnchor(str: string): AnchorInfo {\n  const blobRange = parseBlobRange(str)!\n  const anchorPrefix = parseAnchorPrefix(str)\n  return {blobRange, anchorPrefix}\n}\n\n// Formats line number range pair as an anchor String.\n//\n// Examples\n//\n//   formatBlobRangeAnchor({blobRange: {start: {line: 3}}, anchorPrefix: \"\"})\n//   // => \"#L3\"\n//\n//   formatBlobRangeAnchor({blobRange: {start: {line: 3}}, anchorPrefix: \"file-zshrc-\"})\n//   // => \"#file-zshrc-L3\"\n//\n//   formatBlobRangeAnchor({blobRange: {start: {line: 3}, end: {line: 5}}, anchorPrefix: \"\"})\n//   // => \"#L3-L5\"\n//\n//   formatBlobRangeAnchor({blobRange: {start: {line: 3, column: 1}, end: {line: 5, column: 5}}, anchorPrefix: \"\"})\n//   // => \"#L3C1-L5C5\"\n//\n//   formatBlobRangeAnchor({blobRange: {start: {line: 3}, end: {line: 5}}, anchorPrefix: \"file-zshrc-\"})\n//   // => \"#file-zshrc-L3-L5\"\n//\n//   formatBlobRangeAnchor({blobRange: null, anchorPrefix: \"\"})\n//   // => \"#\"\n//\n//   formatBlobRangeAnchor({blobRange: null, anchorPrefix: \"file-zshrc-\"})\n//   // => \"#\"\nexport function formatBlobRangeAnchor({anchorPrefix, blobRange}: AnchorInfo): string {\n  if (!blobRange) return '#'\n  return `#${anchorPrefix}${formatBlobRange(blobRange)}`\n}\n\nfunction parseBlobOffset(str: string): BlobOffset | null {\n  const lineMatch = str.match(/L(\\d+)/)\n  const columnMatch = str.match(/C(\\d+)/)\n  if (lineMatch) {\n    return Object.freeze({\n      line: parseInt(lineMatch[1]!),\n      column: columnMatch ? parseInt(columnMatch[1]!) : null,\n    })\n  } else {\n    return null\n  }\n}\n\nexport function DOMRangeFromBlob(\n  blobRange: BlobRange,\n  getLineElement: (line: number) => Node | null,\n): Range | undefined {\n  const [startContainer, _startOffset] = findRangeOffset(blobRange.start, true, getLineElement)\n  const [endContainer, _endOffset] = findRangeOffset(blobRange.end, false, getLineElement)\n  if (!startContainer || !endContainer) return\n\n  // Treat -1 as full line selection\n  let startOffset = _startOffset\n  let endOffset = _endOffset\n  if (startOffset === -1) startOffset = 0\n  if (endOffset === -1) endOffset = endContainer.childNodes.length\n  if (!startContainer.ownerDocument) throw new Error(`DOMRange needs to be inside document`)\n\n  const range = startContainer.ownerDocument.createRange()\n  range.setStart(startContainer, startOffset)\n  range.setEnd(endContainer, endOffset)\n  return range\n}\n\nfunction findRangeOffset(\n  offset: BlobOffset,\n  lookAhead: boolean,\n  getLineElement: (n: number) => Node | null,\n): [Node | null, number] {\n  const error: [null, number] = [null, 0]\n\n  const lineElement = getLineElement(offset.line)\n  if (!lineElement) return error\n\n  if (offset.column == null) {\n    return [lineElement, -1]\n  }\n\n  let column = offset.column - 1\n\n  const textNodes = getAllTextNodes(lineElement)\n  for (let i = 0; i < textNodes.length; i++) {\n    const textNode = textNodes[i]!\n\n    // TODO: length might be buggy with emoji\n    const nextC = column - (textNode.textContent || '').length\n\n    if (nextC === 0) {\n      const nextTextNode = textNodes[i + 1]\n      if (lookAhead && nextTextNode) {\n        return [nextTextNode, 0]\n      } else {\n        return [textNode, column]\n      }\n    } else if (nextC < 0) {\n      return [textNode, column]\n    }\n\n    column = nextC\n  }\n\n  return error\n}\n\n// Get a flat list of text nodes in depth first order.\nfunction getAllTextNodes(el: Node): Node[] {\n  if (el.nodeType === Node.TEXT_NODE) {\n    return [el]\n  }\n  if (!el.childNodes || !el.childNodes.length) return []\n  let list: Node[] = []\n  for (const node of el.childNodes) {\n    list = list.concat(getAllTextNodes(node))\n  }\n  return list\n}\n\n// Sorts range start and end offsets to be in ascending order.\nfunction ascendingBlobRange(range: BlobRange): BlobRange {\n  const offsets = [range.start, range.end]\n  offsets.sort(compareBlobOffsets)\n\n  if (offsets[0] === range.start && offsets[1] === range.end) {\n    return range\n  } else {\n    return Object.freeze({\n      start: offsets[0]!,\n      end: offsets[1]!,\n    })\n  }\n}\n\n// Compare line offsets. May be used with Array.sort\nfunction compareBlobOffsets(a: BlobOffset, b: BlobOffset): number {\n  if (a.line === b.line && a.column === b.column) {\n    return 0\n  } else if (a.line === b.line && typeof a.column === 'number' && typeof b.column === 'number') {\n    return a.column - b.column\n  } else {\n    return a.line - b.line\n  }\n}\n","import {DOMRangeFromBlob, formatBlobRangeAnchor, parseBlobRange, parseFileAnchor} from '../blob-anchor'\nimport type {AnchorInfo} from '../blob-anchor'\nimport type {ClipboardCopyElement} from '@github/clipboard-copy-element'\nimport {TemplateInstance} from '@github/template-parts'\nimport hashChange from '../behaviors/hash-change'\n// eslint-disable-next-line no-restricted-imports\nimport {observe} from '@github/selector-observer'\n// eslint-disable-next-line no-restricted-imports\nimport {on} from 'delegated-events'\nimport {sendEvent} from '@github-ui/hydro-analytics'\nimport {surroundContents} from '../range'\nimport type {DeferredDiffLinesElement} from '../../../../components/diffs/deferred-diff-lines-element'\n\nlet skipNextScrollTo = false\n\nfunction queryLineElement(anchorPrefix: string, line: number) {\n  return document.querySelector(`#${anchorPrefix}LC${line}`)\n}\n\n// Highlight a line or range of lines.\nfunction highlightLines({blobRange, anchorPrefix}: AnchorInfo): void {\n  const lineElements = document.querySelectorAll('.js-file-line')\n\n  if (lineElements.length === 0) return\n  clearHighlights()\n\n  if (!blobRange) return\n\n  if (blobRange.start.column === null || blobRange.end.column === null) {\n    for (let i = blobRange.start.line; i <= blobRange.end.line; i += 1) {\n      const line = queryLineElement(anchorPrefix, i)\n      if (line) line.classList.add('highlighted')\n    }\n  } else if (\n    blobRange.start.line === blobRange.end.line &&\n    blobRange.start.column != null &&\n    blobRange.end.column != null\n  ) {\n    const range = DOMRangeFromBlob(blobRange, line => queryLineElement(anchorPrefix, line))\n\n    if (range) {\n      const span = document.createElement('span')\n      span.classList.add('highlighted')\n      surroundContents(range, span)\n    }\n  } else {\n    // TODO column highlights across multiple lines\n  }\n}\n\n// Clear all highlighted lines and ranges.\nfunction clearHighlights() {\n  for (const el of document.querySelectorAll('.js-file-line.highlighted')) {\n    el.classList.remove('highlighted')\n  }\n\n  for (const el of document.querySelectorAll('.js-file-line .highlighted')) {\n    const lineEl = el.closest<HTMLElement>('.js-file-line')!\n    el.replaceWith(...el.childNodes)\n    lineEl.normalize()\n  }\n}\n\n// Highlight and scroll to the lines in the current location hash.\nfunction scrollLinesIntoView(): void {\n  const anchorInfo = parseFileAnchor(window.location.hash)\n\n  highlightLines(anchorInfo)\n  showOrHideLineActions()\n\n  const {blobRange, anchorPrefix} = anchorInfo\n\n  const line = blobRange && queryLineElement(anchorPrefix, blobRange.start.line)\n\n  if (!skipNextScrollTo && line) {\n    line.scrollIntoView()\n    const container = line.closest<HTMLElement>('.blob-wrapper, .js-blob-wrapper')!\n    container.scrollLeft = 0\n  }\n\n  skipNextScrollTo = false\n}\n\n// Update highlighted lines when the page loads and\n// anytime the hash changes.\nhashChange(function () {\n  if (document.querySelector('.js-file-line-container')) {\n    setTimeout(scrollLinesIntoView, 0)\n    const hash = window.location.hash\n    for (const element of document.querySelectorAll('.js-update-url-with-hash')) {\n      if (element instanceof HTMLAnchorElement) {\n        element.hash = hash\n      } else if (element instanceof HTMLFormElement) {\n        const newAction = new URL(element.action, window.location.origin)\n        newAction.hash = hash\n        element.action = newAction.toString()\n      }\n    }\n  }\n})\n\nfunction setCopyLines(lines: NodeListOf<HTMLElement>): void {\n  const lineTextArray: string[] = []\n  for (const line of lines) {\n    lineTextArray.push(line.textContent!)\n  }\n  const button = document.getElementById('js-copy-lines') as ClipboardCopyElement | null\n\n  if (button && button.tagName === 'CLIPBOARD-COPY') {\n    // eslint-disable-next-line i18n-text/no-en\n    button.textContent = `Copy ${lines.length === 1 ? 'line' : 'lines'}`\n    button.value = lineTextArray.join('\\n')\n    const gaText = `Blob, copyLines, numLines:${lines.length.toString()}`\n    button.setAttribute('data-ga-click', gaText)\n  }\n}\n\nfunction setPermalink(numLines: number): string | undefined {\n  const permalinkContainer = document.querySelector('.js-permalink-shortcut')\n  if (permalinkContainer instanceof HTMLAnchorElement) {\n    const url = `${permalinkContainer.href}${window.location.hash}`\n    const button = document.getElementById('js-copy-permalink') as ClipboardCopyElement | null\n\n    if (button && button.tagName === 'CLIPBOARD-COPY') {\n      button.value = url\n      const gaText = `Blob, copyPermalink, numLines:${numLines.toString()}`\n      button.setAttribute('data-ga-click', gaText)\n    }\n    return url\n  }\n}\n\nfunction setOpenIssueLink(permalink: string, numLines: number) {\n  const newIssueLink = document.getElementById('js-new-issue')\n  if (newIssueLink instanceof HTMLAnchorElement) {\n    if (!newIssueLink.href) return\n    const newIssueUrl = new URL(newIssueLink.href, window.location.origin)\n    const params = new URLSearchParams(newIssueUrl.search)\n    params.set('permalink', permalink)\n    newIssueUrl.search = params.toString()\n    newIssueLink.href = newIssueUrl.toString()\n    newIssueLink.setAttribute('data-ga-click', `Blob, newIssue, numLines:${numLines.toString()}`)\n  }\n}\n\nfunction setOpenDiscussionLink(permalink: string, numLines: number) {\n  const newDiscussionLink = document.getElementById('js-new-discussion')\n  if (!(newDiscussionLink instanceof HTMLAnchorElement) || !newDiscussionLink?.href) return\n  const newDiscussionUrl = new URL(newDiscussionLink.href, window.location.origin)\n  const params = new URLSearchParams(newDiscussionUrl.search)\n  params.set('permalink', permalink)\n  newDiscussionUrl.search = params.toString()\n  newDiscussionLink.href = newDiscussionUrl.toString()\n  newDiscussionLink.setAttribute('data-ga-click', `Blob, newDiscussion, numLines:${numLines.toString()}`)\n}\n\nfunction setViewGitBlame(numLines: number): void {\n  const button = document.getElementById('js-view-git-blame')\n  if (!button) return\n  button.setAttribute('data-ga-click', `Blob, viewGitBlame, numLines:${numLines.toString()}`)\n}\n\nfunction showOrHideLineActions(): void {\n  const actions = document.querySelector<HTMLElement>('.js-file-line-actions')\n  if (!actions) return\n\n  const lines = document.querySelectorAll<HTMLElement>('.js-file-line.highlighted')\n  const firstSelected = lines[0]\n\n  if (firstSelected) {\n    setCopyLines(lines)\n    setViewGitBlame(lines.length)\n    const permalink = setPermalink(lines.length)\n    if (permalink) setOpenIssueLink(permalink, lines.length)\n    if (permalink) setOpenDiscussionLink(permalink, lines.length)\n\n    actions.style.top = `${firstSelected.offsetTop - 2}px`\n    /* eslint-disable-next-line github/no-d-none */\n    actions.classList.remove('d-none')\n  } else {\n    /* eslint-disable-next-line github/no-d-none */\n    actions.classList.add('d-none')\n  }\n}\n\n// Prevent scroll position from changing after setting location.hash.\n//\n// callback - Function to preserve scroll position after.\nfunction preserveLineNumberScrollPosition(callback: () => void): void {\n  const scrollTop = window.scrollY\n  skipNextScrollTo = true\n  callback()\n  window.scrollTo(0, scrollTop)\n}\n\n// Clicking line numbers highlights the line\non('click', '.js-line-number', function (event) {\n  const anchorInfo = parseFileAnchor(event.currentTarget.id)\n\n  const {blobRange} = anchorInfo\n\n  const currentLines = parseBlobRange(window.location.hash)\n\n  if (currentLines && event.shiftKey) {\n    anchorInfo.blobRange = {\n      start: currentLines.start,\n      end: blobRange.end,\n    }\n  }\n\n  preserveLineNumberScrollPosition(() => {\n    window.location.hash = formatBlobRangeAnchor(anchorInfo)\n  })\n})\n\nobserve('.js-check-bidi', alertOnBidiCharacter)\n\n// There are 9 unicode codepoints in two contiguous blocks that act as\n// bidi (bidirectional) control characters which can obscure malicious code:\n// +-----------+----------------------------------+\n// | codepoint | Control character name           |\n// +-----------+----------------------------------+\n// |  \\u202A   | LEFT-TO-RIGHT EMBEDDING (LRE)    |\n// |  \\u202B   | RIGHT-TO-LEFT EMBEDDING (RLE)    |\n// |  \\u202C   | POP DIRECTIONAL FORMATTING (PDF) |\n// |  \\u202D   | LEFT-TO-RIGHT OVERRIDE (LRO)     |\n// |  \\u202E   | RIGHT-TO-LEFT OVERRIDE (RLO)     |\n// |        [ ... ].                              |\n// |  \\u2066   | LEFT-TO-RIGHT ISOLATE (LRI)      |\n// |  \\u2067   | RIGHT-TO-LEFT ISOLATE (RLI)      |\n// |  \\u2068   | FIRST STRONG ISOLATE (FSI)       |\n// |  \\u2069   | POP DIRECTIONAL ISOLATE (PDI)    |\n// +-----------+----------------------------------+\nconst bidiRegex = /[\\u202A-\\u202E]|[\\u2066-\\u2069]/\nconst bidiReplacementMap: {[char: string]: string} = {\n  '\\u202A': 'U+202A', // LEFT-TO-RIGHT EMBEDDING\n  '\\u202B': 'U+202B', // RIGHT-TO-LEFT EMBEDDING\n  '\\u202C': 'U+202C', // POP DIRECTIONAL FORMATTING\n  '\\u202D': 'U+202D', // LEFT-TO-RIGHT OVERRIDE\n  '\\u202E': 'U+202E', // RIGHT-TO-LEFT OVERRIDE\n  '\\u2066': 'U+2066', // LEFT-TO-RIGHT ISOLATE\n  '\\u2067': 'U+2067', // RIGHT-TO-LEFT ISOLATE\n  '\\u2068': 'U+2068', // FIRST STRONG ISOLATE\n  '\\u2069': 'U+2069', // POP DIRECTIONAL ISOLATE\n}\n\n// Function to recursively search elements for child text nodes,\n// find bidi characters and optionally replace them with their unicode\n// character codes. If we are not replacing characters, we will return\n// early when we find the first bidi character.\n//\n// _revealedCharacterTemplate - Template to use when replacing characters, if null we will skip characer replacement\n//\n// Returns true if a bidi character is found, false if no bidi character was found\nfunction checkNodeForBidiCharacters(el: Node, _revealedCharacterTemplate: HTMLTemplateElement | null): boolean {\n  if (el.nodeType === Node.TEXT_NODE) return checkTextNodeForBidiCharacters(el, _revealedCharacterTemplate)\n  if (!el.childNodes || !el.childNodes.length) return false\n\n  let foundBidiCharacter = false\n  for (const node of el.childNodes) {\n    foundBidiCharacter ||= checkNodeForBidiCharacters(node, _revealedCharacterTemplate)\n    // If we found a bidi character and we are not replacing characters stop searching\n    if (foundBidiCharacter && !_revealedCharacterTemplate) break\n  }\n  return foundBidiCharacter\n}\n\nfunction checkTextNodeForBidiCharacters(el: Node, _revealedCharacterTemplate: HTMLTemplateElement | null): boolean {\n  // search for bidi characters and optionally replace\n  let foundBidiCharacter = false\n  if (el.nodeValue) {\n    for (let i = el.nodeValue.length - 1; i >= 0; i--) {\n      const char = el.nodeValue.charAt(i)\n      if (bidiReplacementMap[char]) {\n        foundBidiCharacter = true\n        // If we are not replacing characters, we can break early to avoid searching the entire node\n        if (!_revealedCharacterTemplate) break\n        const revealedCharacterInstance = new TemplateInstance(_revealedCharacterTemplate, {\n          revealedCharacter: bidiReplacementMap[char],\n        })\n        // Delete the hidden character and replace it with the revealed character\n        const r = new Range()\n        r.setStart(el, i)\n        r.setEnd(el, i + 1)\n        r.deleteContents()\n        r.insertNode(revealedCharacterInstance)\n      }\n    }\n  }\n  return foundBidiCharacter\n}\n\n// Search for bidi Unicode characters, which can obscure malicious code,\n// within blob/diff elements, and display an alert if they are present.\n// This is run after the content is displayed, so it won't impact the page TTI.\n// The container should provide 2 templates: .js-file-alert-template and .js-line-alert-template.\nexport function alertOnBidiCharacter(container: Element) {\n  let result = false\n  const start = performance.now()\n  const blobText = container.textContent || ''\n\n  // Quick check for bidi characters, it may return false positive if the occurrence\n  // is on a comment or other random content inside the blob container.\n  if (bidiRegex.test(blobText)) {\n    // .js-file-line covers blob and csv rendering,\n    // .blob-code-inner covers diff rendering, more specific with .diff-table to avoid being checked twice in blob.\n    const contentElements = container.querySelectorAll<HTMLElement>(\n      '.diff-table .blob-code-inner, .js-file-line-container .js-file-line, .js-suggested-changes-blob .blob-code-inner',\n    )\n\n    const lineAlertTemplate = document.querySelector<HTMLTemplateElement>('.js-line-alert-template')\n    const revealedCharTemplate = document.querySelector<HTMLTemplateElement>('.js-revealed-character-template')\n\n    // This is not an array, so we use a loop to check elements\n    for (const element of contentElements) {\n      if (checkNodeForBidiCharacters(element, revealedCharTemplate)) {\n        result = true\n\n        if (lineAlertTemplate) {\n          const lineAlertElement = new TemplateInstance(lineAlertTemplate, {})\n\n          // By default, alerts are included after the offending element,\n          // then we use CSS to display it properly. This is so to not break table layouts.\n          // But for CSV we need to render before, otherwise the alert jumps to the next line,\n          // so to avoid an even uglier CSS placement, we use .before() for it.\n          if (container.getAttribute('data-line-alert') === 'before') {\n            element.before(lineAlertElement)\n          } else {\n            element.after(lineAlertElement)\n          }\n        }\n      }\n    }\n  }\n\n  const duration = performance.now() - start\n  const context = {durationMs: duration.toString(), result: result.toString()}\n\n  sendEvent('blob_js_check_bidi_character', context)\n\n  if (result) {\n    // Searching the template in the whole document, to prevent duplicating it on each container (each file/comment in a PR)\n    const fileAlertTemplate = document.querySelector<HTMLTemplateElement>('.js-file-alert-template')\n    if (fileAlertTemplate) {\n      // Create a URL to reload the current page with the opposing hidden character parameter\n      const revealButtonUrl = new URL(window.location.href, window.location.origin)\n      revealButtonUrl.searchParams.get('h') === '1'\n        ? revealButtonUrl.searchParams.delete('h')\n        : revealButtonUrl.searchParams.set('h', '1')\n\n      const fileAlertElement = new TemplateInstance(fileAlertTemplate, {revealButtonHref: revealButtonUrl.href})\n      container.prepend(fileAlertElement)\n    }\n  }\n\n  // Remove the attribute to avoid checking again and duplicating the alert on pjax navigation\n  container.classList.remove('js-check-bidi')\n}\n\nclass CodeListingLine {\n  lineElement: Element\n  numberElement: Element\n\n  constructor(lineElement: Element, numberElement: Element) {\n    this.lineElement = lineElement\n    this.numberElement = numberElement\n  }\n\n  // Find a DOM Range for a given character range in a blob line.\n  range(startOffset: number, endOffset: number): Range | null {\n    startOffset = isNaN(startOffset) ? 0 : startOffset\n    endOffset = isNaN(endOffset) ? 0 : endOffset\n\n    let startNode: ChildNode | null = null\n    let startNodeIndex = 0\n    let endNodeIndex = 0\n    for (const [nodeIndex, textNode] of this.lineElement.childNodes.entries()) {\n      const length = (textNode.textContent || '').length\n      if (length > startOffset && !startNode) {\n        startNode = textNode\n        startNodeIndex = nodeIndex\n      }\n      if (length >= endOffset) {\n        endNodeIndex = nodeIndex\n        break\n      }\n\n      startOffset -= length\n      endOffset -= length\n    }\n\n    const range = document.createRange()\n    if (startNodeIndex === endNodeIndex) {\n      // The entire range is contained in a single element,\n      // so we want a character range within that element's text node.\n\n      while (startNode && startNode.nodeName !== '#text') {\n        startNode = startNode.childNodes[0]!\n      }\n\n      if (!startNode) {\n        return null\n      }\n\n      range.setStart(startNode, startOffset)\n      range.setEnd(startNode, endOffset)\n    } else {\n      // The range spans multiple elements,\n      // so we want an element range covering all of them.\n\n      range.setStart(this.lineElement, startNodeIndex)\n      range.setEnd(this.lineElement, endNodeIndex + 1)\n    }\n\n    return range\n  }\n}\n\nclass CodeListing {\n  container: Element\n\n  constructor(container: Element) {\n    this.container = container\n  }\n\n  findLine(lineNum: number | string | null): CodeListingLine | null {\n    if (!lineNum) {\n      return null\n    }\n\n    // Find the coresponding line number element. For diffs this will\n    // always be the right side line number.\n    const lineNumElement = this.container.querySelector<HTMLElement>(`.js-blob-rnum[data-line-number='${lineNum}']`)\n    if (!lineNumElement) {\n      return null\n    }\n\n    // Find the code wrapper immediatly after the line number. For diffs\n    // this ensures we're always annotating the right-hand side.\n    let lineElement = lineNumElement.nextElementSibling\n    if (!lineElement || !lineElement.classList.contains('js-file-line')) {\n      return null\n    }\n\n    // For PR diffs, some interaction markup may exist within the line element\n    // (e.g. comment button). This skips over those if they exist.\n    lineElement = lineElement.querySelector<HTMLElement>('.js-code-nav-pass') || lineElement\n\n    return new CodeListingLine(lineElement, lineNumElement)\n  }\n}\n\nconst annotatedErrors: WeakMap<HTMLElement, boolean> = new WeakMap()\nfunction annotateCodeownersErrors(errorsContainer: Element | null | undefined) {\n  if (!errorsContainer) {\n    return\n  }\n\n  const fileContainer = errorsContainer.closest('.js-blob-code-container, .js-file-content')\n  const tooltipTemplate = errorsContainer.querySelector<HTMLTemplateElement>('.js-codeowners-error-tooltip-template')\n  const lineAlertTemplate = errorsContainer.querySelector<HTMLTemplateElement>(\n    '.js-codeowners-error-line-alert-template',\n  )\n  if (!fileContainer || !tooltipTemplate || !lineAlertTemplate) {\n    return\n  }\n\n  const deferredHighlight = fileContainer.querySelector<DeferredDiffLinesElement>('deferred-diff-lines')\n  if (deferredHighlight?.isAwaitingHighlight()) {\n    return\n  }\n\n  const errors = errorsContainer.querySelectorAll<HTMLElement>('.js-codeowners-error')\n  const listing = new CodeListing(fileContainer)\n\n  for (const error of errors) {\n    if (annotatedErrors.get(error)) {\n      continue\n    }\n\n    const lineNum = error.getAttribute('data-line')\n    const kind = error.getAttribute('data-kind')\n    const suggestion = error.getAttribute('data-suggestion')\n    const startOffset = parseInt(error.getAttribute('data-start-offset') || '', 10)\n    const endOffset = parseInt(error.getAttribute('data-end-offset') || '', 10)\n\n    const line = listing.findLine(lineNum)\n    const range = line?.range(startOffset, endOffset)\n\n    if (!line || !range) {\n      continue\n    }\n\n    let message = kind\n    if (suggestion) {\n      message += `: ${suggestion}`\n    }\n\n    // Our highlight and tooltip styles both use the `::after`\n    // pseudo element, so we have to apply them to different elements.\n    const highlight = document.createElement('SPAN')\n    highlight.className = 'error-highlight'\n    range.surroundContents(highlight)\n\n    const tooltip = new TemplateInstance(tooltipTemplate, {message}).firstElementChild\n    range.surroundContents(tooltip!)\n\n    const lineAlertElement = new TemplateInstance(lineAlertTemplate, {})\n    line.numberElement.appendChild(lineAlertElement)\n\n    annotatedErrors.set(error, true)\n  }\n}\nobserve('.js-codeowners-errors', annotateCodeownersErrors)\non('expander:expanded', '.js-file', function (event: Event) {\n  if (!event.target || !(event.target instanceof HTMLElement)) {\n    return\n  }\n\n  const errorsContainer = event.target.querySelector<HTMLElement>('.js-codeowners-errors')\n  annotateCodeownersErrors(errorsContainer)\n})\n\non('deferred-highlight:applied', 'deferred-diff-lines', function (event: Event) {\n  if (!event.target || !(event.target instanceof HTMLElement)) {\n    return\n  }\n\n  const fileContainer = event.target.closest<HTMLElement>('.js-file')\n  const errorsContainer = fileContainer?.querySelector<HTMLElement>('.js-codeowners-errors')\n  annotateCodeownersErrors(errorsContainer)\n})\n","// Detect if location Hash matches a diff anchor with line numbers.\n// Use this to check whether a location should be routed to a diff expander element.\nexport function matchHash(hash: string): RegExpMatchArray | null {\n  const diffAnchorMatch = hash.match(/^#?(diff-[a-f0-9]+)(L|R)(\\d+)(?:-(L|R)(\\d+))?$/i)\n  if (diffAnchorMatch != null && diffAnchorMatch.length === 6) {\n    return diffAnchorMatch\n  }\n\n  const discussionAnchorMatch = hash.match(/^#?(discussion-diff-[0-9]+)(L|R)(\\d+)(?:-(L|R)(\\d+))?$/i)\n  if (discussionAnchorMatch != null && discussionAnchorMatch.length === 6) {\n    return discussionAnchorMatch\n  }\n\n  return null\n}\n","import {findElementByFragmentName} from '../fragment-target'\n\nclass DiffPosition {\n  diffId: string\n  side: string\n  lineNumber: number\n  element: Element | null\n\n  constructor(diffId: string, side: string, lineNumber: number) {\n    this.diffId = diffId\n    this.side = side\n    this.lineNumber = lineNumber\n\n    this.element = findElementByFragmentName(document, this.anchor())\n  }\n\n  sideForCommenting(): string {\n    if (this.element && this.element.classList.contains('blob-num-context')) {\n      return 'right'\n    }\n\n    // @ts-expect-error string can't index R or L, we can probably tighten this up everywhere\n    return {R: 'right', L: 'left'}[this.side]\n  }\n\n  isContext(): boolean {\n    if (!this.element) {\n      return false\n    }\n\n    return this.element.classList.contains('blob-num-context')\n  }\n\n  // The URL anchor for this diff position on the page.\n  anchor(): string {\n    return `${this.diffId}${this.anchorSuffix()}`\n  }\n\n  // The URL anchor anchor for this diff position on the page.\n  //\n  // E.g. - 'L42'\n  anchorSuffix(): string {\n    return `${this.side}${this.lineNumber}`\n  }\n\n  // Tests whether or not this position is equivalent with another.\n  is(otherPosition: DiffPosition): boolean {\n    return (\n      this.diffId === otherPosition.diffId &&\n      this.side === otherPosition.side &&\n      this.lineNumber === otherPosition.lineNumber\n    )\n  }\n}\n\nexport class DiffRange {\n  elements: Set<Element>\n  isParsed: boolean\n  isSplit: boolean\n  diffId: string\n  diffTable: HTMLElement | null\n  start: DiffPosition\n  end: DiffPosition\n  lineCount: number\n  _rows: Set<HTMLElement>\n  _isAcrossHunks: boolean\n  _isContextOnly: boolean\n  _includesExpandedLine: boolean\n  _commentOutsideTheDiff: boolean\n\n  constructor(diffId: string, startSide: string, startLineNumber: number, endSide: string, endLineNumber: number) {\n    this.elements = new Set()\n    this.isParsed = false\n    this.isSplit = false\n    this._rows = new Set()\n    this._isAcrossHunks = false\n    this._isContextOnly = true\n    this._includesExpandedLine = false\n    this._commentOutsideTheDiff = false\n\n    this.diffId = diffId\n    this.diffTable = document.querySelector(`.js-diff-table[data-diff-anchor=\"${diffId}\"]`)\n    if (this.diffTable) this.isSplit = this.diffTable.classList.contains('js-file-diff-split')\n\n    this.start = new DiffPosition(diffId, startSide, startLineNumber)\n    this.end = new DiffPosition(diffId, endSide, endLineNumber)\n    this.lineCount = 0\n\n    this.parse()\n  }\n\n  // Generates an URL anchor which identifies this range.\n  //\n  // E.g. 'diff-2b939de295abbeb764a2b0de8fe0e690L5-R7'\n  anchor(): string {\n    const parts = []\n    parts.push(this.start.anchor())\n\n    if (!this.start.is(this.end)) {\n      parts.push(this.end.anchorSuffix())\n    }\n\n    return parts.join('-')\n  }\n\n  // Internal: Finds all elements in the specified range.\n  parse() {\n    if (!this.diffTable) return\n\n    let lineNumbers = this.unify(this.diffTable.querySelectorAll('.js-linkable-line-number'))\n    lineNumbers = this.filterInRange(lineNumbers)\n\n    this.lineCount = lineNumbers.length\n    this.elements = this.expandRelatedElements(lineNumbers)\n    this._commentOutsideTheDiff = this.diffTable.classList.contains('js-comment-outside-the-diff')\n    this.isParsed = true\n  }\n\n  // Internal: Orders line number elements in the order they would appear in a unified diff.\n  unify(lineNumbers: NodeListOf<Element>): Element[] {\n    if (!this.isSplit) return Array.from(lineNumbers)\n\n    const unified = []\n    let additions = []\n    let deletions = []\n\n    for (const lineNumber of lineNumbers) {\n      if (lineNumber.classList.contains('blob-num-addition')) {\n        additions.push(lineNumber)\n      } else if (lineNumber.classList.contains('blob-num-deletion')) {\n        deletions.push(lineNumber)\n      } else {\n        unified.push(...deletions, ...additions, lineNumber)\n        additions = []\n        deletions = []\n      }\n    }\n\n    unified.push(...deletions, ...additions)\n\n    return unified\n  }\n\n  // Internal: Takes all line number elements in this diff and filters it down to\n  // only the ones included in the range.\n  filterInRange(lineNumbers: Element[]): Element[] {\n    if (!this.start.element || !this.end.element) return []\n\n    let startIndex = lineNumbers.indexOf(this.start.element)\n    let endIndex = lineNumbers.indexOf(this.end.element)\n\n    if (startIndex > endIndex) {\n      // start and end are out of order\n      ;[startIndex, endIndex] = [endIndex, startIndex]\n\n      // 2-step reassignement since flow doesn't support this inline.\n      const [newStart, newEnd] = [this.end, this.start]\n      this.start = newStart\n      this.end = newEnd\n    }\n\n    return lineNumbers.slice(startIndex, endIndex + 1)\n  }\n\n  isContextOnly(): boolean {\n    if (!this.isParsed) {\n      this.parse()\n    }\n\n    return this._isContextOnly\n  }\n\n  isAcrossHunks(): boolean {\n    if (!this.isParsed) {\n      this.parse()\n    }\n\n    return this._isAcrossHunks\n  }\n\n  includesExpandedLine(): boolean {\n    if (!this.isParsed) {\n      this.parse()\n    }\n\n    return this._includesExpandedLine\n  }\n\n  commentOutsideTheDiffEnabled(): boolean {\n    if (!this.isParsed) {\n      this.parse()\n    }\n\n    return this._commentOutsideTheDiff\n  }\n\n  rows(): Set<HTMLElement> {\n    if (!this.isParsed) {\n      this.parse()\n    }\n\n    return this._rows\n  }\n\n  // Internal: Takes line number elements in the range and expands them to include other\n  // elements that should be highlighted whenever the line number element is.\n  //\n  // Behavior differs between split diffs and unified.\n  expandRelatedElements(lineNumbers: Element[]): Set<Element> {\n    const splitDiff = this.isSplit\n\n    const firstElement = lineNumbers[0]\n    const lastElement = lineNumbers[lineNumbers.length - 1]\n\n    if (firstElement && lastElement) {\n      const firstElementTR = firstElement.closest('[data-hunk]')\n      const lastElementTR = lastElement.closest('[data-hunk]')\n\n      if (firstElementTR && lastElementTR) {\n        const firstElementHunk = firstElementTR.getAttribute('data-hunk')\n        const lastElementHunk = lastElementTR.getAttribute('data-hunk')\n\n        if (firstElementHunk !== lastElementHunk) {\n          this._isAcrossHunks = true\n        }\n      }\n    }\n\n    const expander = (expandedSet: Set<Element>, lineNumber: Element): Set<Element> => {\n      if (!this._includesExpandedLine && lineNumber.closest('.blob-expanded')) {\n        this._includesExpandedLine = true\n      }\n\n      const row = lineNumber.parentElement\n      if (row instanceof HTMLElement) {\n        this._rows.add(row)\n      }\n      const additionOrDeletion =\n        lineNumber.classList.contains('blob-num-deletion') || lineNumber.classList.contains('blob-num-addition')\n\n      if (additionOrDeletion) {\n        this._isContextOnly = false\n      }\n\n      if (!row) return expandedSet\n\n      if (splitDiff && additionOrDeletion) {\n        // Addition or deletion in a split diff. Only return elements from that side of the diff.\n        const index = Array.from(row.children).indexOf(lineNumber)\n        if (index < 2) {\n          // Diff left side\n          return expandedSet.add(row.children[0]!).add(row.children[1]!)\n        } else {\n          return expandedSet.add(row.children[2]!).add(row.children[3]!)\n        }\n      } else {\n        for (const el of Array.from(row.children)) {\n          expandedSet.add(el)\n        }\n        return expandedSet\n      }\n    }\n\n    return lineNumbers.reduce(expander, new Set())\n  }\n}\n","// Diff Line Number\n// Click line number on td::before element line numbers to jump to the anchor.\n//\n// Avoids using a native <a> for performance reasons. Theres a large number of\n// css selectors that target `a` on the right most side. If we can reduce the\n// number of these, selector matching performance on thousands of blob and diff\n// lines shouldn't be so bad.\n\nimport {DiffRange} from './diff-range'\nimport hashChange from '../behaviors/hash-change'\nimport {matchHash} from './helpers'\n// eslint-disable-next-line no-restricted-imports\nimport {observe} from '@github/selector-observer'\n// eslint-disable-next-line no-restricted-imports\nimport {on} from 'delegated-events'\nimport {trackView} from '../hydro-tracking'\nimport {DiffSelectionEvent} from '@github-ui/copilot-code-chat/diff-selection-event'\n\n// Highlight diff range\nlet currentRange: DiffRange | null = null\nlet showMultiLineCommentForm: (() => void) | null = null\nlet isDraggingForComment = false\nlet waitingForDragFrom: Element | null = null\n\nexport function getCurrentRange(): DiffRange | null {\n  return currentRange\n}\n\nfunction isMultiLineCommentingEnabled(target: Element): boolean {\n  return !!target.closest('.js-multi-line-comments-enabled')\n}\n\nexport function isMultiLineCommentAllowed(target: Element, expandedRange: DiffRange): boolean {\n  if (!isMultiLineCommentingEnabled(target)) {\n    return false\n  }\n\n  const {\n    start: {lineNumber: startLineNumber},\n    end: {lineNumber: endLineNumber},\n  } = expandedRange\n\n  // It's not multi-line if it's just one line\n  if (startLineNumber === endLineNumber && expandedRange.isContextOnly()) {\n    return false\n  }\n\n  if (!expandedRange.commentOutsideTheDiffEnabled()) {\n    if (expandedRange.isAcrossHunks()) {\n      return false\n    }\n\n    if (expandedRange.includesExpandedLine()) {\n      return false\n    }\n  }\n\n  return true\n}\n\nfunction isSelecting(element: Element): boolean {\n  return element.closest<HTMLElement>('.js-diff-table')!.classList.contains('is-selecting')\n}\n\nexport function clearSelection(): void {\n  window.history.replaceState(null, '', `#`)\n  showHighlight()\n  DiffSelectionEvent.dispatch()\n}\n\nfunction setSelection(target: Element, canExpand: boolean) {\n  let targetLineAnchor = target.id\n\n  if (canExpand) {\n    const parsedAnchor = matchHash(targetLineAnchor)\n    if (!parsedAnchor) return\n\n    const diffId = parsedAnchor[1]!\n    const endSide = parsedAnchor[2]!\n    const endLine = parsedAnchor[3]!\n\n    if (currentRange && currentRange.diffId === diffId) {\n      // Don't let people drag upwards because it causes some weirdness. Could fix this later,\n      // but we're just disabling for the initial ship\n      if (endSide === currentRange.start.side && Number.parseInt(endLine) < currentRange.start.lineNumber) {\n        return\n      }\n\n      const expandedRange = new DiffRange(\n        diffId,\n        currentRange.start.side,\n        currentRange.start.lineNumber,\n        endSide,\n        +endLine,\n      )\n      targetLineAnchor = expandedRange.anchor()\n\n      const trackingElement = target.closest('.js-file-content[data-hydro-view]')\n\n      if (trackingElement instanceof HTMLElement) {\n        sendHydroEvent(trackingElement, expandedRange)\n      }\n\n      if (isDraggingForComment && isSelecting(target)) {\n        const table = target.closest<HTMLElement>('.js-diff-table')!\n        table.classList.toggle('is-commenting', isMultiLineCommentAllowed(target, expandedRange))\n      }\n\n      showMultiLineCommentForm = function () {\n        if (isMultiLineCommentAllowed(target, expandedRange)) {\n          const sideValue = expandedRange.end.sideForCommenting()\n          const buttonSelector = `.js-add-line-comment[data-side=\"${sideValue}\"]`\n          const button = target.closest<HTMLElement>('tr')!.querySelector<HTMLElement>(buttonSelector)\n\n          if (button && expandedRange) {\n            button.click()\n          }\n        }\n      }\n    }\n  }\n\n  window.history.replaceState(null, '', `#${targetLineAnchor}`)\n  showHighlight()\n\n  if (currentRange) DiffSelectionEvent.dispatch()\n}\n\nfunction nearestLinkableLineNumber(element: Element): Element | null {\n  if (!(element instanceof HTMLElement)) {\n    return null\n  }\n\n  if (element.classList.contains('js-linkable-line-number')) {\n    return element\n  }\n\n  const previousElementSibling = element.previousElementSibling\n\n  if (previousElementSibling) {\n    return nearestLinkableLineNumber(previousElementSibling)\n  }\n\n  return null\n}\n\nfunction handleClick(e: MouseEvent) {\n  if (!currentRange) {\n    return\n  }\n\n  if ((e.target as Element).closest('.js-diff-table')) {\n    return\n  }\n\n  clearSelection()\n}\n\nfunction beginDrag() {\n  if (!waitingForDragFrom) {\n    return\n  }\n\n  setSelection(waitingForDragFrom, false)\n  const table = waitingForDragFrom.closest<HTMLElement>('.js-diff-table')!\n  waitingForDragFrom = null\n\n  table.classList.add('is-selecting')\n  table.classList.add('is-commenting')\n\n  document.addEventListener(\n    'mouseup',\n    function (e: MouseEvent) {\n      table.classList.remove('is-selecting')\n      table.classList.remove('is-selecting', 'is-commenting')\n      showMultiLineCommentForm && showMultiLineCommentForm()\n      showMultiLineCommentForm = null\n      removeCommentSelectionEvents(table)\n      e.preventDefault()\n    },\n    {once: true},\n  )\n}\n\nfunction commentSelectionMouseverToCode(codeElement: Element) {\n  const target = nearestLinkableLineNumber(codeElement)\n\n  if (!target || !isSelecting(target)) {\n    return\n  }\n\n  setSelection(target, true)\n}\n\nfunction commentSelectionMouseverToLineNumbers(lineNumberElement: Element) {\n  if (!isSelecting(lineNumberElement)) {\n    return\n  }\n\n  setSelection(lineNumberElement, true)\n}\n\nfunction handleDragMouseEvent(event: MouseEvent) {\n  const target = event.target\n  if (!(target instanceof Element)) {\n    return\n  }\n\n  if (waitingForDragFrom) {\n    beginDrag()\n  }\n\n  const cell = target.closest('.blob-code, .js-linkable-line-number')\n  if (!cell) {\n    return\n  }\n\n  if (cell.classList.contains('blob-code')) {\n    return commentSelectionMouseverToCode(cell)\n  }\n\n  if (cell.classList.contains('js-linkable-line-number')) {\n    commentSelectionMouseverToLineNumbers(cell)\n  }\n}\n\nfunction addCommentSelectionEvents(container: HTMLElement) {\n  container.addEventListener('mouseenter', handleDragMouseEvent, {capture: true})\n}\n\nfunction removeCommentSelectionEvents(container: HTMLElement) {\n  isDraggingForComment = false\n  container.removeEventListener('mouseenter', handleDragMouseEvent, {capture: true})\n  setTimeout(() => {\n    document.addEventListener('click', handleClick, {once: true})\n  }, 0)\n}\n\non('mousedown', '.js-add-line-comment', function (event) {\n  if (!(event instanceof MouseEvent)) {\n    return\n  }\n\n  // Don't do anything for right click\n  if (event.button !== 0) {\n    return\n  }\n\n  const parent = (event.target as Element).parentElement\n\n  if (!parent) {\n    return\n  }\n\n  if (!isMultiLineCommentingEnabled(event.target as Element)) {\n    return\n  }\n\n  const lineNumber = nearestLinkableLineNumber(parent)\n\n  if (!lineNumber) {\n    return\n  }\n\n  const table = (event.target as Element).closest<HTMLElement>('.js-diff-table')!\n\n  addCommentSelectionEvents(table)\n  waitingForDragFrom = lineNumber\n  isDraggingForComment = true\n\n  // If the user is just clicking to leave a single line comment, cancel\n  // the drag behaviors\n  event.target!.addEventListener(\n    'mouseup',\n    function () {\n      removeCommentSelectionEvents(table)\n      waitingForDragFrom = null\n      isDraggingForComment = false\n    },\n    {once: true},\n  )\n\n  if (currentRange && currentRange.lineCount > 1) {\n    event.preventDefault()\n  }\n})\n\non('mousedown', '.js-linkable-line-number', function (event) {\n  if (!(event instanceof MouseEvent)) {\n    return\n  }\n\n  // Don't do anything for right click\n  if (event.button !== 0) {\n    return\n  }\n\n  const target = event.target\n\n  if (!(target instanceof Element)) {\n    return\n  }\n  const table = target.closest<HTMLElement>('.js-diff-table')!\n  table.classList.add('is-selecting')\n  addCommentSelectionEvents(table)\n\n  document.addEventListener(\n    'mouseup',\n    function () {\n      target.closest<HTMLElement>('.js-diff-table')!.classList.remove('is-selecting')\n      removeCommentSelectionEvents(table)\n    },\n    {once: true},\n  )\n\n  setSelection(target, event instanceof MouseEvent && event.shiftKey)\n\n  event.preventDefault()\n})\n\nfunction drawBorderForSplit() {\n  if (!currentRange) {\n    return\n  }\n\n  for (const el of currentRange.elements) {\n    el.classList.add('selected-line')\n  }\n\n  const leftLineNumbers = []\n  const leftLineCodes = []\n  const rightLineNumbers = []\n  const rightLineCodes = []\n\n  for (const el of currentRange.rows()) {\n    const [leftNumber, leftCode, rightNumber, rightCode] = el.children\n    leftLineNumbers.push(leftNumber!)\n    leftLineCodes.push(leftCode!)\n    rightLineNumbers.push(rightNumber!)\n    rightLineCodes.push(rightCode!)\n  }\n\n  function doBorder(array: Element[]) {\n    for (const [i, el] of array.entries()) {\n      if (el.classList.contains('empty-cell')) {\n        continue\n      }\n\n      const prevElement = array[i - 1]\n      if (!prevElement || !prevElement.classList.contains('selected-line')) {\n        el.classList.add('selected-line-top')\n      }\n\n      const nextElement = array[i + 1]\n      if (!nextElement || !nextElement.classList.contains('selected-line')) {\n        el.classList.add('selected-line-bottom')\n      }\n    }\n  }\n\n  doBorder(leftLineNumbers)\n  doBorder(leftLineCodes)\n  doBorder(rightLineNumbers)\n  doBorder(rightLineCodes)\n\n  for (const [i, el] of leftLineCodes.entries()) {\n    if (!rightLineCodes[i]!.classList.contains('selected-line')) {\n      el.classList.add('selected-line-right')\n    }\n  }\n\n  for (const [i, el] of rightLineNumbers.entries()) {\n    if (!leftLineCodes[i]!.classList.contains('selected-line')) {\n      el.classList.add('selected-line-left')\n    }\n  }\n}\n\nfunction drawBorderForUnified() {\n  if (!currentRange) {\n    return\n  }\n\n  for (const el of currentRange.elements) {\n    el.classList.add('selected-line')\n  }\n\n  const trs = Array.from(currentRange.rows())\n  const firstTR = trs[0]!\n  for (const el of firstTR.children) {\n    el.classList.add('selected-line-top')\n  }\n\n  const lastTR = trs[trs.length - 1]!\n  for (const el of lastTR.children) {\n    el.classList.add('selected-line-bottom')\n  }\n}\n\nfunction showHighlight() {\n  if (currentRange) {\n    for (const el of currentRange.elements) {\n      el.classList.remove(\n        'selected-line',\n        'selected-line-top',\n        'selected-line-bottom',\n        'selected-line-left',\n        'selected-line-right',\n      )\n    }\n    currentRange = null\n  }\n\n  const parsedAnchor = matchHash(window.location.hash)\n  if (!parsedAnchor) return\n\n  const diffId = parsedAnchor[1]!\n  const startSide = parsedAnchor[2]!\n  const startLine = parsedAnchor[3]!\n  const endSide = parsedAnchor[4] || startSide\n  const endLine = parsedAnchor[5] || startLine\n\n  currentRange = new DiffRange(diffId, startSide, +startLine, endSide, +endLine)\n\n  const rangeLines = Array.from(currentRange.elements)\n  const firstCell = rangeLines[0]\n\n  if (!firstCell) {\n    return\n  }\n\n  if (firstCell.closest<HTMLElement>('.js-diff-table')!.classList.contains('file-diff-split')) {\n    drawBorderForSplit()\n  } else {\n    drawBorderForUnified()\n  }\n}\n\nfunction sendHydroEvent(trackingElement: HTMLElement, diffRange: DiffRange) {\n  const hydroContextAttributes = {\n    starting_diff_position: diffRange.start.side + diffRange.start.lineNumber,\n    ending_diff_position: diffRange.end.side + diffRange.end.lineNumber,\n    line_count: diffRange.lineCount,\n  }\n  trackingElement.setAttribute('data-hydro-client-context', JSON.stringify(hydroContextAttributes))\n  trackView(trackingElement)\n}\n\nhashChange(showHighlight)\n\n// Try to highlight again if we expanded the diff and load more lines\nobserve('.blob-expanded', showHighlight)\n\n// Try to highlight again if we progressively loaded more parts of the diff\nobserve('.js-diff-progressive-loader', function (loader) {\n  loader.addEventListener('load', showHighlight)\n})\nobserve('.js-diff-entry-loader', function (loader) {\n  loader.addEventListener('load', showHighlight)\n})\n","// eslint-disable-next-line no-restricted-imports\nimport {on} from 'delegated-events'\n\non('click', '.js-rich-diff.collapsed .js-expandable', function (event) {\n  if (!(event.target instanceof Element)) return\n  event.preventDefault()\n  const container = event.target.closest('.js-rich-diff')!\n  container.classList.remove('collapsed')\n})\n\non('click', '.js-show-rich-diff', function (event) {\n  const warn = event.currentTarget.closest('.js-warn-no-visible-changes')\n  if (!warn) return\n\n  /* eslint-disable-next-line github/no-d-none */\n  warn.classList.add('d-none')\n\n  const container = warn.parentElement!\n\n  const message = container.querySelector('.js-no-rich-changes')\n  if (message) {\n    /* eslint-disable-next-line github/no-d-none */\n    message.classList.remove('d-none')\n  }\n})\n","import {sendStats} from '@github-ui/stats'\n\nexport function sendData(hydroEventPayload: string, hydroEventHmac: string, hydroClientContext: string): void {\n  const data = {\n    hydroEventPayload,\n    hydroEventHmac,\n    visitorPayload: '',\n    visitorHmac: '',\n    hydroClientContext,\n  }\n\n  const visitorPayload = document.querySelector('meta[name=visitor-payload]')\n  if (visitorPayload instanceof HTMLMetaElement) {\n    data['visitorPayload'] = visitorPayload.content\n  }\n  const visitorHmac = document.querySelector('meta[name=visitor-hmac]') || ''\n  if (visitorHmac instanceof HTMLMetaElement) {\n    data['visitorHmac'] = visitorHmac.content\n  }\n\n  sendStats(data, true)\n}\n\nexport function trackView(el: HTMLElement) {\n  const payload = el.getAttribute('data-hydro-view') || ''\n  const hmac = el.getAttribute('data-hydro-view-hmac') || ''\n  const hydroClientContext = el.getAttribute('data-hydro-client-context') || ''\n  sendData(payload, hmac, hydroClientContext)\n}\n\nexport function sendHydroEvent(el: HTMLElement) {\n  const payload = el.getAttribute('data-hydro-click-payload') || ''\n  const hmac = el.getAttribute('data-hydro-click-hmac') || ''\n  const hydroClientContext = el.getAttribute('data-hydro-client-context') || ''\n  sendData(payload, hmac, hydroClientContext)\n}\n","// More robust version of Range.surroundContents().\nexport function surroundContents(range: Range, newNode: Node) {\n  newNode.appendChild(range.extractContents())\n  range.insertNode(newNode)\n}\n","export class DiffSelectionEvent extends Event {\n  static readonly NAME = 'diff-line-selection'\n\n  constructor() {\n    super(DiffSelectionEvent.NAME, {\n      bubbles: false,\n      cancelable: true,\n    })\n  }\n\n  static dispatch() {\n    window.dispatchEvent(new DiffSelectionEvent())\n  }\n}\n\ndeclare global {\n  interface WindowEventMap {\n    'diff-line-selection': DiffSelectionEvent\n  }\n}\n","// this file is a shim to allow importing @github/hotkey and is the only allowed import for @github/hotkey\n// eslint-disable-next-line no-restricted-imports\nexport * from '@github/hotkey'\n\n// - (?:^|,)    Starting with the beginning of the string or the comma delineating the previous item\n// - ((?:[^,]|,(?=\\+| |$))*(?:,(?=,))?)    The target capture group, consisting of:\n//   - (?:[^,]|,(?=\\+| |$))*    Any number of characters that are not commas, or are commas that are followed by a\n//     plus sign, space, or end of string (ie, the commas in `,+Control` or `Control+, g` or `Control+,`)\n//   - (?:,(?=,))?    Optionally ending with a comma followed by another comma, like the commas in `Control+,,n` or\n//     `Control+,,,`\n// - (?=,|$)    Ending with a comma or the end of the string\nconst chordOrKeyRegex = /(?:^|,)((?:[^,]|,(?=\\+| |$))*(?:,(?=,))?)/g\n\nexport function splitHotkeyString(hotkey: string) {\n  // \",\" is a valid key name, so we can't just use `String.split()`. Even with a regular expression we can't split, for\n  // example \"Control+,,,\" into [\"Control+,\", \",\"] without a lookbehind (not supported in Safari).\n\n  // Instead, we match against all valid substrings:\n  return Array.from(hotkey.matchAll(chordOrKeyRegex)).map(([, chord]) => chord!)\n}\n","// React to elements receiving focus\n//\n// Often we need to apply some behavior to form elements when they start getting\n// interacted with. We could use `observe`, but that can be expensive if there\n// are many such elements on the page, and when we aren't actually interested in\n// those elements until they receive focus.\n//\n// This is a lightweight and preferred alternative to the family of methods\n// from `github/focused` module.\n//\n// Examples\n//\n//   onFocus('.js-widget', element => {\n//     // ...\n//   })\n\nimport SelectorSet from 'selector-set'\n\nlet initialized = false\nconst selectorSet: SelectorSet<(el: HTMLElement) => void> = new SelectorSet()\n\nfunction handleFocus(event: FocusEvent) {\n  const focused = event.target\n  if (focused instanceof HTMLElement && focused.nodeType !== Node.DOCUMENT_NODE) {\n    for (const match of selectorSet.matches(focused)) {\n      match.data.call(null, focused)\n    }\n  }\n}\n\nexport function onFocus(selector: string, fn: (el: HTMLElement) => unknown) {\n  if (!initialized) {\n    initialized = true\n    // We use the \"focus\" event in the capture phase because Firefox\n    // historically had a limitation with \"focusin\" not bubbling.\n    document.addEventListener('focus', handleFocus, true)\n  }\n  selectorSet.add(selector, fn)\n\n  if (document.activeElement instanceof HTMLElement && document.activeElement.matches(selector)) {\n    fn(document.activeElement)\n  }\n}\n\nexport function onKey(\n  eventType: 'keydown' | 'keypress' | 'keyup',\n  selector: string,\n  inputHandler: (event: KeyboardEvent) => unknown,\n) {\n  function blurHandler(event: Event) {\n    const currentTarget = event.currentTarget as HTMLElement\n    if (!currentTarget) return\n    currentTarget.removeEventListener(eventType, inputHandler)\n    currentTarget.removeEventListener('blur', blurHandler)\n  }\n\n  onFocus(selector, function (field) {\n    field.addEventListener(eventType, inputHandler)\n    field.addEventListener('blur', blurHandler)\n  })\n}\n\nexport function onInput(selector: string, inputHandler: EventListener) {\n  function blurHandler(event: Event) {\n    const {currentTarget} = event\n    if (!currentTarget) return\n\n    currentTarget.removeEventListener('input', inputHandler)\n    currentTarget.removeEventListener('blur', blurHandler)\n  }\n\n  onFocus(selector, function (field) {\n    field.addEventListener('input', inputHandler)\n    field.addEventListener('blur', blurHandler)\n  })\n}\n","export const SOFT_NAV_STATE = Object.freeze({\n  INITIAL: 'soft-nav:initial',\n  START: 'soft-nav:start',\n  SUCCESS: 'soft-nav:success',\n  ERROR: 'soft-nav:error',\n  FRAME_UPDATE: 'soft-nav:frame-update',\n  END: 'soft-nav:end',\n  RENDER: 'soft-nav:render',\n  PROGRESS_BAR: {\n    START: 'soft-nav:progress-bar:start',\n    END: 'soft-nav:progress-bar:end',\n  },\n})\n","// TODO: Research replacing this module with a composable observable library.\n// The scope of this module simply returns a finalized subscription object.\n\n// Lightweight TC39 observable Subscription.\nexport class Subscription {\n  constructor(cleanup: () => void) {\n    this.closed = false\n    this.unsubscribe = () => {\n      cleanup()\n      this.closed = true\n    }\n  }\n\n  // A boolean value indicating whether the subscription is closed.\n  closed: boolean\n  // Cancels the subscription.\n  unsubscribe: () => void\n}\n\n// Create a Subscription from an event.\nexport function fromEvent(\n  target: EventTarget,\n  eventName: string,\n  onNext: EventListenerOrEventListenerObject,\n  options: AddEventListenerOptions = {capture: false},\n): Subscription {\n  target.addEventListener(eventName, onNext, options)\n  return new Subscription(() => {\n    target.removeEventListener(eventName, onNext, options)\n  })\n}\n\n// Combine several subscriptions into a single subscription.\n//\n// subscriptions - A list of subscriptions to combine.\n//\n// Returns a single, combined, subscription.\nexport function compose(...subscriptions: Subscription[]): Subscription {\n  return new Subscription(() => {\n    for (const subscription of subscriptions) {\n      subscription.unsubscribe()\n    }\n  })\n}\n","// Due to the way `visible` is implemented, it causes the browser to\n// perform a full page reflow, it lays out all elements again, when called. This\n// is one of the most time consuming operations the browser can perform, so it\n// affects perceived page load times.\n//\n// The preferred way to determine element visibility is check for the presence\n// of the `hidden` attribute: `if (el.hidden) ...` and `el.hidden = false`.\n//\n// More info: https://github.com/github/eslint-plugin-github/blob/master/docs/rules/no-d-none.md.\n//\n// We would ideally like to remove the `visible` function and consistently\n// use the `hidden` attribute.\n//\n// Returns true if the element is hidden.\nfunction hidden(element: HTMLElement): boolean {\n  return element.offsetWidth <= 0 && element.offsetHeight <= 0\n}\n\nexport default function visible(element: HTMLElement): boolean {\n  return !hidden(element)\n}\n"],"names":["parseBlobRange","str","lines","match","length","offset","parseBlobOffset","Object","freeze","start","end","startOffset","endOffset","ascendingBlobRange","formatBlobRange","blobRange","column","line","parseFileAnchor","anchorPrefix","parseAnchorPrefix","formatBlobRangeAnchor","lineMatch","columnMatch","parseInt","DOMRangeFromBlob","getLineElement","startContainer","_startOffset","findRangeOffset","endContainer","_endOffset","childNodes","ownerDocument","range","createRange","setStart","setEnd","lookAhead","error","lineElement","textNodes","getAllTextNodes","el","nodeType","Node","TEXT_NODE","list","node","concat","i","textNode","nextC","textContent","nextTextNode","offsets","sort","compareBlobOffsets","a","b","skipNextScrollTo","queryLineElement","document","querySelector","scrollLinesIntoView","anchorInfo","window","location","hash","highlightLines","lineElements","querySelectorAll","clearHighlights","classList","remove","lineEl","closest","replaceWith","normalize","add","span","createElement","surroundContents","showOrHideLineActions","actions","firstSelected","setCopyLines","lineTextArray","push","button","getElementById","tagName","value","join","gaText","toString","setAttribute","setViewGitBlame","numLines","permalink","setPermalink","permalinkContainer","HTMLAnchorElement","url","href","setOpenIssueLink","newIssueLink","newIssueUrl","URL","origin","params","URLSearchParams","search","set","setOpenDiscussionLink","newDiscussionLink","newDiscussionUrl","style","top","offsetTop","scrollIntoView","container","scrollLeft","hashChange","setTimeout","element","HTMLFormElement","newAction","action","on","event","currentTarget","id","currentLines","shiftKey","preserveLineNumberScrollPosition","callback","scrollTop","scrollY","scrollTo","observe","result","performance","now","bidiRegex","test","contentElements","lineAlertTemplate","revealedCharTemplate","checkNodeForBidiCharacters","_revealedCharacterTemplate","checkTextNodeForBidiCharacters","foundBidiCharacter","nodeValue","char","charAt","bidiReplacementMap","revealedCharacterInstance","TemplateInstance","revealedCharacter","r","Range","deleteContents","insertNode","lineAlertElement","getAttribute","before","after","context","durationMs","duration","sendEvent","fileAlertTemplate","revealButtonUrl","searchParams","get","delete","fileAlertElement","revealButtonHref","prepend","CodeListingLine","isNaN","startNode","startNodeIndex","endNodeIndex","nodeIndex","entries","nodeName","constructor","numberElement","CodeListing","findLine","lineNum","lineNumElement","nextElementSibling","contains","annotatedErrors","WeakMap","annotateCodeownersErrors","errorsContainer","fileContainer","tooltipTemplate","deferredHighlight","isAwaitingHighlight","errors","listing","kind","suggestion","message","highlight","className","tooltip","firstElementChild","appendChild","target","HTMLElement","matchHash","diffAnchorMatch","discussionAnchorMatch","DiffPosition","sideForCommenting","R","L","side","isContext","anchor","diffId","anchorSuffix","lineNumber","is","otherPosition","findElementByFragmentName","DiffRange","parts","parse","diffTable","lineNumbers","unify","filterInRange","lineCount","elements","expandRelatedElements","_commentOutsideTheDiff","isParsed","isSplit","Array","from","unified","additions","deletions","startIndex","indexOf","endIndex","newStart","newEnd","slice","isContextOnly","_isContextOnly","isAcrossHunks","_isAcrossHunks","includesExpandedLine","_includesExpandedLine","commentOutsideTheDiffEnabled","rows","_rows","splitDiff","firstElement","lastElement","firstElementTR","lastElementTR","firstElementHunk","reduce","expandedSet","row","parentElement","additionOrDeletion","children","Set","startSide","startLineNumber","endSide","endLineNumber","currentRange","showMultiLineCommentForm","isDraggingForComment","waitingForDragFrom","getCurrentRange","isMultiLineCommentingEnabled","isMultiLineCommentAllowed","expandedRange","isSelecting","clearSelection","history","replaceState","showHighlight","DiffSelectionEvent","dispatch","setSelection","canExpand","targetLineAnchor","parsedAnchor","endLine","Number","trackingElement","sendHydroEvent","diffRange","hydroContextAttributes","starting_diff_position","ending_diff_position","line_count","JSON","stringify","trackView","table","toggle","sideValue","buttonSelector","click","nearestLinkableLineNumber","previousElementSibling","handleClick","e","handleDragMouseEvent","Element","beginDrag","addEventListener","removeCommentSelectionEvents","preventDefault","once","cell","commentSelectionMouseverToCode","codeElement","addCommentSelectionEvents","capture","removeEventListener","startLine","firstCell","rangeLines","drawBorderForSplit","leftLineNumbers","leftLineCodes","rightLineNumbers","rightLineCodes","leftNumber","leftCode","rightNumber","rightCode","doBorder","array","prevElement","nextElement","drawBorderForUnified","trs","firstTR","lastTR","MouseEvent","parent","loader","warn","sendData","hydroEventPayload","hydroEventHmac","hydroClientContext","data","visitorPayload","visitorHmac","HTMLMetaElement","content","sendStats","newNode","extractContents","Event","dispatchEvent","NAME","bubbles","cancelable","chordOrKeyRegex","splitHotkeyString","hotkey","matchAll","map","chord","initialized","selectorSet","SelectorSet","handleFocus","focused","DOCUMENT_NODE","matches","call","onFocus","selector","fn","activeElement","onKey","eventType","inputHandler","blurHandler","field","onInput","SOFT_NAV_STATE","INITIAL","START","SUCCESS","ERROR","FRAME_UPDATE","END","RENDER","PROGRESS_BAR","Subscription","cleanup","closed","unsubscribe","fromEvent","eventName","onNext","options","compose","subscriptions","subscription","visible","offsetWidth","offsetHeight"],"sourceRoot":""}