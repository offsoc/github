"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["ui_packages_billing-app_components_usage_UsageChart_tsx"],{41737:(e,t,a)=>{a.r(t),a.d(t,{UsageChart:()=>D,default:()=>F});var r=a(74848),s=a(75177),n=a(73729),i=a(37976),o=a(39995),l=a(83308),d=a(42415),c=a(19526),u=a(99525),g=a(96540),p=a(605),h=a(92032),A=a(61148);let m=function({filters:e,useUsageChartDataEndpoint:t}){let[a,r]=(0,g.useState)([]),[s,n]=(0,g.useState)(d.X_.INIT);return(0,p.Ay)({route:h.wG,reqParams:{customer_id:e.customer.id,group:(()=>{let t=e.group?.type??A.Jt,a=e.period?.type===d.FA.THIS_HOUR;return(e.searchQuery.startsWith("org:")||e.searchQuery.startsWith("repo:"))&&t===A.IN&&!a?A.hL:t})().toString(),period:(e.period?.type??d.FA.DEFAULT).toString(),product:e.product?.toString()??"",query:e.searchQuery},noop:!t,onStart:()=>{r([]),n(d.X_.LOADING)},onSuccess:e=>{r(e.data.usage),n(d.X_.IDLE)},onError:()=>{n(d.X_.ERROR)}}),{usageChartData:a,requestState:s}},x={...c.jk,width:"100%",height:"100%",p:0,mb:3},y={display:"flex",alignItems:"center",justifyContent:"space-between",pl:3,pr:3,pt:3},T={height:"432px",border:0},S=e=>e?{color:"fg.muted",fontSize:"14px",fontWeight:"normal"}:{color:"fg.muted",fontSize:"16px",fontWeight:"bold"};function b(e){let t="Metered usage",a="";switch(e.group?.type){case d.Jw.ORG:a="Organization";break;case d.Jw.REPO:a="Repository";break;case d.Jw.SKU:a="SKU";break;case d.Jw.PRODUCT:a="Product"}if(e.searchQuery&&e.searchQuery.includes(":")){let a="";for(let t of e.searchQuery.match(/(?:[^\s"]+|"[^"]*")+/g)||[]){let[e,r]=t.split(":");e&&r&&(["repo","org"].includes(e)?a+=`${r} `:["product","sku"].includes(e)?a+=`${(0,i.A)(r)} `:["cost_center"].includes(e)&&(r.startsWith('"')&&r.endsWith('"')?a+=`${r.split("").slice(1,-1).join("")} `:a+=`${r} `))}a&&(t=`${a} usage`)}return a&&(t+=` grouped by ${a}`),t}function f(e){switch(e.period?.type){case d.FA.THIS_YEAR:return new Date().toLocaleDateString("en-US",{timeZone:"UTC",year:"numeric"});case d.FA.THIS_MONTH:{let e=new Date,t=e.toLocaleDateString("en-US",{timeZone:"UTC",month:"short"}),a=new Date(e.getFullYear(),e.getMonth(),1).getDate(),r=new Date(e.getFullYear(),e.getMonth()+1,0).getDate();return`${t} ${a} - ${t} ${r}, ${e.getFullYear()}`}case d.FA.TODAY:{let e=new Date().toLocaleDateString("en-US",{timeZone:"UTC",month:"long",day:"numeric",year:"numeric"});return`${e} (All times in UTC)`}case d.FA.THIS_HOUR:{let e=new Date().toLocaleDateString("en-US",{timeZone:"UTC",month:"long",day:"numeric",year:"numeric",hour:"numeric"});return`${e} UTC`}case d.FA.LAST_MONTH:{let e=new Date;e.setMonth(e.getMonth()-1);let t=e.toLocaleDateString("en-US",{timeZone:"UTC",month:"short"}),a=new Date(e.getFullYear(),e.getMonth(),1).getDate(),r=new Date(e.getFullYear(),e.getMonth()+1,0).getDate();return`${t} ${a} - ${t} ${r}, ${e.getFullYear()}`}case d.FA.LAST_YEAR:{let e=new Date().toLocaleDateString("en-US",{timeZone:"UTC",year:"numeric"});return`${Number(e)-1} (All times in UTC)`}default:return""}}function D({filters:e,requestState:t,usage:a,otherUsage:i,children:c,showTitle:g=!0,useUsageChartDataEndpoint:p}){let{usageChartData:h,requestState:A}=m({filters:e,useUsageChartDataEndpoint:p}),D=p?A:t,F=(0,u.Y1)({usage:a,otherUsage:i,filters:e}),_=p?h:F.data.datasets,O=p?_.length:a.length,H=D===d.X_.IDLE&&O>0,w=h[0]?.data[0]?.x??new Date,U=p?w:F.data.startDate;return(0,r.jsxs)("div",{"data-hpc":!0,children:[(0,r.jsx)(s.A,{sx:{pb:2,display:["block","none"],maxWidth:"100%"},children:c}),(0,r.jsxs)(s.A,{sx:H?{}:x,children:[!H&&(0,r.jsxs)(s.A,{sx:y,children:[(0,r.jsxs)("div",{children:[g&&(0,r.jsx)(n.A,{as:"h3",sx:{fontSize:2},id:"usage-chart-title","data-testid":"usage-chart-title",children:b(e)}),(0,r.jsx)(n.A,{as:g?"h4":"h3",sx:S(g),id:"usage-chart-subtitle","data-testid":"usage-chart-subtitle",className:g?"":"h4",children:f(e)})]}),(0,r.jsx)(s.A,{sx:{pr:2,display:["none","block"]},children:c})]}),(0,r.jsxs)(s.A,{sx:{mb:3},children:[[d.X_.INIT,d.X_.LOADING].includes(D)&&(0,r.jsx)(l.qH,{sx:T,testid:"usage-loading-spinner"}),D===d.X_.ERROR&&(0,r.jsx)(l.Ax,{sx:T,testid:"usage-loading-error",text:"Something went wrong"}),D===d.X_.IDLE&&(0,r.jsxs)(r.Fragment,{children:[0===O&&(0,r.jsx)(l.Fk,{sx:T,testid:"no-usage-data",text:"No usage found"}),O>0&&(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(o.d,{size:"xl",border:!0,children:[(0,r.jsx)(o.d.Title,{sx:g?{}:S(g),children:g?b(e):f(e)}),g&&(0,r.jsx)(o.d.Description,{children:f(e)}),(0,r.jsx)(o.d.TrailingVisual,{children:(0,r.jsx)(s.A,{sx:{pr:2,display:["none","block"]},children:c})}),(0,r.jsx)(o.d.Chart,{series:_.map(e=>({...e,type:"areaspline"})),xAxisTitle:"Time",yAxisTitle:"Billing",xAxisOptions:{type:"datetime",labels:{format:function(e){switch(e.period?.type){case d.FA.THIS_YEAR:case d.FA.LAST_YEAR:return"{value:%b}";case d.FA.THIS_MONTH:case d.FA.LAST_MONTH:return"{value:%b %e}";case d.FA.TODAY:return"{value:%l%p}";case d.FA.THIS_HOUR:return"{value:%l:%M%p}";default:return"{value:%b %e}"}}(e)},title:{text:null},gridLineDashStyle:"Solid"},yAxisOptions:{labels:{format:"${value:,.0f}"},gridLineDashStyle:"Solid",title:{text:null}},plotOptions:{series:{pointStart:U,pointInterval:function(e){switch(e.period?.type){case d.FA.THIS_YEAR:case d.FA.LAST_YEAR:return 2592e6;case d.FA.THIS_MONTH:case d.FA.LAST_MONTH:return 864e5;case d.FA.TODAY:return 36e5;case d.FA.THIS_HOUR:return 6e4;default:return 864e5}}(e),marker:{enabled:!1}}},type:"areaspline",overrideOptionsNotRecommended:{legend:{enabled:!0,margin:16,align:"left",layout:"horizontal",verticalAlign:"top",floating:!1,maxHeight:64},tooltip:{dateTimeLabelFormats:{millisecond:function(e){switch(e.period?.type){case d.FA.THIS_YEAR:case d.FA.LAST_YEAR:return"in %b %Y";case d.FA.THIS_MONTH:case d.FA.LAST_MONTH:return"on %b %e, %Y";case d.FA.TODAY:return"at %l%p";case d.FA.THIS_HOUR:return"at %l:%M%p";default:return"%b %e, %Y"}}(e)},headerFormat:'<table><tr><th colspan="2">{series.name} {point.key}</th></tr>',pointFormat:p?'<tr><td style="padding-top:var(--base-size-4)"><span style="color:{point.color}">\u25CF</span> Gross:</td><td style="text-align: right; padding-top:var(--base-size-4);"><strong>{point.custom.grossAmount:,.2f}</strong></td></tr><tr><td style="padding-top:var(--base-size-4); padding-left:16px"> Billed:</td><td style="text-align: right; padding-top:var(--base-size-4);"><strong>{point.custom.totalAmount:,.2f}</strong></td></tr><tr><td style="padding-top:var(--base-size-4); padding-left:16px"> Discount:</td><td style="text-align: right; padding-top:var(--base-size-4);"><strong>{point.custom.discountAmount:,.2f}</strong></td></tr><table>':'<tr><td style="padding-top:var(--base-size-4)"><span style="color:{point.color}">\u25CF</span> Gross:</td><td style="text-align: right; padding-top:var(--base-size-4);"><strong>{point.custom.formattedGrossAmount:,.2f}</strong></td></tr><tr><td style="padding-top:var(--base-size-4); padding-left:16px"> Billed:</td><td style="text-align: right; padding-top:var(--base-size-4);"><strong>{point.custom.formattedTotalAmount:,.2f}</strong></td></tr><tr><td style="padding-top:var(--base-size-4); padding-left:16px"> Discount:</td><td style="text-align: right; padding-top:var(--base-size-4);"><strong>{point.custom.formattedDiscountAmount:,.2f}</strong></td></tr><table>'},accessibility:{keyboardNavigation:{order:["legend","series"]}}}})]})})]})]})]})]})}let F=D;try{D.displayName||(D.displayName="UsageChart")}catch{}}}]);
//# sourceMappingURL=ui_packages_billing-app_components_usage_UsageChart_tsx-d20193dc232f.js.map