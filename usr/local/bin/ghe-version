#!/bin/bash
#/ Usage: ghe-version [-hv]
#/
#/ Print GitHub Enterprise version, platform and build information.
#/
#/ OPTIONS:
#/   -h | --help       Show this message.
#/   -v | --version    Only print the version number.
#/
set -e

. /etc/github/enterprise-release

usage() {
  grep '^#/' < "$0" | cut -c 4-
}

ARGS=$(getopt --name "${0}" --long help,version --options hv -- "$@") || {
  usage
  exit 2
}
eval set -- "$ARGS"

while [ $# -gt 0 ]; do
  case "$1" in
    -h|--help)
      usage
      exit 2
      ;;
    -v|--version)
      echo "${RELEASE_VERSION}"
      exit 0
      ;;
    *)
      # Prior to the conversion to getopt, this script would ignore
      # positional arguments. This case statement preserves that behavior.
      shift;
      break
      ;;
  esac
done

echo "GitHub Enterprise Server $RELEASE_VERSION $RELEASE_PLATFORM $(echo $RELEASE_BUILD_DATE | cut -dT -f1) $RELEASE_BUILD_ID"
