"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["ui_packages_repos-branches_components_RenameBranchDialog_tsx"],{34117:(e,t,n)=>{n.d(t,{A:()=>i});var s=n(38267),a=n(44999);let i=s.Ay.details.withConfig({displayName:"Details",componentId:"sc-1jjccgx-0"})(["& > summary{list-style:none;}& > summary::-webkit-details-marker{display:none;}",";"],a.A);i.displayName="Details"},72010:(e,t,n)=>{n.d(t,{A:()=>a});var s=n(96540);function a({ref:e,closeOnOutsideClick:t,defaultOpen:n,onClickOutside:a}){let[i,l]=(0,s.useState)(n),r=(0,s.useRef)(null),o=null!=e?e:r,c=(0,s.useCallback)(e=>{let{current:t}=o;e.target.closest("details")===t||(a&&a(e),e.defaultPrevented||l(!1))},[o,l,a]);(0,s.useEffect)(()=>{if(i&&t)return document.addEventListener("click",c),()=>{document.removeEventListener("click",c)}},[i,t,c]);let d=e=>{e.defaultPrevented||l(e.target.open)};return{open:i,setOpen:l,getDetailsProps:()=>({onToggle:d,open:i,ref:o})}}},32426:(e,t,n)=>{n.r(t),n.d(t,{RenameBranchDialog:()=>R,default:()=>L});var s=n(74848),a=n(86079),i=n(83056),l=n(72010),r=n(75177),o=n(65481),c=n(66889),d=n(94153),u=n(44981),h=n(69909),x=n(30729),m=n(34117),p=n(86519),g=n(38553),f=n(96540),j=n(47767),b=n(27788),y=n(59857),v=n(38510),A=n(70170),C=n(28784),w=n(54156),k=n(92979);function R({repo:e,branch:t,onDismiss:n}){let g=function({repo:e,branchName:t}){let[n,s]=(0,f.useState)(void 0);return(0,f.useEffect)(()=>{let n=(0,i.cT)({owner:e.ownerLogin,repo:e.name,branchName:t}),a={prRetargetCount:0,prRetargetRepoCount:0,prClosureCount:0,draftReleaseCount:0,protectedBranchCount:0,willPagesChange:!1};(async function(){s(void 0);try{let e=await (0,C.lS)(n,{method:"GET"});if(e.ok){let t=await e.json();t?s(t):s(a)}else s(a)}catch{s(a)}})()},[t,e.ownerLogin,e.name]),n}({repo:e,branchName:t.name}),[v,R]=(0,f.useState)(!1),[L,W]=(0,f.useState)(!1),[D,P]=(0,f.useState)(!1),[T,E]=(0,f.useState)(!1),[B,$]=(0,f.useState)(null),[z,O]=(0,f.useState)(t.name),[U,_]=(0,f.useState)(t.name),{getDetailsProps:H,open:G}=(0,l.A)({closeOnOutsideClick:!1}),{getDetailsProps:F,open:M}=(0,l.A)({closeOnOutsideClick:!1}),V=(0,b.Z)(),{pathname:X}=(0,j.zy)(),{addToast:Y}=(0,w.Y6)(),[q,Z]=function({repo:e,currentRefName:t}){let[n,s]=(0,f.useState)({status:null});async function a(n){try{let a=await (0,C.lS)((0,i.A3)({owner:e.ownerLogin,repo:e.name,refName:t}),{method:"POST",body:{value:n}}),{message:l,normalized_name:r}=await a.json();a.ok?s({status:"valid",message:l,normalizedName:r}):s({status:"invalid",message:l})}catch(e){s({status:"invalid"})}}let l=(0,f.useCallback)((0,A.s)(a,300),[]);return[n,(0,f.useCallback)(e=>{e?(s({status:null}),l(e)):s({status:"unknown"})},[l])]}({repo:e,currentRefName:t.name}),J=`
  git branch -m ${t.name} ${U}
  git fetch origin
  git branch -u origin/${U} ${U}
  git remote set-head origin -a
  `;function K(){O(""),$(null),P(!1),E(!1),n()}async function Q(){if(!D&&!L){W(!0);let n=await (0,C.lS)((0,i.p7)({owner:e.ownerLogin,repo:e.name,refName:t.name}),{method:"put",body:{new_name:z}}),s=await n.json();if(n.ok)K(),Y({type:"success",message:s.message}),V(X);else{let e=s.error;e&&$(e)}W(!1)}}return(0,f.useEffect)(()=>{T&&Z(z)},[T,z]),(0,f.useEffect)(()=>{if(T){if(D){_(t.name);return}q.message&&q.normalizedName&&_(q.normalizedName)}},[D,t.name,q.message,q.normalizedName,T]),(0,f.useEffect)(()=>{if(g){let{prRetargetCount:e,prClosureCount:t,draftReleaseCount:n,protectedBranchCount:s,willPagesChange:a}=g;R(e>0||t>0||n>0||s>0||!!a)}},[g]),(0,s.jsx)(a.l,{title:`Rename ${t.isDefault?"default ":""}branch`,width:"large",onClose:K,footerButtons:[{content:"Cancel",buttonType:"normal",onClick:K},{content:"Rename branch",buttonType:"primary",onClick:Q}],children:(0,s.jsxs)(r.A,{sx:{overflow:"hidden"},children:[B?(0,s.jsx)(o.A,{variant:"danger",sx:{mb:3},children:(0,s.jsx)("span",{children:B})}):null,(0,s.jsxs)(c.A,{sx:{mb:3},children:[(0,s.jsxs)(c.A.Label,{children:["Rename ",(0,s.jsx)(d.A,{href:t.path,children:t.name})," to:"]}),(0,s.jsx)(u.A,{block:!0,"aria-label":"New branch name",className:"color-bg-subtle",value:z,placeholder:t.name,onChange:e=>{var t;return t=e.target.value,void(E(!0),t.trim()?P(!1):P(!0),O(t))}}),t.isDefault&&(0,s.jsxs)(c.A.Caption,{children:["Most projects name the default branch ",(0,s.jsx)(h.A,{sx:{fontWeight:"bold"},children:"main"})]}),(0,s.jsx)(I,{validate:T,isBlank:D,result:q})]}),g?(0,s.jsx)(s.Fragment,{children:v?(0,s.jsxs)("div",{children:[(0,s.jsx)(r.A,{sx:{mb:2},children:(0,s.jsx)("span",{children:"Renaming this branch:"})}),(0,s.jsxs)("ul",{style:{display:"flex",flexDirection:"column",margin:0,listStyle:"none",gap:2},children:[g.prRetargetCount>0&&(0,s.jsxs)("li",{style:{display:"flex",alignItems:"flex-start",gap:3},"data-testid":"update-pr",children:[(0,s.jsx)("div",{children:(0,s.jsx)(x.A,{icon:y.CheckIcon,sx:{color:"success.fg"}})}),(0,s.jsxs)("div",{children:["Will update ",(0,s.jsx)(h.A,{sx:{fontWeight:"bold"},children:g.prRetargetCount})," pull"," ",S({word:"request",count:g.prRetargetCount})," targeting this"," ",g.prRetargetRepoCount>1?(0,s.jsxs)("span",{children:["branch across"," ",(0,s.jsx)(h.A,{sx:{fontWeight:"bold"},children:g.prRetargetRepoCount})," ","repositories."]}):(0,s.jsx)("span",{children:"branch."})]})]}),g.prClosureCount>0&&(0,s.jsxs)("li",{style:{display:"flex",alignItems:"flex-start",gap:3},"data-testid":"close-pr",children:[(0,s.jsx)("div",{children:(0,s.jsx)(x.A,{icon:y.CheckIcon,sx:{color:"success.fg"}})}),(0,s.jsxs)("div",{children:["Will close ",(0,s.jsx)(h.A,{sx:{fontWeight:"bold"},children:g.prClosureCount})," open pull"," ",S({word:"request",count:g.prClosureCount})," for this branch."]})]}),g.draftReleaseCount>0&&(0,s.jsxs)("li",{style:{display:"flex",alignItems:"flex-start",gap:3},"data-testid":"rename-draft",children:[(0,s.jsx)("div",{children:(0,s.jsx)(x.A,{icon:y.CheckIcon,sx:{color:"success.fg"}})}),(0,s.jsxs)("div",{children:["Will update",(0,s.jsxs)(h.A,{sx:{fontWeight:"bold"},children:[" ",g.draftReleaseCount," "]}),"draft"," ",S({word:"release",count:g.draftReleaseCount})," ","targeting this branch."]})]}),g.protectedBranchCount>0&&(0,s.jsxs)("li",{style:{display:"flex",alignItems:"flex-start",gap:3},"data-testid":"update-pb",children:[(0,s.jsx)("div",{children:(0,s.jsx)(x.A,{icon:y.CheckIcon,sx:{color:"success.fg"}})}),(0,s.jsxs)("div",{children:["Will update ",(0,s.jsx)(h.A,{sx:{fontWeight:"bold"},children:g.protectedBranchCount})," ","branch ",S({word:"protection",count:g.protectedBranchCount})," that"," ","explicitly"," ",S({word:"target",count:g.protectedBranchCount,verb:!0})," ",(0,s.jsx)(d.A,{href:t.path,children:t.name}),"."]})]}),!!g.willPagesChange&&(0,s.jsxs)("li",{style:{display:"flex",alignItems:"flex-start",gap:3,minWidth:0},"data-testid":"update-page",children:[(0,s.jsx)("div",{children:(0,s.jsx)(x.A,{icon:y.AlertIcon,sx:{color:"danger.fg"}})}),(0,s.jsxs)(r.A,{sx:{minWidth:0},children:[(0,s.jsx)("span",{children:"Will unpublish current GitHub Pages site."}),(0,s.jsxs)(m.A,{...F(),children:[(0,s.jsx)("summary",{title:`${M?"Hide":"Show"} details on unpublishing GitHub Pages site`,children:(0,s.jsxs)(p.A,{sx:{display:"flex",alignItems:"center"},children:["Learn more",(0,s.jsx)(x.A,{icon:M?y.TriangleUpIcon:y.TriangleDownIcon})]})}),M&&(0,s.jsx)(o.A,{variant:"default",sx:{mt:2},children:(0,s.jsxs)(r.A,{sx:{display:"flex"},children:[(0,s.jsx)(x.A,{icon:y.InfoIcon,sx:{mt:1}}),(0,s.jsxs)(h.A,{sx:{fontSize:0},children:["Your current GitHub Pages site will become unpublished. A new commit on the renamed"," ","branch will publish the GitHub Pages site again."]})]})})]})]})]}),(0,s.jsxs)("li",{style:{display:"flex",alignItems:"flex-start",gap:3,minWidth:0},"data-testid":"copy-details",children:[(0,s.jsx)("div",{children:(0,s.jsx)(x.A,{icon:y.XIcon,sx:{color:"danger.fg"}})}),(0,s.jsxs)(r.A,{sx:{minWidth:0},children:[(0,s.jsx)(h.A,{sx:{verticalAlign:"top"},children:"Will not update your members' local environments."}),(0,s.jsx)(N,{getUpdateLocalEnvDetailsProps:H,openUpdateLocalEnvLearnMore:G,content:J})]})]})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{children:"Renaming this branch will not update your members' local environments."}),(0,s.jsx)(N,{getUpdateLocalEnvDetailsProps:H,openUpdateLocalEnvLearnMore:G,content:J})]})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(k.O,{sx:{width:"30%",mb:2},variant:"rounded",height:"md"}),(0,s.jsx)(k.O,{sx:{width:"60%",mb:2},variant:"rounded",height:"md"}),(0,s.jsx)(k.O,{sx:{width:"80%",mb:2},variant:"rounded",height:"md"}),(0,s.jsx)(k.O,{sx:{width:"70%",mb:2},variant:"rounded",height:"md"})]})]})})}function I({validate:e,isBlank:t,result:n}){return e?t?(0,s.jsx)(c.A.Validation,{variant:"error",children:"Name cannot be blank"}):n.status?n.message?(0,s.jsx)(c.A.Validation,{variant:"valid"===n.status?"success":"error",children:n.message}):null:(0,s.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",fontSize:0},children:[(0,s.jsx)(g.A,{size:"small","aria-label":"Checking if ref name is valid",sx:{mr:1}}),(0,s.jsx)(h.A,{sx:{color:"fg.subtle"},children:"Checking if branch name is valid"})]}):null}function S({word:e,count:t,verb:n=!1}){return n?`${e}${1===t?"s":""}`:`${e}${1===t?"":"s"}`}function N({getUpdateLocalEnvDetailsProps:e,openUpdateLocalEnvLearnMore:t,content:n}){return(0,s.jsxs)(m.A,{...e(),children:[(0,s.jsx)("summary",{title:`${t?"Hide":"Show"} details on updating local environment`,children:(0,s.jsxs)(p.A,{sx:{display:"flex",alignItems:"center"},children:["Learn more",(0,s.jsx)(x.A,{icon:t?y.TriangleUpIcon:y.TriangleDownIcon})]})}),t&&(0,s.jsx)(o.A,{variant:"default",sx:{mt:2},children:(0,s.jsxs)(r.A,{sx:{display:"flex"},children:[(0,s.jsx)(x.A,{icon:y.InfoIcon,sx:{mt:1}}),(0,s.jsxs)(r.A,{sx:{overflowX:"hidden"},children:[(0,s.jsx)(h.A,{sx:{fontSize:0},children:"Your members will have to manually update their local environments. We'll let them know when they visit the repository, or you can share the following commands."}),(0,s.jsxs)(r.A,{sx:{backgroundColor:"canvas.subtle",marginTop:3,position:"relative",padding:2,borderRadius:2},children:[(0,s.jsx)(r.A,{sx:{overflowX:"auto"},tabIndex:0,children:(0,s.jsx)(h.A,{as:"pre",sx:{fontFamily:"mono",fontSize:0},children:n})}),(0,s.jsx)(r.A,{sx:{position:"absolute",top:1,right:1},children:(0,s.jsx)(v.T,{sx:{".octicon-copy":{m:0,color:"fg.subtle"},".octicon-check":{m:0,color:"success.fg"}},textToCopy:n,ariaLabel:"Copy to clipboard",tooltipProps:{direction:"w"}})})]})]})]})})]})}let L=R;try{R.displayName||(R.displayName="RenameBranchDialog")}catch{}try{I.displayName||(I.displayName="BranchRenameValidation")}catch{}try{N.displayName||(N.displayName="UpdateLocalEnvDetails")}catch{}}}]);
//# sourceMappingURL=ui_packages_repos-branches_components_RenameBranchDialog_tsx-a878629e5970.js.map