{"version":3,"file":"chunk-app_assets_modules_github_settings_user-sessions-map-element_ts-xxxxxxxxxxxx.js","mappings":"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","sources":["app/assets/modules/github/graphs/map.ts","app/assets/modules/github/settings/user-sessions-map-element.ts"],"sourcesContent":["// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-nocheck\n/* eslint @typescript-eslint/no-shadow: off */\nimport {feature, mesh} from 'topojson-client'\nimport {geoCentroid, geoEquirectangular, geoGraticule, geoPath} from 'd3-geo'\nimport {max as d3max} from 'd3-array'\nimport {zoom as d3zoom} from 'd3-zoom'\nimport {easeCircleOut} from 'd3-ease'\nimport {format} from 'd3-format'\nimport {scaleSqrt} from 'd3-scale'\nimport {select} from 'd3-selection'\nimport {transition} from 'd3-transition'\n\n// TODO Remove this and use Array.indexOf directly\nconst indexOf =\n  [].indexOf ||\n  function (item) {\n    /* eslint-disable-next-line @typescript-eslint/no-invalid-this */\n    for (let i = 0, l = this.length; i < l; i++) {\n      /* eslint-disable-next-line @typescript-eslint/no-invalid-this */\n      if (i in this && this[i] === item) return i\n    }\n    return -1\n  }\n\nexport interface World {\n  objects: {\n    countries: number[]\n    land: number[]\n  }\n}\n\ninterface Options {\n  legend?: boolean\n  zoom?: boolean\n  graticule?: boolean\n  hoverShowCountryInfo?: boolean\n  link?: boolean\n}\n\ntype Feature = {properties: {name: string; iso_a2: number}}\n\nconst defaultOptions = {\n  legend: false,\n  zoom: false,\n  graticule: false,\n  hover: false,\n  link: false,\n}\n\n// Render the map.\n//\n// node - The container element\n// world - The GeoJSON FeatureCollection {Object}\nexport default function render(node: Element, world: World, options?: Options) {\n  const opts = Object.assign({}, defaultOptions, options)\n  const nodeRect = node.getBoundingClientRect()\n  const width = Math.round(nodeRect.width)\n  const height = Math.round(nodeRect.height)\n\n  let active = select(null)\n  const dataSource = select('.js-map-data')\n  const mapData = dataSource.attr('data-map-data')\n  const codes = JSON.parse(mapData)\n\n  const projection = geoEquirectangular()\n    .scale(width / 2 / Math.PI)\n    .translate([0, 0])\n  const zoom = d3zoom().scaleExtent([1, 20]).on('zoom', zoomed)\n  const path = geoPath().projection(projection)\n  const graticule = geoGraticule()\n  const vis = select(node)\n    .append('svg')\n    .attr('width', width)\n    .attr('height', height)\n    .on(\n      'click',\n      function (event) {\n        if (event != null && event.defaultPrevented) {\n          return event.stopPropagation()\n        }\n      },\n      true,\n    )\n    .append('g')\n    .attr('transform', `translate(${width / 2},${height / 2})`)\n    .call(zoom)\n  vis\n    .append('rect')\n    .attr('class', `map-background${opts.zoom ? ' map-background-zoom' : ''}`)\n    .attr('x', -width / 2)\n    .attr('y', -height / 2)\n    .attr('width', width)\n    .attr('height', height)\n  const zoomlayer = vis.append('g')\n\n  function zoomed(event) {\n    if (opts.zoom) {\n      zoomlayer.attr('transform', event.transform)\n    }\n  }\n\n  function clearCountryLink(node) {\n    const searchPath = dataSource.attr('data-search-path')\n    return node.attr('xlink:href', searchPath)\n  }\n\n  function targetCountry() {\n    /* eslint-disable-next-line @typescript-eslint/no-invalid-this */\n    if (active.node() === this) {\n      return reset()\n    }\n    active.classed('active', false)\n    /* eslint-disable-next-line @typescript-eslint/no-invalid-this */\n    active = select(this).classed('active', true)\n  }\n\n  function selectActiveCountry(el) {\n    const selector = countrySelector(el.attr('data-country'))\n    active.classed('active', false)\n    active = select(null)\n    if (selector.length) {\n      const feature = zoomlayer.select(`.${selector}`)\n      if (feature.size()) {\n        active = select(feature.node())\n        active.classed('active', true)\n        return clearCountryLink(select(feature.node().parentNode))\n      }\n    }\n  }\n\n  function countrySelector(country) {\n    return country.toLowerCase().replace(/\\s+/, '-')\n  }\n\n  function displayCountryInfo(feature: Feature) {\n    let count = 0\n\n    if (feature !== undefined && feature.target !== undefined) {\n      count = codes[feature.target.__data__.properties.iso_a2] || 0\n    }\n\n    const container = select('.js-map-country-info')\n    container.transition().duration(100).style('opacity', 1)\n    container.html('')\n    return container.append('span').text(function () {\n      return `${count === 0 ? 'No' : count} ${count === 1 ? 'event' : 'events'} originating from ${\n        feature.target.__data__.properties.name\n      }`\n    })\n  }\n\n  function reset() {\n    active.classed('active', false)\n    active = select(null)\n    return zoomlayer\n      .transition()\n      .duration(750)\n      .call(zoom.translate([0, 0]).scale(1).event)\n  }\n\n  function bestCenter(feature: Feature) {\n    const code = feature.properties.iso_a2\n    const mapping = {\n      US: [-98.5795, 39.828175],\n      CA: [-107.74899, 59.24028],\n      AU: [134.016341, -24.367113],\n      SE: [15.985167, 63.687217],\n      GB: [-1.505067, 53.647271],\n      FR: [2.3488, 48.85341],\n      NO: [10.683333, 59.933333],\n      ID: [106.828333, -6.175],\n      IN: [72.825833, 18.975],\n      MY: [101.7, 3.133333],\n    }\n    const lonlat = mapping[code] || geoCentroid(feature)\n    return projection(lonlat)\n  }\n\n  function drawBaseMap(world: World) {\n    const outline = feature(world, world.objects.countries)\n    const borders = mesh(world, world.objects.countries, function (a, b) {\n      return a !== b\n    })\n    const land = mesh(world, world.objects.land)\n    const searchPath = dataSource.attr('data-search-path')\n\n    select(node).datum(outline.features)\n\n    zoomlayer.append('path').datum(land).attr('class', 'map-land').attr('d', path)\n\n    const countryItem = zoomlayer\n      .selectAll('.map-country')\n      .data(outline.features)\n      .enter()\n      .append('a')\n      .attr('class', 'map-country-outline')\n      .attr('aria-label', d => d.properties.name)\n\n    if (opts.link) {\n      countryItem.attr('data-pjax', '').attr('xlink:href', function (d) {\n        return `${searchPath} country:${encodeURIComponent(d.properties.iso_a2)}`.replace(/=\\s+/, '=')\n      })\n    } else {\n      countryItem.attr('role', 'button')\n    }\n    countryItem\n      .append('path')\n      .attr('class', function (d) {\n        const code = countrySelector(d.properties.iso_a2)\n        const name = countrySelector(d.properties.name)\n        return `map-country ${code} ${name}`\n      })\n      .attr('d', path)\n\n    if (opts.hoverShowCountryInfo) {\n      countryItem\n        .on('click', targetCountry)\n        .on('mouseover', displayCountryInfo)\n        .on('mouseout', function () {\n          return select('.js-map-country-info').transition().style('opacity', 0)\n        })\n    }\n\n    zoomlayer.append('path').datum(borders).attr('class', 'map-borders').attr('d', path)\n\n    if (opts.graticule) {\n      zoomlayer\n        .append('g')\n        .attr('class', 'map-graticule')\n        .selectAll('path')\n        .data(graticule.lines)\n        .enter()\n        .append('path')\n        .attr('d', path)\n    }\n    return selectActiveCountry(dataSource)\n  }\n\n  function drawDataLayer(data) {\n    const keys = Object.keys(data)\n    const numCodes = keys.length\n    const countries = select(node)\n      .datum()\n      .filter(function (c) {\n        const iso = c.properties.iso_a2\n        return iso !== '-99' && indexOf.call(keys, iso) >= 0\n      })\n    for (const country of countries) {\n      const props = country.properties\n      props.count = codes[props.iso_a2] || 0\n    }\n    const max = d3max(countries, function (d) {\n      return d.properties.count\n    })\n    const radius = scaleSqrt().domain([0, max]).range([0, 15])\n    const circle = zoomlayer.selectAll('.map-point').data(countries, function (d) {\n      return d.properties.iso_a2\n    })\n    circle\n      .enter()\n      .append('circle')\n      .attr('class', d => `map-point ${d.properties.iso_a2}`)\n      .attr('r', 0)\n      .transition(transition().delay((d, i) => (i / numCodes) * 15))\n      .ease(easeCircleOut)\n      .attr('r', d => radius(d.properties.count))\n      .each(function (d) {\n        /* eslint-disable-next-line @typescript-eslint/no-invalid-this */\n        const el = select(this)\n        const [lon, lat] = bestCenter(d)\n        return el.attr('cx', lon).attr('cy', lat)\n      })\n    circle.exit().remove()\n    if (opts.legend && countries.length > 0) {\n      vis.select('.map-legend').remove()\n      const legend = vis\n        .append('g')\n        .attr('class', 'map-legend')\n        .attr('transform', `translate(${width / 2 - 25},${height / 2 - 50})`)\n        .selectAll('g')\n        .data([max, Math.round(max / 3)])\n        .enter()\n        .append('g')\n      legend\n        .append('circle')\n        .attr('class', 'map-legend-circle')\n        .attr('cy', function (d) {\n          return -radius(d)\n        })\n        .attr('r', radius)\n      legend\n        .append('line')\n        .attr('x1', function (d) {\n          return -radius(d) / 2 + 5\n        })\n        .attr('x2', function (d) {\n          return -radius(d) - 20\n        })\n        .attr('y1', function (d) {\n          return -2 * radius(d)\n        })\n        .attr('y2', function (d) {\n          return -2 * radius(d)\n        })\n        .attr('class', 'map-legend-link')\n      legend\n        .append('text')\n        .attr('class', 'map-legend-text')\n        .attr('y', function (d) {\n          return -2 * radius(d)\n        })\n        .attr('x', function (d) {\n          return -radius(d) - 20\n        })\n        .attr('dy', '0.5em')\n        .text(function (d) {\n          if (d < 10) {\n            return d\n          } else {\n            return format('.2s')(d)\n          }\n        })\n    }\n  }\n  drawBaseMap(world)\n  drawDataLayer(codes)\n}\n","import {controller, target} from '@github/catalyst'\nimport type {World} from '../graphs/map'\nimport {fetchPoll} from '@github-ui/fetch-utils'\nimport memoize from '@github/memoize'\nimport render from '../graphs/map'\n\ninterface GraphNetworkData {\n  unusable: boolean\n  summary?: {total: number}\n  length: number\n  [index: number]: {weeks: []}\n}\n\nconst cachedData = memoize(fetchData)\nasync function fetchData(url: string): Promise<World & GraphNetworkData> {\n  const response = await fetchPoll(url, {headers: {accept: 'application/json'}})\n  return await response.json()\n}\n\n@controller\nclass UserSessionsMapElement extends HTMLElement {\n  @target graph: HTMLElement\n\n  async connectedCallback() {\n    const graph = this.graph\n    const url = graph.getAttribute('data-url')\n    if (!url) {\n      return\n    }\n\n    graph.classList.add('is-graph-loading')\n    graph.classList.remove('is-graph-load-error', 'is-graph-empty')\n\n    try {\n      const data = await cachedData(url)\n      graph.classList.remove('is-graph-loading')\n      if (data != null && data.unusable) {\n        graph.classList.add('is-graph-without-usable-data')\n      } else if (\n        (data != null && data.length === 0) ||\n        (data != null && data.summary != null && data.summary.total === 0) ||\n        (data[0] != null && data[0].weeks != null && data[0].weeks.length === 0)\n      ) {\n        graph.classList.add('is-graph-empty')\n      } else {\n        render(graph, data)\n      }\n    } catch (error) {\n      graph.classList.remove('is-graph-loading')\n      graph.classList.add('is-graph-load-error')\n      throw error\n    }\n  }\n}\n"],"names":["indexOf","item","i","l","length","defaultOptions","legend","zoom","graticule","hover","link","cachedData","memoize","fetchData","url","response","fetchPoll","headers","accept","json","UserSessionsMapElement","HTMLElement","connectedCallback","graph","getAttribute","classList","add","remove","data","unusable","summary","total","weeks","render","node","world","options","opts","Object","assign","nodeRect","getBoundingClientRect","width","Math","round","height","active","select","dataSource","codes","JSON","parse","attr","projection","geoEquirectangular","scale","PI","translate","d3zoom","scaleExtent","on","event","zoomlayer","transform","path","geoPath","geoGraticule","vis","append","defaultPrevented","stopPropagation","call","targetCountry","classed","transition","duration","countrySelector","country","toLowerCase","replace","displayCountryInfo","feature","count","undefined","target","__data__","properties","iso_a2","container","style","html","text","name","drawBaseMap","outline","objects","countries","borders","mesh","a","b","land","searchPath","datum","features","countryItem","selectAll","enter","d","encodeURIComponent","code","hoverShowCountryInfo","lines","selectActiveCountry","el","selector","size","clearCountryLink","parentNode","drawDataLayer","keys","numCodes","filter","c","iso","props","max","d3max","radius","scaleSqrt","domain","range","circle","delay","ease","easeCircleOut","each","lon","lat","bestCenter","mapping","US","CA","AU","SE","GB","FR","NO","ID","IN","MY","geoCentroid","exit","format","error","controller"],"sourceRoot":""}