"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_assets_modules_react-code-view_components_blob-edit_WebCommitDialog_tsx"],{70908:(e,t,r)=>{function a(){return Promise.resolve()}function n(){return new Promise(window.requestAnimationFrame)}async function s(e,t){let r;let a=new Promise(t=>{r=self.setTimeout(t,e)});if(!t)return a;try{var n;await Promise.race([a,(n=t,new Promise((e,t)=>{let r=Error("aborted");r.name="AbortError",n.aborted?t(r):n.addEventListener("abort",()=>t(r))}))])}catch(e){throw self.clearTimeout(r),e}}function o(e){let t=[];return function(r){t.push(r),1===t.length&&queueMicrotask(()=>{let r=t.slice(0);t.length=0,e(r)})}}r.d(t,{G$:()=>n,k2:()=>a,rK:()=>o,uk:()=>s})},98629:(e,t,r)=>{r.r(t),r.d(t,{default:()=>x});var a=r(9449),n=r(24389),s=r(30814),o=r(20826),i=r(88299),l=r(27788),c=r(28784),d=r(59079),u=r(55293),h=r(70908);async function m(e){let t=await (0,c.lS)(e);return t.ok?(await t.json()).data.hasQuorum:{statusText:t.statusText}}async function p(e){let t=!1,r=0;try{for(;!1===t&&r<3;){let a=await m(`${e}?attempt_number=${r+1}`);if("boolean"==typeof a)(t=t||a)||(r++,await (0,h.uk)(1e3*r));else break}}catch{}}function x(e){let{content:t,contentChanged:r,fileName:h,isDelete:m,isNewFile:x,oldPath:f,ownerName:g,placeholderMessage:y,refName:b,webCommitInfo:j,setDialogState:v,setSecretDetected:A,setSecretBypassMetadata:w}=e,{authorEmails:k,canCommitStatus:C,commitOid:N,defaultEmail:P,defaultNewBranchName:I,forkedRepo:_,guidanceTask:E,pr:R,repoHeadEmpty:B,saveUrl:F}=j,L=(0,o.H)(F,m?"delete":"post"),S=(0,l.Z)(),[T,q]=u.useState(y),[H,M]=u.useState(""),[D,z]=u.useState("allowed"!==C||!!_),[G,U]=u.useState(I),[W,$]=u.useState(k.length?P:void 0),[O,Y]=u.useState(""),[Q,V]=u.useState(),{refreshTree:K}=(0,s.Uy)(),Z=(0,n.yY)(),X=u.useRef(null);(0,u.useEffect)(()=>{X.current&&X.current.focus()},[]);let J=!_&&!B,ee=async()=>{let e;v("saving");let a=_?`${g}:${b}`:b,n={message:T,placeholder_message:y,description:H,author_email:W??void 0,"commit-choice":J?D?"quick-pull":"direct":void 0,target_branch:J?D?G:b:void 0,quick_pull:D?a:"",guidance_task:E??"",commit:N,same_repo:_||B?void 0:1,pr:R??""};e=m?{...n,_method:"delete"}:{...n,content_changed:r,filename:x?h:f,new_filename:h,value:t};let s=new FormData;for(let[t,r]of Object.entries(e))void 0!==r&&s.set(t,r);s.append("authenticity_token",L??"");try{let e=await (0,c.DI)(F,{method:"post",body:s,headers:{Accept:"application/json"}}),t=await e.json();if(t.data.commitQuorumPollPath&&await p(t.data.commitQuorumPollPath),t.data.redirect){let e=t.data.redirect,r=e.startsWith(window.location.origin)?e.replace(window.location.origin,""):e;(0,i.q)(),K?.current!==void 0&&(K.current=!0),t.data.message&&Z({message:t.data.message,variant:"default"}),v("saved"),setTimeout(()=>{S(r)},50);return}t.data.error&&t.data.secretBypassMetadata?(A&&A(!0),w?.(t.data.secretBypassMetadata),v("closed")):t.data.error?(v("pending"),Y(t.data.error),t.data.error_details&&V(t.data.error_details)):(Y("File could not be edited"),v("pending"))}catch(e){Y("File could not be edited"),v("pending")}};return(0,a.jsx)(d.a,{onSave:ee,message:T,setMessage:q,description:H,setDescription:M,isQuickPull:D,setIsQuickPull:z,prTargetBranch:G,setPRTargetBranch:U,setAuthorEmail:$,errorMessage:O,errorDetails:Q,...e})}try{x.displayName||(x.displayName="WebCommitDialog")}catch{}},73940:(e,t,r)=>{r.d(t,{r:()=>d});var a=r(9449),n=r(59857),s=r(65481),o=r(86519),i=r(75177),l=r(30729),c=r(22084);function d({prefix:e,errorMessageUsingPrefix:t,errorMessageNotUsingPrefix:r,ruleErrors:d,helpUrl:u,flashRef:h}){let m=(d?.length||0)>0;return t||r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.A,{id:"flash",variant:"danger",className:"d-flex flex-items-center flex-justify-between",sx:{marginBottom:3},tabIndex:-1,ref:h,children:t?(0,a.jsxs)("div",{children:[e," ",(0,a.jsx)(c.yx,{sx:{fontWeight:"bold"},unverifiedHTML:t}),m&&(0,a.jsx)(o.A,{href:`${u}/repositories/configuring-branches-and-merges-in-your-repository/managing-rulesets/about-rulesets`,sx:{marginLeft:1},children:"Learn more about rulesets."})]}):r&&(0,a.jsx)("div",{children:r})}),m&&(0,a.jsxs)(i.A,{sx:{marginBottom:3},children:[(0,a.jsx)(i.A,{sx:{fontWeight:"bold",marginBottom:1},children:"Repository rule violations found:"}),d?.map(e=>a.jsxs(i.A,{sx:{display:"flex",alignItems:"center"},children:[a.jsx(l.A,{icon:n.XCircleFillIcon,size:16,sx:{color:"danger.fg"}}),a.jsx(i.A,{sx:{marginLeft:2},children:e})]},e))]})]}):null}try{d.displayName||(d.displayName="FlashError")}catch{}},21937:(e,t,r)=>{r.d(t,{E:()=>s});var a=r(9449),n=r(59857);let s=({status:e})=>{switch(e){case"A":return(0,a.jsx)(n.FileAddedIcon,{className:"color-fg-success"});case"D":return(0,a.jsx)(n.FileRemovedIcon,{className:"color-fg-danger"});case"M":return(0,a.jsx)(n.FileDiffIcon,{className:"color-fg-attention"});case"R":return(0,a.jsx)(n.DiffRenamedIcon,{className:"color-fg-muted"});default:return(0,a.jsx)(n.FileIcon,{})}};try{s.displayName||(s.displayName="FileStatusIcon")}catch{}},59079:(e,t,r)=>{r.d(t,{a:()=>D});var a,n,s,o,i,l,c=r(9449),d=r(28910),u=r(62353),h=r(73940);r(81028);var m=r(75177),p=r(61043),x=r(55293);function f({suggestionsUrlIssue:e,suggestionsUrlMention:t,suggestionsUrlEmoji:r,value:a,setValue:n,sx:s,textareaProps:o}){let i=(0,x.useRef)(null),l=(0,x.useRef)(null),d=(0,x.useCallback)(()=>{n(l.current?.value||a)},[n,a]);return(0,x.useEffect)(()=>{let e=i.current;return e?.addEventListener("text-expander-committed",d),()=>{e?.removeEventListener("text-expander-committed",d)}},[d]),(0,c.jsx)(m.A,{sx:{position:"relative",...s},children:(0,c.jsx)("text-expander",{keys:": @ #","data-issue-url":e,"data-mention-url":t,"data-emoji-url":r,ref:i,children:(0,c.jsx)(p.Ay,{onChange:e=>n(e.target.value),onKeyDown:e=>{("Enter"!==e.code||e.metaKey||e.ctrlKey)&&("Tab"!==e.code||l.current?.value===a)||e.stopPropagation()},ref:l,value:a,sx:{width:"100%"},...o})})})}try{f.displayName||(f.displayName="TextExpander")}catch{}var g=r(59857),y=r(55847),b=r(66889),j=r(44981),v=r(73880),A=r(86519),w=r(89015),k=r(43257),C=r(19797),N=r(47553),P=r(86079),I=r(80838),_=r(51489),E=r(92240),R=r(30729),B=r(65481),F=r(10871);function L({branch:e,protectionNotEnforcedInfo:t}){let r=t.upsellCtaInfo.cta,a=t.organization,{branchProtected:n,rulesetsProtected:s}=t,{showUpgradeButton:o,askAdmin:i,ctaPath:l}=r;function d(e,t,r){return e?(0,c.jsx)(A.A,{href:r,role:"link",...(0,E.G)("linked-text"),underline:!0,children:t}):t}return(0,c.jsxs)(B.A,{variant:"warning",sx:{alignItems:"flex-start",display:"flex",flexDirection:"column",mt:2,mb:3},children:[(0,c.jsx)(()=>a?n&&!s?(0,c.jsx)(function({branchProtectionPath:t}){return(0,c.jsxs)("div",{...(0,E.G)("pb-org"),children:[(0,c.jsx)(R.A,{icon:g.AlertIcon}),"Your ",d(!i,"protected branch rules",t)," ",(0,c.jsx)("strong",{children:e})," branch won't be enforced on this private repository until you upgrade this organization to a GitHub Team or Enterprise account."]})},{branchProtectionPath:t.editRepositoryBranchesPath}):(0,c.jsx)(function({rulesetsPath:t}){return(0,c.jsxs)("div",{...(0,E.G)("ru-org"),children:[(0,c.jsx)(R.A,{icon:g.AlertIcon}),"The ",d(!i,"rulesets",t)," targeting your ",(0,c.jsx)("strong",{children:e}),i?" branch won't be enforced on this private repository until your organization admins upgrade this organization account to GitHub Team.":" branch won't be enforced on this private repository until you upgrade this organization to GitHub Team."]})},{rulesetsPath:t.editRepositoryRulesetsPath}):n&&!s?(0,c.jsx)(function({branchProtectionPath:t}){return(0,c.jsxs)("div",{...(0,E.G)("pb-personal"),children:[(0,c.jsx)(R.A,{icon:g.AlertIcon}),"Your ",d(!i,"protected branch rules",t)," ",(0,c.jsx)("strong",{children:e})," branch won't be enforced on this private repository until you move to a GitHub Team or Enterprise account."]})},{branchProtectionPath:t.editRepositoryBranchesPath}):(0,c.jsx)(function({rulesetsPath:t}){return(0,c.jsxs)("div",{...(0,E.G)("ru-personal"),children:[(0,c.jsx)(R.A,{icon:g.AlertIcon}),"The ",d(!i,"rulesets",t)," targeting your ",(0,c.jsx)("strong",{children:e})," branch won't be enforced on this private repository until you move to a GitHub Team organization account."]})},{rulesetsPath:t.editRepositoryRulesetsPath}),{}),o&&(0,c.jsx)(F.z,{...(0,E.G)("Upgrade-Btn"),href:l,sx:{mt:2,...I.E},children:"Upgrade"}),(0,c.jsx)(m.A,{sx:{mt:2},children:(0,c.jsx)(_._$,{featureRequestInfo:t.featureRequestInfo,requestedMessage:"You've successfully submitted a request to your organization's admins for this feature."})})]})}try{L.displayName||(L.displayName="BranchProtectionNotEnforcedBanner")}catch{}try{(a=BannerMessage).displayName||(a.displayName="BannerMessage")}catch{}try{(n=ProtectedBranchOrganizationMessage).displayName||(n.displayName="ProtectedBranchOrganizationMessage")}catch{}try{(s=ProtectedBranchPersonalMessage).displayName||(s.displayName="ProtectedBranchPersonalMessage")}catch{}try{(o=RulesetsUpsellPersonalMessage).displayName||(o.displayName="RulesetsUpsellPersonalMessage")}catch{}try{(i=RulesetUpsellOrganizationMessage).displayName||(i.displayName="RulesetUpsellOrganizationMessage")}catch{}try{(l=LinkToIf).displayName||(l.displayName="LinkToIf")}catch{}var S=r(21937);let T={commitFileIcon:"WebCommitDialog-module__commitFileIcon--sHZ5I"},q="commit-message-input",H="commit-description-input",M="branch-name-input";function D({additionalFooterContent:e,disableQuickPull:t,dialogProps:r,helpUrl:a,placeholderMessage:n,refName:s,webCommitInfo:o,dialogState:i,onSave:l,setDialogState:p,fileStatuses:I,selectedFiles:_,setSelectedFiles:E,message:R,setMessage:B,description:F,setDescription:D,isQuickPull:z,setIsQuickPull:G,prTargetBranch:U,setPRTargetBranch:W,setAuthorEmail:$,errorMessage:O,errorDetails:Y,returnFocusRef:Q}){let{authorEmails:V,canCommitStatus:K,dcoSignoffEnabled:Z,dcoSignoffHelpUrl:X,defaultEmail:J,defaultNewBranchName:ee,forkedRepo:et,repoHeadEmpty:er,suggestionsUrlEmoji:ea,suggestionsUrlIssue:en,suggestionsUrlMention:es}=o,[eo,ei]=x.useState(!1),el="saving"===i,ec=x.useRef(null),ed=x.useRef(null),{submitCommitDialogShortcut:eu}=(0,u.wk)(),eh=x.useRef(null);(0,x.useEffect)(()=>{eh.current&&eh.current.focus()},[]);let em=x.useRef(!1),ep=z?"Propose changes":"Commit changes";Z&&(ep=`Sign off and ${ep.toLocaleLowerCase()}`);let ex=!et&&!er&&!t,ef=async()=>{if(z&&ex&&"HEAD"===U){ei(!0),ec.current?.focus();return}ei(!1),l()},eg=(0,x.useCallback)(e=>{let t=e.target.value;E?.(e=>{let r=new Set(e);return r.has(t)?r.delete(t):r.add(t),r})},[E]);(0,x.useEffect)(()=>{O&&ed.current&&ed.current.focus()},[O]);let ey=V.filter(e=>e),eb="allowed"===K||z?"primary":"danger",ej="can_bypass"!==K||z?ep:"Bypass rules and commit changes";return(0,c.jsxs)(P.l,{"aria-labelledby":"web-commit-dialog-header",onClose:e=>{"close-button"===e&&(em.current||p("closed"))},sx:{overflowY:"auto"},title:ep,returnFocusRef:Q,width:"large",renderFooter:()=>(0,c.jsxs)(m.A,{sx:{borderTop:"1px solid",borderColor:"border.default",display:"flex",justifyContent:"flex-end",flexWrap:"wrap-reverse",gap:2,padding:3},children:[e,(0,c.jsx)(y.Q,{onClick:()=>{p("closed")},children:"Cancel"}),(0,c.jsx)(y.Q,{onClick:ef,disabled:el,variant:eb,"data-hotkey":eu.hotkey,children:el?"Saving...":ej}),(0,c.jsx)(d._,{buttonFocusId:q,buttonHotkey:eu.hotkey,onlyAddHotkeyScopeButton:!0,onButtonClick:ef}),(0,c.jsx)(d._,{buttonFocusId:H,buttonHotkey:eu.hotkey,onlyAddHotkeyScopeButton:!0,onButtonClick:ef}),(0,c.jsx)(d._,{buttonFocusId:M,buttonHotkey:eu.hotkey,onlyAddHotkeyScopeButton:!0,onButtonClick:ef})]}),...r,children:[(0,c.jsx)(h.r,{prefix:"There was an error committing your changes:",errorMessageUsingPrefix:O,ruleErrors:Y?.ruleViolations,helpUrl:a,flashRef:ed}),(0,c.jsxs)("form",{onSubmit:e=>{ef(),e.preventDefault()},children:[(0,c.jsxs)(b.A,{id:q,children:[(0,c.jsx)(b.A.Label,{children:"Commit message"}),(0,c.jsx)(j.A,{onChange:e=>B(e.target.value),placeholder:n,value:R,ref:eh,sx:{width:"100%",mb:3}})]}),(0,c.jsxs)(b.A,{children:[(0,c.jsx)(b.A.Label,{children:"Extended description"}),(0,c.jsx)(f,{suggestionsUrlIssue:en,suggestionsUrlMention:es,suggestionsUrlEmoji:ea,value:F,setValue:D,sx:{width:"100%",mb:3},textareaProps:{placeholder:"Add an optional extended description..",onCompositionStart:()=>em.current=!0,onCompositionEnd:()=>em.current=!1,id:H}})]}),ey.length>1?(0,c.jsxs)(b.A,{sx:{mb:3},children:[(0,c.jsx)(b.A.Label,{children:"Commit Email"}),(0,c.jsx)(v.A,{onChange:e=>{$(e.target.value)},defaultValue:J,children:V.map((e,t)=>(0,c.jsx)(v.A.Option,{value:e,children:e},t))}),Z&&(0,c.jsxs)(b.A.Caption,{children:["Choose an email address for"," ",(0,c.jsx)(A.A,{href:X,target:"_blank",rel:"noreferrer",inline:!0,children:"signing off"})," ","on this commit"]})]}):Z?(0,c.jsxs)(m.A,{sx:{mb:3},children:["You are"," ",(0,c.jsx)(A.A,{href:X,target:"_blank",rel:"noreferrer",inline:!0,children:"signing off"})," ","on this commit as ",J]}):null,o.protectionNotEnforcedInfo?.upsellCtaInfo.visible&&(0,c.jsx)(L,{branch:s,protectionNotEnforcedInfo:o.protectionNotEnforcedInfo}),ex&&(0,c.jsxs)(w.A,{name:"pr-choice",onChange:e=>{G?.("pr"===e)},children:[(0,c.jsx)(w.A.Label,{visuallyHidden:!0,children:"Direct commit or PR"}),(0,c.jsxs)(b.A,{children:["blocked"!==K&&(0,c.jsx)(k.A,{"aria-checked":!z,"aria-describedby":"can_bypass"!==K||z?void 0:"bypass-warning",value:"direct",defaultChecked:!z}),(0,c.jsx)(b.A.Label,{sx:{fontWeight:"normal"},children:"blocked"!==K?(0,c.jsxs)(c.Fragment,{children:["Commit directly to the"," ",(0,c.jsx)(m.A,{as:"pre",sx:{display:"inline"},children:s})," ","branch"]}):(0,c.jsxs)(c.Fragment,{children:["You can\u2019t commit to"," ",(0,c.jsx)(m.A,{as:"pre",sx:{display:"inline"},children:s})," ","because it is a"," ",(0,c.jsx)(A.A,{href:`${a}/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests`,inline:!0,children:"protected branch"})]})}),"blocked"!==K&&"can_bypass"===K&&!z&&(0,c.jsx)(b.A.Caption,{children:"Some rules will be bypassed by committing directly"})]}),(0,c.jsxs)(b.A,{children:[(0,c.jsx)(k.A,{"aria-checked":z,value:"pr",defaultChecked:z}),(0,c.jsxs)(b.A.Label,{sx:{fontWeight:"normal"},children:["Create a ",(0,c.jsx)("strong",{children:"new branch"})," for this commit and start a pull request"," ",(0,c.jsx)(A.A,{href:`${a}/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests`,sx:{fontSize:0},inline:!0,children:"Learn more about pull requests"})]})]}),z&&(0,c.jsx)(m.A,{sx:{mt:3,mx:3},children:(0,c.jsxs)(b.A,{id:M,children:[(0,c.jsx)(b.A.Label,{visuallyHidden:!0,children:"Branch Name"}),(0,c.jsx)(j.A,{ref:ec,"aria-label":"PR target branch",leadingVisual:g.GitPullRequestIcon,onChange:e=>W?.(e.target.value),placeholder:ee,sx:{width:"100%"},value:U}),eo&&(0,c.jsx)(b.A.Validation,{variant:"error",children:'New branch name can not be "HEAD"'})]})})]}),I&&_&&(0,c.jsxs)(C.A,{sx:{flexGrow:1},children:[(0,c.jsx)(C.A.Label,{children:"Changes to commit"}),Object.entries(I).map(([e,t])=>(0,c.jsxs)(b.A,{children:[(0,c.jsx)(N.A,{value:e,checked:_.has(e),onChange:eg}),(0,c.jsxs)(b.A.Label,{sx:{display:"flex"},children:[(0,c.jsx)("div",{className:T.commitFileIcon,children:(0,c.jsx)(S.E,{status:t})}),e]})]},e))]})]})]})}try{D.displayName||(D.displayName="WebCommitDialog")}catch{}}}]);
//# sourceMappingURL=app_assets_modules_react-code-view_components_blob-edit_WebCommitDialog_tsx-b3d791b6ac0b.js.map