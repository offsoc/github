"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_organizations_settings_codespaces_policy_form_constraint_row_host-setup-element_ts"],{27363:(e,t,a)=>{a.r(t);var o=a(39595);function s(e,t,a,o){var s,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,a):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,a,o);else for(var i=e.length-1;i>=0;i--)(s=e[i])&&(r=(n<3?s(r):n>3?s(t,a,r):s(t,a))||r);return n>3&&r&&Object.defineProperty(t,a,r),r}let n={},r=class HostSetupElement extends HTMLElement{connectedCallback(){this.repositoriesAddEventListner(),this.updateSaveButtonVisibility(),this.updateHostConfig(),this.updateBranchList()}repositoriesAddEventListner(){for(let e of document.querySelectorAll("#host-setup-repository-menu-list"))e.addEventListener("click",e=>{let t=e.target.textContent;t&&t.includes("/")&&(n.repo=t.trim(),this.saveRepository())})}saveHostSetupConstraintChange(){let e=this.hostSetupBox.getAttribute("data-constraint-name");this.dispatchEvent(new CustomEvent("commit",{detail:{hostSetup:n,constraintName:e}}))}async saveRepository(){n.repo&&(this.updateSelectedRepoText(),await this.addBranchesList(n.repo,!0),this.branchSelectorBox.hidden=!1,this.pathInputBox.hidden=!1,this.updateSaveButtonVisibility())}async updateBranchList(){n.repo&&"None"!==n.repo&&await this.addBranchesList(n.repo)}async getBranchList(e){try{let t=await fetch(`/${e}/refs?type=branch`,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}});if(!t.ok)return[];return(await t.json()).refs}catch(e){return[]}}async addBranchesList(e,t=!1){let a=await this.getBranchList(e);if(t){let e=a[0];n.branch=e}this.updateSelectedBranchText();let o=document.getElementById("data-filterable-branch");if(o){let e=a.map(e=>`
            <label tabindex="0" class="select-menu-item" role="menuitemradio" aria-checked="false">
              <input type="radio" name="branch" value="${e}"
                data-action="change:host-setup#saveBranch">
                <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" class="octicon octicon-check select-menu-item-icon">
                  <path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"></path>
                </svg>
                <span class="text-normal select-menu-item-text" data-menu-button-text>${e}</span>
            </label>
          `).join("");o.innerHTML=e}}saveBranch(e){n.branch=e.target.value,this.updateSelectedBranchText(),this.updateSaveButtonVisibility()}updateSelectedBranchText(){let e=document.querySelector('[data-target="host-setup.selectedBranch"]');e&&(e.textContent=n.branch||"None")}updateSelectedRepoText(){let e=document.querySelector('[data-target="host-setup.selectedRepo"]');e&&(e.textContent=n.repo||"None")}savePath(e){n.path=e.target.value,this.updateSaveButtonVisibility()}getSelectedRepoValue(){let e=document.querySelector('[data-target="host-setup.selectedRepo"]');return e?.textContent||"None"}getSelectedBranchValue(){let e=document.querySelector('[data-target="host-setup.selectedBranch"]');return e?.textContent||"None"}getSelectedPathValue(){return this.selectedPath.value.trim()||"None"}updateHostConfig(){n={repo:this.getSelectedRepoValue(),branch:this.getSelectedBranchValue(),path:this.getSelectedPathValue()}}closeDetailsDropdown(e){let t=e.target.closest(".dropdown");t&&t.removeAttribute("open")}updateSaveButtonVisibility(){this.saveErrorElement.hidden=!0;let e="None"===this.getSelectedRepoValue()||"None"===this.getSelectedBranchValue()||"None"===this.getSelectedPathValue();this.configSaveButton.disabled=e}async saveHostSetup(e){let t=document.querySelector('[data-target="codespaces-policy-form.saveErrorElement"]');t&&"Host setup must be specified"===t.textContent&&(t.textContent="");let a=`/${n.repo}/blob/${n.branch}/${n.path}`;try{let t=await fetch(a,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}});if(200===t.status){this.saveHostSetupConstraintChange();let t=this.repositoryFormGroup.getAttribute("github-url");this.updateDisplayText(`${t}${a}`),this.closeDetailsDropdown(e);return}404===t.status&&(this.saveErrorElement.textContent="Error: Specified path does not exist in the repository."),this.saveErrorElement.hidden=!1,this.configSaveButton.disabled=!0}catch{this.saveErrorElement.hidden=!1,this.configSaveButton.disabled=!0}}updateDisplayText(e){let t=document.querySelector('[data-target="host-setup.selectedHostSetupValuesText"]');if(null!==t){t.textContent="";let a=document.createElement("a");a.classList.add("Link","color-fg-muted"),a.textContent=e,a.href=encodeURI(e),t.appendChild(a)}}};s([o.aC],r.prototype,"repositoryFormGroup",void 0),s([o.aC],r.prototype,"branchSelectorBox",void 0),s([o.aC],r.prototype,"pathInputBox",void 0),s([o.aC],r.prototype,"hostSetupBox",void 0),s([o.aC],r.prototype,"configSaveButton",void 0),s([o.aC],r.prototype,"selectedPath",void 0),s([o.aC],r.prototype,"saveErrorElement",void 0),r=s([o.p_],r)}}]);
//# sourceMappingURL=app_components_organizations_settings_codespaces_policy_form_constraint_row_host-setup-element_ts-393a083b7cb5.js.map