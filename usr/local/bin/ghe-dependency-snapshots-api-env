#!/bin/bash
#/ ghe-dependency-snapshots-api-env [-h]
#/
#/ Load the Dependency Snapshots API application environment.
#/
#/ Typically, you will only execute this if you've contacted support and they've asked you to do so.
#/
#/ OPTIONS:
#/   -h | --help         Show this message.
#/
#/ NOTE: this runs the given command or console a dedicated dependency-snapshots-api container.
#/       the container is active on all nodes, and exists only to perform
#/       exec'd
set -e

#shellcheck source=vm_files/usr/local/share/enterprise/ghe-nomad-lib
source /usr/local/share/enterprise/ghe-nomad-lib

if [ "$1" = "--help" ] || [ "$1" = "-h" ]; then
  grep '^#/' < "$0" | cut -c4-
  exit 2
fi

set -ex

hostname=
if [[ -f /etc/github/cluster ]]; then
  hostname=$(cat /etc/github/cluster)
fi

alloc_id=$(find_allocation "dependency-snapshots-api-env" "$hostname")

if [[ -z "$*" ]]; then
  run_in_allocation "$alloc_id" "/bin/bash"
elif [[ -n "$interactive" ]]; then
  run_in_allocation "$alloc_id" "$@"
else
  run_in_allocation "$alloc_id" "$@"
fi