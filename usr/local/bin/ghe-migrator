#!/bin/bash
#/ Usage: ghe-migrator <command> [options]
#/
#/ OPTIONS:
#/   -h | --help    Show this message.
#/
#/ Possible commands are:
#/
#/   add       - Add a repository or organization and
#/               associated records to export.
#/   export    - Create export archive with exported records.
#/   prepare   - Read archive and build reference table.
#/   conflicts - Output conflicts as csv.
#/   map       - Map source_url to target_url with optional
#/               action (map, merge, rename).
#/   import    - Import records.
#/   audit     - Audit imported records.
#/   unlock    - Unlock imported repositories.
#/   list      - List migrations that are in progress.
#/
#/ Documentation can be found at https://docs.github.com/enterprise-server/admin/user-management/migrating-data-to-and-from-your-enterprise
#/

# Show usage.
if [ "$1" = "--help" ] || [ "$1" = "-h" ]; then
  grep '^#/' < "$0" | cut -c 4-
  exit 2
fi

: ${GH_MIGRATOR_INVOCATION:=`basename $0`}
: ${GH_MIGRATOR_PWD:=`pwd`}

github-env -i eval "/usr/bin/env \
  GH_MIGRATOR_INVOCATION=${GH_MIGRATOR_INVOCATION} \
  GH_MIGRATOR_PWD=${GH_MIGRATOR_PWD} \
  MIGRATION_GUID=$MIGRATION_GUID \
  bin/gh-migrator $*"
