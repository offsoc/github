"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_memex_memex-project-picker-element_ts"],{25088:(e,t,i)=>{function s(e,t,i){if(!t.has(e))throw TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}function r(e,t){var i=s(e,t,"get");return i.get?i.get.call(e):i.value}function n(e,t,i){!function(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,i)}function o(e,t,i){var r=s(e,t,"set");return!function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw TypeError("attempted to set read only private field");t.value=i}}(e,r,i),i}i.d(t,{A:()=>m});var l=new WeakMap,a=new WeakMap,c=new WeakMap,h=new WeakMap,u=new WeakMap,d=new WeakMap,p=new WeakMap;let m=class VirtualListboxFocusState{isFocused(){return r(this,u)}updateItems(){o(this,a,Array.from(r(this,l).values())),this.isFocused()&&!this.isExistingItemFocused()&&this.focusFirst()}focusFirst(){this.defocusCurrentElement(),o(this,d,0),o(this,c,r(this,a)[0])}focusLast(){this.defocusCurrentElement(),o(this,d,0),o(this,c,r(this,a)[r(this,a).length-1])}focusNext(){let e;if(r(this,c)){let t=r(this,a).indexOf(r(this,c));e=t===r(this,a).length-1?r(this,a)[t]:r(this,a)[t+1]}else e=r(this,a)[0];this.defocusCurrentElement(),o(this,d,0),o(this,c,e)}focusPrev(){let e;if(r(this,c)){let t=r(this,a).indexOf(r(this,c));e=0===t?r(this,a)[0]:-1===t?r(this,a)[0]:r(this,a)[t-1]}else e=r(this,a)[0];this.defocusCurrentElement(),o(this,d,0),o(this,c,e)}focusIndex(e){this.defocusCurrentElement(),e>-1&&e<r(this,a).length?o(this,c,r(this,a)[e]):this.resetFocus(),o(this,d,0)}captureFocus(){this.markRootAsFocused(),document.activeElement!==r(this,l)&&r(this,l).focus(),this.isExistingItemFocused()||this.focusFirst(),r(this,l).addEventListener("focusout",r(this,p))}releaseFocus(){this.markRootAsNotFocused(),r(this,l).removeEventListener("focusout",r(this,p))}resetFocus(){o(this,h,void 0),o(this,c,void 0),this.defocusCurrentElement(),this.commitFocus()}captureFocusElement(e){if(!r(this,c))return;let t=e.get(r(this,c));if(t){let e=t.querySelector("[tabindex]");this.setFocusElement(e)}}restoreFocus(){this.isFocused()&&(this.captureFocus(),this.commitFocus())}setFocusElement(e){o(this,h,e)}handleKeydown(e){if(e instanceof KeyboardEvent)switch(e.key){case"ArrowDown":this.isFocused()&&(this.focusNext(),r(this,l).update()),e.preventDefault(),e.stopPropagation();break;case"ArrowUp":this.isFocused()&&(this.focusPrev(),r(this,l).update()),e.preventDefault(),e.stopPropagation();break;case"Home":this.isFocused()&&(this.focusFirst(),r(this,l).update());break;case"End":this.isFocused()&&(this.focusLast(),r(this,l).update())}}handleClick(e){let t=e.target;if(r(this,l).list.contains(t)){let e=t.closest("[tabindex]"),i=parseInt(t.closest("[aria-posinset]")?.getAttribute("aria-posinset")||"");if(!e||isNaN(i))return;o(this,h,e),this.focusIndex(i-1),r(this,l).update(),this.captureFocus()}}handleRenderFocus(e){this.captureFocusElement(e.rowsCache),this.restoreFocus()}handleFocusChange(e){this.focusIndex(e.index)}markRootAsNotFocused(){o(this,u,!1)}markRootAsFocused(){o(this,u,!0)}isExistingItemFocused(){return r(this,c)&&r(this,a).indexOf(r(this,c))>-1}commitFocus(){this.forceFocusOnElement(),r(this,h)&&(this.updateScrollPosition(),o(this,d,1),r(this,l).setAttribute("aria-activedescendant",r(this,h).id))}forceFocusOnElement(){for(let e of r(this,l).querySelectorAll("[tabindex]"))e.classList.remove("focused");let e=r(this,h);e&&e.classList.add("focused")}defocusCurrentElement(){let e=r(this,h);e&&(e.classList.remove("focused"),o(this,h,void 0))}updateScrollPosition(){if(!r(this,c)||!r(this,h)||1===r(this,d))return;let e=r(this,h),t=r(this,l);this.isItemDetached()?this.scrollIntoView():this.isItemHiddenByTopBorder()?t.scrollTop=e.offsetTop:this.isItemHiddenByBottomBorder()&&(t.scrollTop=e.offsetTop+e.offsetHeight-t.clientHeight)}scrollIntoView(){if(!r(this,h))return;let e=parseInt(r(this,h).getAttribute("data-scrolltop")||"");isNaN(e)||(r(this,l).scrollTop=e)}isItemHiddenByTopBorder(){return!!(r(this,h)&&r(this,l))&&r(this,h).offsetTop<r(this,l).scrollTop}isItemHiddenByBottomBorder(){let e=r(this,l),t=r(this,h);if(!t||!e)return!1;let i=e.scrollTop+e.clientHeight;return t.offsetTop+t.offsetHeight>i}isItemDetached(){return!!r(this,h)&&!r(this,h).offsetParent}constructor(e){n(this,l,{writable:!0,value:void 0}),n(this,a,{writable:!0,value:void 0}),n(this,c,{writable:!0,value:void 0}),n(this,h,{writable:!0,value:void 0}),n(this,u,{writable:!0,value:void 0}),n(this,d,{writable:!0,value:void 0}),n(this,p,{writable:!0,value:void 0}),o(this,u,!1),o(this,l,e),o(this,a,Array.from(e.values())),o(this,p,this.releaseFocus.bind(this)),r(this,l).addEventListener("focus",()=>{this.isExistingItemFocused()?this.captureFocus():(this.captureFocus(),r(this,l).update())}),r(this,l).addEventListener("virtual-list-rendered",e=>this.handleRenderFocus(e)),r(this,l).addEventListener("virtual-list-data-updated",()=>this.updateItems()),r(this,l).addEventListener("virtual-list-activedescendant-changed",e=>this.handleFocusChange(e)),r(this,l).addEventListener("keydown",e=>this.handleKeydown(e)),r(this,l).addEventListener("click",e=>this.handleClick(e))}}},19594:(e,t,i)=>{i.r(t),i.d(t,{MemexProjectPickerElement:()=>MemexProjectPickerElement});var s=i(79049),r=i(52976),n=i(39595),o=i(25088),l=i(78350);function a(e,t,i,s){var r,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(o=(n<3?r(o):n>3?r(t,i,o):r(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o}var c=new WeakMap;let MemexProjectPickerElement=class MemexProjectPickerElement extends HTMLElement{connectedCallback(){if(this.didLoad(),this.multiselect="true"===this.getAttribute("data-multiselect"),this.recentSrc=this.filterElement.src,this.allSrc=this.all.getAttribute("data-src")||"",this.filterElement.filter=(e,t)=>{if(!t)return!0;let i=e.name.trim().toLowerCase(),s=(0,r.dt)(i,t),n=e.number.toString(),o=Math.max(s,(0,r.dt)(t,n),(0,r.dt)(n,t)),l=o>0?{score:o,text:i}:null;return l&&this.hashedItemScore.set(e,l),o>0},this.list){var e;e=new o.A(this.list),function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw TypeError("attempted to set read only private field");t.value=i}}(this,function(e,t,i){if(!t.has(e))throw TypeError("attempted to set private field on non-instance");return t.get(e)}(this,c,0),e)}let t=this.closest("details.select-menu");t&&this.list&&t.addEventListener("toggle",this.toggleProjectMenu.bind(this)),this.filterElement.addEventListener("virtual-filter-input-filtered",()=>this.filterDone()),this.filterElement.input?.addEventListener("keydown",e=>{"Enter"===e.key&&e.preventDefault()})}filterDone(){this.list.sort((e,t)=>{let i=this.hashedItemScore.get(t),s=this.hashedItemScore.get(e);return s||i?s?i?(0,r.UD)(s,i):-1:1:0})}switchMode(){let e=this.filterInput.value.length>0;e&&this.filterElement.src!==this.allSrc?this.switchToAllProjectsMode():e||this.filterElement.src===this.recentSrc||this.switchToRecentProjectMode()}switchToAllProjectsMode(){this.filterElement.src=this.allSrc,this.filterElement.loading="eager",this.isAllProjectsMode=!0}switchToRecentProjectMode(){this.filterElement.src=this.recentSrc,this.filterElement.loading="eager",this.isAllProjectsMode=!1}showAllProjectsBlankslate(){this.blankslateAllProjects.hidden=!1}hideAllProjectsBlankslate(){this.blankslateAllProjects.hidden=!0}showRecentProjectsBlankslate(){this.blankslateRecentProjects.hidden=!1}hideRecentProjectsBlankslate(){this.blankslateRecentProjects.hidden=!0}showBlankslate(){this.isAllProjectsMode?this.showAllProjectsBlankslate():this.showRecentProjectsBlankslate()}hideBlankslate(){this.isAllProjectsMode?this.hideAllProjectsBlankslate():this.hideRecentProjectsBlankslate()}showLoadingIndicator(){this.loadingIndicator.removeAttribute("hidden")}hideLoadingIndicator(){this.loadingIndicator.setAttribute("hidden","true")}willLoad(){this.loading=!0,this.showLoadingIndicator(),this.hideAllProjectsBlankslate(),this.hideRecentProjectsBlankslate(),this.filterElement.reset()}didLoad(){this.loading=!1,this.hideLoadingIndicator()}willRenderItems(){this.loading||(0===this.list.size?this.showBlankslate():this.hideBlankslate())}renderItem(e){let t={number:e.detail.item.number,name:e.detail.item.name,owner:e.detail.item.owner,selected:this.isProjectSelected(e.detail.item),table_icon_hidden:e.detail.item.template,template_icon_hidden:!e.detail.item.template};e.detail.fragment.append(this.createItem(t)),this.renderedProjects.has(t.number)||this.renderedProjects.set(t.number,t)}toggleItem(e){if(!(e.target instanceof HTMLInputElement)||"checkbox"!==e.target.type)return;let t=e.target.closest("[data-project-number]");if(!t)return;let i=parseInt(t.getAttribute("data-project-number")||"",10),s=this.renderedProjects.get(i);s&&(this.multiselect||this.resetSelectionDiff(),"true"===(t.getAttribute("aria-checked")||"")?(s.selected=!1,this.selectionDiff[i]=s,t.setAttribute("aria-checked","false")):(s.selected=!0,this.selectionDiff[i]=s,t.setAttribute("aria-checked","true")),this.serializeSelection(),this.multiselect||this.triggerUpdate(e))}resetSelectionDiff(){this.selectionDiff={}}removeItem(e,t,i){let s=this.renderedProjects.get(t)||{number:t,name:e,owner:i,selected:!1,table_icon_hidden:!1,template_icon_hidden:!1};return this.selectionDiff[t]=s,this.serializeSelection(),!0}triggerUpdate(e){this.multiselect&&this.filterElement.clear();let t=document.getElementById("js-project-picker-form"),i=t.querySelector("memex-project-picker-interstitial");if(!this.multiselect&&i){i.show(e);return}for(let e of t.elements)if((e.getAttribute("name")||"").indexOf("projects_changes")>-1){(0,l.k_)(t);return}}serializeSelection(){for(let[e,t]of(this.submitContainer.replaceChildren(),Object.entries(this.selectionDiff)))this.submitContainer.append(this.createSubmitSelection(t))}isProjectSelected(e){return(this.selectionDiff[e.number]??e).selected}toggleProjectMenu(e){let t=e.target;if(t&&"create"!==t.getAttribute("data-button-type")){if(e.target.open)return this.open=!0,this.onMenuOpen();this.open=!1,this.multiselect&&this.triggerUpdate(e)}}onMenuOpen(){this.list.update(),!1===this.loading&&0===this.list.size&&this.filterElement.load()}createSubmitSelection(e){return new s.i4(this.selectionTemplate,{name:`projects_changes[${e.number.toString()}]`,checked:e.selected,projectNumber:e.number,projectName:e.name,projectOwner:e.owner,type:e.selected?"checkbox":"hidden"},s.xr)}createItem(e){return new s.i4(this.itemTemplate,e,s.xr)}constructor(...e){super(...e),function(e,t,i){(function(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,i)}(this,c,{writable:!0,value:void 0}),this.loading=!0,this.isAllProjectsMode=!1,this.recentSrc="",this.allSrc="",this.selectionDiff={},this.hashedItemScore=new Map,this.multiselect=!0,this.renderedProjects=new Map,this.open=!1}};a([n.aC],MemexProjectPickerElement.prototype,"filterElement",void 0),a([n.aC],MemexProjectPickerElement.prototype,"list",void 0),a([n.aC],MemexProjectPickerElement.prototype,"itemTemplate",void 0),a([n.aC],MemexProjectPickerElement.prototype,"selectionTemplate",void 0),a([n.aC],MemexProjectPickerElement.prototype,"submitContainer",void 0),a([n.aC],MemexProjectPickerElement.prototype,"blankslateAllProjects",void 0),a([n.aC],MemexProjectPickerElement.prototype,"blankslateRecentProjects",void 0),a([n.aC],MemexProjectPickerElement.prototype,"all",void 0),a([n.aC],MemexProjectPickerElement.prototype,"filterInput",void 0),a([n.aC],MemexProjectPickerElement.prototype,"loadingIndicator",void 0),MemexProjectPickerElement=a([n.p_],MemexProjectPickerElement)},78350:(e,t,i)=>{i.d(t,{Cy:()=>l,K3:()=>h,Z8:()=>a,k_:()=>n,lK:()=>u,m$:()=>o});var s=i(41695);function r(e,t,i){return e.dispatchEvent(new CustomEvent(t,{bubbles:!0,cancelable:i}))}function n(e,t){t&&(function(e,t){if(!(e instanceof HTMLFormElement))throw TypeError("The specified element is not of type HTMLFormElement.");if(!(t instanceof HTMLElement))throw TypeError("The specified element is not of type HTMLElement.");if("submit"!==t.type)throw TypeError("The specified element is not a submit button.");if(!e||e!==t.form)throw Error("The specified element is not owned by the form element.")}(e,t),(0,s.A)(t)),r(e,"submit",!0)&&e.submit()}function o(e,t){if("boolean"==typeof t){if(e instanceof HTMLInputElement)e.checked=t;else throw TypeError("only checkboxes can be set to boolean value")}else{if("checkbox"===e.type)throw TypeError("checkbox can't be set to string value");e.value=t}r(e,"change",!1)}function l(e,t){for(let i in t){let s=t[i],r=e.elements.namedItem(i);r instanceof HTMLInputElement?r.value=s:r instanceof HTMLTextAreaElement&&(r.value=s)}}function a(e){if(!(e instanceof HTMLElement))return!1;let t=e.nodeName.toLowerCase(),i=(e.getAttribute("type")||"").toLowerCase();return"select"===t||"textarea"===t||"input"===t&&"submit"!==i&&"reset"!==i||e.isContentEditable}function c(e){return new URLSearchParams(e)}function h(e,t){let i=new URLSearchParams(e.search);for(let[e,s]of c(t))i.append(e,s);return i.toString()}function u(e){return c(new FormData(e)).toString()}},41695:(e,t,i)=>{function s(e){let t=e.closest("form");if(!(t instanceof HTMLFormElement))return;let i=r(t);if(e.name){let s=e.matches("input[type=submit]")?"Submit":"",r=e.value||s;i||((i=document.createElement("input")).type="hidden",i.classList.add("js-submit-button-value"),t.prepend(i)),i.name=e.name,i.value=r}else i&&i.remove()}function r(e){let t=e.querySelector("input.js-submit-button-value");return t instanceof HTMLInputElement?t:null}i.d(t,{A:()=>s,C:()=>r})},52976:(e,t,i)=>{function s(e,t,i=.1){let s=o(e,t,i);return s&&-1===t.indexOf("/")&&(s+=o(e.substring(e.lastIndexOf("/")+1),t,i)),s}function r(e,t,i){if(t){let s=e.innerHTML.trim().match(i||function(e){let t=e.toLowerCase().split(""),i="",s=!0;for(let e of t){let t=e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&");s?(i+=`(.*)(${t})`,s=!1):i+=`([^${t}]*?)(${t})`}return RegExp(`${i}(.*?)$`,"i")}(t));if(!s)return;let r=!1,n=[];for(let e=1;e<s.length;++e){let t=s[e];t&&(e%2==0?r||(n.push("<mark>"),r=!0):r&&(n.push("</mark>"),r=!1),n.push(t))}e.innerHTML=n.join("")}else{let t=e.innerHTML.trim(),i=t.replace(/<\/?mark>/g,"");t!==i&&(e.innerHTML=i)}}i.d(t,{He:()=>r,UD:()=>l,dt:()=>s});let n=new Set([" ","-","_"]);function o(e,t,i=.1){let s=e;if(s===t)return 1;let r=s.length,o=0,l=0,a=!0;for(let e of t){let t=s.indexOf(e.toLowerCase()),c=s.indexOf(e.toUpperCase()),h=Math.min(t,c),u=h>-1?h:Math.max(t,c);if(-1===u)return 0;o+=.1,s[u]===e&&(o+=.1),0===u&&(o+=.9-i,a&&(l=1)),n.has(s.charAt(u-1))&&(o+=.9-i),s=s.substring(u+1,r),a=!1}let c=t.length,h=o/c,u=(c/r*h+h)/2;return l&&u+i<1&&(u+=i),u}function l(e,t){return e.score>t.score?-1:e.score<t.score?1:e.text<t.text?-1:e.text>t.text?1:0}},79049:(e,t,i)=>{function*s(e){let t="",i=0,s=!1;for(let r=0;r<e.length;r+=1)"{"!==e[r]||"{"!==e[r+1]||"\\"===e[r-1]||s?"}"===e[r]&&"}"===e[r+1]&&"\\"!==e[r-1]&&s&&(s=!1,yield{type:"part",start:i,end:r+2,value:t.slice(2).trim()},t="",r+=2,i=r):(s=!0,t&&(yield{type:"string",start:i,end:r,value:t}),t="{{",i=r,r+=2),t+=e[r]||"";t&&(yield{type:"string",start:i,end:e.length,value:t})}i.d(t,{i4:()=>TemplateInstance,xr:()=>b});var r,n,o,l,a,c=function(e,t,i){if(!t.has(e))throw TypeError("attempted to set private field on non-instance");return t.set(e,i),i},h=function(e,t){if(!t.has(e))throw TypeError("attempted to get private field on non-instance");return t.get(e)};let AttributeTemplatePart=class AttributeTemplatePart{constructor(e,t){this.expression=t,r.set(this,void 0),n.set(this,""),c(this,r,e),h(this,r).updateParent("")}get attributeName(){return h(this,r).attr.name}get attributeNamespace(){return h(this,r).attr.namespaceURI}get value(){return h(this,n)}set value(e){c(this,n,e||""),h(this,r).updateParent(e)}get element(){return h(this,r).element}get booleanValue(){return h(this,r).booleanValue}set booleanValue(e){h(this,r).booleanValue=e}};r=new WeakMap,n=new WeakMap;let AttributeValueSetter=class AttributeValueSetter{constructor(e,t){this.element=e,this.attr=t,this.partList=[]}get booleanValue(){return this.element.hasAttributeNS(this.attr.namespaceURI,this.attr.name)}set booleanValue(e){if(1!==this.partList.length)throw new DOMException("Operation not supported","NotSupportedError");this.partList[0].value=e?"":null}append(e){this.partList.push(e)}updateParent(e){if(1===this.partList.length&&null===e)this.element.removeAttributeNS(this.attr.namespaceURI,this.attr.name);else{let e=this.partList.map(e=>"string"==typeof e?e:e.value).join("");this.element.setAttributeNS(this.attr.namespaceURI,this.attr.name,e)}}};var u=function(e,t,i){if(!t.has(e))throw TypeError("attempted to set private field on non-instance");return t.set(e,i),i},d=function(e,t){if(!t.has(e))throw TypeError("attempted to get private field on non-instance");return t.get(e)};let NodeTemplatePart=class NodeTemplatePart{constructor(e,t){this.expression=t,o.set(this,void 0),u(this,o,[e]),e.textContent=""}get value(){return d(this,o).map(e=>e.textContent).join("")}set value(e){this.replace(e)}get previousSibling(){return d(this,o)[0].previousSibling}get nextSibling(){return d(this,o)[d(this,o).length-1].nextSibling}replace(...e){let t=e.map(e=>"string"==typeof e?new Text(e):e);for(let e of(t.length||t.push(new Text("")),d(this,o)[0].before(...t),d(this,o)))e.remove();u(this,o,t)}};function p(e){return{createCallback(e,t,i){this.processCallback(e,t,i)},processCallback(t,i,s){var r;if("object"==typeof s&&s){for(let t of i)if(t.expression in s){let i=null!==(r=s[t.expression])&&void 0!==r?r:"";e(t,i)}}}}}function m(e,t){e.value=String(t)}o=new WeakMap;let f=p(m),b=p((e,t)=>{(function(e,t){return"boolean"==typeof t&&e instanceof AttributeTemplatePart&&"boolean"==typeof e.element[e.attributeName]&&(e.booleanValue=t,!0)})(e,t)||m(e,t)});var g=function(e,t,i){if(!t.has(e))throw TypeError("attempted to set private field on non-instance");return t.set(e,i),i},v=function(e,t){if(!t.has(e))throw TypeError("attempted to get private field on non-instance");return t.get(e)};let TemplateInstance=class TemplateInstance extends DocumentFragment{constructor(e,t,i=f){var r,n;super(),l.set(this,void 0),a.set(this,void 0),Object.getPrototypeOf(this!==TemplateInstance.prototype)&&Object.setPrototypeOf(this,TemplateInstance.prototype),this.appendChild(e.content.cloneNode(!0)),g(this,a,Array.from(function*(e){let t;let i=e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,null,!1);for(;t=i.nextNode();)if(t instanceof Element&&t.hasAttributes())for(let e=0;e<t.attributes.length;e+=1){let i=t.attributes.item(e);if(i&&i.value.includes("{{")){let e=new AttributeValueSetter(t,i);for(let t of s(i.value))if("string"===t.type)e.append(t.value);else{let i=new AttributeTemplatePart(e,t.value);e.append(i),yield i}}}else if(t instanceof Text&&t.textContent&&t.textContent.includes("{{"))for(let e of s(t.textContent)){e.end<t.textContent.length&&t.splitText(e.end),"part"===e.type&&(yield new NodeTemplatePart(t,e.value));break}}(this))),g(this,l,i),null===(n=(r=v(this,l)).createCallback)||void 0===n||n.call(r,this,v(this,a),t)}update(e){v(this,l).processCallback(this,v(this,a),e)}};l=new WeakMap,a=new WeakMap}}]);
//# sourceMappingURL=app_components_memex_memex-project-picker-element_ts-e91f47042716.js.map