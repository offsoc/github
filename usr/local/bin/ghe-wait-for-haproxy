#!/bin/bash
# wait for haproxy to be available
TIMEOUT=${1:-300}
END_TIME=$(($SECONDS + $TIMEOUT))
while [ $SECONDS -lt $END_TIME ]; do
  if curl http://localhost:8080/ &>/dev/null; then
    exit
  fi
  echo "waiting for haproxy to become available; sleeping for 5 seconds"
  sleep 5
done
echo "haproxy did not start before timeout (${TIMEOUT})"
exit 1
