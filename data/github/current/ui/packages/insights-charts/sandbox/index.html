<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>insights-components sandbox</title>
  <link href="https://unpkg.com/@primer/css@^19.0.0/dist/primer.css" rel="stylesheet" />
  <script src="theme.js"></script>
</head>

<body>
  <div class="qa-omit position-fixed width-full color-bg-default border z-1">
    <div class="position-absolute pt-2 right-10 d-flex">
      <button title='color mode selector' id="color-mode-selector" class="btn" type="button"></button>
      <select title='theme option select' id="theme-options" class="form-select"></select>
    </div>

    <script>
      initThemeOptions()
    </script>

    <div class="d-flex flex-justify-center">
      <h2 class="pt-2">Insights Component Sandbox</h2>
    </div>
  </div>
  <div style="height:60px"></div>
  <a href="/forecasting">To Forecasting Examples</a><br>
  <a href="/rolling-sum">To Rolling-sum Examples</a>
  <nav id="nav" class="d-flex flex-column flex-items-end container-xl">
  </nav>
  <div class="container-xl border p-3">
    <!-- Example using attribute -->

    <div class="qa-snapshot">
      <h3>Query passed in via query attribute</h3>
      <insights-query auth-url="auth/api" api-url='/sql/api' class='markdown-body' query="attribute query">
      </insights-query>
    </div>

    <hr />

    <!-- Example using property (w/ attribute reflection)-->

    <div class="qa-snapshot">
      <h3>Query property set programmatically</h3>

      <insights-query auth-url="auth/api" id="property-example" class='markdown-body' api-url='/sql/api'>
      </insights-query>
    </div>

    <hr />

    <!-- Example using external query (see script tag below) -->

    <div class="qa-snapshot">
      <h3>Query sourced from external element via element id</h3>

      <insights-query auth-url="auth/api" query-container-id="query" class='markdown-body' api-url='/sql/api'>
      </insights-query>
    </div>
    <hr />

    <!-- Example using textarea (see script tag below) -->

    <div class="qa-snapshot">
      <h3>Query sourced from external element via element id and updated when input changed</h3>

      <textarea id="textarea-query">element id query</textarea>

      <insights-query auth-url="auth/api" id="textarea-example" query-container-id="textarea-query" class='markdown-body'
        api-url='/sql/api'>
      </insights-query>
    </div>
    <hr />

    <!-- series-table example -->
    <div class="qa-snapshot">
      <h3>&#60; series-table /&#62; rendered directly (w/o styling)</h3>
      <series-table
        series='{"columns":["Reviewer","Pull request","Requester","Age"],"rows":[["@monalisa","[github/knowledge-base#906] GHES protocol-port-service-map Doc","@lisamona","726 days, 6 hrs"],["@monalisa","[github/product-design#207] [WIP] Project Manager hiring rubric","@lisamona","726 days, 8 hrs"],["@monalisa","[github/enterprise2#16683] Refactor CIBuild-Jasig using Ansible","@lisamona","726 days, 9 hrs"],["@monalisa","[github/components-go#17] twirp: Start adding a service component","@lisamona","726 days, 10 hrs"],["@monalisa","[github/graphql-docs#245] Turn off automerging PRs in internal-developer","@lisamona","726 days, 11 hrs"]]}'>
      </series-table>
    </div>
    <hr />

    <div class="qa-snapshot">
      <h3>Stacked area chart via query attribute</h3>
      <insights-query auth-url="auth/api" class='markdown-body' api-url='/sql/api'
        query="--render stacked-area-chart
        attribute query" height="300px">
      </insights-query>
    </div>
    <hr />

    <div class="qa-snapshot">
      <h3>Stacked area chart via child rendering</h3>
      <insights-query auth-url="auth/api" api-url="/sql/api" query="attribute query" height="300px">
        <stacked-area-chart
          color-coding="%7B%22In%20progress%22:%7B%22borderColor%22:%22#005CC5%22,%22backgroundColor%22:%22red%22%7D,%22Done%22:%7B%22borderColor%22:%22#005CC5%22,%22backgroundColor%22:%22blue%22%7D%7D">
        </stacked-area-chart>
      </insights-query>
    </div>
    <hr />

    <div class="qa-snapshot">
      <h3>Stacked area chart with WeekStartingDateKey in series</h3>
        <stacked-area-chart
          height="300px"
          series='{"columns":[{"name":"WeekStartingDateKey","dataType":"int"},{"name":"incoming_issues","dataType":"int"},{"name":"Name","dataType":"nvarchar"}],"rows":[[20221031,2,"P2"],[20221031,1,"P4"],[20221024,6,"P3"],[20221017,1,"P2"],[20221017,1,"P3"],[20221017,1,"P4"],[20221010,4,"P2"],[20221010,2,"P3"],[20221003,2,"P2"],[20221003,3,"P3"],[20221003,1,"P4"],[20220926,5,"P3"],[20220919,1,"P1"],[20220919,2,"P2"],[20220919,4,"P3"],[20220919,1,"P4"],[20220912,2,"P2"],[20220912,4,"P3"],[20220912,1,"P4"],[20220905,1,"P2"],[20220905,1,"P3"],[20220905,1,"P4"],[20220829,1,"P2"],[20220829,1,"P3"]],"isSensitive":false}'
        >
        </stacked-area-chart>
    </div>
    <hr />

    <div class="qa-snapshot">
      <h3>Bar chart via child rendering</h3>
      <insights-query auth-url="auth/api" api-url="/sql/api" query="attribute query" height="500px">
        <bar-chart
          color-coding="%7B%22In%20progress%22:%7B%22borderColor%22:%22#005CC5%22,%22backgroundColor%22:%22red%22%7D,%22Done%22:%7B%22borderColor%22:%22#005CC5%22,%22backgroundColor%22:%22blue%22%7D%7D">
        </bar-chart>
      </insights-query>
    </div>
    <hr />

    <div class="qa-snapshot">
      <h3>Bar chart (stacked) via query attribute</h3>
      <insights-query auth-url="auth/api" class='markdown-body' api-url='/sql/api'
        query="--render bar-chart ( chart-stacked ) attribute query" height="300px">
      </insights-query>
    </div>
    <hr />

    <div class="qa-snapshot">
      <h3>Bar chart (grouped) via query attribute</h3>
      <insights-query auth-url="auth/api" class='markdown-body' api-url='/sql/api'
        query="--render bar-chart ( abcd ) attribute query">
      </insights-query>
    </div>
    <hr />

    <div class="qa-snapshot">
      <h3>Column chart via child rendering</h3>
      <insights-query auth-url="auth/api" api-url="/sql/api" query="attribute query" height="300px">
        <column-chart
          color-coding="%7B%22In%20progress%22:%7B%22borderColor%22:%22#005CC5%22,%22backgroundColor%22:%22red%22%7D,%22Done%22:%7B%22borderColor%22:%22#005CC5%22,%22backgroundColor%22:%22blue%22%7D%7D">
        </column-chart>
      </insights-query>
    </div>
    <hr />

    <div class="qa-snapshot">
      <h3>Column chart (stacked) via query attribute</h3>
      <insights-query auth-url="auth/api" class='markdown-body' api-url='/sql/api' query="--render column-chart ( chart-stacked
        chart-title = My title)
        attribute query" height="300px">
      </insights-query>
    </div>
    <hr />

    <div class="qa-snapshot">
      <h3>Column chart (grouped) via query attribute</h3>
      <insights-query auth-url="auth/api" class='markdown-body' api-url='/sql/api'
        query="--render column-chart attribute query">
      </insights-query>
    </div>
    <hr />

    <div class="qa-snapshot">
      <h3>Line chart via child rendering</h3>
      <insights-query auth-url="auth/api" api-url="/sql/api" query="attribute query" height="300px">
        <line-chart
          color-coding="%7B%22In%20progress%22:%7B%22borderColor%22:%22#005CC5%22,%22backgroundColor%22:%22red%22%7D,%22Done%22:%7B%22borderColor%22:%22#005CC5%22,%22backgroundColor%22:%22blue%22%7D%7D">
        </line-chart>
      </insights-query>
    </div>
    <hr />

    <div class="qa-snapshot">
      <h3>Line chart with int col1</h3>
      <line-chart
          color-coding="%7B%22In%20progress%22:%7B%22borderColor%22:%22#005CC5%22,%22backgroundColor%22:%22red%22%7D,%22Done%22:%7B%22borderColor%22:%22#005CC5%22,%22backgroundColor%22:%22blue%22%7D%7D"
          series='{"columns":[{"name":"date","dataType":"int"},{"name":"count","dataType":"int"}],"rows":[[1,1],[2,0],[3,0],[4,3],[5,3],[6,6],[7,1]],"isSensitive":false}'
          height="300px"
      ></line-chart>
    </div>
    <hr />

    <div class="qa-snapshot">
      <h3>Line chart with DAY series data</h3>
      <line-chart
          color-coding="%7B%22In%20progress%22:%7B%22borderColor%22:%22#005CC5%22,%22backgroundColor%22:%22red%22%7D,%22Done%22:%7B%22borderColor%22:%22#005CC5%22,%22backgroundColor%22:%22blue%22%7D%7D"
          series='{"columns":[{"name":"Day","dataType":"nvarchar"},{"name":"Count","dataType":"int"},{"name":"Group","dataType":"nvarchar"}],"rows":[["Oct 1",6,"Group 1"],["Oct 2",2,"Group 1"],["Oct 3",4,"Group 1"],["Oct 4",3,"Group 1"],["Oct 1",2,"Group 2"],["Oct 2",3,"Group 2"],["Oct 4",7,"Group 2"]]}'
          height="300px"
      ></line-chart>
    </div>
    <hr />

    <div class="qa-snapshot">
      <h3>Line chart with arbitrary series data</h3>
      <line-chart
          color-coding="%7B%22In%20progress%22:%7B%22borderColor%22:%22#005CC5%22,%22backgroundColor%22:%22red%22%7D,%22Done%22:%7B%22borderColor%22:%22#005CC5%22,%22backgroundColor%22:%22blue%22%7D%7D"
          series='{"columns":[{"name":"Toots","dataType":"nvarchar"},{"name":"Count","dataType":"int"},{"name":"Group","dataType":"nvarchar"}],"rows":[["blue",6,"Group 1"],["red",2,"Group 1"],["yellow",4,"Group 1"],["green",3,"Group 1"],["blue",2,"Group 2"],["yellow",3,"Group 2"],["green",7,"Group 2"]]}'
          height="300px"
      ></line-chart>
    </div>
    <hr />

    <div class="qa-snapshot">
      <h3>Line chart chart-min-y=0</h3>
      <line-chart
        height="300px"
        series='{"columns":[{"name":"Day","dataType":"nvarchar"},{"name":"Count","dataType":"int"},{"name":"Group","dataType":"nvarchar"}],"rows":[["Oct 1",20,"Group 1"],["Oct 2",30,"Group 1"],["Oct 3",25,"Group 1"],["Oct 4",40,"Group 1"]]}'
        chart-min-y="0"
      ></line-chart>
    </div>
    <hr />

    <div class="qa-snapshot">
      <h3>Line chart chart-min-y=10</h3>
      <line-chart
        height="300px"
        series='{"columns":[{"name":"Day","dataType":"nvarchar"},{"name":"Count","dataType":"int"},{"name":"Group","dataType":"nvarchar"}],"rows":[["Oct 1",20,"Group 1"],["Oct 2",30,"Group 1"],["Oct 3",25,"Group 1"],["Oct 4",40,"Group 1"]]}'
        chart-min-y=10
      ></line-chart>
    </div>
    <hr />

    <!-- Forecasting simple series -->
    <div class="qa-snapshot">
      <h3>Forecasting dataset</h3>
      <div id="forecasting"></div>
    </div>
    <hr />

    <div class="qa-snapshot">
      <h3>Error From SQL</h3>
      <insights-query auth-url="auth/api" api-url="/sql/api/error" class='markdown-body' query="attribute query">
      </insights-query>
    </div>
    <hr />

    <div class="qa-snapshot">
      <h3>XSS Attempt</h3>
      <insights-query auth-url="auth/api" api-url="/sql/api/xss" class='markdown-body' query="attribute query">
      </insights-query>
    </div>
    <hr />

    <div class="qa-snapshot">
      <h3>XSS Attempt with Error Msg</h3>
      <insights-query auth-url="auth/api"
        api-url="/sql/api/error?message=<style>body {background-color: hotpink;}</style>" class='markdown-body'
        query="attribute query">
      </insights-query>
    </div>
    <hr />

    <div class="qa-snapshot">
      <h3>A-Tag Rendering</h3>
      <insights-query auth-url="auth/api" api-url="/sql/api/atag" class='markdown-body' query="attribute query">
      </insights-query>
    </div>
    <hr />

  </div>

  <!-- Example using external query -->

  <script>
    document.querySelector('#property-example').query = "property query"
  </script>

  <!-- Example using textarea -->

  <script>
    const textArea = document.querySelector('textarea');
    const insightsQueryElement = document.querySelector('#textarea-example')

    textArea.addEventListener('input', function () {
      insightsQueryElement.query = textArea.value
      insightsQueryElement.fetchDataAndRenderComponent()
    }, false);
  </script>

  <script type="module">
    import { InsightsQueryElement } from '/dist'

    window.customElements.define("insights-query", InsightsQueryElement)
  </script>

  <script type="module">
    import { SeriesTableElement } from '/dist'

    window.customElements.define("series-table", SeriesTableElement)
  </script>

  <script type="module">
    import { StackedAreaChartElement } from '/dist'

    window.customElements.define("stacked-area-chart", StackedAreaChartElement)

  </script>

  <script type="module">
    import { BarChartElement } from '/dist'

    window.customElements.define("bar-chart", BarChartElement)
  </script>

  <script type="module">
    import { ColumnChartElement } from '/dist'

    window.customElements.define("column-chart", ColumnChartElement)
  </script>

  <script type="module">
    import { LineChartElement } from '/dist'

    window.customElements.define("line-chart", LineChartElement)
  </script>

  <script type="module">
    import { forecasting, padding } from '/dist'

    const simpleSeries = [
      [new Date('Sep 29 2022'), 4],
      [new Date('Oct 1 2022'), 2],
      [new Date('Oct 2 2022'), 1],
      [new Date('Oct 3 2022'), 2],
      [new Date('Oct 4 2022'), 8],
      [new Date('Oct 5 2022'), 6]
    ]

    const paddedSeries = padding.fillMissing(simpleSeries)
    const { series, forecastStartdate } = forecasting.linearRegression.forecastAndAppend(paddedSeries)
    const seriesData = {
      columns: [
        {
          name: 'Date',
          dataType: 'datetimeoffset'
        },
        {
          name: 'Count',
          dataType: 'int'
        },
      ],
      rows: series
    }
    document.getElementById('forecasting').innerHTML = `<line-chart series=${JSON.stringify(seriesData)} forecast-startdate="${forecastStartdate}" height="300px"></line-chart>`
  </script>

  <!-- add our nav at the top -->
  <script>
    const nav = document.getElementById("nav")
    const els = document.getElementsByClassName("qa-snapshot")
    for (let i = 0; i < els.length; i++) {
      const el = els[i]
      const id = `chart${i}`
      el.id = id
      const a = document.createElement("a")
      a.href = `#${id}`
      a.innerText = el.getElementsByTagName('h3')[0].innerText
      nav.appendChild(a)
    }
  </script>
</body>

</html>