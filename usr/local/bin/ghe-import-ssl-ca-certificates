#!/bin/bash
#/ Usage: ghe-import-ssl-ca-certificates [-h]
#/
#/ Import a backup taken with ghe-export-ssl-ca-certificates.
#/
#/ OPTIONS:
#/   -h | --help      Show this message.
#/
#/ EXAMPLE:
#/
#/  Import the custom CA certificates from a tar file:
#/    $ ghe-import-ssl-ca-certificates < dump-file
#/
#/  Transfer the custom CA certificates from the current appliance to another:
#/    $ ghe-export-ssl-ca-certificates | ssh -p 122 admin@[hostname] -- ghe-import-ssl-ca-certificates
#/
set -e

# Show usage.
if [ "$1" = "--help" ] || [ "$1" = "-h" ] || [ -t 0 ]; then
  grep '^#/' < "$0" | cut -c 4-
  exit 2
fi

function message {
  echo " --> ${1}"
}

[ "$(whoami)" = "root" ] || {
  exec sudo -u root "$0" "$@"
  echo Run this script as the root user. >&2
  exit 1
}

message "Importing custom CA certificates..."

tar --acls -xOf - | ghe-ssl-ca-certificate-install || true
