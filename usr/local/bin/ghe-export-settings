#!/bin/sh
#/ Usage: ghe-export-settings [-h]
#/
#/ Export the Management Console settings.
#/
#/ OPTIONS:
#/   -h | --help      Show this message.
#/
#/ EXAMPLE:
#/
#/  Export the settings to a file:
#/    $ ghe-export-settings > dump-file
#/
#/  Transfer the settings from the current appliance to another:
#/    $ ghe-export-settings | ssh -p 122 admin@[hostname] -- ghe-import-settings
#/
set -e

# Show usage.
if [ "$1" = "--help" ] || [ "$1" = "-h" ]; then
  grep '^#/' < "$0" | cut -c 4-
  exit 2
fi

[ "$(whoami)" = "admin" ] || {
    exec sudo -u admin "$0" "$@"
    echo Run this script as the git user. >&2
    exit 1
}

sudo cat /data/user/common/github.conf || {
  echo "Enterprise is not configured yet" >&2
  exit 1
}
