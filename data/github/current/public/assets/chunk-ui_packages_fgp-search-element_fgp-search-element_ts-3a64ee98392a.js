"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["ui_packages_fgp-search-element_fgp-search-element_ts"],{74068:(t,e,i)=>{i.r(e),i.d(e,{FgpSearchElement:()=>FgpSearchElement});var r=i(39595),s=i(35908);function a(t,e){if(e.has(t))throw TypeError("Cannot initialize the same private elements twice on an object")}function n(t,e,i){if(!e.has(t))throw TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}function o(t,e){var i=n(t,e,"get");return i.get?i.get.call(t):i.value}function l(t,e,i){a(t,e),e.set(t,i)}function c(t,e,i){var r=n(t,e,"set");return!function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw TypeError("attempted to set read only private field");e.value=i}}(t,r,i),i}function h(t,e,i){if(!e.has(t))throw TypeError("attempted to get private field on non-instance");return i}function u(t,e){a(t,e),e.add(t)}function d(t,e,i,r){var s,a=arguments.length,n=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;o>=0;o--)(s=t[o])&&(n=(a<3?s(n):a>3?s(e,i,n):s(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n}var p=new WeakMap,m=new WeakMap,f=new WeakMap,b=new WeakMap,v=new WeakMap,g=new WeakMap,S=new WeakMap,y=new WeakSet,k=new WeakSet,w=new WeakSet,E=new WeakSet,A=new WeakSet,L=new WeakSet,x=new WeakSet,C=new WeakSet,F=new WeakSet;let FgpSearchElement=class FgpSearchElement extends HTMLElement{async connectedCallback(){c(this,p,new s.A(this.searchInput,this.resultList)),o(this,g).call(this)}removeFgp(t){let e=t.currentTarget.getAttribute("data-fgp");e&&(this.removeFromSummary(e),h(this,w,T).call(this,e)),h(this,F,j).call(this)}handleRepoBaseRoleChange(){let t=h(this,C,R).call(this)||this.getAttribute("data-initial-base-role"),e=document.getElementById("role_base_role");e&&(e.value="none"!==t&&t?t:""),t&&(this.searchInput.disabled="none"===t,h(this,L,M).call(this,t),h(this,F,j).call(this))}keepOpen(){c(this,b,!0)}openSearch(){this.resultList.hidden=!1,this.resultList.ariaExpanded="true",o(this,p).start()}closeSearch(){if(o(this,b)){c(this,b,!1);return}this.resultList.hidden=!0,o(this,p).stop()}addToSummary(t,e=!1){let i=o(this,f)[t];if(!i||(o(this,v).add(t),h(this,A,I).call(this,t)))return;let r=h(this,x,O).call(this),s=r.querySelector(".js-fgp-list-item"),a=r.querySelector(".js-fgp-item-title"),n=r.querySelector(".js-fgp-remove-button");if(e){n&&(n.hidden=!0);let t=r.querySelector("span.js-repository-inherit-label");t&&(t.textContent=`Inherited from ${i.base_role||"admin"}`)}if(s&&a&&n){if(a.textContent=i.description,s.setAttribute("data-fgp",t),s.setAttribute("id",`fgp-item-${t}`),n.setAttribute("data-fgp",t),e)this.fgpSummaryList.appendChild(r);else{let t=this.fgpSummaryList.querySelector("span.js-repository-inherit-label:not([hidden])")?.closest("li");t?this.fgpSummaryList.insertBefore(r,t):this.fgpSummaryList.appendChild(r)}o(this,v).size>=1&&(this.emptyState.hidden=!0,this.fgpSummaryList.hidden=!1)}}removeFromSummary(t){let e=h(this,A,I).call(this,t);e&&(o(this,v).delete(t),0===o(this,v).size&&(this.emptyState.hidden=!1,this.fgpSummaryList.hidden=!0),e.remove())}handleFgpChange(t){let e=t.currentTarget,i=e.value;e.checked?this.addToSummary(i):this.removeFromSummary(i),e.setAttribute("aria-checked",e.checked.toString()),this.searchInput.focus(),h(this,F,j).call(this)}constructor(...t){super(...t),u(this,y),u(this,k),u(this,w),u(this,E),u(this,A),u(this,L),u(this,x),u(this,C),u(this,F),l(this,p,{writable:!0,value:void 0}),l(this,m,{writable:!0,value:void 0}),l(this,f,{writable:!0,value:void 0}),l(this,b,{writable:!0,value:void 0}),l(this,v,{writable:!0,value:void 0}),l(this,g,{writable:!0,value:void 0}),l(this,S,{writable:!0,value:void 0}),c(this,f,{}),c(this,b,!1),c(this,v,new Set),c(this,g,async()=>{if(!this.src)throw Error("src attribute is required");let t=await fetch(this.src,{headers:{"X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw Error(`Failed to fetch FGP metadata: ${t.statusText}`);c(this,f,await t.json()),o(this,S).call(this)}),c(this,S,()=>{this.getAttribute("data-initial-base-role")&&this.handleRepoBaseRoleChange();let t=this.getAttribute("data-initial-edit-role-permissions");if(!t)return;let e=JSON.parse(t);for(let t of e)this.addToSummary(t),h(this,k,W).call(this,t);h(this,y,q).call(this,e),h(this,F,j).call(this)})}};function q(t){for(let e of this.resultList.querySelectorAll('input[type="checkbox"]'))!e.checked||e.disabled||t.includes(e.value)||this.addToSummary(e.value)}function W(t){let e=h(this,E,H).call(this,t);e&&(e.checked=!0)}function T(t){let e=h(this,E,H).call(this,t);e&&(e.checked=!1)}function H(t){return this.resultList.querySelector(`input[type="checkbox"][value="${t}"]`)}function I(t){return this.fgpSummaryList.querySelector(`#fgp-item-${t}`)}function M(t){let e=["read","triage","write","maintain","admin"],i=e.indexOf(t);for(let r of this.resultList.querySelectorAll('input[type="checkbox"]')){let s=r.value;"none"===t&&(this.removeFromSummary(s),r.checked=!1,r.disabled=!1);let a=o(this,f)[s];if(!a)continue;let n=a.base_role?a.base_role:"admin",l=e.indexOf(n);-1!==i&&l<=i?(r.checked=!0,r.disabled=!0,this.removeFromSummary(s),this.addToSummary(s,!0)):(r.disabled=!1,r.checked=!1,this.removeFromSummary(s))}}function O(){if(!o(this,m)){let t=document.querySelector("#fgp-summary-list-item-template");if(t)c(this,m,t);else throw Error("fgp-summary-list-item-template not found")}return o(this,m).content.cloneNode(!0)}function R(){return this.baseRoleSelect?this.baseRoleSelect.querySelector('button[aria-checked="true"]')?.getAttribute("data-value"):null}function j(){let t=document.querySelector(`#${this.fgpCounterId}`);t&&(t.textContent=o(this,v).size.toString())}d([r.aC],FgpSearchElement.prototype,"searchInput",void 0),d([r.aC],FgpSearchElement.prototype,"resultList",void 0),d([r.aC],FgpSearchElement.prototype,"emptyState",void 0),d([r.aC],FgpSearchElement.prototype,"fgpSummaryList",void 0),d([r.aC],FgpSearchElement.prototype,"baseRoleSelect",void 0),d([r.CF],FgpSearchElement.prototype,"src",void 0),d([r.CF],FgpSearchElement.prototype,"fgpCounterId",void 0),FgpSearchElement=d([r.p_],FgpSearchElement)},35908:(t,e,i)=>{i.d(e,{A:()=>Combobox});let Combobox=class Combobox{constructor(t,e,{tabInsertsSuggestions:i,firstOptionSelectionMode:r,scrollIntoViewOptions:a}={}){this.input=t,this.list=e,this.tabInsertsSuggestions=null==i||i,this.firstOptionSelectionMode=null!=r?r:"none",this.scrollIntoViewOptions=null!=a?a:{block:"nearest",inline:"nearest"},this.isComposing=!1,e.id||(e.id=`combobox-${Math.random().toString().slice(2,6)}`),this.ctrlBindings=!!navigator.userAgent.match(/Macintosh/),this.keyboardEventHandler=t=>(function(t,e){if(!t.shiftKey&&!t.metaKey&&!t.altKey&&(e.ctrlBindings||!t.ctrlKey)&&!e.isComposing)switch(t.key){case"Enter":s(e.input,e.list)&&t.preventDefault();break;case"Tab":e.tabInsertsSuggestions&&s(e.input,e.list)&&t.preventDefault();break;case"Escape":e.clearSelection();break;case"ArrowDown":e.navigate(1),t.preventDefault();break;case"ArrowUp":e.navigate(-1),t.preventDefault();break;case"n":e.ctrlBindings&&t.ctrlKey&&(e.navigate(1),t.preventDefault());break;case"p":e.ctrlBindings&&t.ctrlKey&&(e.navigate(-1),t.preventDefault());break;default:if(t.ctrlKey)break;e.resetSelection()}})(t,this),this.compositionEventHandler=t=>(function(t,e){e.isComposing="compositionstart"===t.type,document.getElementById(e.input.getAttribute("aria-controls")||"")&&e.clearSelection()})(t,this),this.inputHandler=this.clearSelection.bind(this),t.setAttribute("role","combobox"),t.setAttribute("aria-controls",e.id),t.setAttribute("aria-expanded","false"),t.setAttribute("aria-autocomplete","list"),t.setAttribute("aria-haspopup","listbox")}destroy(){this.clearSelection(),this.stop(),this.input.removeAttribute("role"),this.input.removeAttribute("aria-controls"),this.input.removeAttribute("aria-expanded"),this.input.removeAttribute("aria-autocomplete"),this.input.removeAttribute("aria-haspopup")}start(){this.input.setAttribute("aria-expanded","true"),this.input.addEventListener("compositionstart",this.compositionEventHandler),this.input.addEventListener("compositionend",this.compositionEventHandler),this.input.addEventListener("input",this.inputHandler),this.input.addEventListener("keydown",this.keyboardEventHandler),this.list.addEventListener("click",r),this.resetSelection()}stop(){this.clearSelection(),this.input.setAttribute("aria-expanded","false"),this.input.removeEventListener("compositionstart",this.compositionEventHandler),this.input.removeEventListener("compositionend",this.compositionEventHandler),this.input.removeEventListener("input",this.inputHandler),this.input.removeEventListener("keydown",this.keyboardEventHandler),this.list.removeEventListener("click",r)}indicateDefaultOption(){var t;"active"===this.firstOptionSelectionMode?null===(t=Array.from(this.list.querySelectorAll('[role="option"]:not([aria-disabled="true"])')).filter(a)[0])||void 0===t||t.setAttribute("data-combobox-option-default","true"):"selected"===this.firstOptionSelectionMode&&this.navigate(1)}navigate(t=1){let e=Array.from(this.list.querySelectorAll('[aria-selected="true"]')).filter(a)[0],i=Array.from(this.list.querySelectorAll('[role="option"]')).filter(a),r=i.indexOf(e);if(r===i.length-1&&1===t||0===r&&-1===t){this.clearSelection(),this.input.focus();return}let s=1===t?0:i.length-1;if(e&&r>=0){let e=r+t;e>=0&&e<i.length&&(s=e)}let n=i[s];if(n)for(let t of i)t.removeAttribute("data-combobox-option-default"),n===t?(this.input.setAttribute("aria-activedescendant",n.id),n.setAttribute("aria-selected","true"),function(t){t.dispatchEvent(new Event("combobox-select",{bubbles:!0}))}(n),n.scrollIntoView(this.scrollIntoViewOptions)):t.removeAttribute("aria-selected")}clearSelection(){for(let t of(this.input.removeAttribute("aria-activedescendant"),this.list.querySelectorAll('[aria-selected="true"], [data-combobox-option-default="true"]')))t.removeAttribute("aria-selected"),t.removeAttribute("data-combobox-option-default")}resetSelection(){this.clearSelection(),this.indicateDefaultOption()}};function r(t){if(!(t.target instanceof Element))return;let e=t.target.closest('[role="option"]');e&&"true"!==e.getAttribute("aria-disabled")&&function(t,e){t.dispatchEvent(new CustomEvent("combobox-commit",{bubbles:!0,detail:e}))}(e,{event:t})}function s(t,e){let i=e.querySelector('[aria-selected="true"], [data-combobox-option-default="true"]');return!!i&&("true"===i.getAttribute("aria-disabled")||(i.click(),!0))}function a(t){return!t.hidden&&!(t instanceof HTMLInputElement&&"hidden"===t.type)&&(t.offsetWidth>0||t.offsetHeight>0)}}}]);
//# sourceMappingURL=ui_packages_fgp-search-element_fgp-search-element_ts-fa1e969e7eaa.js.map