<%# erblint:counter DeprecatedInPrimerCounter 1 %>
<%# erblint:counter GoogleAnalyticsDeprecation 5 %>
<% if repositories.any? %>
  <% instrument_explore_page_view(
    user: current_user,
    visitor: current_visitor,
    view_context: :TRENDING_REPOSITORIES_CARD,
    visible_record_ids: { visible_trending_repository_ids: repositories.map(&:id) },
  ) %>

  <!--// Trending repos //-->
  <div class="Box color-shadow-small mb-4">
    <div class="Box-header d-flex">
      <span class="color-fg-muted tooltipped tooltipped-ne mr-2" aria-label="These results are generated by GitHub computers"><%# erblint:disable GitHub::Accessibility::NoAriaLabelMisuse, Primer::Accessibility::TooltippedMigration %>
        <%= primer_octicon(:telescope) %>
      </span>
      <h3 class="Box-title">
        <%= render(Primer::Beta::Link.new(
          href: trending_index_path,
          color: :default,
          data: explore_click_tracking_attributes(
            actor: current_user,
            click_context: :TRENDING_CARD,
            click_target: :TRENDING,
            click_visual_representation: :TRENDING_REPOSITORIES_HEADING,
            ga_click_text: "Explore, go to Trending, location:trending repositories box",
          ),
        )) do %>
          Trending repositories <span class="text-normal color-fg-muted">today</span>
        <% end %>
      </h3>
    </div>

    <div>
      <% repositories.each do |repository| %>
        <article class="Box-row">
          <a
            href="<%= stargazers_repository_path(repository.owner.display_login, repository.name) %>"
            class="float-right Link--secondary no-wrap mb-2 ml-2"
            data-ga-click="Explore, go to repository stargazers, location:trending repositories box"
          >
            <%= render Primer::Beta::Octicon.new(icon: "star", mt: 1, mr: 1) %>
            <%= social_count(repository.stargazer_count) %>
          </a>

          <div class="d-flex">
            <span><%= render Primer::Beta::Octicon.new(icon: "repo", mr: 2, color: :muted) %></span>
            <h4 class="f4 color-fg-muted text-normal lh-condensed Truncate" title="<%= repository.owner.display_login %>/<%= repository.name %>"><%# erblint:disable GitHub::Accessibility::NoTitleAttribute %>
              <%= render(Primer::Beta::Link.new(
                href: user_path(repository.owner),
                classes: "Truncate-text",
                data: explore_click_tracking_attributes(
                  actor: current_user,
                  click_context: :TRENDING_CARD,
                  click_target: :OWNER,
                  click_visual_representation: :REPOSITORY_OWNER_HEADING,
                  record_id: repository.owner.id,
                  ga_click_text: "Explore, go to repository owner, "\
                    "location:trending repositories box",
                ),
              )) do %>
                <%= repository.owner.display_login %>
              <% end %>
              <span class="Truncate-text Truncate-text--primary">
                /
                <%= render(Primer::Beta::Link.new(
                  style: "max-width: 240px",
                  href: repository_path(repository),
                  font_weight: :bold,
                  data: explore_click_tracking_attributes(
                    actor: current_user,
                    click_context: :TRENDING_CARD,
                    click_target: :REPOSITORY,
                    click_visual_representation: :REPOSITORY_NAME_HEADING,
                    record_id: repository.id,
                    ga_click_text: "Explore, go to repository, location:trending repositories box",
                  ),
                )) do %>
                  <%= repository.name %>
                <% end %>
              </span>
            </h4>
          </div>

          <p class="f6 color-fg-muted mt-2 mb-0">
            <% if repository.description.present? %>
              <%= repository.description.truncate(140, omission: '...') %>
            <% end %>
          </p>
        </article>
      <% end %>
    </div>

    <div class="Box-footer">
      <%= render(Primer::Beta::Link.new(
        href: trending_index_path,
        font_size: 6,
        data: explore_click_tracking_attributes(
          actor: current_user,
          click_context: :TRENDING_CARD,
          click_target: :TRENDING,
          click_visual_representation: :SEE_MORE_TRENDING_REPOSITORIES,
          ga_click_text: "Explore, go to Trending, location:trending repositories box",
        ),
      )) do %>
        See more trending repositories<%= primer_octicon(:"chevron-right", ml: 1) %>
      <% end %>
    </div>
  </div>
<% end %>
